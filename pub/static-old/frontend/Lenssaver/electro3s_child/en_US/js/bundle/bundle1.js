require.config({"config": {
        "jsbuild":{"Amasty_Stripe/js/view/payment/method-renderer/stripe-apple-pay.js":"/*\n * @author Amasty Team\n * @copyright Copyright (c) 2019 Amasty (https://www.amasty.com)\n * @package Amasty_Stripe\n */\n\n/* browser:true */\n/* global Stripe */\ndefine(\n    [\n        'jquery',\n        'Amasty_Stripe/js/view/payment/method-renderer/stripe-cc-form',\n        'Magento_Checkout/js/model/quote',\n        'mage/translate',\n        'Magento_Checkout/js/model/totals',\n        'Magento_Checkout/js/model/resource-url-manager',\n        'mage/storage',\n        'Magento_Checkout/js/action/redirect-on-success',\n        'Magento_Ui/js/model/messageList',\n        'mage/url',\n        'Magento_Checkout/js/model/full-screen-loader',\n        'Magento_CheckoutAgreements/js/model/agreement-validator',\n        'Magento_Checkout/js/model/payment/additional-validators',\n    ],\n    function (\n        $,\n        Component,\n        quote,\n        $t,\n        totals,\n        resourceUrlManager,\n        storage,\n        redirectOnSuccessAction,\n        messageList,\n        url,\n        fullScreenLoader,\n        agreementValidator,\n        additionalValidators\n    ) {\n        'use strict';\n\n        return Component.extend({\n            item: {\n                method: 'amasty_stripe'\n            },\n            selectedAddress: {},\n            selectedShippingMethod: '',\n            dataSecret: null,\n            paymentIntent: null,\n            paymentData: null,\n            defaults: {\n                template: 'Amasty_Stripe/payment/method-renderer/stripe-apple-pay',\n                source: null,\n                stripe: null,\n                pennyCurrencies: [\n                    'bif', 'djf', 'jpy', 'krw', 'pyg', 'vnd', 'xaf',\n                    'xpf', 'clp', 'gnf', 'kmf', 'mga', 'rwf', 'vuv', 'xof'\n                ]\n            },\n\n            /**\n             * @returns {exports.initialize}\n             */\n            initialize: function () {\n                this._super();\n\n                return this;\n            },\n\n            /**\n             * @returns {void}\n             */\n            initStripe: function () {\n                var config = window.checkoutConfig.payment[this._getCode()];\n\n                if (!config || !config.isApplePayEnabled) {\n                    return;\n                }\n\n                require([ config.sdkUrl ], function () {\n                    // Initialise Stripe\n                    this.stripe = Stripe(config.publicKey);\n\n                    // Initialise elements\n                    var elements = this.stripe.elements(),\n                        quoteTotals = quote.totals();\n\n                    this.paymentRequest = this.stripe.paymentRequest({\n                        country: quote.billingAddress().countryId,\n                        currency: quoteTotals.quote_currency_code.toLowerCase(),\n                        requestPayerName: true,\n                        requestPayerEmail: true,\n                        requestPayerPhone: false,\n                        requestShipping: false,\n                        total: {\n                            label: totals.getSegment('grand_total').title,\n                            amount: 0,\n                        },\n                        label: totals.getSegment('grand_total').title,\n                    });\n                    this._setPaymentDynamicData();\n\n                    var prButton = elements.create('paymentRequestButton', {\n                        paymentRequest: this.paymentRequest\n                    });\n\n                    // Check the availability of the Payment Request API first.\n                    this.paymentRequest.canMakePayment().then(function (result) {\n                        var button = document.getElementById('payment-request-button');\n\n                        if (result) {\n                            prButton.mount('#payment-request-button');\n                            button.insertAdjacentHTML(\n                                'afterend',\n                                '<div id=\"apple-pay-separator\" style=\"text-align: center; padding: 10px 0\">'\n                                    + $t('OR') + '</div>'\n                            );\n                            this._subscribeForSource()\n                                ._subscribeForQuoteChange()\n                                ._setPaymentDynamicData();\n\n                            prButton.on('click', function(event) {\n                                if (!this._validate()) {\n                                    event.preventDefault();\n                                }\n                            }.bind(this));\n                        } else {\n                            button.style.display = 'none';\n                        }\n                    }.bind(this));\n                }.bind(this));\n            },\n\n            /**\n             * @returns {this}\n             */\n            _decorateAddress: function () {\n                if (quote.shippingAddress()) {\n                    this.selectedAddress = {\n                        'street': quote.shippingAddress().street || [],\n                        'city': quote.shippingAddress().city || '',\n                        'region': quote.shippingAddress().region || '',\n                        'country_id': quote.shippingAddress().countryId || '',\n                        'postcode': quote.shippingAddress().postcode || '',\n                        'company': quote.shippingAddress().company || '',\n                        'telephone': quote.shippingAddress().telephone || '',\n                        'firstname': quote.shippingAddress().firstname || '',\n                        'lastname': quote.shippingAddress().lastname || ''\n                    };\n                }\n\n                return this;\n            },\n\n            /**\n             * Handle error from stripe\n             */\n            handleStripeError: function (result) {\n                var message = result.error.message;\n\n                if (result.error.type === 'validation_error') {\n                    if (!message) {\n                        message = $t('Please verify you card information.');\n                    }\n                }\n\n                messageList.addErrorMessage({\n                    message: message\n                });\n                this.dataSecret = null;\n                fullScreenLoader.stopLoader();\n                return;\n            },\n\n            /**\n             * @param {Object} event\n             * @returns {*}\n             */\n            getClientSecret: function (event) {\n                if (!this.dataSecret) {\n                    var self = this;\n\n                    return $.get(\n                        url.build('amstripe/checkout_paymentintents/data'),\n                        {\n                            form_key: $.cookie('form_key')\n                        },\n                        function (response) {\n                            if (response.success) {\n                                this.dataSecret = response.clientSecret;\n                                this.paymentIntent = response.paymentIntent;\n                            }\n\n                            if (response.error) {\n                                console.log(response);\n                                self.messageContainer.addErrorMessage({\n                                    message: response.message\n                                });\n                                fullScreenLoader.stopLoader();\n                            }\n                        }.bind(this),\n                        'json'\n                    );\n                }\n            },\n\n            /**\n             * @param result\n             * @returns {boolean|void}\n             */\n            processThreeDSecureV2: function (result) {\n                if (result.paymentIntent) {\n                    this.paymentData = result.paymentIntent;\n                }\n\n                if (result.error) {\n                    return this.handleStripeError(result);\n                } else {\n                    // set filled shipping fields because after paymentRequest 'paymentmethod' we have got full data\n                    this._decorateAddress();\n                    this.setSource(result.paymentIntent.id);\n                    this.isPlaceOrderActionAllowed(false);\n\n                    this.getPlaceOrderDeferredObject()\n                        .fail(\n                            function (result) {\n                                this.isPlaceOrderActionAllowed(true);\n                                result.complete('fail');\n\n                                this.handleStripeError({\n                                    error: {\n                                        type: 'validation_error'\n                                    }\n                                });\n                            }.bind(this)\n                        ).done(\n                        function () {\n                            this.afterPlaceOrder();\n\n                            if (this.redirectAfterPlaceOrder) {\n                                redirectOnSuccessAction.execute();\n                            }\n                        }.bind(this)\n                    );\n\n                    return true;\n                }\n            },\n\n            /**\n             * @returns {boolean}\n             * @private\n             */\n            _validate: function (ev) {\n                if (!this.validate(ev)) {\n                    if (ev) {\n                        ev.complete('fail');\n                    }\n\n                    this.handleStripeError({\n                        error: {\n                            type: 'validation_error',\n                            message: $t('Please complete all required fields before placing the order.')\n                        }\n                    });\n\n                    return false;\n                }\n\n                return true;\n            },\n\n            /**\n             * @returns {boolean}\n             * @private\n             */\n            _isAmRecurringQuote: function () {\n                return window.checkoutConfig.amastyRecurringConfig\n                    && window.checkoutConfig.amastyRecurringConfig.isRecurringProducts;\n            },\n\n            /**\n             * @returns {boolean}\n             * @private\n             */\n            _isSaveCardEnabled: function () {\n                return Component.defaults.saveCard();\n            },\n\n            /**\n             * @returns {this}\n             */\n            _subscribeForSource: function () {\n                this.paymentRequest.on('paymentmethod', function (ev) {\n                    fullScreenLoader.startLoader();\n\n                    if (!this._validate(ev)) {\n                        return this;\n                    }\n\n                    this.getClientSecret(ev).always(function () {\n                        this.stripe.confirmCardPayment(\n                            this.dataSecret,\n                            {\n                                payment_method: ev.paymentMethod.id,\n                                ...(this._isAmRecurringQuote() || this._isSaveCardEnabled()\n                                    ? { setup_future_usage: 'off_session' }\n                                    : {}\n                                )\n                            },\n                            { handleActions: false }\n                        ).then(function (confirmResult) {\n                                if (confirmResult.error) {\n                                    ev.complete('fail');\n                                } else {\n                                    ev.complete('success');\n                                    if (confirmResult.paymentIntent.status === \"requires_action\") {\n                                        // Let Stripe.js handle the rest of the payment flow.\n                                        this.stripe.confirmCardPayment(this.dataSecret).then(function (result) {\n                                            this.processThreeDSecureV2(result);\n                                        }.bind(this));\n                                    } else {\n                                        this.processThreeDSecureV2(confirmResult);\n                                    }\n                                }\n                            }.bind(this)\n                        );\n                    }.bind(this));\n                }.bind(this));\n\n                return this;\n            },\n\n            /**\n             * @returns {Object}\n             */\n            getData: function () {\n                var data = this._super();\n\n                data.additional_data = data.additional_data || {};\n                data.additional_data.apple_pay = JSON.stringify({\n                    selectedAddress: this.selectedAddress,\n                    selectedShippingMethod: this.selectedShippingMethod\n                });\n\n                if (!data.additional_data.payment_method && this.paymentData.payment_method) {\n                    data.additional_data.payment_method = this.paymentData.payment_method;\n                }\n\n                return data;\n            },\n\n            /**\n             * @returns {this}\n             */\n            _subscribeForQuoteChange: function () {\n                quote.totals.subscribe(this._setPaymentDynamicData.bind(this));\n\n                return this;\n            },\n\n            /**\n             * @returns {this}\n             */\n            _setPaymentDynamicData: function () {\n                var data = {\n                    total: {\n                        label: totals.getSegment('grand_total').title,\n                        amount: parseInt((this.getCorrectAmount(totals.getSegment('grand_total').value)), 10),\n                    },\n                    displayItems: this._decorateDisplayItems()\n                };\n\n                this.paymentRequest.update(data);\n\n                return this;\n            },\n\n            /**\n             * @returns {string}\n             */\n            _getCode: function () {\n                return 'amasty_stripe';\n            },\n\n            /**\n             * @returns {Object}\n             */\n            _decorateGrandTotal: function (displayItems) {\n                var total = {};\n\n                displayItems.forEach(function (item) {\n                    if (item.code === 'grand_total') {\n                        total.label = item.title;\n                        total.amount = this.getCorrectAmount(item.value);\n                    }\n                }.bind(this));\n\n                return total;\n            },\n\n            _decorateDisplayItemsResponse: function (displayItems) {\n                var resultArray = [];\n\n                displayItems.forEach(function (item) {\n                    resultArray.push({\n                        label: item.title,\n                        amount: this.getCorrectAmount(item.value)\n                    });\n                }.bind(this));\n\n                return resultArray;\n            },\n\n            /**\n             * @returns {Array}\n             */\n            _decorateDisplayItems: function (shippingPrice) {\n                var i,\n                    total,\n                    amount,\n                    resultArray = [];\n\n                if (!totals.totals()) {\n                    return resultArray;\n                }\n\n                for (i in totals.totals()['total_segments']) { // eslint-disable-line guard-for-in\n                    total = totals.totals()['total_segments'][i];\n\n                    if (!total.value && ['grand_total', 'shipping'].indexOf(total.code) === -1) {\n                        continue;\n                    }\n\n                    amount = this.getCorrectAmount(total.value);\n                    if(total.title == '' && total.code == 'shipping') {\n                        total.title = $t('Shipping');\n                    }\n                    resultArray.push({\n                        label: total.title,\n                        amount: parseInt(amount, 10),\n                        pending: total.code === 'shipping' && shippingPrice === undefined\n                    });\n                }\n\n                return resultArray;\n            },\n\n            /**\n             * @returns {Array}\n             */\n            _decorateShippingRates: function (rates) {\n                var decoratedRates = [];\n\n                rates.forEach(function (rate) {\n                    decoratedRates.push({\n                        id: rate['carrier_code'] + '|' + rate['method_code'],\n                        label: rate['carrier_title'] + ' - ' + rate['method_title'],\n                        amount: this.getCorrectAmount(rate['amount'])\n                    });\n                }.bind(this));\n\n                // set first shipping method as default\n                if (decoratedRates[0]) {\n                    this.selectedShippingMethod = decoratedRates[0].id;\n                }\n\n                return decoratedRates;\n            },\n\n            /**\n             * @param {Object} quote\n             * @return {*}\n             */\n            _getUrlForEstimationShippingMethods: function (quote) {\n                var params = {};\n\n                if (resourceUrlManager.getCheckoutMethod() == 'guest') {\n                    params = { quoteId: quote.getQuoteId() };\n                }\n\n                var urls = {\n                    'guest': '/guest-carts/:quoteId/estimate-shipping-methods-apple-pay',\n                    'customer': '/carts/mine/estimate-shipping-methods-apple-pay'\n                };\n\n                return resourceUrlManager.getUrl(urls, params);\n            },\n\n            /**\n             * @param {Object} quote\n             * @return {*}\n             */\n            _getUrlForSelectingShippingMethod: function (quote) {\n                var params = {};\n\n                if (resourceUrlManager.getCheckoutMethod() == 'guest') {\n                    params = { quoteId: quote.getQuoteId() };\n                }\n\n                var urls = {\n                    'guest': '/guest-carts/:quoteId/select-shipping-method-apple-pay',\n                    'customer': '/carts/mine/select-shipping-method-apple-pay'\n                };\n\n                return resourceUrlManager.getUrl(urls, params);\n            },\n\n            /**\n             * ApplePay requires to pass the price in cents\n             *\n             * @param float amount\n             * @returns {number}\n             */\n            getCorrectAmount: function (amount) {\n                var quoteTotals = quote.totals();\n\n                if (!this.pennyCurrencies.includes(quoteTotals.quote_currency_code.toLowerCase())) {\n                    amount = amount * 100;\n                }\n\n                return Math.round(amount);\n            },\n\n            validate: function()\n            {\n                if (agreementValidator.validate() && additionalValidators.validate())\n                    return true;\n\n                return false;\n            },\n        });\n    }\n);\n","Amasty_Stripe/js/view/payment/method-renderer/stripe-cc-form.js":"/* browser:true */\ndefine(\n    [\n        'underscore',\n        'jquery',\n        'ko',\n        'Magento_Checkout/js/view/payment/default',\n        'Amasty_Stripe/js/view/abstract-stripe',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Checkout/js/model/payment/additional-validators',\n        'Magento_Checkout/js/model/full-screen-loader',\n        'Magento_Customer/js/model/customer',\n        'mage/translate',\n        'Magento_Ui/js/model/messageList',\n        'mage/url',\n        'Magento_Checkout/js/action/redirect-on-success'\n    ],\n    function (\n        _,\n        $,\n        ko,\n        Component,\n        AbstractStripe,\n        quote,\n        additionalValidators,\n        fullScreenLoader,\n        customer,\n        $t,\n        messageList,\n        url\n    ) {\n        'use strict';\n\n        return Component.extend({\n            defaults: {\n                template: 'Amasty_Stripe/payment/form',\n                source: null,\n                paymentMethod: null,\n                isCustomerLoggedIn: customer.isLoggedIn,\n                abstractStripe: null,\n                dataSecret: null,\n                paymentIntent: null,\n                isPlaceOrderDisabled: ko.observable(false),\n                selectedCard: ko.observable('new-card'),\n                visible: ko.observable(function () {\n                    return this.selectedCard() === 'new-card';\n                }),\n                saveCard: ko.observable(false),\n                savedCards: ko.observable([]),\n                onBillingEmptyText: $t('Please update or cancel Billing Address Form.'),\n            },\n\n            initialize: function () {\n                this._super();\n                var config = window.checkoutConfig.payment[this.getCode()];\n\n                if (!config) {\n                    return;\n                }\n\n                this.savedCards(config.savedCards);\n                this.selectedCard.subscribe(function (newValue) {\n                    if (newValue === 'new-card') {\n                        this.visible(true);\n                    } else {\n                        this.visible(false);\n                    }\n                }.bind(this));\n            },\n\n            /**\n             * Initialize Stripe element\n             */\n            initStripe: function () {\n                var config = window.checkoutConfig.payment[this.getCode()];\n\n                if (!config) {\n                    return;\n                }\n\n                this.abstractStripe = AbstractStripe().initStripe(config.sdkUrl, config.publicKey);\n            },\n\n            /**\n             * Check if payment is active\n             *\n             * @returns {Boolean}\n             */\n            isActive: function () {\n                return this.getCode() === this.isChecked();\n            },\n\n            isSaveCardsEnable: function () {\n                return window.checkoutConfig.payment.amasty_stripe.enableSaveCards;\n            },\n\n            /**\n             * Return field's error message observable\n             */\n            getErrorMessageObserver: function () {\n                return AbstractStripe().getErrorMessageObserver();\n            },\n\n            /**\n             * Return field change event handler\n             */\n            onFieldChange: function () {\n                return AbstractStripe().onFieldChange();\n            },\n\n            isSavedCardsExist: function () {\n                return this.savedCards().length > 0;\n            },\n\n            /**\n             * Get data\n             *\n             * @returns {Object}\n             */\n            getData: function () {\n                var data = {\n                    'method': this.item.method,\n                    'additional_data': {\n                        'source': this.source,\n                        'payment_method': this.paymentMethod,\n                        'save_card': this.saveCard()\n                    }\n                };\n\n                return data;\n            },\n\n            /**\n             * Set source\n             *\n             * @param {String} source\n             */\n            setSource: function (source) {\n                this.source = source;\n            },\n\n            setPaymentMethod: function (paymentMethod) {\n                this.paymentMethod = paymentMethod;\n            },\n\n            getExpDate: function (savedCard) {\n                return AbstractStripe().getExpDate(savedCard);\n            },\n\n            getBrand: function (savedCard) {\n                return AbstractStripe().getBrand(savedCard);\n            },\n\n            getLast4: function (savedCard) {\n                return AbstractStripe().getLast4(savedCard);\n            },\n\n            getThreeDSecure: function (savedCard) {\n                return AbstractStripe().getThreeDSecure(savedCard);\n            },\n\n            getClass: function (savedCard) {\n                return AbstractStripe().getClass(savedCard);\n            },\n\n            getSourceId: function (savedCard) {\n                return AbstractStripe().getSourceId(savedCard);\n            },\n\n            /**\n             * Place the order\n             *\n             * @param {Object} data\n             */\n            placeOrderClick: function () {\n                fullScreenLoader.startLoader();\n\n                this.isPlaceOrderDisabled(true);\n\n                if (!this.validate() || !additionalValidators.validate()) {\n                    fullScreenLoader.stopLoader();\n                    this.isPlaceOrderDisabled(false);\n\n                    return false;\n                }\n\n                this.placeOrderAction();\n            },\n\n            /**\n             * Process order action\n             *\n             * @returns {boolean}\n             */\n            placeOrderAction: function () {\n                var config = window.checkoutConfig.payment[this.getCode()];\n\n                if (!this.abstractStripe.stripe || !this.abstractStripe.cardElement) {\n                    console.error('Stripe or CardElement not found');\n\n                    return false;\n                }\n\n                var cardData = {},\n                    billingAddress = quote.billingAddress();\n\n                if (billingAddress) {\n                    cardData.billing_details = {\n                        name: billingAddress.firstname + ' ' + billingAddress.lastname,\n                        address: {\n                            postal_code: billingAddress.postcode,\n                            country: billingAddress.countryId\n                        }\n                    };\n\n                    if (billingAddress.telephone) {\n                        cardData.billing_details.phone = billingAddress.telephone;\n                    }\n\n                    if (billingAddress.city) {\n                        cardData.billing_details.address.city = billingAddress.city;\n                    }\n\n                    if (billingAddress.region) {\n                        cardData.billing_details.address.state = billingAddress.region;\n                    }\n\n                    if (billingAddress.street && billingAddress.street[0]) {\n                        cardData.billing_details.address.line1 = billingAddress.street[0];\n\n                        if (billingAddress.street[1]) {\n                            cardData.billing_details.address.line2 = billingAddress.street[1];\n                        }\n                    }\n\n                    cardData.metadata = { saveCard: this.saveCard() };\n                } else {\n                    return this.handleStripeError({ error: { message: this.onBillingEmptyText }});\n                }\n\n                var cardDataSecret = {\n                        payment_method_data: {\n                            billing_details: {\n                                name: billingAddress.firstname + ' ' + billingAddress.lastname,\n                                address: {\n                                    line1: billingAddress.street[0],\n                                    line2: billingAddress.street[1],\n                                    city: billingAddress.city,\n                                    postal_code: billingAddress.postcode,\n                                    country: billingAddress.countryId,\n                                    state: billingAddress.region\n                                }\n                            }\n                        }\n                    },\n\n                    selectedCardData = null;\n\n                if (this.selectedCard() && this.selectedCard() !== 'new-card') {\n                    cardDataSecret = {\n                        payment_method: this.selectedCard()\n                    };\n                    selectedCardData = this.selectedCard();\n                }\n\n                this.createPaymentMethod(cardData).done(\n                    function () {\n                        this.getClientSecret().done(\n                            function () {\n                                this.threeDSecureProcess(this.paymentIntent, cardDataSecret, selectedCardData, cardData);\n                            }.bind(this)\n                        );\n                    }.bind(this)\n                ).fail(\n                    function () {\n                        fullScreenLoader.stopLoader();\n                        this.isPlaceOrderDisabled(false);\n                    }.bind(this)\n                );\n            },\n\n            /**\n             * Save new payment method\n             *\n             * @param cardData\n             */\n            createPaymentMethod: function (cardData) {\n                var deferred = $.Deferred();\n\n                this.abstractStripe.stripe.createPaymentMethod('card', this.abstractStripe.cardElement, cardData).then(function (result) {\n                    if (result.paymentMethod) {\n                        var token = result.paymentMethod.id + ':' + result.paymentMethod.card.brand + ':' + result.paymentMethod.card.last4;\n                        this.setPaymentMethod(token);\n                        deferred.resolve();\n                    } else if (result.error) {\n\n                        if (this.selectedCard() && this.selectedCard() !== 'new-card') {\n                            deferred.resolve();\n                        } else {\n                            messageList.addErrorMessage({\n                                message: result.error.message\n                            });\n                            console.log(result.error.message);\n                            deferred.reject();\n                        }\n                    }\n                }.bind(this));\n\n                return deferred.promise();\n            },\n\n            /**\n             * Create payment intent and get client Secret\n             */\n            getClientSecret: function () {\n                var self = this,\n                    deferred = $.Deferred();\n\n                $.get(\n                    url.build('amstripe/checkout_paymentintents/data'),\n                    {\n                        form_key: $.cookie('form_key')\n                    },\n                    function (response) {\n                        if (response.success) {\n                            this.dataSecret = response.clientSecret;\n                            this.paymentIntent = response.paymentIntent;\n                            deferred.resolve();\n                        }\n\n                        if (response.error) {\n                            console.log(response);\n                            self.messageContainer.addErrorMessage({\n                                message: response.message\n                            });\n                            fullScreenLoader.stopLoader();\n                            this.isPlaceOrderDisabled(false);\n                            deferred.reject();\n                        }\n                    }.bind(this),\n                    'json'\n                );\n\n                return deferred.promise();\n            },\n\n            /**\n             * Processing with three D secure V2\n             * @param sourceId\n             * @param {Object} cardDataSecret\n             * @param selectedCardData\n             * @param cardData\n             */\n            threeDSecureProcess: function (sourceId, cardDataSecret, selectedCardData, cardData) {\n                const paymentMethodData = this.collectConfirmData(sourceId, cardDataSecret, selectedCardData, cardData);\n\n                this.abstractStripe.stripe.confirmCardPayment(this.dataSecret, paymentMethodData).then(function (result) {\n                    if (result.error) {\n                        return this.handleStripeError(result);\n                    }\n\n                    return this.handleStripeSuccess(result, selectedCardData, cardData);\n                }.bind(this));\n            },\n\n            /**\n             * @param sourceId\n             * @param {Object} cardDataSecret\n             * @param selectedCardData\n             * @param cardData\n             */\n            collectConfirmData: function (sourceId, cardDataSecret, selectedCardData, cardData) {\n                if (this.selectedCard() && this.selectedCard() !== 'new-card') {\n                    return cardDataSecret;\n                }\n\n                return {\n                    payment_method: {\n                        card: this.abstractStripe.cardElement,\n                        billing_details: cardDataSecret.payment_method_data.billing_details\n                    }\n                };\n            },\n\n            /**\n             * Handle success from stripe\n             */\n            handleStripeSuccess: function (result, selectedCardData, cardData) {\n                if (!result.paymentIntent) {\n                    this.setSource(result.source.id);\n                } else {\n                    this.setSource(result.paymentIntent.id);\n\n                    if (this.selectedCard() && this.selectedCard() !== 'new-card') {\n                        this.setPaymentMethod(this.selectedCard());\n                    }\n                }\n\n                fullScreenLoader.stopLoader();\n                this.isPlaceOrderDisabled(false);\n                this.placeOrder();\n            },\n\n            /**\n             * Handle error from stripe\n             */\n            handleStripeError: function (result) {\n                var message = result.error.message;\n\n                if (result.error.type == 'validation_error') {\n                    message = $t('Please verify you card information.');\n                }\n\n                messageList.addErrorMessage({\n                    message: message\n                });\n                fullScreenLoader.stopLoader();\n                this.isPlaceOrderDisabled(false);\n            },\n\n            getImageStripe: function () {\n                var imageUrl = window.checkoutConfig.payment.amasty_stripe.imageUrl;\n\n                return imageUrl;\n            }\n        });\n    }\n);\n","Magento_PaymentServicesPaypal/js/order-review.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'uiComponent',\n    'Magento_Customer/js/customer-data'\n], function ($, Component, customerData) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            element: null,\n            placeOrderButtonSelector: '#review-button',\n            shippingMethodFormSelector: '#shipping-method-form',\n            shippingMethodInputSelector: '#shipping-method',\n            updateContainerSelector: '#details-reload',\n            waitLoadingContainer: '#review-please-wait',\n            orderFormSelector: '#order-review-form',\n            editShoppingCartSelector: '.magento-payments-review-items .edit',\n            updateShippingMethodUrl: null,\n            placeOrderUrl: null,\n            canEditShippingMethod: false,\n            isVirtual: false\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            this._super();\n            this.element = element;\n\n            $(this.placeOrderButtonSelector).on('click', this.submitOrder.bind(this));\n            $(this.editShoppingCartSelector).on('click', this.invalidateCustomerData.bind(this));\n\n            if (!this.isVirtual && this.canEditShippingMethod) {\n                $(this.shippingMethodInputSelector).on('change', this.selectShippingMethod.bind(this));\n                this.setPlaceOrderButtonActive(!!$(this.shippingMethodInputSelector).val());\n            }\n        },\n\n        invalidateCustomerData: function () {\n            customerData.invalidate(['cart']);\n        },\n\n        /**\n         * Before request start\n         */\n        beforeRequestStart: function () {\n            $(this.waitLoadingContainer).show();\n        },\n\n        /**\n         * On request complete\n         */\n        onRequestComplete: function () {\n            $(this.waitLoadingContainer).hide();\n        },\n\n        /**\n         * Submit order\n         */\n        submitOrder: function () {\n            if (this.validateForm()) {\n                this.beforeRequestStart();\n                $(this.orderFormSelector).trigger('submit');\n                this.setPlaceOrderButtonActive(false);\n            }\n        },\n\n        /**\n         * Validate form\n         */\n        validateForm: function () {\n            return $(this.element).validation().valid();\n        },\n\n        /**\n         * Enable/disable order button\n         *\n         * @param {Boolean} isActive\n         */\n        setPlaceOrderButtonActive: function (isActive) {\n            $(this.placeOrderButtonSelector).prop('disabled', !isActive).toggleClass('no-checkout', !isActive);\n        },\n\n        /**\n         * Select shipping method\n         */\n        selectShippingMethod: function () {\n            var shippingMethod,\n                formData,\n                responseCallback;\n\n            if ($(this.waitLoadingContainer).is(':visible')) {\n                return false;\n            }\n            shippingMethod = $(this.shippingMethodInputSelector).val();\n            shippingMethod = shippingMethod.trim();\n            this.setPlaceOrderButtonActive(false);\n\n            if (shippingMethod) {\n                formData = $(this.shippingMethodFormSelector).serialize() + '&isAjax=true';\n\n                /**\n                 * @param {Object} response\n                 */\n                responseCallback = function (response) {\n                    if (typeof response.redirectUrl == 'undefined') {\n                        $(this.updateContainerSelector).html(response.html);\n                    } else {\n                        window.location = response.redirectUrl;\n                    }\n                    this.setPlaceOrderButtonActive(true);\n                    this.onRequestComplete();\n                };\n                $.ajax({\n                    url: this.updateShippingMethodUrl,\n                    type: 'post',\n                    context: this,\n                    beforeSend: this.beforeRequestStart,\n                    data: formData,\n                    success: responseCallback\n                });\n            }\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/helpers/get-allowed-locations.js":"define(['uiRegistry'], function (uiRegistry) {\n    'use strict';\n\n    /**\n     * Get the available list of countries as defined in configuration.\n     *\n     * @returns {Array}\n     */\n    return function () {\n        const countries = uiRegistry.get('checkoutProvider').get('dictionaries.country_id'),\n            allowedLocations = countries.map(({ value }) => value).filter((value) => value && value !== 'delimiter');\n\n        return allowedLocations;\n    };\n});\n","Magento_PaymentServicesPaypal/js/helpers/get-street-line-count.js":"define(['uiRegistry'], function (uiRegistry) {\n    'use strict';\n\n    /**\n     * Returns the integer count of the number of street lines available on a customer address.\n     *\n     * @returns {number}\n     */\n    return function () {\n        const shippingAddress = uiRegistry.get('checkout.steps.shipping-step.shippingAddress');\n        return Object.values(shippingAddress.source.shippingAddress.street).length;\n    };\n});\n","Magento_PaymentServicesPaypal/js/helpers/remove-paypal-url-token.js":"define(function () {\n    'use strict';\n\n    return function () {\n            // Remove the URL hash token to prevent refreshes trying to resume the same payment.\n            const params = new URLSearchParams(window.location.search);\n            params.delete('token');\n            window.history.replaceState('', document.title, window.location.pathname + '?' + params.toString());\n    };\n});\n","Magento_PaymentServicesPaypal/js/helpers/map-address-to-magento.js":"define([\n    'Magento_Checkout/js/model/new-customer-address',\n    'Magento_PaymentServicesPaypal/js/helpers/get-allowed-locations',\n    'Magento_PaymentServicesPaypal/js/helpers/get-street-line-count',\n    'Magento_PaymentServicesPaypal/js/helpers/get-region-id'\n], function (Address, getAllowedLocations, getStreetLineCount, getRegionId) {\n    'use strict';\n\n    /**\n     * Creates an array of empty strings with the length being the set street lines for a customer address.\n     *\n     * @returns {Array}\n     */\n    const createEmptyStreetArray = () => {\n        const streetLines = getStreetLineCount();\n        return Array.apply(null, Array(streetLines))\n            .reduce((prev, curr, index) => { prev[index] = ''; return prev; }, {});\n    };\n\n    /**\n     * Fastlane provides an address object that isn't in the correct Adobe Commerce format so map it to the\n     * correct format.\n     *\n     * @param {Object} address - An address object as gathered from Fastlane.\n     * @returns {Object} - A correctly mapped address using 'Magento_Checkout/js/model/new-customer-address' model.\n     */\n    return function (address) {\n        const street = createEmptyStreetArray();\n\n        street[0] = address.address.addressLine1 || address.address.streetAddress;\n\n        if (address.address.addressLine2 || address.address.extendedAddress) {\n            street[1] = address.address.addressLine2 || address.address.extendedAddress;\n        }\n\n        const mappedAddress = Address({\n                region: {\n                    region_id: getRegionId(\n                        address.address.countryCode || address.address.countryCodeAlpha2,\n                        address.address.adminArea1 || address.address.region\n                    ),\n                    region_code: address.address.adminArea1 || address.address.region,\n                    region: address.address.adminArea1 || address.address.region\n                },\n                company: address.address.company || '',\n                country_id: address.address.countryCode || address.address.countryCodeAlpha2,\n                street,\n                firstname: address.name?.firstName || '',\n                lastname: address.name?.lastName || '',\n                city: address.address.adminArea2 || address.address.locality,\n                telephone: address.phoneNumber?.nationalNumber || '00000000000',\n                postcode: address.address.postalCode\n            }),\n            allowedLocations = getAllowedLocations();\n\n        mappedAddress.country_id = mappedAddress.countryId;\n        mappedAddress.region_code = mappedAddress.regionCode;\n        mappedAddress.region_id = mappedAddress.regionId;\n        mappedAddress.street = street;\n\n        // If the country / region isn't available on this website then throw an error.\n        if (!allowedLocations.includes(mappedAddress.countryId)) {\n            const error = new Error();\n\n            error.name = 'paypal_fastlane:address_unavailable';\n            throw error;\n        }\n\n        return mappedAddress;\n    };\n});\n","Magento_PaymentServicesPaypal/js/helpers/is-fastlane-available.js":"define(['Magento_Customer/js/model/customer'], function (customer) {\n    'use strict';\n\n    /**\n     * Small helper to check if Fastlane is enabled and the User is NOT logged in.\n     *\n     * @retuns {boolean}\n     */\n    return function () {\n        return window.checkoutConfig.payment.payment_services_paypal_fastlane?.isVisible && !customer.isLoggedIn();\n    };\n});\n","Magento_PaymentServicesPaypal/js/helpers/map-address-to-fastlane.js":"define(function () {\n    'use strict';\n\n    /**\n     * Formats an address object back to the format expected by Fastlane.\n     *\n     * @param {Object} address - Address that ideally is a 'Magento_Checkout/js/model/new-customer-address' object.\n     * @returns {Object} - A correctly mapped address that is expected by Fastlane.\n     */\n    return function (address) {\n        const formattedAddress = {\n            firstName: address.firstname,\n            lastName: address.lastname,\n            company: address.company,\n            locality: address.city,\n            region: address.regionCode,\n            postalCode: address.postcode,\n            countryCodeAlpha2: address.countryId,\n            phoneNumber: address.telephone\n        };\n\n        // Street needs a little bit of extra work because it can be more than two lines.\n        formattedAddress.streetAddress =  address.street?.[0];\n\n        // If there is a second line available then join all of the remaining array properties together.\n        if (address.street?.[1]) {\n            formattedAddress.extendedAddress = address.street.slice(1).join(', ');\n        }\n\n        return formattedAddress;\n    };\n});\n","Magento_PaymentServicesPaypal/js/helpers/get-region-id.js":"define(['Magento_Customer/js/customer-data'], function (customerData) {\n    'use strict';\n\n    /**\n     * Converts a region string into the associated region ID.\n     *\n     * @returns {number}\n     */\n    return function (countryCode, administrativeArea) {\n        const countryData = customerData.get('directory-data')(),\n            country = countryData[countryCode];\n\n            if (country?.regions) {\n                const regionIds = Object.keys(country.regions);\n\n                return regionIds.find((regionId) => {\n                    return country.regions[regionId].code === administrativeArea;\n                }) || 0;\n            }\n\n            return 0;\n    };\n});\n","Magento_PaymentServicesPaypal/js/view/shipping-mixin.js":"define(function () {\n    'use strict';\n\n    var mixin = {\n        /**\n         * When changing the shipping method store it within checkoutConfig to support PayPal app switch.\n         *\n         * @param {*} shippingMethod\n         */\n        selectShippingMethod: function (shippingMethod) {\n            this._super(shippingMethod);\n\n            window.checkoutConfig.selectedShippingMethod = shippingMethod;\n        },\n    };\n\n    return function (shipping) {\n        return shipping.extend(mixin);\n    };\n});\n","Magento_PaymentServicesPaypal/js/view/shipping-information-mixin.js":"define([\n    'Magento_PaymentServicesPaypal/js/helpers/is-fastlane-available',\n    'Magento_PaymentServicesPaypal/js/view/payment/fastlane'\n], function (isFastlaneAvailable, fastlaneModel) {\n    'use strict';\n\n    var mixin = {\n        initialize: function () {\n            this._super();\n\n            // Early return if Fastlane is not available\n            if (!isFastlaneAvailable()) {\n                return;\n            }\n\n            fastlaneModel.setup();\n\n            return this;\n        },\n\n        /**\n         * Override the core back behaviour to call Fastlane if required.\n         */\n        back: function () {\n            if (fastlaneModel.profileData()) {\n                fastlaneModel.displayChangeShipping();\n            } else {\n                this._super();\n            }\n        }\n    };\n\n    return function (shippingInformation) {\n        return shippingInformation.extend(mixin);\n    };\n});\n","Magento_PaymentServicesPaypal/js/view/payment/apple-pay-cart.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'jquery',\n    'mageUtils',\n    'Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/apple-pay',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/cart/totals-processor/default',\n    'Magento_Customer/js/model/customer',\n], function (_, $, utils, Component, $t, customerData, ResponseError, ApplePayButton, quote, totalsProcessor, customer) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalApplePay',\n            sdkParamsKey: 'applepay',\n            buttonContainerId: 'apple-pay-${ $.uid }',\n            paymentActionError: $t('Something went wrong with your request. Please try again later.'),\n            isErrorDisplayed: false\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            _.bindAll(this, 'initApplePayButton', 'onClick', 'afterOnAuthorize',  'afterCreateOrder', 'showPopup', 'cancelApplePay');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.element = element;\n            this.element.id = this.buttonContainerId;\n\n            this.getSdkParams()\n                .then(this.initApplePayButton)\n                .catch(console.log);\n\n            return this;\n        },\n\n        initApplePayButton: function () {\n            this.applePayButton = new ApplePayButton({\n                scriptParams: this.sdkParams,\n                createOrderUrl: this.createOrderUrl,\n                estimateShippingMethodsWhenLoggedInUrl: this.estimateShippingMethodsWhenLoggedInUrl,\n                estimateShippingMethodsWhenGuestUrl: this.estimateShippingMethodsWhenGuestUrl,\n                shippingInformationWhenLoggedInUrl: this.shippingInformationWhenLoggedInUrl,\n                shippingInformationWhenGuestUrl: this.shippingInformationWhenGuestUrl,\n                updatePaypalOrderUrl: this.updatePaypalOrderUrl,\n                countriesUrl: this.countriesUrl,\n                placeOrderUrl: this.placeOrderUrl,\n                showPopup: this.showPopup,\n                updateQuoteUrl: this.authorizeOrderUrl,\n                onClick: this.onClick,\n                afterCreateOrder: this.afterCreateOrder,\n                catchCreateOrder: this.catchError,\n                onError: this.catchError,\n                buttonContainerId: this.buttonContainerId,\n                afterOnAuthorize: this.afterOnAuthorize,\n                shippingAddressRequired: !this.isVirtual,\n                styles: this.styles,\n                location: this.pageType,\n            });\n\n            $('#' + this.buttonContainerId).on('click', this.onClick);\n\n            this.applePayButton.sdkLoaded\n                .then(this.applePayButton.initAppleSDK);\n        },\n\n        afterOnAuthorize: function (data) {\n\n            this.applePayButton.showLoaderAsync(true)\n            .then(() => {\n                fetch(this.placeOrderUrl, {\n                    method: 'POST'\n                }).then(response => {\n                    if (response.redirected && response.url.includes(\"review\")) {\n                        throw new Error();\n                    }\n                    return response.text();\n                }).then(result => {\n                    if (result) {\n                        customerData.invalidate(['cart']);\n                        document.open();\n                        document.write(result);\n                        document.close();\n                    }\n                })\n                    .catch(error => {\n                        this.applePayButton.showLoader(false);\n                        this.applePayButton.catchError(error);\n                    });\n            })\n            .catch(error => {\n                this.catchError(error);\n            });\n        },\n\n        onClick: function () {\n            // Reload customer data to use correct loggedin/guest urls in the applepay button\n            // See smart_buttons_minicart.phtml:21-22\n            if (this.location === 'minicart') {\n                this.fixCustomerData();\n            }\n\n            // Show popup with initial order amount from window.checkoutConfig\n            // See smart_buttons_minicart.phtml:20\n            this.applePayButton.showLoaderAsync(true).then(() => {\n                const data = {\n                    response: {\n                        'paypal-order': {\n                            currency_code: window.checkoutConfig.quoteData.base_currency_code,\n                            amount: window.checkoutConfig.quoteData.grand_total.toString(),\n                        }\n                    }\n                }\n                this.applePayButton.showPopup(data);\n            })\n\n            this.isErrorDisplayed = false;\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {\n            if (data.response['paypal-order'] && data.response['paypal-order']['mp_order_id']) {\n                this.paymentsOrderId = data.response['paypal-order']['mp_order_id'];\n                this.paypalOrderId = data.response['paypal-order'].id;\n                return this.paypalOrderId;\n            }\n\n            throw new Error();\n        },\n\n        cancelApplePay: function (){\n            customerData.invalidate(['cart']);\n            window.location.reload();\n        },\n\n        showPopup: function (paymentData) {\n            const paymentRequest = {\n                countryCode: this.applePayButton.applePayConfig.countryCode,\n                merchantCapabilities: this.applePayButton.applePayConfig.merchantCapabilities,\n                supportedNetworks: this.applePayButton.applePayConfig.supportedNetworks,\n                currencyCode: paymentData.response['paypal-order']['currency_code'],\n                requiredShippingContactFields: [\"name\", \"phone\", \"email\", \"postalAddress\"],\n                requiredBillingContactFields: [\"postalAddress\"],\n                total: {\n                    label: $t(\"Summary\"),\n                    type: \"final\",\n                    amount: Number(paymentData.response['paypal-order']['amount']).toString(),\n                }\n            };\n\n            // See https://developer.apple.com/documentation/apple_pay_on_the_web/applepaysession\n            this.applePaySession = new ApplePaySession(this.applePayButton.applePayVersionNumber, paymentRequest);\n\n            this.applePayButton.onApplePayValidateMerchant(this.applePaySession);\n            this.applePayButton.onApplePayCancel(this.applePaySession, this.cancelApplePay);\n            this.applePayButton.onApplePayShippingContactSelected(this.applePaySession, quote.getQuoteId() , paymentRequest.total, quote.isVirtual());\n            this.applePayButton.onApplePayShippingMethodSelectedInCartPage(this.applePaySession, quote.getQuoteId());\n            this.applePayButton.onApplePayPaymentAuthorized(this.applePaySession);\n\n            this.applePaySession.begin();\n        },\n\n        /**\n         * Fix customer data\n         *\n         * Why do we need this?\n         * See: src/app/code/Magento/Customer/view/frontend/web/js/model/customer.js:17\n         *\n         * When we initialise customer data on the page where the minicart was not rendered yet,\n         * the customer data in the \"window\" object is 'undefined' at first because . This makes this line\n         *      var isLoggedIn = ko.observable(window.isCustomerLoggedIn),\n         * to create an observable of undefined variable, that does not work in knockout.\n         * knockout expects an existing variable to create an observable.\n         *\n         * Later, when we render minicart and update \"window\" object with customer data,\n         * it's not being picked up by customer.js logic and when try to read the data, it's still undefined,\n         * even though it exists in the \"window\" object.\n         *\n         * This function forces the customer data to be updated from the \"window\" object.\n         */\n        fixCustomerData: function () {\n            if (customer.isLoggedIn() === undefined && window.isCustomerLoggedIn !== undefined) {\n                customer.setIsLoggedIn(window.isCustomerLoggedIn);\n            }\n\n            if (customer.isLoggedIn() && _.isEmpty(customer.customerData)) {\n                customer.customerData = window.customerData;\n            }\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/smart-buttons-product.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'jquery',\n    'mageUtils',\n    'scriptLoader',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/smart-buttons',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/helpers/remove-paypal-url-token',\n    'Magento_PaymentServicesPaypal/js/model/app-switch-data',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'jquery/jquery-storageapi'\n], function (_, $, utils, loadSdkScript, Component, $t, customerData,\n    removePayPalUrlToken, appSwitchDataModel, ResponseError) {\n    'use strict';\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url\n            }\n        );\n    };\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalProduct',\n            buttonsContainerId: 'smart-buttons-${ $.uid }',\n            element: null,\n            productFormSelector: '#product_addtocart_form',\n            formInvalid: false,\n            paymentActionError: $t('Something went wrong with your request. Please try again later.'),\n            addToCartUrl: null,\n            isErrorDisplayed: false\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            _.bindAll(this, 'renderButtons', 'onClick', 'onError', 'beforeCreateOrder',\n                'afterCreateOrder', 'beforeOnAuthorize', 'onCancel');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.element = element;\n            this.element.id = this.buttonsContainerId;\n            this.sdkLoaded = this.getSdkParams().then(() => {\n                return loadSdkScript(this.sdkParams, this.sdkNamespace).then((sdkScript) => {\n                    this.paypal = sdkScript;\n                });\n            });\n            this.renderButtons();\n\n            return this;\n        },\n\n        /**\n         * Render buttons\n         */\n        renderButtons: function () {\n            if (!this.sdkLoaded) {\n                return;\n            }\n\n            this.sdkLoaded.then(function () {\n                let containerSelector = '#' + this.buttonsContainerId;\n\n                if ($(containerSelector).length > 0) {\n                    this.setup(containerSelector);\n                    this.render();\n                } else {\n                    console.warn('PayPal button container not found:', containerSelector);\n                }\n            }.bind(this)).catch(function () {\n                console.log('Error: Failed to load PayPal SDK script!');\n            });\n        },\n\n        /**\n         * Show/hide loader.\n         *\n         * @param {Boolean} show\n         */\n        showLoader: function (show) {\n            let event = show ? 'processStart' : 'processStop';\n\n            $('body').trigger(event);\n        },\n\n        /**\n         * Add error handing to catch errors with authorizing the order.\n         *\n         * @param {*} error\n         */\n        catchOnAuthorize: function (error) {\n            this.onError(error);\n        },\n\n        /**\n         * Add error handling to catch errors on creating the order.\n         *\n         * @param {*} error\n         */\n        catchCreateOrder: function (error) {\n            this.onError(error);\n        },\n\n        /**\n         * Catch errors.\n         *\n         * @param {*} error\n         */\n        onError: function (error) {\n            removePayPalUrlToken();\n\n            this.render(this.element);\n\n            let message = error instanceof ResponseError ? error.message : this.paymentActionError;\n\n            this.showLoader(false);\n\n            if (this.isErrorDisplayed) {\n                return;\n            }\n            this.addMessage(message);\n            this.isErrorDisplayed = true;\n        },\n\n        /**\n         * Add message to customer data.\n         *\n         * @param {String} message\n         * @param {String} [type]\n         */\n        addMessage: function (message, type) {\n            type = type || 'error';\n            customerData.set('messages', {\n                messages: [{\n                    type: type,\n                    text: message\n                }],\n                'data_id': Math.floor(Date.now() / 1000)\n            });\n        },\n\n        /**\n         * Calls when user click PayPal button\n         *\n         * @param {Object} data\n         * @param {Promise} actions\n         * @return {Promise}\n         */\n        onClick: function (data, actions) {\n            let productForm = $(this.productFormSelector);\n\n            if (productForm.data('mageValidation')) {\n                this.formInvalid = !productForm.validation('isValid');\n            }\n\n            if (this.formInvalid) {\n                return actions.reject();\n            }\n\n            appSwitchDataModel.setData('pageType', this.pageType);\n\n            return actions.resolve();\n        },\n\n        /**\n         * Set quote created from PDP as Inactive\n         */\n        setQuoteInactive: function () {\n            // Set Quote as inactive to avoid having multiple active quotes for the customer\n            return $.ajax({\n                type: 'POST',\n                url: this.setQuoteAsInactiveUrl\n            });\n        },\n\n        /**\n         * Before create order.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            this.isErrorDisplayed = false;\n            this.showLoader(true);\n\n            return new Promise(function (resolve, reject) {\n                if (this.formInvalid) {\n                    return reject();\n                }\n\n                fetch(this.addToCartUrl, {\n                    method: 'POST',\n                    headers: {},\n                    body: new FormData($(this.productFormSelector)[0]),\n                    credentials: 'same-origin'\n                }).then(function (response) {\n                    return response.json();\n                }).then(function (data) {\n                    if (typeof data.success !== 'undefined') {\n                        refreshCustomerData(this.addToCartUrl);\n\n                        return resolve();\n                    }\n\n                    return reject(new ResponseError(data.error));\n                }.bind(this)).catch(function () {\n                    return reject();\n                });\n            }.bind(this));\n        },\n\n        /**\n         * After order id created.\n         *\n         * @param {Object} res\n         * @return {*}\n         */\n        afterCreateOrder: function (res) {\n            if (res.response['is_successful']) {\n                refreshCustomerData(this.createOrderUrl);\n\n                return res.response['paypal-order'].id;\n            }\n\n            throw new ResponseError(res.response.error);\n        },\n\n        /**\n         * Before onAuthorize execute\n         *\n         * @param {Object} data\n         * @return {Promise}\n         */\n        beforeOnAuthorize: function (data) {\n            this.showLoader(true);\n\n            return Promise.resolve(data);\n        },\n\n        /**\n         * Set the quote inactive on cancel\n         */\n        onCancel: function () {\n            removePayPalUrlToken();\n\n            this.render(this.element);\n\n            this.setQuoteInactive()\n                .always(() => {\n                    this.showLoader(false);\n                });\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/google-pay-cart.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'jquery',\n    'mageUtils',\n    'Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/google-pay'\n], function (_, $, utils, Component, $t, customerData, ResponseError, GooglePayButton) {\n    'use strict';\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url,\n            }\n        );\n    }\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalGooglePay',\n            sdkParamsKey: 'googlepay',\n            buttonContainerId: 'google-pay-${ $.uid }',\n            paymentActionError: $t('Something went wrong with your request. Please try again later.'),\n            isErrorDisplayed: false\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            _.bindAll(this, 'initGooglePayButton', 'onClick',\n                'afterOnAuthorize', 'catchError', 'onCancel');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.element = element;\n            this.element.id = this.buttonContainerId;\n            this.getSdkParams()\n                .then(this.initGooglePayButton)\n                .catch(console.log);\n\n            return this;\n        },\n\n        initGooglePayButton: function () {\n            this.googlePayButton = new GooglePayButton({\n                scriptParams: this.sdkParams,\n                createOrderUrl: this.createOrderUrl,\n                updateQuoteUrl: this.authorizeOrderUrl,\n                onClick: this.onClick,\n                catchCreateOrder: this.catchError,\n                onError: this.catchError,\n                buttonContainerId: this.buttonContainerId,\n                afterOnAuthorize: this.afterOnAuthorize,\n                shippingAddressRequired: !this.isVirtual,\n                styles: this.styles,\n                onCancel: this.onCancel,\n                mode: this.googlePayMode,\n                getOrderDetailsUrl: this.getOrderDetailsUrl,\n                threeDSMode: this.threeDSMode,\n                location: this.pageType,\n            });\n\n            this.googlePayButton.sdkLoaded\n                .then(this.googlePayButton.initGoogleSDK);\n        },\n\n        afterOnAuthorize: function (data) {\n            window.location = data.redirectUrl;\n            this.googlePayButton.showLoader(false);\n        },\n\n        onClick: function () {\n            this.isErrorDisplayed = false;\n\n            this.googlePayButton.showLoaderAsync(true)\n                .then(() => {\n                    return this.googlePayButton.createOrder();\n                })\n                .then(() => {\n                    refreshCustomerData(this.createOrderUrl);\n                })\n                .catch(error => {\n                    this.catchError(error);\n                });\n        },\n\n        /**\n         * Catch errors.\n         *\n         * @param {*} error\n         */\n        catchError: function (error) {\n            var message = error instanceof ResponseError ? error.message : this.paymentActionError;\n\n            console.log(error);\n\n            this.googlePayButton.showLoader(false);\n\n            if (this.isErrorDisplayed) {\n                return;\n            }\n\n            if (error.hidden === undefined || !error.hidden) {\n                this.addMessage(message);\n            }\n\n            this.isErrorDisplayed = true;\n        },\n\n        /**\n         * Add message to customer data.\n         *\n         * @param {String} message\n         * @param {String} [type]\n         */\n        addMessage: function (message, type) {\n            type = type || 'error';\n            customerData.set('messages', {\n                messages: [{\n                    type: type,\n                    text: message\n                }],\n                'data_id': Math.floor(Date.now() / 1000)\n            });\n        },\n\n        /**\n         * Redirect to cart on cancel.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         */\n        onCancel: function () {\n            customerData.invalidate(['cart']);\n            window.location = this.cancelUrl;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/message-cart.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract',\n    'Magento_PaymentServicesPaypal/js/view/payment/message',\n    'Magento_Customer/js/customer-data'\n], function (Component, Message, customerData) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalCart',\n            element: null,\n            message: null\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            var cartData = customerData.get('cart');\n\n            this.element = element;\n            this._super();\n            this.getSdkParams()\n                .then(this.initMessage.bind(this))\n                .then(function () {\n                    cartData.subscribe(function (updatedCart) {\n                        this.message.updateAmount(updatedCart.subtotalAmount);\n                    }, this);\n                }.bind(this))\n                .then(this.render.bind(this));\n\n        },\n\n        /**\n         * Create instance of messages.\n         */\n        initMessage: function () {\n            var cartData = customerData.get('cart');\n\n            this.message = new Message({\n                sdkNamespace: this.sdkNamespace,\n                scriptParams: this.sdkParams,\n                element: this.element,\n                renderContainer: this.renderContainer,\n                styles: this.styles,\n                placement: this.placement,\n                amount: cartData().subtotalAmount\n            });\n        },\n\n        /**\n         * Render message\n         */\n        render: function () {\n            this.message.render();\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'uiComponent',\n    'Magento_Checkout/js/model/payment/renderer-list',\n    'Magento_PaymentServicesPaypal/js/helpers/is-fastlane-available'\n], function (Component, rendererList, isFastlaneAvailable) {\n    'use strict';\n\n    const cardField = isFastlaneAvailable() ? {\n        type: 'payment_services_paypal_fastlane',\n        component: 'Magento_PaymentServicesPaypal/js/view/payment/method-renderer/fastlane'\n    } : {\n        type: 'payment_services_paypal_hosted_fields',\n        component: 'Magento_PaymentServicesPaypal/js/view/payment/method-renderer/hosted-fields'\n    };\n\n    rendererList.push({\n        type: 'payment_services_paypal_smart_buttons',\n        component: 'Magento_PaymentServicesPaypal/js/view/payment/method-renderer/smart-buttons'\n    }, {\n        type: 'payment_services_paypal_apple_pay',\n        component: 'Magento_PaymentServicesPaypal/js/view/payment/method-renderer/apple-pay'\n    }, {\n        type: 'payment_services_paypal_google_pay',\n        component: 'Magento_PaymentServicesPaypal/js/view/payment/method-renderer/google-pay'\n    }, cardField);\n\n    return Component.extend({});\n});\n","Magento_PaymentServicesPaypal/js/view/payment/apple-pay-product.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'underscore',\n    'mageUtils',\n    'Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/apple-pay',\n], function ($, _, utils, Component, $t, customerData, ResponseError, ApplePayButton) {\n    'use strict';\n\n    const HTTP_STATUS_OK = 200;\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url,\n            }\n        );\n    }\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalApplePay',\n            scriptParams: {},\n            buttonContainerId: 'apple-pay-${ $.uid }',\n            template: 'Magento_PaymentServicesPaypal/payment/apple-pay',\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            sdkLoaded: null,\n            quoteIdForRest: null,\n            quoteId: null,\n            sdkParamsKey: 'applepay',\n            paymentTypeIconTitle: $t('Pay with Apple Pay'),\n            notEligibleErrorMessage: $t('This payment option is currently unavailable.'),\n            productFormSelector: '#product_addtocart_form'\n        },\n\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            _.bindAll(this, 'initApplePayButton', 'onClick', 'afterUpdateQuote', 'beforeCreateOrder',\n                'afterCreateOrder', 'afterOnAuthorize', 'onCancel');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.element = element;\n            this.element.id = this.buttonContainerId;\n            this.getSdkParams()\n                .then(this.initApplePayButton)\n                .catch(console.log);\n\n            return this;\n        },\n\n        initApplePayButton: function () {\n            this.applePayButton = new ApplePayButton({\n                scriptParams: this.sdkParams,\n                createOrderUrl: this.createOrderUrl,\n                updateQuoteUrl: this.authorizeOrderUrl,\n                shippingInformationWhenGuestUrl: this.shippingInformationWhenGuestUrl,\n                shippingInformationWhenLoggedInUrl: this.shippingInformationWhenLoggedInUrl,\n                estimateShippingMethodsWhenGuestUrl: this.estimateShippingMethodsWhenGuestUrl,\n                estimateShippingMethodsWhenLoggedInUrl: this.estimateShippingMethodsWhenLoggedInUrl,\n                updatePayPalOrderUrl: this.updatePayPalOrderUrl,\n                setQuoteAsInactiveUrl: this.setQuoteAsInactiveUrl,\n                countriesUrl: this.countriesUrl,\n                placeOrderUrl: this.placeOrderUrl,\n                onClick: this.onClick,\n                beforeCreateOrder: this.beforeCreateOrder,\n                afterCreateOrder: this.afterCreateOrder,\n                catchCreateOrder: this.catchError,\n                onError: this.catchError,\n                buttonContainerId: this.buttonContainerId,\n                afterUpdateQuote: this.afterUpdateQuote,\n                shippingAddressRequired: !this.isVirtual,\n                styles: this.styles,\n                afterOnAuthorize: this.afterOnAuthorize,\n                onCancel: this.onCancel,\n                location: this.pageType,\n            });\n\n            $('#' + this.buttonContainerId).on('click', this.onClick);\n\n            this.applePayButton.sdkLoaded\n                .then(this.applePayButton.initAppleSDK);\n        },\n\n        afterUpdateQuote: function (data) {\n            window.location = data.redirectUrl;\n            this.applePayButton.showLoader(false);\n        },\n\n        onClick: function () {\n\n            var $form = $(this.productFormSelector);\n\n            if ($form.data('mageValidation')) {\n                this.formValid = $form.validation('isValid');\n            }\n\n            if (this.formValid) {\n                this.applePayButton.showLoaderAsync(true)\n                    .then(() => {\n                        return this.applePayButton.createOrder();\n                    })\n                    .then(() => {\n                        refreshCustomerData(this.createOrderUrl);\n                    })\n                    .catch(error => {\n                        this.applePayButton.catchError(error);\n                    });\n            }\n        },\n\n        setQuoteInactive: function () {\n            // Set Quote as inactive to avoid having multiple active quotes for the customer\n            $.ajax({\n                type: 'POST',\n                url: this.setQuoteAsInactiveUrl,\n            });\n        },\n\n        showPopup: function (paymentData) {\n\n            const paymentRequest = {\n                countryCode: this.applePayButton.applePayConfig.countryCode,\n                merchantCapabilities: this.applePayButton.applePayConfig.merchantCapabilities,\n                supportedNetworks: this.applePayButton.applePayConfig.supportedNetworks,\n                currencyCode: String(paymentData['currencyCode']),\n                requiredShippingContactFields: [\"name\", \"phone\", \"email\", \"postalAddress\"],\n                requiredBillingContactFields: [\"postalAddress\"],\n                total: {\n                    label: $t(\"Summary\"),\n                    type: \"final\",\n                    amount: Number(paymentData['totalPrice']).toString(),\n                }\n            };\n\n            // See https://developer.apple.com/documentation/apple_pay_on_the_web/applepaysession\n            this.applePaySession = new ApplePaySession(this.applePayButton.applePayVersionNumber, paymentRequest);\n            this.applePayButton.onApplePayValidateMerchant(this.applePaySession);\n            this.applePayButton.onApplePayCancel(this.applePaySession, this.setQuoteInactive.bind(this));\n            this.applePayButton.onApplePayShippingContactSelected(this.applePaySession, this.quoteIdForRest, paymentRequest.total, null);\n            this.applePayButton.onApplePayShippingMethodSelected(this.applePaySession, this.quoteId, this.quoteIdForRest, this.paypalOrderId);\n            this.applePayButton.onApplePayPaymentAuthorized(this.applePaySession);\n\n            this.applePaySession.begin();\n        },\n\n        /**\n         * Before create order.\n         *\n         * @return {String}\n         */\n        beforeCreateOrder: function () {\n            if (this.formInvalid) {\n                throw new Error('Form is Invalid');\n            }\n\n            let xhr = new XMLHttpRequest();\n            xhr.open('POST', this.addToCartUrl, false);\n            xhr.send(new FormData($(this.productFormSelector)[0]));\n\n            if (xhr.status !== HTTP_STATUS_OK) {\n                throw new Error('Request failed');\n            } else {\n                try {\n                    let result = JSON.parse(xhr.responseText);\n\n                    if (typeof result.success !== 'undefined') {\n                        refreshCustomerData(this.addToCartUrl);\n                        this.quoteIdForRest = result.success.quoteIdMask;\n                        this.quoteId = result.success.quoteId;\n                        return result.success;\n                    }\n                } catch (parseError) {\n                    throw new Error('Failed to parse response JSON: ' + parseError.message);\n                }\n            }\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {\n            if (data.response['paypal-order'] && data.response['paypal-order']['mp_order_id']) {\n                this.paymentsOrderId = data.response['paypal-order']['mp_order_id'];\n                this.paypalOrderId = data.response['paypal-order'].id;\n\n                this.showPopup({\n                    displayItems: [],\n                    currencyCode: data.response['paypal-order']['currency_code'],\n                    totalPriceStatus: 'FINAL',\n                    totalPrice: Number(data.response['paypal-order']['amount']).toString(),\n                    totalPriceLabel: $t('Total')\n                });\n\n                return this.paypalOrderId;\n            }\n\n            throw new Error();\n        },\n\n        afterOnAuthorize: function (data) {\n\n            this.applePayButton.showLoaderAsync(true)\n                .then(() => {\n                    fetch(this.placeOrderUrl, {\n                        method: 'POST'\n                    }).then(response => {\n                        if (response.redirected && response.url.includes(\"review\")) {\n                            throw new Error();\n                        }\n                        return response.text();\n                    }).then(result => {\n                        if (result) {\n                            customerData.invalidate(['cart']);\n                            document.open();\n                            document.write(result);\n                            document.close();\n                        }\n                    })\n                    .catch(error => {\n                        this.applePayButton.showLoader(false);\n                        this.applePayButton.catchError(error);\n                    });\n                })\n                .catch(error => {\n                    this.catchError(error);\n                });\n        },\n\n        /**\n         * Redirect to cart on cancel.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         */\n        onCancel: function () {\n            customerData.invalidate(['cart']);\n            window.location = this.cancelUrl;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/message-product.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract',\n    'Magento_PaymentServicesPaypal/js/view/payment/message',\n    'Magento_PaymentServicesPaypal/js/view/product/product-data-provider',\n    'Magento_PaymentServicesPaypal/js/view/product/grouped-product-data-provider',\n    'Magento_PaymentServicesPaypal/js/view/product/bundle-product-data-provider',\n    'Magento_PaymentServicesPaypal/js/view/product/gift-card-product-data-provider'\n], function (\n    Component,\n    Message,\n    ProductDataProvider,\n    GroupedProductDataProvider,\n    BundledProductDataProvider,\n    GiftCardProductDataProvider\n) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalProduct',\n            element: null,\n            message: null\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            var providerOptions = {\n                updateAmount: this.updateAmount.bind(this)\n            };\n\n            this.element = element;\n            this._super();\n\n            if (GroupedProductDataProvider.prototype.isProductGrouped()) {\n                this.provider = new GroupedProductDataProvider(providerOptions);\n            } else if (BundledProductDataProvider.prototype.isBundleProduct()) {\n                this.provider = new BundledProductDataProvider(providerOptions);\n            }  else if (GiftCardProductDataProvider.prototype.isProductGiftCard()) {\n                this.provider = new GiftCardProductDataProvider(providerOptions);\n            } else {\n                this.provider = new ProductDataProvider(providerOptions);\n            }\n            this.getSdkParams()\n                .then(this.initMessage.bind(this))\n                .then(this.render.bind(this));\n        },\n\n        /**\n         * Create instance of messages.\n         */\n        initMessage: function () {\n            this.message = new Message({\n                sdkNamespace: this.sdkNamespace,\n                scriptParams: this.sdkParams,\n                element: this.element,\n                renderContainer: this.renderContainer,\n                styles: this.styles,\n                placement: this.placement,\n                amount: this.provider.getAmount()\n            });\n        },\n\n        /**\n         * Update message amount.\n         */\n        updateAmount: function () {\n            this.message && this.message.updateAmount(this.provider.getAmount());\n        },\n\n        /**\n         * Render the message\n         */\n        render: function () {\n            this.message.render();\n            this.provider.updatePrice();\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/message.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'uiComponent',\n    'scriptLoader'\n], function ($, Component, loadSdkScript) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypal',\n            renderContainer: null,\n            amountAttribute: 'data-pp-amount',\n            amount: null\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function () {\n            this._super();\n            this.sdkLoaded = loadSdkScript(this.scriptParams, this.sdkNamespace);\n\n            return this;\n        },\n\n        /**\n         * Update amount\n         *\n         * @param {*} amount\n         */\n        updateAmount: function (amount) {\n            this.amount = amount;\n            $(this.renderContainer).attr(this.amountAttribute, this.amount);\n        },\n\n        /**\n         * Render message\n         *\n         * @return {Promise}\n         */\n        render: function () {\n            return this.sdkLoaded.then(function (sdkScript) {\n                const styles = this.getStyles();\n\n                if (!styles) {\n                    return;\n                }\n\n                sdkScript.Messages({\n                    amount: parseFloat(this.amount).toFixed(2),\n                    placement: this.placement,\n                    style: styles\n                })\n                .render(this.renderContainer);\n            }.bind(this)).catch(function (exception) {\n                console.log('Error: Failed to load PayPal SDK script!');\n                console.log(exception.message);\n            });\n        },\n\n        /**\n         * Gets the Pay Later Message styling for the given placement.\n         *\n         * Returns null if the placement is disabled.\n         *\n         * @returns {Object|bool}\n         */\n        getStyles: function () {\n            if (!this.styles) {\n                return {};\n            }\n\n            let parsedStyles = JSON.parse(this.styles),\n                placement = this.placement === 'payment' ? 'checkout' : this.placement,\n                styles = parsedStyles[placement];\n\n            if (!styles) {\n                return false;\n            }\n\n            return styles;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/vault.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n/*browser:true*/\n\n/* @api */\ndefine([\n    'underscore',\n    'uiComponent',\n    'mage/translate',\n    'Magento_Checkout/js/model/payment/renderer-list',\n    'uiLayout',\n    'uiRegistry'\n], function (_, Component, $t, rendererList, layout, registry) {\n    'use strict';\n\n    var vaultGroupName = 'vaultGroup';\n\n    layout([{\n        name: vaultGroupName,\n        component: 'Magento_Checkout/js/model/payment/method-group',\n        alias: 'vault',\n        sortOrder: 10,\n        title: $t('Stored Cards')\n    }]);\n\n    registry.get(vaultGroupName, function (vaultGroup) {\n        _.each(window.checkoutConfig.payment.vault, function (config, index) {\n            rendererList.push(\n                {\n                    type: index,\n                    config: config.config,\n                    component: config.component,\n                    group: vaultGroup,\n\n                    /**\n                     * Custom payment method types comparator\n                     * @param {String} typeA\n                     * @param {String} typeB\n                     * @return {Boolean}\n                     */\n                    typeComparatorCallback: function (typeA, typeB) {\n                        // vault token items have the same name as vault payment without index\n                        return typeA.substring(0, typeA.lastIndexOf('_')) === typeB;\n                    }\n                }\n            );\n        });\n    });\n\n    /**\n     * Add view logic here if needed\n     */\n    return Component.extend({});\n});\n","Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'uiComponent',\n    'Magento_PaymentServicesPaypal/js/view/payment/actions/get-sdk-params'\n], function (Component, getSdkParams) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            sdkParamsKey: 'paypal',\n            sdkParams: [],\n            cacheTtl: 30000\n        },\n\n        /**\n         * Get sdk params\n         *\n         * @return {Promise<Object>}\n         */\n        getSdkParams: function () {\n            return getSdkParams(this.cacheTtl)\n                .then(function (sdkParams) {\n                    this.sdkParams = sdkParams[this.sdkParamsKey];\n                }.bind(this));\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/google-pay-product.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'jquery',\n    'mageUtils',\n    'Magento_PaymentServicesPaypal/js/view/payment/paypal-abstract',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/google-pay'\n], function (_, $, utils, Component, $t, customerData, ResponseError, GooglePayButton) {\n    'use strict';\n\n    const HTTP_STATUS_OK = 200;\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url,\n            }\n        );\n    }\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalGooglePay',\n            scriptParams: {},\n            buttonContainerId: 'google-pay-${ $.uid }',\n            template: 'Magento_PaymentServicesPaypal/payment/google-pay',\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            sdkLoaded: null,\n            sdkParamsKey: 'googlepay',\n            paymentTypeIconTitle: $t('Pay with Google Pay'),\n            requestProcessingError: $t('Something went wrong with your request. Please try again later.'),\n            notEligibleErrorMessage: $t('This payment option is currently unavailable.'),\n            productFormSelector: '#product_addtocart_form'\n        },\n\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            _.bindAll(this, 'initGooglePayButton', 'onClick', 'afterUpdateQuote',\n                'catchError', 'beforeCreateOrder', 'afterOnAuthorize', 'onCancel');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.element = element;\n            this.element.id = this.buttonContainerId;\n            this.getSdkParams()\n                .then(this.initGooglePayButton)\n                .catch(console.log);\n\n            return this;\n        },\n\n        initGooglePayButton: function () {\n            this.googlePayButton = new GooglePayButton({\n                scriptParams: this.sdkParams,\n                createOrderUrl: this.createOrderUrl,\n                updateQuoteUrl: this.authorizeOrderUrl,\n                onClick: this.onClick,\n                setQuoteAsInactiveUrl: this.setQuoteAsInactiveUrl,\n                beforeCreateOrder: this.beforeCreateOrder,\n                catchCreateOrder: this.catchError,\n                onError: this.catchError,\n                buttonContainerId: this.buttonContainerId,\n                afterUpdateQuote: this.afterUpdateQuote,\n                shippingAddressRequired: !this.isVirtual,\n                styles: this.styles,\n                afterOnAuthorize: this.afterOnAuthorize,\n                onCancel: this.onCancel,\n                mode: this.googlePayMode,\n                getOrderDetailsUrl: this.getOrderDetailsUrl,\n                threeDSMode: this.threeDSMode,\n                location: this.pageType,\n            });\n\n            this.googlePayButton.sdkLoaded\n                .then(this.googlePayButton.initGoogleSDK);\n        },\n\n        afterUpdateQuote: function (data) {\n            window.location = data.redirectUrl;\n            this.googlePayButton.showLoader(false);\n        },\n\n        onClick: function () {\n            var $form = $(this.productFormSelector);\n\n            if ($form.data('mageValidation')) {\n                this.formValid = $form.validation('isValid');\n            }\n\n            if (this.formValid) {\n                this.isErrorDisplayed = false;\n\n                this.googlePayButton.showLoaderAsync(true)\n                    .then(() => {\n                        return this.googlePayButton.createOrder();\n                    })\n                    .then(() => {\n                        refreshCustomerData(this.createOrderUrl);\n                    })\n                    .catch(error => {\n                        this.catchError(error);\n                    });\n            }\n        },\n\n        /**\n         * Set quote created from PDP as Inactive\n         */\n        setQuoteInactive: function () {\n            // Set Quote as inactive to avoid having multiple active quotes for the customer\n            return $.ajax({\n                type: 'POST',\n                url: this.setQuoteAsInactiveUrl\n            });\n        },\n\n        /**\n         * Catch errors.\n         *\n         * @param {*} error\n         */\n        catchError: function (error) {\n            console.log(error);\n            this.googlePayButton.showLoader(false);\n\n            if (error.name !== \"PayPalGooglePayError\") {\n                try {\n                    this.setQuoteInactive()\n                } catch (e) {\n                    console.warn('Failed to set quote inactive:', e);\n                }\n            }\n\n            if (this.isErrorDisplayed) {\n                return;\n            }\n\n            if (error.hidden === undefined || !error.hidden) {\n                this.addMessage(this.requestProcessingError);\n            }\n\n            this.isErrorDisplayed = true;\n        },\n\n        /**\n         * Add message to customer data.\n         *\n         * @param {String} message\n         * @param {String} [type]\n         */\n        addMessage: function (message, type) {\n            type = type || 'error';\n            customerData.set('messages', {\n                messages: [{\n                    type: type,\n                    text: message\n                }],\n                'data_id': Math.floor(Date.now() / 1000)\n            });\n        },\n\n        /**\n         * Before create order.\n         *\n         * @return {String}\n         */\n        beforeCreateOrder: function () {\n            this.isErrorDisplayed = false;\n\n            if (this.formInvalid) {\n                throw new Error('Form is Invalid');\n            }\n\n            let xhr = new XMLHttpRequest();\n            xhr.open('POST', this.addToCartUrl, false);\n            xhr.send(new FormData($(this.productFormSelector)[0]));\n\n            if (xhr.status !== HTTP_STATUS_OK) {\n                throw new Error('Request failed');\n            } else {\n                try {\n                    let result = JSON.parse(xhr.responseText);\n\n                    if (typeof result.success !== 'undefined') {\n                        refreshCustomerData(this.addToCartUrl);\n                        return result.success;\n                    }\n                } catch (parseError) {\n                    throw new Error('Failed to parse response JSON: ' + parseError.message);\n                }\n            }\n        },\n\n        afterOnAuthorize: function (data) {\n            window.location = data.redirectUrl;\n            this.googlePayButton.showLoader(false);\n        },\n\n        /**\n         * Set quote inactive on cancel\n         */\n        onCancel: function () {\n            this.setQuoteInactive()\n                .always(() => {\n                    this.googlePayButton.showLoader(false);\n                });\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/fastlane.js":"/**\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2025 Adobe\n * All Rights Reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\ndefine([\n    'jquery',\n    'knockout',\n    'uiRegistry',\n    'mage/translate',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/action/select-payment-method',\n    'Magento_Checkout/js/action/set-shipping-information',\n    'Magento_Checkout/js/checkout-data',\n    'Magento_Checkout/js/model/shipping-service',\n    'Magento_Checkout/js/model/step-navigator',\n    'Magento_Customer/js/model/address-list',\n    'Magento_Ui/js/model/messageList',\n    'Magento_PaymentServicesPaypal/js/helpers/get-allowed-locations',\n    'Magento_PaymentServicesPaypal/js/helpers/map-address-to-fastlane',\n    'Magento_PaymentServicesPaypal/js/helpers/map-address-to-magento',\n    'scriptLoader'\n], function ($, ko, uiRegistry, $t, quote, selectPaymentMethodAction, setShippingInformationAction, checkoutData,\n             shippingService, stepNavigator, addressList, messageList,\n             getAllowedLocations, mapAddressToFastlane, mapAddressToMagento, loadSdkScript) {\n    'use strict';\n\n    return {\n        code: 'payment_services_paypal_fastlane',\n        clientInstance: null,\n        fastlaneInstance: null,\n        fastlanePaymentComponent: null,\n        fastlaneWatermarkComponent: null,\n        deviceData: null,\n        runningSetup: null,\n        customerContextId: null,\n        profileData: ko.observable(null),\n        email: null,\n        sdkNamespace: 'paypalFastlane',\n        liabilityShift: ko.observable(null),\n        authenticationState: ko.observable(null),\n\n        /**\n         * Creates the Fastlane instance.\n         *\n         * The Fastlane instance is assigned to this.fastlaneInstance.\n         *\n         * @returns {void}\n         */\n        createFastlaneInstance: function () {\n            return new Promise((resolve) => {\n                const braintreeVersion = '3.116.2';\n                const fastlaneRequire = require.config({\n                    context: 'fastlane',\n                    paths: {\n                        braintree: `https://js.braintreegateway.com/web/${braintreeVersion}/js`,\n                        fastlane: 'https://www.paypalobjects.com/connect-boba',\n                    },\n                    shim: {\n                        'fastlane/axo': {\n                            deps: ['braintree/client', 'braintree/hosted-fields'],\n                        },\n                        'fastlane/axo.min': {\n                            deps: ['braintree/client.min', 'braintree/hosted-fields.min'],\n                        },\n                    },\n                });\n\n                fastlaneRequire(['fastlane/axo.min'], () => {\n                    (async () => {\n                        window.braintree = window.braintree || {};\n                        window.braintree.client = await new Promise(resolve => fastlaneRequire(['braintree/client.min'], resolve));\n                        window.braintree.hostedFields = await new Promise(resolve => fastlaneRequire(['braintree/hosted-fields.min'], resolve));\n                        window.braintree.version = braintreeVersion;\n\n                        await loadSdkScript(window.checkoutConfig.payment[this.getCode()].sdkParams, this.sdkNamespace)\n\n                        const fastlaneInstance = await window[this.sdkNamespace].Connect({\n                            shippingAddressOptions: {\n                                allowedLocations: getAllowedLocations(),\n                            },\n                            styles: this.getStyles()\n                        });\n\n                        resolve(fastlaneInstance);\n                    })();\n                });\n            });\n        },\n\n        /**\n         * Return the payment method code.\n         *\n         * @returns {string}\n         */\n        getCode: function () {\n            return this.code;\n        },\n\n        getStyles: function () {\n            return {\n                theme: window.checkoutConfig.payment[this.getCode()].styling.theme,\n                root: {\n                    backgroundColor: window.checkoutConfig.payment[this.getCode()].styling.rootBackgroundColor,\n                    errorColor: window.checkoutConfig.payment[this.getCode()].styling.rootErrorColor,\n                    fontFamily: window.checkoutConfig.payment[this.getCode()].styling.rootFontFamily,\n                    fontSizeBase: window.checkoutConfig.payment[this.getCode()].styling.rootFontSize,\n                    padding: window.checkoutConfig.payment[this.getCode()].styling.rootPadding,\n                    primaryColor: window.checkoutConfig.payment[this.getCode()].styling.rootPrimaryColor,\n                    textColorBase: window.checkoutConfig.payment[this.getCode()].styling.rootTextColor,\n                },\n                input: {\n                    backgroundColor: window.checkoutConfig.payment[this.getCode()].styling.inputBackgroundColor,\n                    borderColor: window.checkoutConfig.payment[this.getCode()].styling.inputBorderColor,\n                    borderRadius: window.checkoutConfig.payment[this.getCode()].styling.inputBorderRadius,\n                    borderWidth: window.checkoutConfig.payment[this.getCode()].styling.inputBorderWidth,\n                    focusBorderColor: window.checkoutConfig.payment[this.getCode()].styling.inputFocusBorderColor,\n                    textColorBase: window.checkoutConfig.payment[this.getCode()].styling.inputTextColor,\n                }\n            };\n        },\n\n        /**\n         * Setups all the required instances needed for Fastlane.\n         *\n         * @returns {Promise} A promise that completes once the client, data collector and Fastlane instances\n         * have been created.\n         */\n        setup: async function () {\n            // If the Fastlane instance has already been creates then immediately return a completed promise.\n            if (this.fastlaneInstance !== null) {\n                return Promise.resolve();\n            }\n\n            // There are multiple different components that can call the setup function at the same time so this\n            // is in place to prevent creating multiple instances.\n            if (this.runningSetup) {\n                return this.runningSetup;\n            }\n\n            this.runningSetup = new Promise(async (resolve) => {\n                this.attachStepsListener();\n\n                if (this.fastlaneInstance === null) {\n                    this.fastlaneInstance = await this.createFastlaneInstance();\n                }\n\n                resolve();\n            });\n\n            return this.runningSetup;\n        },\n\n        /**\n         * Attach a listener on the steps so that going to payment page opens Fastlane by default.\n         */\n        attachStepsListener: function () {\n            stepNavigator.steps.subscribe((steps) => {\n                const payment = steps.find(({ code }) => code === 'payment');\n\n                // Check against a few things:\n                // 1. The payment step is visible\n                // 2. The User has authenticated with Fastlane\n                // 3. No other payment method has been selected\n                if (payment.isVisible() && this.profileData() && !quote.paymentMethod()) {\n                    checkoutData.setSelectedPaymentMethod(this.code);\n                    selectPaymentMethodAction({ method: this.code });\n                }\n            });\n        },\n\n        /**\n         * Run the lookup for an email address within Fastlane.\n         *\n         * This will reset data within this.profileData and this.customerContextId and then trigger\n         * another authentication if a new account is found.\n         *\n         * @param {string} email\n         * @returns {void}\n         */\n        lookupCustomerByEmail: async function (email) {\n            // Early return if we haven't run setup and got a valid Fastlane instance.\n            if (!this.fastlaneInstance) {\n                return;\n            }\n\n            try {\n                this.showLoader(true);\n\n                // When we perform another lookup destroy all existing data.\n                this.profileData(null);\n                this.customerContextId = null;\n\n                // Lookup the new User.\n                const { customerContextId } = await this.fastlaneInstance?.identity?.lookupCustomerByEmail(email) || {};\n\n                this.showLoader(false);\n\n                this.customerContextId = customerContextId;\n\n                // If we have do have an account then trigger the authentication.\n                if (this.customerContextId) {\n                    return this.triggerAuthenticationFlow();\n                }\n            } catch (error) {\n                console.warn(error);\n                this.showLoader(false);\n            }\n        },\n\n        /**\n         * Checks whether the quote already contains a customer email address and shipping address.\n         *\n         * @param {Object} profileData - The complete profile data as gathered from Fastlane.\n         * @param {Object} [profileData.card] - Optional card data object.\n         * @param {Object} [profileData.name] - Optional name data object.\n         * @param {Object} [profileData.shippingAddress] - Optional shipping address object.\n         * @returns {Boolean}\n         */\n        quoteHasAddressSaved: function (profileData) {\n            return !this.email\n                && profileData?.shippingAddress?.address?.addressLine1\n                && !quote.shippingAddress().postcode;\n        },\n\n        /**\n         * Checks whether the User has changed their email address against the quote.\n         *\n         * @returns {Boolean}\n         */\n        userHasChangedEmailAddress: function () {\n            return this.email && this.email !== quote.guestEmail;\n        },\n\n        /**\n         * Trigger the authentication flow within Fastlane.\n         *\n         * Once the User has finished the action the information will be available within this.profileData.\n         *\n         * @returns {void}\n         */\n        triggerAuthenticationFlow: async function () {\n            // Early return if we haven't run setup and got a valid Fastlane instance.\n            if (!this.fastlaneInstance) {\n                return;\n            }\n\n            this.showLoader(true);\n            const { profileData }\n                = await this.fastlaneInstance.identity.triggerAuthenticationFlow(this.customerContextId);\n\n            this.showLoader(false);\n\n            // With the account data push it into the required models.\n            if (profileData) {\n                // Before processing the data we need to check for a few things:\n                //   - If there is no email address already but we do have a postcode then don't override as this will\n                //     be a custom address set by the User.\n                //   - If we have an email address stored but it doesn't match with the quote then the User must have\n                //     updated their email address and authenticated so process their new profile data.\n                if (this.quoteHasAddressSaved(profileData) || this.userHasChangedEmailAddress()) {\n                    this.processUserData(profileData);\n                }\n\n                // Store the current email address and profile data.\n                this.email = quote.guestEmail;\n                this.profileData(profileData);\n            }\n        },\n\n        /**\n         * Renders the Fastlane card component inside the given css selector.\n         *\n         * @param {string} selector The css selector where to render the card component.\n         * @returns {void}\n         */\n        renderFastlanePaymentComponent: async function (selector) {\n            // Early return if we haven't run setup and got a valid Fastlane instance.\n            if (!this.fastlaneInstance) {\n                return;\n            }\n\n            // If there is no customer context ID they must have reloaded on the payment page so trigger the\n            // authentication here again.\n            if (this.customerContextId === null) {\n                await this.lookupCustomerByEmail(quote.guestEmail);\n            }\n\n            const shippingAddress = mapAddressToFastlane(quote.shippingAddress()),\n                fields = {\n                    phoneNumber: {\n                        prefill: this.profileData()?.shippingAddress?.phoneNumber\n                            || quote.shippingAddress().telephone || ''\n                    },\n                    cardholderName: {\n                        // Enabled flag currently not available within Fastlane SDK but leaving functionality\n                        // in as it will be in a later release.\n                        // enabled: window.checkoutConfig.fastlane.show_cardholder_name,\n                        prefill: shippingAddress.firstName && shippingAddress.lastName\n                            ? `${shippingAddress.firstName} ${shippingAddress.lastName}` : ''\n                    }\n                },\n                styles = this.getStyles();\n\n            this.fastlanePaymentComponent = await this.fastlaneInstance\n                .FastlanePaymentComponent({ fields, shippingAddress, styles });\n            this.fastlanePaymentComponent.render(selector);\n        },\n\n        /**\n         * Shows the address Fastlane address selector.\n         *\n         * When the User selects a new address this will automatically call `processUserData` with the updated\n         * information.\n         *\n         * @returns {void}\n         */\n        displayChangeShipping: async function () {\n            // Early return if we haven't run setup and got a valid Fastlane instance.\n            if (!this.fastlaneInstance?.profile) {\n                return;\n            }\n\n            this.showLoader(true);\n\n            const {\n                selectionChanged,\n                selectedAddress\n            } = await this.fastlaneInstance.profile.showShippingAddressSelector();\n\n            if (selectionChanged) {\n                this.processUserData({ shippingAddress: selectedAddress });\n            }\n\n            this.showLoader(false);\n        },\n\n        /**\n         * Renders the Fastlane watermark into the given selector.\n         * @param {string} selector The css selector where to render the watermark component.\n         * @returns {void}\n         */\n        renderFastlaneWatermarkComponent: async function (selector) {\n            // Early return if we haven't run setup and got a valid Fastlane instance.\n            if (!this.fastlaneInstance) {\n                return;\n            }\n\n            // Make sure the element still exists.\n            if (!document.querySelector(selector)) {\n                return;\n            }\n\n            this.fastlaneWatermarkComponent = await this.fastlaneInstance.FastlaneWatermarkComponent({\n                includeAdditionalInfo: true\n            });\n            this.fastlaneWatermarkComponent.render(selector);\n        },\n\n        /**\n         * Handles all the data from Fastlane and populating that into Adobe Commerce checkout models.\n         *\n         * @param {Object} profileData - The complete profile data as gathered from Fastlane.\n         * @param {Object} [profileData.card] - Optional card data object.\n         * @param {Object} [profileData.name] - Optional name data object.\n         * @param {Object} [profileData.shippingAddress] - Optional shipping address object.\n         * @returns {void}\n         */\n        processUserData: async function (profileData) {\n            // Clean up any existing subscriptions so we don't add more than one at a time.\n            if (this.shippingServiceSubscription) {\n                this.shippingServiceSubscription.dispose();\n            }\n\n            try {\n                // If the quote is virtual then open paypal and stop.\n                if (quote.isVirtual()) {\n                    selectPaymentMethodAction({ method: this.code });\n                    return;\n                }\n\n                const shippingAddress = uiRegistry.get('checkout.steps.shipping-step.shippingAddress'),\n                    mappedAddress = mapAddressToMagento(profileData.shippingAddress);\n\n                // Subscribe to get the updated shipping rates.\n                this.shippingServiceSubscription = shippingService.getShippingRates().subscribe(function (rates) {\n                    this.shippingServiceSubscription.dispose();\n\n                    // Filter out the \"instore\" option as we cannot select the pickup location\n                    rates = rates.filter(function (rate) {\n                        return rate.carrier_code !== 'instore';\n                    });\n\n                    if (!rates || !rates.length) {\n                        this.redirectToShipping();\n                        return;\n                    }\n\n                    // If the shipping address is valid and we have some shipping rates then set the data to quote.\n                    if (!shippingAddress.source.get('params.invalid') && rates && rates[0]) {\n                        shippingAddress.selectShippingMethod(rates[0]);\n\n                        setShippingInformationAction().done(\n                            function () {\n                                // If we are on the first step of the checkout then we can skip to the next step.\n                                if (stepNavigator.getActiveItemIndex() === 0) {\n                                    stepNavigator.next();\n                                }\n                            }\n                        );\n                    }\n                }.bind(this));\n\n                // Push mapped address into the correct models which will trigger getting the updated shipping methods.\n                addressList.push(mappedAddress);\n                this.addAddressToCheckoutProvider(mappedAddress);\n\n                shippingAddress.source.set('params.invalid', false);\n                shippingAddress.triggerShippingDataValidateEvent();\n\n                if (shippingAddress.source.get('params.invalid')) {\n                    this.redirectToShipping();\n                }\n            } catch {\n                messageList.addErrorMessage({\n                    message: $t('The selected shipping address is not available to be used. Please enter a new one.')\n                });\n                this.showLoader(false);\n            }\n        },\n\n        /**\n         * Redirects the User back to the shipping step.\n         * @returns {void}\n         */\n        redirectToShipping: function () {\n            stepNavigator.setHash('shipping');\n            this.showLoader(false);\n        },\n\n        /**\n         * Push the new address into the checkout provider.\n         *\n         * @param {Object} address - A complete address object in the correct Adobe Commerce format.\n         * @returns {void}\n         */\n        addAddressToCheckoutProvider: function (address) {\n            const checkoutProvider = uiRegistry.get('checkoutProvider');\n            const billingAddress = uiRegistry.get('checkout.steps.billing-step.payment.payments-list.paypal_billing_agreement-form');\n\n            checkoutProvider.set(\n                'shippingAddress',\n                address\n            );\n\n            // If the billing address is set to be the same as the shipping then update the billing address with\n            // the same changed address.\n            if (billingAddress && billingAddress.isAddressSameAsShipping()) {\n                quote.shippingAddress({ ...address, street: Object.values(address.street) });\n                quote.billingAddress({ ...address, street: Object.values(address.street) });\n            }\n        },\n\n        /**\n         * Get the payment token.\n         *\n         * @returns {Promise}\n         */\n        getPaymentToken: function () {\n            if (!this.fastlanePaymentComponent) {\n                const error = new Error();\n\n                error.name = 'paypal_paypal:undefined_component';\n                throw error;\n            }\n\n            return this.fastlanePaymentComponent.getPaymentToken();\n        },\n\n        /**\n         * Validate the token with 3DS.\n         *\n         * @param {string} nonce\n         */\n        validate3DS: async function (nonce) {\n            const totals = quote.totals();\n\n            const payload = {\n                amount: totals['base_grand_total'].toFixed(2),\n                currency: window.checkoutConfig.quoteData.base_currency_code,\n                nonce,\n                threeDSRequested: true,\n                transactionContext: {\n                    experience_context: {\n                        brand_name: \"\",\n                        locale: window.LOCALE\n                    }\n                }\n            }\n\n            const isThreeDomainSecureEligible = await window[this.sdkNamespace].ThreeDomainSecureClient.isEligible(payload);\n\n            if (isThreeDomainSecureEligible) {\n                const { liabilityShift, authenticationState, nonce } = await window[this.sdkNamespace].ThreeDomainSecureClient.show();\n\n                this.liabilityShift(liabilityShift);\n                this.authenticationState(authenticationState);\n                if (authenticationState === \"succeeded\") {\n                    return nonce;\n                } else {\n                    throw new Error('Authentication has been failed or cancelled');\n                }\n            }\n\n            return nonce;\n        },\n\n        /**\n         * Show/hide loader.\n         *\n         * @param {Boolean} show\n         */\n        showLoader: function (show) {\n            var event = show ? 'processStart' : 'processStop';\n\n            $('body').trigger(event);\n        },\n    };\n});\n","Magento_PaymentServicesPaypal/js/view/payment/smart-buttons-cart.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'jquery',\n    'mageUtils',\n    'scriptLoader',\n    'Magento_PaymentServicesPaypal/js/helpers/remove-paypal-url-token',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/smart-buttons',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error'\n], function (_, $, utils, loadSdkScript, removePayPalUrlToken, Component, $t, customerData, ResponseError) {\n    'use strict';\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url\n            }\n        );\n    };\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalCart',\n            buttonsContainerId: 'smart-buttons-${ $.uid }',\n            element: null,\n            paymentActionError: $t('Something went wrong with your request. Please try again later.'),\n            isErrorDisplayed: false\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config, element) {\n            _.bindAll(this, 'renderButtons', 'onError', 'beforeCreateOrder', 'afterCreateOrder',\n                'beforeOnAuthorize', 'onCancel');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.element = element;\n            this.element.id = this.buttonsContainerId;\n            this.sdkLoaded = this.getSdkParams().then(() => {\n                return loadSdkScript(this.sdkParams, this.sdkNamespace).then((sdkScript) => {\n                    this.paypal = sdkScript;\n                });\n            });\n            this.renderButtons();\n\n            return this;\n        },\n\n        /**\n         * Render buttons\n         */\n        renderButtons: function () {\n            if (!this.sdkLoaded) {\n                return;\n            }\n\n            this.sdkLoaded.then(function () {\n                let containerSelector = '#' + this.buttonsContainerId;\n\n                if ($(containerSelector).length > 0) {\n                    this.setup(containerSelector);\n                    this.render();\n                } else {\n                    console.warn('PayPal button container not found:', containerSelector);\n                }\n            }.bind(this)).catch(function () {\n                console.log('Error: Failed to load PayPal SDK script!');\n            });\n        },\n\n        /**\n         * Show/hide loader.\n         *\n         * @param {Boolean} show\n         */\n        showLoader: function (show) {\n            let event = show ? 'processStart' : 'processStop';\n\n            $('body').trigger(event);\n        },\n\n        /**\n         * Add error handling to catch errors on creating the order.\n         *\n         * @param {*} error\n         */\n        catchCreateOrder: function (error) {\n            this.onError(error);\n        },\n\n        /**\n         * Catch errors.\n         *\n         * @param {*} error\n         */\n        onError: function (error) {\n            let message = error instanceof ResponseError ? error.message : this.paymentActionError;\n\n            this.showLoader(false);\n\n            if (this.isErrorDisplayed) {\n                return;\n            }\n            this.addMessage(message);\n            this.isErrorDisplayed = true;\n        },\n\n        /**\n         * Add message to customer data.\n         *\n         * @param {String} message\n         * @param {String} [type]\n         */\n        addMessage: function (message, type) {\n            type = type || 'error';\n            customerData.set('messages', {\n                messages: [{\n                    type: type,\n                    text: message\n                }],\n                'data_id': Math.floor(Date.now() / 1000)\n            });\n        },\n\n        /**\n         * Before create order.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            this.isErrorDisplayed = false;\n            this.showLoader(true);\n\n            return Promise.resolve();\n        },\n\n        /**\n         * After order id created.\n         *\n         * @param {Object} res\n         * @return {*}\n         */\n        afterCreateOrder: function (res) {\n            if (res.response['is_successful']) {\n                refreshCustomerData(this.createOrderUrl);\n\n                return res.response['paypal-order'].id;\n            }\n\n            throw new ResponseError(res.response.error);\n        },\n\n        /**\n         * Before onAuthorize execute\n         *\n         * @param {Object} data\n         * @return {Promise}\n         */\n        beforeOnAuthorize: function (data) {\n            this.showLoader(true);\n\n            return Promise.resolve(data);\n        },\n\n        /**\n         * Redirect to cart on cancel.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         */\n        onCancel: function (data, actions) {\n            removePayPalUrlToken();\n\n            customerData.invalidate(['cart']);\n            window.location.replace(this.cancelUrl);\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer/apple-pay.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'Magento_Checkout/js/view/payment/default',\n    'jquery',\n    'underscore',\n    'mageUtils',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/full-screen-loader',\n    'mage/translate',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/apple-pay',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Magento_Checkout/js/action/set-billing-address',\n    'Magento_Ui/js/model/messageList',\n    'Magento_Customer/js/customer-data'\n], function (\n    Component,\n    $,\n    _,\n    utils,\n    quote,\n    fullScreenLoader,\n    $t,\n    ApplePayButton,\n    additionalValidators,\n    setBillingAddressAction,\n    globalMessageList,\n    customerData\n) {\n    'use strict';\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url,\n            }\n        );\n    }\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalApplePay',\n            fundingSource: 'applepay',\n            buttonContainerId: 'apple-pay-${ $.uid }',\n            template: 'Magento_PaymentServicesPaypal/payment/apple-pay',\n            isAvailable: false,\n            isButtonRendered: false,\n            grandTotalAmount: null,\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            paymentTypeIconTitle: $t('Pay with Apple Pay'),\n            requestProcessingError: $t('Error happened when processing the request. Please try again later.'),\n            notEligibleErrorMessage: $t('This payment option is currently unavailable.'),\n            paymentTypeIconUrl: window.checkoutConfig.payment['payment_services_paypal_apple_pay'].paymentTypeIconUrl\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config) {\n            _.bindAll(this, 'catchError', 'beforeCreateOrder', 'afterCreateOrder', 'placeOrder', 'onClick');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.initApplePayButton();\n\n            return this;\n        },\n\n        /**\n         * Initialize observables\n         *\n         * @returns {Component} Chainable.\n         */\n        initObservable: function () {\n            this._super().observe('grandTotalAmount isAvailable isButtonRendered');\n            this.grandTotalAmount(quote.totals()['base_grand_total']);\n\n            return this;\n        },\n\n        /**\n         * Create instance of smart buttons.\n         */\n        initApplePayButton: function () {\n            this.applePayButton = new ApplePayButton({\n                scriptParams: window.checkoutConfig.payment[this.getCode()].sdkParams,\n                createOrderUrl: window.checkoutConfig.payment[this.getCode()].createOrderUrl,\n                estimateShippingMethodsWhenLoggedInUrl: window.checkoutConfig.payment[this.getCode()].estimateShippingMethodsWhenLoggedInUrl,\n                estimateShippingMethodsWhenGuestUrl: window.checkoutConfig.payment[this.getCode()].estimateShippingMethodsWhenGuestUrl,\n                shippingInformationWhenLoggedInUrl: window.checkoutConfig.payment[this.getCode()].shippingInformationWhenLoggedInUrl,\n                shippingInformationWhenGuestUrl: window.checkoutConfig.payment[this.getCode()].shippingInformationWhenGuestUrl,\n                updatePayPalOrderUrl: window.checkoutConfig.payment[this.getCode()].updatePayPalOrderUrl,\n                countriesUrl: window.checkoutConfig.payment[this.getCode()].countriesUrl,\n                onClick: this.onClick,\n                beforeCreateOrder: this.beforeCreateOrder,\n                afterCreateOrder: this.afterCreateOrder,\n                catchCreateOrder: this.catchError,\n                onError: this.catchError,\n                buttonContainerId: this.buttonContainerId,\n                onApprove: this.placeOrder,\n                styles: window.checkoutConfig.payment[this.getCode()].buttonStyles,\n                location: window.checkoutConfig.payment[this.getCode()].location,\n            });\n        },\n\n        /**\n         * Get method code\n         *\n         * @return {String}\n         */\n        getCode: function () {\n            return 'payment_services_paypal_apple_pay';\n        },\n\n        /**\n         * Get method data\n         *\n         * @return {Object}\n         */\n        getData: function () {\n            return {\n                'method': this.item.method,\n                'additional_data': {\n                    'payments_order_id': this.paymentsOrderId,\n                    'paypal_order_id': this.paypalOrderId,\n                    'payment_source': this.fundingSource\n                }\n            };\n        },\n\n        /**\n         * Render buttons\n         */\n        afterRender: function () {\n            this.applePayButton.sdkLoaded\n                .then(this.applePayButton.initAppleSDK)\n                .then(function () {\n                        this.isAvailable(true);\n                        this.isButtonRendered(true);\n                    }.bind(this)\n                ).catch(function () {\n                this.isAvailable(false);\n            }.bind(this)).finally(function () {\n                this.isButtonRendered(true);\n            }.bind(this));\n        },\n\n        /**\n         * Enable/disable buttons.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         */\n        onInit: function (data, actions) {\n            if (!this.isPlaceOrderActionAllowed()) {\n                actions.disable();\n            }\n\n            this.isPlaceOrderActionAllowed.subscribe(function (isAllowed) {\n                if (isAllowed) {\n                    actions.enable();\n                } else {\n                    actions.disable();\n                }\n            });\n        },\n\n        /**\n         * Validate form onClick\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         * @return {*}\n         */\n        onClick: function (data, actions) {\n            this.applePayButton.showLoaderAsync(true)\n                .then(() => {\n                    this.applePayButton.createOrder();\n                })\n                .then(() => {\n                    refreshCustomerData(window.checkoutConfig.payment[this.getCode()].createOrderUrl);\n                })\n                .catch(error => {\n                    this.catchError(error);\n                });\n        },\n\n        /**\n         * Before order created.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            if (this.validate() && this.isPlaceOrderActionAllowed() && additionalValidators.validate()) {\n                return new Promise(function (resolve, reject) {\n                    setBillingAddressAction(globalMessageList).done(resolve.bind(null, null)).fail(reject);\n                });\n            } else {\n                throw {message: 'before create order validation failed', hidden: true};\n            }\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {\n            if (data.response['paypal-order'] && data.response['paypal-order']['mp_order_id']) {\n                this.paymentsOrderId = data.response['paypal-order']['mp_order_id'];\n                this.paypalOrderId = data.response['paypal-order'].id;\n\n                this.applePayButton.showPopup(data, quote);\n\n                return this.paypalOrderId;\n            }\n\n            throw new Error();\n        },\n\n        /**\n         * Catch error.\n         *\n         * @param {Error} error\n         */\n        catchError: function (error) {\n            this.messageContainer.addErrorMessage({\n                message: this.requestProcessingError\n            });\n            console.log('Error: ', error.message);\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer/fastlane.js":"/**\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2025 Adobe\n * All Rights Reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'mage/translate',\n    'uiRegistry',\n    'Magento_Checkout/js/action/set-billing-address',\n    'Magento_Checkout/js/model/full-screen-loader',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/view/payment/default',\n    'Magento_PaymentServicesPaypal/js/helpers/map-address-to-magento',\n    'Magento_PaymentServicesPaypal/js/view/payment/fastlane',\n    'Magento_Ui/js/model/messageList',\n], function (\n    $,\n    $t,\n    uiRegistry,\n    setBillingAddressAction,\n    loader,\n    additionalValidators,\n    quote,\n    Component,\n    mapAddressToMagento,\n    fastlaneModel,\n    messageList\n) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            code: 'payment_services_paypal_fastlane',\n            template: 'Magento_PaymentServicesPaypal/payment/fastlane',\n            createOrderUrl: window.checkoutConfig.payment['payment_services_paypal_fastlane'].createOrderUrl,\n            paymentTypeIconUrl:  window.checkoutConfig.payment['payment_services_paypal_fastlane'].paymentTypeIconUrl, // eslint-disable-line max-len\n            paymentTypeIconTitle: $t('Pay with credit card'),\n            location: window.checkoutConfig.payment['payment_services_paypal_fastlane'].location,\n            paymentSource: window.checkoutConfig.payment['payment_services_paypal_fastlane'].paymentSource,\n            requiresCardDetails: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].requiresCardDetails,\n            threeDSMode: window.checkoutConfig.payment['payment_services_paypal_fastlane'].threeDS,\n            getOrderDetailsUrl: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].getOrderDetailsUrl,\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            fastlaneToken: null,\n        },\n\n        /**\n         * @returns {exports.initialize}\n         */\n        initialize: async function (config) {\n            this._super(config);\n\n            return this;\n        },\n\n        afterRender: async function () {\n            await fastlaneModel.setup();\n            fastlaneModel.renderFastlanePaymentComponent('#payment-services-paypal-fastlane');\n        },\n\n        onClick: async function () {\n            if (!additionalValidators.validate()) {\n                return;\n            }\n\n            // Create the order with PayPal\n            // Get the token from Fastlane\n            // Submit payment\n            try {\n                loader.startLoader();\n\n                let { id, paymentSource: { card: { billingAddress, name } } } = await fastlaneModel.getPaymentToken(),\n                    [firstname, ...lastname] = name.split(' '),\n                    mappedAddress = mapAddressToMagento({ address: billingAddress }),\n                    shippingAddress = quote.shippingAddress();\n\n                // Fastlane doesn't provide a phone number in the billing address so get it from shipping if available.\n                if (shippingAddress.telephone) {\n                    mappedAddress.telephone = shippingAddress.telephone;\n                }\n\n                // Add the firstname and lastname as these aren't within the billing address from Fastlane either.\n                mappedAddress.firstname = firstname;\n                mappedAddress.lastname = lastname.join(' ');\n\n                quote.billingAddress({...mappedAddress, street: Object.values(mappedAddress.street)});\n\n                if (this.isBillingAddressValid()) {\n                    if (this.threeDSMode) {\n                        id = await fastlaneModel.validate3DS(id);\n                    }\n\n                    this.fastlaneToken = id;\n                    this.placeOrder();\n                } else {\n                    this.isProcessing = false;\n                    messageList.addErrorMessage({\n                        message: $t('Your billing address is not valid.')\n                    });\n                }\n            } catch(error) {\n                loader.stopLoader();\n                messageList.addErrorMessage({\n                    message: $t('Cannot validate payment.')\n                });\n            } finally {\n                loader.stopLoader();\n            }\n        },\n\n        /**\n         * Validates the billing address in the checkout provider.\n         *\n         * @returns {Boolean}\n         */\n        isBillingAddressValid() {\n            // Load the Braintree payment form.\n            const billingAddress = uiRegistry.get('checkoutProvider');\n\n            // Reset the validation.\n            billingAddress.set('params.invalid', false);\n\n            // Call validation and also the custom attributes validation if they exist.\n            billingAddress.trigger(billingAddress.dataScopePrefix + '.data.validate');\n\n            if (billingAddress.get(billingAddress.dataScopePrefix + '.custom_attributes')) {\n                billingAddress.trigger(billingAddress.dataScopePrefix + '.custom_attributes.data.validate');\n            }\n\n            return !billingAddress.get('params.invalid');\n        },\n\n        getOrderPaymentDetails: function (data) {\n            if (!this.requiresCardDetails) {\n                return Promise.resolve(data);\n            }\n\n            return fetch(`${this.getOrderDetailsUrl}`, {\n                method: 'GET'\n            }).then((res) => {\n                return res.json();\n            }).catch(function (err) {\n                console.log(\n                    'Could not get order details. Proceeding with order placement without card details.',\n                    err\n                );\n                return data;\n            });\n        },\n\n        /** @inheritdoc */\n        getData: function () {\n            var data = this._super();\n\n            data['additional_data'] = {\n                paypal_fastlane_profile: fastlaneModel.profileData() ? 'Yes' : 'No',\n                payment_source: this.paymentSource,\n                paypal_fastlane_token: this.fastlaneToken,\n                liability_shift: fastlaneModel.liabilityShift() ?? 'false',\n                authentication_state: fastlaneModel.authenticationState() ?? 'Cancelled',\n            };\n\n            return data;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer/vault.js":"/**\n * Copyright \u00a9 2013-2017 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'mage/translate',\n    'Magento_Vault/js/view/payment/method-renderer/vault',\n    'Magento_Checkout/js/model/full-screen-loader',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'escaper'\n], function (\n    $t,\n    VaultComponent,\n    loader,\n    ResponseError,\n    escaper\n) {\n   'use strict';\n\n   return VaultComponent.extend({\n       defaults: {\n           template: 'Magento_PaymentServicesPaypal/payment/vault',\n           paymentSource: 'vault',\n           paypalOrderId: null,\n           paymentsOrderId: null,\n           generalErrorMessage: $t('An error occurred. Refresh the page and try again.'),\n           paymentMethodValidationError: $t('Your payment was not successful. Try again.'),\n           allowedTags: ['br'],\n       },\n\n       /**\n        * Get card brand\n        * @returns {String}\n        */\n       getCardBrand: function () {\n           return this.mapCardBrand(this.details.brand);\n       },\n\n       /**\n        * Map the credit card brand received from PayPal to the Commerce standard\n        * @param payPalCardBrand\n        * @returns {*}\n        */\n       mapCardBrand: function (payPalCardBrand) {\n           const cardBrandMapping = {\n               AMEX: 'AE',\n               DISCOVER: 'DI',\n               DINERS: 'DN',\n               ELO: 'ELO',\n               HIPER: 'HC',\n               JCB: 'JCB',\n               MAESTRO: 'MI',\n               MASTER_CARD: 'MC',\n               MASTERCARD: 'MC',\n               VISA: 'VI'\n           };\n\n           return cardBrandMapping[payPalCardBrand];\n       },\n\n       /**\n        * Get last 4 digits of card\n        * @returns {String}\n        */\n       getMaskedCard: function () {\n           return this.details.maskedCC;\n       },\n\n       /**\n        * Get card Description\n        * @returns {String}\n        */\n       getCardDescription: function () {\n           return this.details.description;\n       },\n\n       /**\n        * Get formatted card billing address\n        * @returns {String}\n        */\n       getFormattedCardBillingAddress: function () {\n           let billingAddress = this.details.billingAddress;\n\n           if (!billingAddress) {\n               return '';\n           }\n\n           let street1 = billingAddress.address_line_1 || '';\n           let street2 = billingAddress.address_line_2 || '';\n           let region = billingAddress.region || '';\n           let city = billingAddress.city || '';\n           let postalCode = billingAddress.postal_code || '';\n           let countryCode = billingAddress.country_code || '';\n\n           let formattedAddress = street1 + '<br/>';\n\n           if (street2 !== '') {\n               formattedAddress += street2 + '<br/>';\n           }\n\n           formattedAddress += region + ' ' + city + ' ' + postalCode + '<br/>' +\n               countryCode;\n\n           return this.getSafeHtml(formattedAddress);\n       },\n\n       /**\n        * Get card holder name\n        * @returns {String}\n        */\n       getCardHolderName: function () {\n           return this.details.cardholderName;\n       },\n\n       /**\n        * Sanitize text\n        *\n        * @param {String} html\n        * @returns {String}\n        */\n       getSafeHtml: function (html) {\n           return escaper.escapeHtml(html, this.allowedTags);\n       },\n\n       /**\n        * Get PayPal order ID\n        */\n       getData: function () {\n          let data = this._super();\n\n          data['additional_data']['paypal_order_id'] = this.paypalOrderId;\n          data['additional_data']['payments_order_id'] = this.paymentsOrderId;\n          data['additional_data']['public_hash'] = this.publicHash;\n          data['additional_data']['payment_source'] = this.paymentSource;\n          return data;\n       },\n\n       /**\n        * Place order\n        */\n       onPlaceOrder: function () {\n           loader.startLoader();\n           this.createOrder()\n               .then(function (order) {\n                   this.onOrderSuccess(order);\n               }.bind(this))\n               .then(function () {\n                   this.placeOrder();\n               }.bind(this))\n               .catch(this.onError.bind(this))\n               .finally(loader.stopLoader);\n       },\n\n       /**\n        * Create PayPal order\n        * @returns {Promise<any>}\n        */\n       createOrder: function () {\n           var orderData = new FormData();\n\n           orderData.append('payment_source', this.paymentSource);\n           orderData.append('location', this.location);\n\n           return fetch(this.createOrderUrl, {\n               method: 'POST',\n               headers: {},\n               body: orderData,\n               credentials: 'same-origin'\n           }).then(function (res) {\n               return res.json();\n           }).then(function (data) {\n               if (data.response['is_successful']) {\n                   return data.response['paypal-order'];\n               }\n           });\n       },\n\n       /**\n        * populate PayPal order ID and trigger Commerce order flow\n        * @param order\n        */\n       onOrderSuccess: function (order) {\n           this.paypalOrderId = order['id'];\n           this.paymentsOrderId = order['mp_order_id'];\n       },\n\n       /**\n        * handle payment error\n        * @param error\n        */\n       onError: function (error) {\n           var message = this.generalErrorMessage;\n\n           if (error instanceof ResponseError) {\n               message = error.message;\n           } else if (error['debug_id']) {\n               message = this.paymentMethodValidationError;\n           }\n\n           this.messageContainer.addErrorMessage({\n               message: message\n           });\n           console.log(error['debug_id'] ? 'Error' + JSON.stringify(error) : error.toString());\n       },\n   });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer/google-pay.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'Magento_Checkout/js/view/payment/default',\n    'jquery',\n    'underscore',\n    'mageUtils',\n    'Magento_Checkout/js/model/quote',\n    'mage/translate',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/google-pay',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Magento_Checkout/js/action/set-billing-address',\n    'Magento_Ui/js/model/messageList',\n    'uiRegistry',\n    'Magento_Customer/js/customer-data'\n], function (\n    Component,\n    $,\n    _,\n    utils,\n    quote,\n    $t,\n    GooglePayButton,\n    additionalValidators,\n    setBillingAddressAction,\n    globalMessageList,\n    registry,\n    customerData\n) {\n    'use strict';\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url,\n            }\n        );\n    }\n\n    return Component.extend({\n        defaults: {\n            buttonContainerId: 'google-pay-${ $.uid }',\n            template: 'Magento_PaymentServicesPaypal/payment/google-pay',\n            isAvailable: false,\n            isButtonRendered: false,\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            paymentTypeIconTitle: $t('Pay with Google Pay'),\n            requestProcessingError: $t('Error happened when processing the request. Please try again later.'),\n            notEligibleErrorMessage: $t('This payment option is currently unavailable.'),\n            paymentTypeIconUrl:  window.checkoutConfig.payment['payment_services_paypal_google_pay'].paymentTypeIconUrl,\n            fundingSource: window.checkoutConfig.payment['payment_services_paypal_google_pay'].paymentSource\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config) {\n            _.bindAll(this, 'catchError', 'beforeCreateOrder', 'afterCreateOrder', 'placeOrder', 'onClick');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.initGooglePayButton();\n\n            return this;\n        },\n\n        /**\n         * Initialize observables\n         *\n         * @returns {Component} Chainable.\n         */\n        initObservable: function () {\n            this._super().observe('isAvailable isButtonRendered');\n\n            return this;\n        },\n\n        initGooglePayButton: function () {\n            this.googlePayButton = new GooglePayButton({\n                scriptParams: window.checkoutConfig.payment[this.getCode()].sdkParams,\n                createOrderUrl: window.checkoutConfig.payment[this.getCode()].createOrderUrl,\n                onClick: this.onClick,\n                beforeCreateOrder: this.beforeCreateOrder,\n                afterCreateOrder: this.afterCreateOrder,\n                catchCreateOrder: this.catchError,\n                onError: this.catchError,\n                buttonContainerId: this.buttonContainerId,\n                onApprove: this.placeOrder,\n                styles: window.checkoutConfig.payment[this.getCode()].styles,\n                mode: window.checkoutConfig.payment[this.getCode()].mode,\n                shippingAddressRequired: false,\n                getOrderDetailsUrl: window.checkoutConfig.payment[this.getCode()].getOrderDetailsUrl,\n                threeDSMode: window.checkoutConfig.payment[this.getCode()].threeDSMode,\n                location: window.checkoutConfig.payment[this.getCode()].location,\n            });\n\n            if (!this.isPlaceOrderActionAllowed()) {\n                this.googlePayButton.disableButton();\n            }\n\n            this.isPlaceOrderActionAllowed.subscribe(function (isAllowed) {\n                if (isAllowed) {\n                    this.googlePayButton.enableButton();\n                } else {\n                    this.googlePayButton.disableButton();\n                }\n            }.bind(this));\n        },\n\n        /**\n         * Get method code\n         *\n         * @return {String}\n         */\n        getCode: function () {\n            return 'payment_services_paypal_google_pay';\n        },\n\n        /**\n         * Get method data\n         *\n         * @return {Object}\n         */\n        getData: function () {\n            return {\n                'method': this.item.method,\n                'additional_data': {\n                    'payments_order_id': this.paymentsOrderId,\n                    'paypal_order_id': this.paypalOrderId,\n                    'payment_source': this.fundingSource\n                }\n            };\n        },\n\n        onClick: function () {\n            this.googlePayButton.showLoaderAsync(true)\n                .then(() => {\n                    return this.googlePayButton.createOrder();\n                })\n                .then(() => {\n                    refreshCustomerData(window.checkoutConfig.payment[this.getCode()].createOrderUrl);\n                })\n                .catch(error => {\n                    this.catchError(error);\n                });\n        },\n\n        /**\n         * Render buttons\n         */\n        afterRender: function () {\n            this.googlePayButton.sdkLoaded\n                .then(function () {\n                    this.googlePayButton.initGoogleSDK()\n                        .then(function () {\n                            this.isAvailable(this.googlePayButton.isEligible());\n                        }.bind(this)).catch(function () {\n                            this.isAvailable(false);\n                        }.bind(this)).finally(function () {\n                            this.isButtonRendered(true);\n                        }.bind(this)\n                    );\n                }.bind(this));\n        },\n\n        /**\n         * Before order created.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            if (this.validate() && this.isPlaceOrderActionAllowed() && additionalValidators.validate()) {\n                setBillingAddressAction(globalMessageList)\n                    .fail(function () {\n                        throw {message: 'Failed to set billing address'};\n                    });\n            } else {\n                throw {message: 'before create order validation failed', hidden: true};\n            }\n        },\n\n        /**\n         * @inheritdoc\n         */\n        validate: function () {\n            var isShippingValid = true,\n                source, shippingAddress;\n\n            if (!this._super()) {\n                return false;\n            }\n            source = registry.get('checkoutProvider');\n            shippingAddress = registry.get('index = shippingAddress');\n\n            if (source && shippingAddress) {\n                source.set('params.invalid', false);\n                if (quote.billingAddress() === null) {\n                    this.triggerBillingValidation(source);\n                }\n\n                // skip shipping validation if quote is virtual or in-store pickup\n                if (!quote.isVirtual() && !quote.shippingMethod()['method_code'] === 'pickup') {\n                    isShippingValid = shippingAddress.validateShippingInformation();\n                }\n\n                return isShippingValid && !source.get('params.invalid');\n            }\n\n            return true;\n        },\n\n        /**\n         * Trigger billing address validation\n         *\n         * @param {Object} source\n         */\n        triggerBillingValidation: function (source) {\n            var dataScope = `billingAddress${ window.checkoutConfig.displayBillingOnPaymentMethod ?\n                this.getCode() : 'shared'}`;\n\n            source.trigger(`${ dataScope }.data.validate`);\n\n            if (source.get(`${dataScope}.custom_attributes`)) {\n                source.trigger(`${dataScope}.custom_attributes.data.validate`);\n            }\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {\n            if (data.response['paypal-order'] && data.response['paypal-order']['mp_order_id']) {\n                this.paymentsOrderId = data.response['paypal-order']['mp_order_id'];\n                this.paypalOrderId = data.response['paypal-order'].id;\n\n                let displayItems = [],\n                    subTotal = this.getTotalsSegment('subtotal'),\n                    shippingTotal = this.getTotalsSegment('shipping'),\n                    taxTotal = this.getTotalsSegment('tax'),\n                    discountTotal = this.getTotalsSegment('discount');\n\n                if (subTotal != null) {\n                    displayItems.push(\n                        {\n                            label: $t('Subtotal'),\n                            type: 'SUBTOTAL',\n                            price: subTotal.value.toString()\n                        }\n                    );\n                }\n                if (taxTotal != null) {\n                    displayItems.push(\n                        {\n                            label: $t('Tax'),\n                            type: 'TAX',\n                            price: taxTotal.value.toString()\n                        }\n                    );\n                }\n\n                if (shippingTotal != null) {\n                    displayItems.push(\n                        {\n                            label: $t('Shipping'),\n                            type: 'LINE_ITEM',\n                            price: shippingTotal.value.toString()\n                        }\n                    );\n                }\n\n                if (discountTotal != null) {\n                    displayItems.push(\n                        {\n                            label: $t('Discount'),\n                            type: 'LINE_ITEM',\n                            price: discountTotal.value.toString()\n                        }\n                    );\n                }\n\n                this.googlePayButton.showPopup({\n                    displayItems: displayItems,\n                    currencyCode: quote.totals()['base_currency_code'].toString(),\n                    totalPriceStatus: 'FINAL',\n                    totalPrice: quote.totals()['base_grand_total'].toString(),\n                    totalPriceLabel: $t('Total')\n                });\n\n                return this.paypalOrderId;\n            }\n\n            throw new Error();\n        },\n\n        /**\n         * Catch error.\n         *\n         * @param {Error} error\n         */\n        catchError: function (error) {\n            if (error.hidden === undefined || !error.hidden) {\n                this.messageContainer.addErrorMessage({\n                    message: this.requestProcessingError\n                });\n            }\n\n            this.googlePayButton.showLoader(false);\n\n            console.log('Error: ', error);\n        },\n\n        getTotalsSegment: function (code) {\n            var segment = null;\n\n            if (!('total_segments' in quote.totals())) {\n                return null;\n            }\n\n            quote.totals()['total_segments'].forEach(function (s) {\n                if (s.code === code) {\n                    segment = s;\n                }\n            });\n\n            return segment;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer/smart-buttons.js":"/**\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2021 Adobe\n * All Rights Reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'Magento_Checkout/js/view/payment/default',\n    'jquery',\n    'underscore',\n    'mageUtils',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/full-screen-loader',\n    'mage/translate',\n    'Magento_PaymentServicesPaypal/js/helpers/remove-paypal-url-token',\n    'Magento_PaymentServicesPaypal/js/model/app-switch-data',\n    'Magento_PaymentServicesPaypal/js/view/payment/methods/smart-buttons',\n    'Magento_PaymentServicesPaypal/js/view/payment/message',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Magento_Checkout/js/action/set-billing-address',\n    'Magento_Ui/js/model/messageList',\n    'uiRegistry',\n    'Magento_Customer/js/customer-data'\n], function (\n    Component,\n    $,\n    _,\n    utils,\n    quote,\n    fullScreenLoader,\n    $t,\n    removePayPalUrlToken,\n    appSwitchDataModel,\n    SmartButtons,\n    Message,\n    additionalValidators,\n    setBillingAddressAction,\n    globalMessageList,\n    registry,\n    customerData\n) {\n    'use strict';\n\n    var refreshCustomerData = function (url) {\n        // Trigger ajaxComplete event to update customer data\n        customerData.onAjaxComplete(\n            {},\n            {\n                type: 'POST',\n                url: url\n            }\n        );\n    };\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypalCheckoutButtons',\n            buttonsContainerId: 'smart-buttons-${ $.uid }',\n            payLaterMessageContainerId: 'pay-later-message-${ $.uid }',\n            template: 'Magento_PaymentServicesPaypal/payment/smart-buttons',\n            isAvailable: false,\n            isButtonsRendered: false,\n            grandTotalAmount: null,\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            requestProcessingError: $t('Error happened when processing the request. Please try again later.'),\n            notEligibleErrorMessage: $t('This payment option is currently unavailable.'),\n            paymentTypeIconUrl: window.checkoutConfig.payment['payment_services_paypal_smart_buttons'].paymentTypeIconUrl, // eslint-disable-line max-len\n            paymentTypeIconTitle: $t('Pay with PayPal')\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function (config) {\n            _.bindAll(this, 'onClick', 'onInit', 'catchError', 'beforeCreateOrder', 'afterCreateOrder');\n            config.uid = utils.uniqueid();\n            this._super();\n            this.initSmartButtons();\n            this.initMessage();\n            quote.totals.subscribe(function (totals) {\n                this.grandTotalAmount(totals['base_grand_total']);\n                this.message.updateAmount(totals['base_grand_total']);\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Initialize observables\n         *\n         * @returns {Component} Chainable.\n         */\n        initObservable: function () {\n            this._super().observe('grandTotalAmount isAvailable isButtonsRendered');\n            this.grandTotalAmount(quote.totals()['base_grand_total']);\n\n            return this;\n        },\n\n        /**\n         * Create instance of smart buttons.\n         */\n        initSmartButtons: function () {\n            this.buttons = new SmartButtons({\n                sdkNamespace: this.sdkNamespace,\n                scriptParams: window.checkoutConfig.payment[this.getCode()].sdkParams,\n                createOrderUrl: window.checkoutConfig.payment[this.getCode()].createOrderUrl,\n                styles: window.checkoutConfig.payment[this.getCode()].buttonStyles,\n                onInit: this.onInit,\n                onClick: this.onClick,\n                beforeCreateOrder: this.beforeCreateOrder,\n                afterCreateOrder: this.afterCreateOrder,\n                catchCreateOrder: this.catchError,\n                onApprove: function () {\n                    if (this.hasReturned) {\n                        this.setAppSwitchResumeData();\n                    }\n\n                    this.placeOrder();\n                }.bind(this),\n                onError: this.catchError,\n                location: window.checkoutConfig.payment[this.getCode()].location,\n                appSwitchWhenAvailable: window.checkoutConfig.payment[this.getCode()].appSwitchWhenAvailable\n            });\n        },\n\n        /**\n         * Initialize message component\n         */\n        initMessage: function () {\n            this.message = new Message({\n                scriptParams: window.checkoutConfig.payment[this.getCode()].sdkParams,\n                element: this.element,\n                renderContainer: '#' + this.payLaterMessageContainerId,\n                styles: window.checkoutConfig.payment[this.getCode()].messageStyles,\n                placement: 'payment',\n                amount: this.grandTotalAmount()\n            });\n        },\n\n        /**\n         * Get method code\n         *\n         * @return {String}\n         */\n        getCode: function () {\n            return 'payment_services_paypal_smart_buttons';\n        },\n\n        /**\n         * Get method data\n         *\n         * @return {Object}\n         */\n        getData: function () {\n            return {\n                'method': this.item.method,\n                'additional_data': {\n                    'payments_order_id': this.paymentsOrderId,\n                    'paypal_order_id': this.paypalOrderId,\n                    'payment_source': this.buttons.paymentSource\n                }\n            };\n        },\n\n        /**\n         * Render buttons\n         */\n        afterRender: function () {\n            this.buttons.sdkLoaded.then(function () {\n                this.buttons.setup('#' + this.buttonsContainerId);\n\n                if (this.buttons.instance.hasReturned()) {\n                    this.hasReturned = true;\n                    this.buttons.instance.resume();\n                } else {\n                    this.buttons.render();\n                }\n\n                this.renderMessage();\n                this.isAvailable(!!this.buttons.instance && this.buttons.instance.isEligible());\n            }.bind(this)).catch(function () {\n                this.isAvailable(false);\n\n                return this.buttons;\n            }.bind(this)).finally(function () {\n                this.isButtonsRendered(true);\n            }.bind(this));\n        },\n\n        /**\n         * Render message\n         */\n        renderMessage: function () {\n            if (window.checkoutConfig.payment[this.getCode()].canDisplayMessage) {\n                this.message.render();\n            }\n        },\n\n        /**\n         * Enable/disable buttons.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         */\n        onInit: function (data, actions) {\n            if (!this.isPlaceOrderActionAllowed()) {\n                actions.disable();\n            }\n\n            this.isPlaceOrderActionAllowed.subscribe(function (isAllowed) {\n                if (isAllowed) {\n                    actions.enable();\n                } else {\n                    actions.disable();\n                }\n            });\n        },\n\n        /**\n         * @inheritdoc\n         */\n        validate: function () {\n            var isShippingValid = true,\n                source, shippingAddress;\n\n            if (!this._super()) {\n                return false;\n            }\n            source = registry.get('checkoutProvider');\n            shippingAddress = registry.get('index = shippingAddress');\n\n            if (source && shippingAddress) {\n                source.set('params.invalid', false);\n                if (quote.billingAddress() === null) {\n                    this.triggerBillingValidation(source);\n                }\n\n                // skip shipping validation if quote is virtual or in-store pickup\n                if (!quote.isVirtual() && !quote.shippingMethod()['method_code'] === 'pickup') {\n                    isShippingValid = shippingAddress.validateShippingInformation();\n                }\n\n                return isShippingValid && !source.get('params.invalid');\n            }\n\n            return true;\n        },\n\n        /**\n         * Trigger billing address validation\n         *\n         * @param {Object} source\n         */\n        triggerBillingValidation: function (source) {\n            var dataScope = `billingAddress${ window.checkoutConfig.displayBillingOnPaymentMethod ?\n                this.getCode() : 'shared'}`;\n\n            source.trigger(`${ dataScope }.data.validate`);\n\n            if (source.get(`${dataScope}.custom_attributes`)) {\n                source.trigger(`${dataScope}.custom_attributes.data.validate`);\n            }\n        },\n\n        /**\n         * Validate form onClick\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         * @return {*}\n         */\n        onClick: function (data, actions) {\n            if (this.validate() && additionalValidators.validate()) {\n                // Add terms data to app switch.\n                if (window.checkoutConfig?.checkoutAgreements?.isEnabled) {\n                    const agreementsInputPath = '.payment-method._active div.checkout-agreements input';\n\n                    $(agreementsInputPath).each(function (index, element) {\n                        const termsData = appSwitchDataModel.getData('terms') || {};\n                        termsData[element.id] = element.value;\n\n                        appSwitchDataModel.setData('terms', termsData);\n                    });\n                }\n\n                const reCaptcha = $('.g-recaptcha:visible');\n                const reCaptchaId = reCaptcha && reCaptcha.last().attr('id');\n\n                // Add recaptcha if it exists.\n                if (reCaptchaId) {\n                    const reCaptchaToken = $(`#${reCaptchaId} [name=\"g-recaptcha-response\"]`).val();\n\n                    appSwitchDataModel.setData('recaptcha', reCaptchaToken);\n                }\n\n                return actions.resolve();\n\n            }\n\n            appSwitchDataModel.setData('pageType', this.pageType);\n\n            return actions.reject();\n        },\n\n        /**\n         * Before order created.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            return new Promise(function (resolve, reject) {\n                setBillingAddressAction(globalMessageList).done(resolve.bind(null, null)).fail(reject);\n            });\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {\n            if (data.response['paypal-order'] && data.response['paypal-order']['mp_order_id']) {\n                refreshCustomerData(window.checkoutConfig.payment[this.getCode()].createOrderUrl);\n\n                this.paymentsOrderId = data.response['paypal-order']['mp_order_id'];\n                this.paypalOrderId = data.response['paypal-order'].id;\n\n                appSwitchDataModel.setData('paymentsOrderId', this.paymentsOrderId);\n                appSwitchDataModel.setData('paypalOrderId', this.paypalOrderId);\n                appSwitchDataModel.setData('paymentSource', this.buttons.paymentSource);\n\n                return this.paypalOrderId;\n            }\n\n            throw new Error();\n        },\n\n        /**\n         * Catch error.\n         *\n         * @param {Error} error\n         */\n        catchError: function (error) {\n            removePayPalUrlToken();\n            this.messageContainer.addErrorMessage({\n                message: this.requestProcessingError\n            });\n            console.log('Error: ', error.message);\n\n            this.afterRender();\n        },\n\n        /**\n         * Re-initialise checkout data.\n         *\n         * This is in case the App Switch returns in a new tab.\n         */\n        setAppSwitchResumeData: function () {\n            this.paymentsOrderId = appSwitchDataModel.getData('paymentsOrderId');\n            this.paypalOrderId = appSwitchDataModel.getData('paypalOrderId');\n            this.buttons.paymentSource = appSwitchDataModel.getData('paymentSource');\n\n            // Add terms data to app switch.\n            if (window.checkoutConfig?.checkoutAgreements?.isEnabled) {\n                const terms = appSwitchDataModel.getData('terms');\n\n                if (terms) {\n                    Object.keys(terms).forEach((term) => {\n                        $(`#${term}`).prop('checked', terms[term] === '1');\n                    });\n                }\n            }\n\n            const reCaptcha = $('.g-recaptcha:visible'),\n                reCaptchaId = reCaptcha && reCaptcha.last().attr('id');\n\n            if (reCaptchaId) {\n                const reCaptchaToken = appSwitchDataModel.getData('recaptcha');\n\n                $(`#${reCaptchaId} [name=\"g-recaptcha-response\"]`).val(reCaptchaToken);\n            }\n\n            appSwitchDataModel.clearData();\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/method-renderer/hosted-fields.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'underscore',\n    'mage/translate',\n    'Magento_Checkout/js/view/payment/default',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/full-screen-loader',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'Magento_Checkout/js/action/set-billing-address',\n    'Magento_Ui/js/model/messageList',\n    'Magento_Vault/js/view/payment/vault-enabler',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Magento_PaymentServicesPaypal/js/lib/script-loader',\n    'ko'\n], function (\n    $,\n    _,\n    $t,\n    Component,\n    quote,\n    loader,\n    ResponseError,\n    setBillingAddressAction,\n    globalMessageList,\n    VaultEnabler,\n    additionalValidators,\n    scriptLoader,\n    ko\n) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            isFormValid: false,\n            invalidFields: [],\n            isAvailable: false,\n            isFormRendered: false,\n            fields: {\n                number: {\n                    class: 'card-number-field',\n                    label: $t('Credit Card Number'),\n                    errorMessage: $t('Please enter a valid credit card number.'),\n                    selector: '#${ $.formId } .${ $.fields.number.class }',\n                    placeholder: '',\n                    showLockIcon: true\n                },\n                expirationDate: {\n                    class: 'expiration-date-field',\n                    selector: '#${ $.formId } .expiration-date-field',\n                    label: $t('Expiration Date'),\n                    errorMessage: $t('Incorrect credit card expiration date.'),\n                    placeholder: 'MM/YY'\n                },\n                cvv: {\n                    class: 'cvv-field',\n                    selector: '#${ $.formId } .cvv-field',\n                    label: $t('Card Security Code'),\n                    errorMessage: $t('Please enter a valid credit card security code.'),\n                    tooltip: {\n                        title: $t('What is this?'),\n                        src:  $.cvvImgUrl,\n                        contentUnsanitizedHtml: '<img src=\"${ $.cvvImgUrl }\" ' +\n                            'alt=\"${ $.cvvTitle }\" title=\"${ $.cvvTitle }\" />'\n                    },\n                    placeholder: ''\n                }\n            },\n            cardsByCode: {\n                \"amex\": \"AE\",\n                \"discover\": \"DI\",\n                \"elo\": \"ELO\",\n                \"hiper\": \"HC\",\n                \"jcb\": \"JCB\",\n                \"mastercard\": \"MC\",\n                \"visa\": \"VI\",\n            },\n            cards: {\n                AE: {\n                    eligibilityCode: 'amex',\n                    typeCode: 'american-express'\n                },\n                DI: {\n                    eligibilityCode: 'discover',\n                    typeCode: 'discover'\n                },\n                ELO: {\n                    eligibilityCode: 'elo',\n                    typeCode: 'elo'\n                },\n                HC: {\n                    eligibilityCode: 'hiper',\n                    typeCode: 'hiper'\n                },\n                JCB: {\n                    eligibilityCode: 'jcb',\n                    typeCode: 'jcb'\n                },\n                MC: {\n                    eligibilityCode: 'mastercard',\n                    typeCode: 'master-card'\n                },\n                VI: {\n                    eligibilityCode: 'visa',\n                    typeCode: 'visa'\n                }\n            },\n            orderCreateErrorMessage: {\n                default: $t('Failed to place order. Try again or refresh the page if that does not resolve the issue.'), // eslint-disable-line max-len,\n                'POSTAL_CODE_REQUIRED': $t('Postal code is required.'),\n                'CITY_REQUIRED': $t('City is required.')\n            },\n            availableCards: [],\n            getOrderDetailsUrl: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].getOrderDetailsUrl, // eslint-disable-line max-len\n            requiresCardDetails: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].requiresCardDetails, // eslint-disable-line max-len\n            ccIcons: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].ccIcons,\n            paymentSource: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].paymentSource,\n            cvvImgUrl:  window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].cvvImageUrl,\n            isCommerceVaultEnabled: window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].isCommerceVaultEnabled, // eslint-disable-line max-len\n            emptyErrorMessage: $t('This is a required field.'),\n            paymentTypeIconUrl:  window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].paymentTypeIconUrl, // eslint-disable-line max-len\n            paymentTypeIconTitle: $t('Pay with credit card'),\n            lockTitle: $t('Secure transaction'),\n            cvvTitle: $t('The card security code is a three or four digit number printed on a credit card. Visa, Mastercard, and Discover cards have a three digit code on the card back. American Express cards have a four digit code on the card front.'), // eslint-disable-line max-len\n            paymentMethodValidationError: $t('Your payment was not successful. Ensure you have entered your details correctly and try again, or try a different payment method. If you have continued problems, contact the issuing bank for your payment method.'), // eslint-disable-line max-len\n            notEligibleErrorMessage: $t('This payment option is currently unavailable.'),\n            generalErrorMessage: '${ $.paymentMethodValidationError }',\n            placeOrderTitle: $t('Place Order'),\n            formId: 'hosted-fields-form',\n            template: 'Magento_PaymentServicesPaypal/payment/credit-card',\n            ccType: '',\n            billingAddress: quote.billingAddress,\n            paymentsOrderId: null,\n            paypalOrderId: null,\n            cardBin: null,\n            holderName: null,\n            cardLast4: null,\n            cardExpiryMonth: null,\n            cardExpiryYear: null,\n            hostedFields: null,\n            shouldCardBeVaulted: false,\n\n            paymentsSdk: null,\n            paymentsSdkInitPromise: null,\n            isInProgress: ko.observable(false),\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            _.bindAll(\n                this,\n                'onError',\n                'getOrderCardDetails'\n            );\n            this._super();\n            this.initPaymentsSDK();\n            this.initVaulting();\n\n            return this;\n        },\n\n        /**\n         * Initialize Payments SDK\n         * Load js script and initialize SDK\n         */\n        initPaymentsSDK: function () {\n            this.paymentsSdkInitPromise = new Promise(\n                function (resolve, reject) {\n                    scriptLoader.loadCustom({url: this.getPaymentsSDKUrl()})\n                        .then(function () {\n                            const sdkConfig = {\n                                storeViewCode: this.getGraphQLStoreCode()\n                            }\n\n                            if (this.getGraphQLToken()) {\n                                sdkConfig.getCustomerToken = () => this.getGraphQLToken();\n                            }\n\n                            if (this.getGraphQLUrl()) {\n                                sdkConfig.apiUrl = this.getGraphQLUrl();\n                            }\n\n                            this.paymentsSdk = new window.PaymentServicesSDK(sdkConfig);\n\n                            this.paymentsSdk.Payment.init({location: \"CHECKOUT\"})\n                                .then(() => {resolve()})\n                                .catch((e) => {reject(e)});\n                        }.bind(this)).catch((e) => {reject(e)});\n                }.bind(this)\n            );\n        },\n\n        /**\n         * Initialize vaulting\n         */\n        initVaulting: function () {\n            this.vaultEnabler = new VaultEnabler();\n            this.vaultEnabler.isActivePaymentTokenEnabler(false);\n            this.vaultEnabler.setPaymentCode(window.checkoutConfig.payment[this.getCode()].ccVaultCode);\n        },\n\n        /** @inheritdoc */\n        initObservable: function () {\n            this._super()\n                .observe('billingAddress paymentsOrderId paypalOrderId cardBin ' +\n                    'holderName cardLast4 cardExpiryMonth cardExpiryYear ' +\n                    'ccType isFormValid invalidFields availableCards isAvailable isFormRendered shouldCardBeVaulted');\n\n            return this;\n        },\n\n        /** @inheritdoc */\n        getCode: function () {\n            return 'payment_services_paypal_hosted_fields';\n        },\n\n        /** @inheritdoc */\n        getData: function () {\n            var data = this._super();\n\n            data['additional_data'] = {\n                payments_order_id: this.paymentsOrderId(),\n                paypal_order_id: this.paypalOrderId(),\n                payment_source: this.paymentSource\n            };\n\n            if (this.cardBin()) {\n                data['additional_data']['cardBin'] = this.cardBin();\n            }\n\n            if (this.holderName()) {\n                data['additional_data']['holderName'] = this.holderName();\n            }\n\n            if (this.cardLast4()) {\n                data['additional_data']['cardLast4'] = this.cardLast4();\n            }\n\n            if (this.cardExpiryMonth()) {\n                data['additional_data']['cardExpiryMonth'] = this.cardExpiryMonth();\n            }\n\n            if (this.cardExpiryYear()) {\n                data['additional_data']['cardExpiryYear'] = this.cardExpiryYear();\n            }\n\n            this.vaultEnabler.visitAdditionalData(data);\n            return data;\n        },\n\n        /** @inheritdoc */\n        afterRender: function () {\n            this.$form = $('#' + this.formId);\n\n            this.paymentsSdkInitPromise.then(function () {\n                this.isAvailable(this.paymentsSdk.Payment.CreditCard.isAvailable())\n\n                if (!this.isAvailable()) {\n                    this.isFormRendered(true);\n                    return;\n                }\n\n                this.paymentsSdk.Payment.CreditCard.render({\n                    fields: {\n                        number: {\n                            selector: this.fields.number.selector,\n                            label: this.fields.number.label,\n                            class: this.fields.number.class,\n                        },\n                        expirationDate: {\n                            selector: this.fields.expirationDate.selector,\n                            label: this.fields.expirationDate.label,\n                            class: this.fields.expirationDate.class,\n                        },\n                        cvv: {\n                            selector: this.fields.cvv.selector,\n                            label: this.fields.cvv.label,\n                            class: this.fields.cvv.class,\n                        },\n                    },\n                    styles: {\n                        input: {\n                            color: '#ccc',\n                            'font-family': '\"Open Sans\",\"Helvetica Neue\",Helvetica,Arial,sans-serif',\n                            'font-size': '16px',\n                            'font-weight': '400'\n                        },\n                        ':focus': {\n                            color: '#333'\n                        },\n                        '.valid': {\n                            color: '#333'\n                        }\n                    },\n                    onRender: this.onRender.bind(this),\n                    getCartId: this.getMaskedCardId,\n                    onStart: this.onStart.bind(this),\n                    onSuccess: this.onSuccess.bind(this),\n                    getBillingAddress: this.getBillingAddress.bind(this),\n                    getShouldVaultCard: () => this.isCommerceVaultEnabled && this.checkShouldCardBeVaulted(),\n                    onValidityChange: this.onValidityChange.bind(this),\n                    onCardTypeChange: this.onCardTypeChange.bind(this),\n                    onError: this.onError.bind(this),\n                });\n            }.bind(this))\n                .catch((e) => {\n                    console.log('Error initializing Payments SDK', e);\n                    this.isFormRendered(true);\n                    this.isAvailable(false);\n                });\n        },\n\n        /**\n         * Get masked cart id\n         */\n        getMaskedCardId: function () {\n            return window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].quoteMaskedId;\n        },\n\n        /**\n         * Get Payments SDK URL to load JS script\n         */\n        getPaymentsSDKUrl: function () {\n            return window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].paymentsSDKUrl;\n        },\n\n        /**\n         * Get GraphQL store code to use in GraphQL requests\n         */\n        getGraphQLStoreCode: function () {\n            return window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].storeViewCode;\n        },\n\n        /**\n         * Get GraphQL edpoint\n         */\n        getGraphQLUrl: function () {\n            return window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].graphQLEndpointUrl;\n        },\n\n        /**\n         * Get GraphQL token for authentication\n         */\n        getGraphQLToken: function () {\n            return window.checkoutConfig.payment['payment_services_paypal_hosted_fields'].oauthToken;\n        },\n\n        /**\n         * Provide billing address for the order\n         */\n        getBillingAddress: function () {\n            return {\n                firstName: this.billingAddress().firstname,\n                lastName: this.billingAddress().lastname,\n                streetAddress: this.billingAddress().street[0],\n                extendedAddress: this.billingAddress().street[1],\n                region: this.billingAddress().region,\n                locality: this.billingAddress().city,\n                postalCode: this.billingAddress().postcode,\n                countryCodeAlpha2: this.billingAddress().countryId,\n            };\n        },\n\n        /**\n         * Start callback for Hosted Fields\n         * Called when the form is submitted\n         *\n         * @param preventCheckout\n         * @returns {Promise<void>}\n         */\n        onStart: async function (preventCheckout) {\n            if (!this.canProceedWithOrder()) {\n                preventCheckout(\"invalid form\");\n            }\n\n            loader.startLoader();\n\n            await setBillingAddressAction(globalMessageList);\n        },\n\n        /**\n         * Success callback for Hosted Fields\n         * Called when PP order is created and card details are collected\n         *\n         * @param data\n         */\n        onSuccess: function (data) {\n            this.paymentsOrderId(data.mpOrderId);\n            this.paypalOrderId(data.payPalOrderId);\n\n            this.getOrderCardDetails()\n                .then(this.placeOrder.bind(this))\n                .catch(this.onError.bind(this));\n        },\n\n        /**\n         * Called after Hosted Fields are rendered\n         *\n         * @param hostedFields\n         */\n        onRender: function (hostedFields)  {\n            this.isFormValid(false);\n            this.ccType('');\n            this.invalidFields([]);\n\n            var cards = hostedFields.getEligibleCards()\n                .filter(card => this.cardsByCode[card.code] !== undefined)\n                .map(card => this.cardsByCode[card.code]);\n\n            this.availableCards(cards);\n\n            this.$form.off('submit');\n            this.$form.on('submit', function (e) {\n                e.preventDefault();\n                this.isInProgress(true);\n                hostedFields.submit()\n                    .catch(this.onError.bind(this))\n                    .finally(function () {\n                        loader.stopLoader();\n                        this.isInProgress(false);\n                    }.bind(this));\n            }.bind(this));\n\n            this.isFormRendered(true);\n        },\n\n        /**\n         * Validity change handler.\n         *\n         * @param {Object} hostedFields\n         * @param {Object} event\n         */\n        onValidityChange: function (fields, emittedBy) {\n            var valid = _.every(fields, function (field) {return field.isValid});\n            var invalidFields = this.invalidFields().filter(field => field.name !== emittedBy);\n\n            if (!valid) {\n                if (fields[emittedBy] && !fields[emittedBy].isValid) {\n                    invalidFields.push({\n                        name: emittedBy,\n                        message: fields[emittedBy].isEmpty ? this.emptyErrorMessage : this.fields[emittedBy].errorMessage\n                    });\n                }\n                this.invalidFields(invalidFields)\n            }\n\n            this.isFormValid(valid);\n            this.isFormValid() && this.invalidFields([]);\n        },\n\n        /**\n         * Check if field is valid.\n         *\n         * @param {String} fieldName\n         * @return {Boolean}\n         */\n        isFieldValid: function (fieldName) {\n            return !this.invalidFields.findWhere({\n                name: fieldName\n            });\n        },\n\n        /**\n         * Get error message for field.\n         *\n         * @param {String} fieldName\n         * @return {String}\n         */\n        getFieldErrorMessage: function (fieldName) {\n            return !this.isFieldValid(fieldName) ? this.invalidFields.findWhere({\n                name: fieldName\n            }).message : '';\n        },\n\n        /**\n         * Card type changes handler.\n         *\n         * @param {Array} a list of cards\n         */\n        onCardTypeChange: function (cards) {\n            var code = '';\n\n            if (cards.length === 1 && this.cardsByCode[cards[0].code]) {\n                code = this.cardsByCode[cards[0].code]\n            }\n\n            this.ccType(code);\n        },\n\n        /**\n         * Get order card details\n         * Used when Signifyd is enabled and requires card details\n         *\n         * @param response\n         * @returns {Promise<any>|Promise<Awaited<unknown>>}\n         */\n        getOrderCardDetails: function (response) {\n            if (!this.requiresCardDetails) {\n                return Promise.resolve(response);\n            }\n\n            return fetch(`${this.getOrderDetailsUrl}`, {\n                method: 'GET'\n            }).then(function (res) {\n                return res.json();\n            }).then(function (data) {\n                if (data.response['is_successful'] && data.response['paypal-order']) {\n                    const order = data.response['paypal-order'];\n\n                    this.cardBin(order?.payment_source_details?.card?.bin_details?.bin);\n                    this.holderName(order?.payment_source_details?.card?.name);\n                    this.cardLast4(order?.payment_source_details?.card?.last_digits);\n                    this.cardExpiryMonth(order?.payment_source_details?.card?.card_expiry_month);\n                    this.cardExpiryYear(order?.payment_source_details?.card?.card_expiry_year);\n                }\n\n                return response;\n            }.bind(this)).catch(function (err) {\n                console.log(\n                    'Could not get order details. Proceeding with order placement without card details',\n                    err\n                );\n                return response;\n            });\n        },\n\n        /**\n         * Error callback for transaction.\n         */\n        onError: function (error) {\n            loader.stopLoader();\n            var message = this.generalErrorMessage;\n\n            if (error instanceof ResponseError) {\n                message = error.message;\n            } else if (error['debug_id']) {\n                message = this.paymentMethodValidationError;\n            }\n\n            if (this.isOrderCreateError(error)) {\n                message = this.parseOrderCreateError(error);\n            }\n\n            this.messageContainer.addErrorMessage({\n                message: message\n            });\n\n            if (error instanceof Error) {\n                console.log(error.toString());\n            } else {\n                console.log('Error' + JSON.stringify(error));\n            }\n        },\n\n        /**\n         * Place order\n         * Click event handler for place order button\n         */\n        placeOrderClick: function () {\n            if (this.isPlaceOrderActionAllowed() === true) {\n                $('#' + this.formId).trigger('submit');\n            }\n        },\n\n        /**\n         * Check if customer checks the \"Save for later\" box upon checkout\n         *\n         * @returns {*}\n         */\n        checkShouldCardBeVaulted: function () {\n            const checked = this.vaultEnabler.isActivePaymentTokenEnabler();\n\n            this.shouldCardBeVaulted(checked);\n            return checked;\n        },\n\n        /**\n         * Check if the form is valid and the order can be placed\n         *\n         * @returns {*}\n         */\n        canProceedWithOrder: function () {\n            return this.validate()\n                && additionalValidators.validate()\n                && this.isFormValid()\n                && this.isPlaceOrderActionAllowed();\n        },\n\n        isOrderCreateError: function (error) {\n            return error?.cause?.graphQLErrors\n                ?.find(e => e?.path?.join(\"\").indexOf(\"createPaymentOrder\") > -1) !== undefined;\n        },\n\n        parseOrderCreateError: function (error) {\n            if (this.isErrorCode(error, 'POSTAL_CODE_REQUIRED')) {\n                return this.orderCreateErrorMessage.POSTAL_CODE_REQUIRED;\n            }\n\n            if (this.isErrorCode(error, 'CITY_REQUIRED')) {\n                return this.orderCreateErrorMessage.CITY_REQUIRED;\n            }\n\n            return this.orderCreateErrorMessage.default;\n        },\n\n        isErrorCode: function (error, code) {\n            return error?.cause?.graphQLErrors\n                ?.find(e => e?.path?.join(\"\").indexOf(\"createPaymentOrder\") > -1)\n                ?.extensions?.debugMessage?.indexOf(code) > -1;\n        }\n\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/actions/get-sdk-params.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'underscore',\n    'Magento_Customer/js/customer-data',\n    'jquery/jquery-storageapi'\n], function ($, _, customerData) {\n    'use strict';\n\n    var promise = null,\n        timeoutKey = 'payments-sdk-params-timeout',\n        paymentsKey = 'payments',\n        sdkParamsKey = 'sdkParams';\n\n    return function (cacheTtl) {\n        if (!promise) {\n            promise = new Promise(function (resolve, reject) {\n                var dateNow = Date.now(),\n                    dateTo = dateNow + cacheTtl,\n                    timeout = $.localStorage.get(timeoutKey);\n                if (timeout < dateNow || !timeout) {\n                    return customerData.reload([paymentsKey]).done(function () {\n                        $.localStorage.set(timeoutKey, dateTo);\n                        resolve(customerData.get(paymentsKey)()[sdkParamsKey]);\n                    }).fail(reject.bind(this, []));\n                }\n\n                if (!_.isEmpty(customerData.get(paymentsKey)())) {\n                    return resolve(customerData.get(paymentsKey)()[sdkParamsKey]);\n                }\n\n                customerData.get(paymentsKey).subscribe(function (payments) {\n                    resolve(payments[sdkParamsKey]);\n                });\n\n            });\n        }\n\n        return promise;\n    };\n});\n","Magento_PaymentServicesPaypal/js/view/payment/methods/apple-pay.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'underscore',\n    'uiComponent',\n    'scriptLoader',\n    'Magento_PaymentServicesPaypal/js/lib/script-loader',\n    'Magento_Customer/js/customer-data',\n    'Magento_Customer/js/model/customer',\n    'mage/translate',\n], function ($, _, Component, loadSdkScript, scriptLoader, customerData, customer, $t) {\n    'use strict';\n\n    const HTTP_STATUS_CREATED = 201;\n\n    const APPLE_PAY_VERSION_NUMBER = 4; // See https://developer.apple.com/documentation/apple_pay_on_the_web/apple_pay_js_api/creating_an_apple_pay_session\n    const appleSDKSrc = 'https://applepay.cdn-apple.com/jsapi/v1/apple-pay-sdk.js';\n\n    /**\n     * Create order request.\n     *\n     * @param {String} url\n     * @param {Object} payPalOrderData\n     * @param {FormData} orderData\n     * @return {Object}\n     */\n    var performCreateOrder = function (url, payPalOrderData, orderData) {\n\n            orderData = orderData || new FormData();\n            orderData.append('form_key', $.mage.cookies.get('form_key'));\n            orderData.append('payment_source', payPalOrderData['paymentSource']);\n\n            let xhr = new XMLHttpRequest();\n            xhr.open('POST', url, false);\n            xhr.send(orderData);\n\n            if (xhr.status !== HTTP_STATUS_CREATED) {\n                throw new Error('Request failed');\n            } else {\n                return JSON.parse(xhr.responseText);\n            }\n        },\n\n        /**\n         * Payment authorization request.\n         *\n         * @return {Promise<Object>}\n         */\n        performOnAuthorize = function (url, data) {\n            var orderData = new FormData();\n\n            orderData.append('form_key', $.mage.cookies.get('form_key'));\n            orderData.append('paypal_order_id', data.orderID);\n\n            return fetch(url, {\n                method: 'POST',\n                headers: {},\n                body: orderData,\n                credentials: 'same-origin'\n            }).then(function (response) {\n                return response.json();\n            });\n        };\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypal',\n            paypal: null,\n            paymentSource: 'applepay',\n            createOrderUrl: '',\n            placeOrderUrl: '',\n            updateQuoteUrl: '',\n            estimateShippingMethodsWhenLoggedInUrl: '',\n            estimateShippingMethodsWhenGuestUrl: '',\n            shippingInformationWhenLoggedInUrl: '',\n            shippingInformationWhenGuestUrl: '',\n            updatePaypalOrderUrl: '',\n            setQuoteAsInactiveUrl: '',\n            countriesUrl: '',\n            instance: null,\n            scriptParams: {},\n            allowedPaymentMethods: null,\n            merchantInfo: null,\n            buttonContainerId: null,\n            paypalOrderId: null,\n            eligible: false,\n            applePayInstance: null,\n            applePayConfig: null,\n            appleSession: null,\n            applePayVersionNumber: APPLE_PAY_VERSION_NUMBER,\n            countryCode: null,\n            regionCode: null,\n            regionId: null,\n            postalCode: null,\n            requestProcessingError: $t('Something went wrong with your request. Please try again later.'),\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            _.bindAll(this, 'createOrder', 'onApprove', 'onError', 'initAppleSDK', 'performAuthorization',\n                'onClick', 'beforeOnAuthorize', 'afterOnAuthorize', 'onCancel');\n            this._super();\n            this.sdkLoaded = Promise.all([this.loadPayPalSDK(), this.loadAppleSDK()]);\n\n            return this;\n        },\n\n        loadPayPalSDK: function () {\n            return loadSdkScript(this.scriptParams, this.sdkNamespace)\n                .then(function (sdkScript) {\n                    this.paypal = sdkScript;\n                }.bind(this))\n                .catch(function (e) {\n                    this.onError(e);\n                });\n        },\n\n        loadAppleSDK: function () {\n            return scriptLoader.loadCustom({url: appleSDKSrc})\n                .catch(function (e) {\n                    this.onError(e);\n                });\n        },\n\n        isCustomerLoggedIn: function () {\n            return customer.isLoggedIn();\n        },\n\n        initAppleSDK: function () {\n            if (!window.ApplePaySession) {\n                console.warn('This device does not support Apple Pay');\n                return;\n            }\n\n            if (!ApplePaySession.canMakePayments()) {\n                console.warn('This device is not capable of making Apple Pay payments');\n            }\n\n            this.applePayInstance = this.paypal.Applepay();\n            return this.applePayInstance.config()\n                .then(applePayConfig => {\n                    this.applePayConfig = applePayConfig;\n                    this.renderApplePayButton();\n                })\n                .catch(applepayConfigError => {\n                    console.error('Error while fetching Apple Pay configuration.');\n                });\n        },\n\n        onApplePayValidateMerchant: function (applePaySession) {\n            applePaySession.onvalidatemerchant = (event) => {\n                this.applePayInstance\n                    .validateMerchant({\n                        validationUrl: event.validationURL,\n                    })\n                    .then((payload) => {\n                        applePaySession.completeMerchantValidation(payload.merchantSession);\n                    })\n                    .catch((error) => {\n                        applePaySession.abort();\n                        this.isErrorDisplayed = false;\n                        this.catchError(error)\n                    });\n            };\n        },\n\n        onApplePayPaymentAuthorized: function (applePaySession, paypalOrderId = null) {\n            applePaySession.onpaymentauthorized = async (event) => {\n                try {\n                    let shippingContact = event.payment.shippingContact;\n\n                    // Remove non-numeric characters from phone number as Paypal doesn't allow it\n                    if (shippingContact && shippingContact.phoneNumber) {\n                        shippingContact = {\n                            ...shippingContact,\n                            phoneNumber: shippingContact.phoneNumber.replace(/\\D/g, '')\n                        };\n                    }\n\n                    await this.applePayInstance.confirmOrder({\n                        orderId: paypalOrderId !== null ? paypalOrderId : this.paypalOrderId,\n                        token: event.payment.token,\n                        billingContact: event.payment.billingContact,\n                        shippingContact: shippingContact\n                    });\n\n                    applePaySession.completePayment({\n                        status: window.ApplePaySession.STATUS_SUCCESS,\n                    });\n\n                    await this.onApprove();\n                } catch (error) {\n                    applePaySession.completePayment({\n                        status: window.ApplePaySession.STATUS_FAILURE,\n                    });\n                    this.isErrorDisplayed = false;\n                    this.catchError(error)\n                }\n            };\n        },\n\n        onApplePayShippingContactSelected: function (applePaySession, quoteId, total, isVirtual) {\n            applePaySession.onshippingcontactselected = (event) => {\n\n                const shippingMethods = [];\n\n                let estimateShippingMethodURL = (this.isCustomerLoggedIn())\n                    ? this.estimateShippingMethodsWhenLoggedInUrl\n                    : this.estimateShippingMethodsWhenGuestUrl.replace(':cartId', quoteId);\n\n                if (this.location === 'product') {\n                    // Product Page: we need to use guest cart quote because it is created outside the checkout process\n                    estimateShippingMethodURL = this.estimateShippingMethodsWhenGuestUrl.replace(':cartId', quoteId);\n                }\n\n                this.countryCode = event.shippingContact.countryCode;\n                this.regionCode = event.shippingContact.administrativeArea;\n                this.postalCode = event.shippingContact.postalCode;\n\n                this.getRegionIdByCode(this.regionCode, this.countryCode)\n                    .then((regionId) => {\n                        this.regionId = regionId;\n                    })\n                    .catch((error)=>  {\n                        // If the Apple region Code doesn't match to the one in Commerce\n                        // we set the regionId to null to still apply the taxes of the country\n                        // to continue with the checkout\n                        console.log(error);\n                        this.regionId = null;\n                    });\n\n                $.ajax({\n                    type: 'POST',\n                    url: estimateShippingMethodURL,\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    data: JSON.stringify({\n                        address: {\n                            country_id: event.shippingContact.countryCode,\n                            postcode: event.shippingContact.postalCode,\n                            city: event.shippingContact.locality\n                        }\n                    })\n                }).then(estimateShippingMethods => {\n\n                    estimateShippingMethods.forEach(method => {\n                        shippingMethods.push({\n                            label: method.method_title,\n                            detail: method.carrier_title,\n                            amount: method.amount.toString(),\n                            identifier: method.carrier_code + '_' + method.method_code,\n                        });\n                    });\n\n                    applePaySession.completeShippingContactSelection({\n                        newShippingMethods: shippingMethods,\n                        newTotal: total,\n                    })\n\n                }, error => {\n                    this.isErrorDisplayed = false;\n                    applePaySession.abort();\n                    this.catchError(error);\n                });\n\n                if (isVirtual) {\n                    // If Quote is virtual, no need to select shipping\n                    // We can already create the order\n                    this.createOrder();\n                }\n            }\n        },\n\n        onApplePayShippingMethodSelectedInCartPage: function (applePaySession, quoteId) {\n            this.onApplePayShippingMethodSelected(applePaySession, quoteId, null,null);\n        },\n\n        onApplePayShippingMethodSelected: function (applePaySession, quoteId, quoteMaskedId, paypalOrderId) {\n           applePaySession.onshippingmethodselected = (event) => {\n\n                let shippingInformationURL = (this.isCustomerLoggedIn())\n                    ? this.shippingInformationWhenLoggedInUrl\n                    : this.shippingInformationWhenGuestUrl.replace(':quoteId', quoteId);\n\n                if (this.location === 'product') {\n                    // Product Page: we need to use quoteMaskedId as the quote is created outside the checkout process\n                    shippingInformationURL = this.shippingInformationWhenGuestUrl.replace(':quoteId', quoteMaskedId);\n                }\n\n                $.ajax({\n                    type: 'POST',\n                    url: shippingInformationURL,\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    data: JSON.stringify({\n                        addressInformation: {\n                            shipping_address: {\"country_id\": this.countryCode, \"region_id\": this.regionId, \"postcode\": this.postalCode},\n                            shipping_method_code: event.shippingMethod.identifier.split('_')[1],\n                            shipping_carrier_code: event.shippingMethod.identifier.split('_')[0],\n                            extension_attributes: {}\n                        }\n                    })\n                }).then(result => {\n\n                    let items = [];\n\n                    result['totals']['items'].forEach(item => {\n                        items.push({\n                            label: item.name + ' ( x ' + item.qty + ' )',\n                            type: \"final\",\n                            amount: item.row_total\n                        });\n                    });\n\n                    items.push({\n                        label: \"Shipping\",\n                        type: \"final\",\n                        amount: result['totals']['shipping_amount'],\n                    });\n\n                    if (result['totals']['tax_amount'] !== 0) {\n                        items.push({\n                            label: \"Tax\",\n                            type: \"final\",\n                            amount: result['totals']['tax_amount'],\n                        });\n                    }\n\n                    applePaySession.completeShippingMethodSelection({\n                        newLineItems: items,\n                        newTotal: {\n                            label: \"Summary\",\n                            type: \"final\",\n                            amount: result['totals']['grand_total'],\n                        },\n                    });\n\n                    if (this.location === 'product') {\n                        // In the product page, the paypal order has been created on the onClick handler\n                        // so we just need to update the amount with the shipping selected\n                        this.updatePaypalOrder();\n                    } else {\n                        // In Cart and Minicart, we need to create the Paypal Order\n                        this.createOrder();\n                    }\n\n                }).catch(error => {\n                    applePaySession.abort();\n                    this.isErrorDisplayed = false;\n                    this.catchError(error);\n                });\n            };\n        },\n\n        updatePaypalOrder: function() {\n\n            // Update PayPal Order Amount as the shipping method has been selected and the price changed\n            // Without the update, the payment is failing as the order amount could be different\n            $.ajax({\n                type: 'POST',\n                url: this.updatePayPalOrderUrl,\n            }).catch(error => {\n                this.catchError(error);\n            });\n        },\n\n        onApplePayCancel: function (applePaySession, callback) {\n            applePaySession.oncancel = () => {\n                if (typeof callback === 'function') {\n                    callback();\n                }\n\n                this.showLoader(false);\n            }\n        },\n\n        getApplePaymentRequestLineItems: function (quote){\n            let items = [];\n\n            quote.getItems().forEach(item => {\n                items.push({\n                    label: item.name + ' ( x ' + item.qty + ' )',\n                    type: \"final\",\n                    amount: item.price * item.qty,\n                });\n            });\n\n            items.push({\n                label: $t(\"Shipping\"),\n                type: \"final\",\n                amount: quote.getTotals()()['shipping_amount'],\n            });\n\n            if (quote.getTotals()['tax_amount'] !== 0) {\n                items.push({\n                    label: $t(\"Tax\"),\n                    type: \"final\",\n                    amount: quote.getTotals()()['tax_amount'],\n                });\n            }\n\n            return items;\n        },\n\n        showPopup: function (paymentData, quote) {\n            const paymentRequest = {\n                countryCode: this.applePayConfig.countryCode,\n                merchantCapabilities: this.applePayConfig.merchantCapabilities,\n                supportedNetworks: this.applePayConfig.supportedNetworks,\n                currencyCode: paymentData.response['paypal-order']['currency_code'],\n                lineItems: this.getApplePaymentRequestLineItems(quote),\n                requiredBillingContactFields: [\"postalAddress\"],\n                shippingContact: {\n                    countryCode: quote.shippingAddress().countryId,\n                    postalCode: quote.shippingAddress().postcode,\n                    locality: quote.shippingAddress().city,\n                    administrativeArea: quote.shippingAddress().regionCode,\n                    familyName: quote.shippingAddress().lastname,\n                    givenName: quote.shippingAddress().firstname,\n                    addressLines: quote.shippingAddress().street,\n                },\n                total: {\n                    label: $t(\"Summary\"),\n                    type: \"final\",\n                    amount: Number(paymentData.response['paypal-order']['amount']).toString(),\n                }\n            };\n\n            // See https://developer.apple.com/documentation/apple_pay_on_the_web/applepaysession\n            this.applePaySession = new ApplePaySession(APPLE_PAY_VERSION_NUMBER, paymentRequest);\n            this.onApplePayValidateMerchant(this.applePaySession);\n            this.onApplePayPaymentAuthorized(this.applePaySession, paymentData.response['paypal-order']['id']);\n            this.onApplePayCancel(this.applePaySession);\n\n            this.applePaySession.begin();\n        },\n\n        onCancel: function () {\n            window.location = data.redirectUrl;\n            this.showLoader(false);\n        },\n\n        renderApplePayButton: function () {\n            if (this.applePayConfig.isEligible) {\n                const buttonStyle = this.mapButtonStyle();\n                const buttonType = this.mapButtonType();\n                const height = this.styles.height > 0\n                    ? this.styles.height + \"px\"\n                    : \"40px\";\n\n                const btnId = this.generateUniqueElementId();\n                document.getElementById(this.buttonContainerId).innerHTML = `\n                <apple-pay-button\n                    id=\"${btnId}\"\n                    buttonstyle=\"${buttonStyle}\"\n                    type=\"${buttonType}\"\n                    locale=\"${window.LOCALE}\"\n                    style=\" --apple-pay-button-width: 100%; --apple-pay-button-height: ${height}\"\n                >`;\n                document.getElementById(btnId).addEventListener(\"click\", this.onClick);\n            }\n        },\n\n        generateUniqueElementId: function() {\n            return `btn-appl-${Date.now()}-${Math.floor(Math.random() * 1000)}`;\n        },\n\n        mapButtonStyle: function () {\n            return this.styles.color === 'white' ? 'white' : 'black';\n        },\n\n        mapButtonType: function () {\n            switch (this.styles.label) {\n                case 'paypal':\n                case 'installment':\n                    return 'plain';\n                case 'checkout':\n                    return 'check-out';\n                case 'buynow':\n                    return 'buy';\n                default:\n                    return 'pay';\n            }\n        },\n\n        enableButton: function () {\n            $('#' + this.buttonContainerId).find('button').prop('disabled', false);\n        },\n\n        disableButton: function () {\n            $('#' + this.buttonContainerId).find('button').prop('disabled', true);\n        },\n\n        performAuthorization: function (paymentData) {},\n\n        onClick: function () {},\n\n        /**\n         * Calls before create order.\n         */\n        beforeCreateOrder: function () {},\n\n        /**\n         * Create order.\n         *\n         * @return {String}\n         */\n        createOrder: function () {\n            let data = {'paymentSource': this.paymentSource};\n\n            // add location to the order create request\n            let createOrderData = new FormData();\n            createOrderData.append('location', this.location);\n\n            try {\n                this.beforeCreateOrder();\n                let orderData = performCreateOrder(this.createOrderUrl, data, createOrderData);\n                this.paypalOrderId = this.afterCreateOrder(orderData);\n                return this.paypalOrderId;\n            } catch (error) {\n                this.isErrorDisplayed = false;\n                this.catchError(error);\n\n                // Propagate the error to be caught in the promise chain\n                return Promise.reject(error);\n            }\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {},\n\n        /**\n         * Catch error on order creation.\n         */\n        catchCreateOrder: function () {},\n\n        /**\n         * On payment approve.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         * @return {Promise}\n         */\n        onApprove: function () {\n            const data = {orderID: this.paypalOrderId};\n\n            return this.beforeOnAuthorize()\n                .then(performOnAuthorize.bind(this, this.updateQuoteUrl, data))\n                .then(this.afterOnAuthorize)\n                .catch(this.onError);\n        },\n\n        beforeOnAuthorize: function () {\n            return Promise.resolve();\n        },\n\n        afterOnAuthorize: function () {\n            return Promise.resolve();\n        },\n\n        /**\n         * Calls when error happened on paypal side.\n         *\n         * @param {Error} error\n         */\n        onError: function (error) {\n            console.log('Error: ', error.message);\n        },\n\n        isEligible: function () {\n            return this.eligible;\n        },\n\n        /**\n         * Async Show/hide loader\n         *\n         * @param {Boolean} show\n         */\n        showLoaderAsync: function (show) {\n            return new Promise(function (resolve, reject) {\n                var event = show ? 'processStart' : 'processStop';\n                $('body').trigger(event);\n\n                // Set minimum time for loader to show\n                setTimeout(() => {\n                    resolve();\n                }, 50);\n            });\n        },\n\n        /**\n         * Show/hide loader.\n         *\n         * @param {Boolean} show\n         */\n        showLoader: function (show) {\n            var event = show ? 'processStart' : 'processStop';\n\n            $('body').trigger(event);\n        },\n\n        /**\n         *  Get region ID by region code and country code\n         *\n         * @param regionCode\n         * @param countryCode\n         * @returns {null}\n         */\n        getRegionIdByCode: function (regionCode, countryCode) {\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: this.countriesUrl.replace(':countryCode', countryCode),\n                    method: 'GET',\n                    success: function (response) {\n                        if (response.available_regions && response.available_regions.length) {\n                            var matchedRegion = response.available_regions.find(function (region) {\n                                return region.code === regionCode;\n                            });\n\n                            if (matchedRegion) {\n                                resolve(matchedRegion.id);\n                            } else {\n                                reject('Region not found');\n                            }\n                        } else {\n                            reject('No regions available for country: ' + countryCode);\n                        }\n                    },\n                    error: function () {\n                        reject('Error fetching regions for country: ' + countryCode);\n                    }\n                });\n            }.bind(this));\n        },\n\n        /**\n         * Catch errors.\n         *\n         * @param {*} error\n         */\n        catchError: function (error) {\n            this.showLoader(false);\n\n            if (this.isErrorDisplayed) {\n                return;\n            }\n\n            if (error.hidden === undefined || !error.hidden) {\n                this.addMessage(this.requestProcessingError);\n            }\n\n            this.isErrorDisplayed = true;\n        },\n\n        /**\n         * Add message to customer data.\n         *\n         * @param {String} message\n         * @param {String} [type]\n         */\n        addMessage: function (message, type) {\n            type = type || 'error';\n\n            // Need to set a slight delay to avoid refresh from core\n            setTimeout(function () {\n                customerData.set('messages', {\n                    messages: [{\n                        text: message,\n                        type: type\n                    }]\n                });\n            }, 1000);\n        },\n\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/methods/smart-buttons.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'underscore',\n    'uiComponent',\n    'scriptLoader',\n    'Magento_Customer/js/customer-data',\n    'Magento_PaymentServicesPaypal/js/helpers/remove-paypal-url-token',\n    'Magento_PaymentServicesPaypal/js/model/app-switch-data',\n    'Magento_PaymentServicesPaypal/js/view/payment/actions/get-sdk-params'\n], function ($, _, Component, loadSdkScript, customerData, removePayPalUrlToken, appSwitchDataModel, getSdkParams) {\n    'use strict';\n\n    /**\n     * Create order request.\n     *\n     * @param {String} url\n     * @param {Object} payPalOrderData\n     * @param {FormData} orderData\n     * @return {Promise<Object>}\n     */\n    const performCreateOrder = function (url, payPalOrderData, orderData) {\n        orderData = orderData || new FormData();\n        orderData.append('form_key', $.mage.cookies.get('form_key'));\n        orderData.append('payment_source', payPalOrderData['paymentSource']);\n\n        return fetch(url, {\n            method: 'POST',\n            headers: {},\n            body: orderData || new FormData(),\n            credentials: 'same-origin'\n        }).then(function (response) {\n            return response.json();\n        });\n    },\n\n    /**\n     * Payment authorization request.\n     *\n     * @return {Promise<Object>}\n     */\n    performAuthorization = function (url, data) {\n        return fetch(url, {\n            method: 'POST',\n            headers: {\n                'X-Requested-With': 'XMLHttpRequest',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                orderId: data.orderID\n            })\n        }).then((response) => {\n            if (!response.ok) {\n                throw new Error($t('We\u2019re unable to take that order right now.'));\n            }\n            return response.json();\n        }).then((response)  => {\n            const parsed = JSON.parse(response);\n\n            if (!parsed.success) {\n                throw new Error($t('We\u2019re unable to take that order right now.'));\n            }\n\n            customerData.invalidate(['cart']);\n            window.location.replace(parsed.redirectUrl);\n        });\n    };\n\n    return Component.extend({\n        defaults: {\n            sdkParamsKey: 'paypal',\n            sdkParams: [],\n            cacheTtl: 30000,\n            sdkNamespace: 'paypal',\n            paypal: null,\n            paymentSource: '',\n            creatOrderUrl: '',\n            placeOrderUrl: '',\n            authorizeOrderUrl: '',\n            setQuoteAsInactiveUrl: '',\n            completeOrderUrl: '',\n            style: {},\n            paymentRequest: {\n                applepay: {\n                    requiredShippingContactFields: []\n                }\n            },\n            element: null,\n            instance: null,\n            hasReturned: false\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            _.bindAll(this, 'createOrder', 'onApprove', 'onError', 'onCancel', 'onClick');\n            this._super();\n\n            if (this.scriptParams?.length) {\n                this.sdkLoaded = loadSdkScript(this.scriptParams, this.sdkNamespace).then(function (sdkScript) {\n                    this.paypal = sdkScript;\n                }.bind(this));\n            }\n\n            return this;\n        },\n\n        /**\n         * Get sdk params\n         *\n         * @return {Promise<Object>}\n         */\n        getSdkParams: function () {\n            return getSdkParams(this.cacheTtl)\n                .then(function (sdkParams) {\n                    this.sdkParams = sdkParams[this.sdkParamsKey];\n                }.bind(this));\n        },\n\n        /**\n         * In the case where the button color is not supported by Apple (black or white)\n         * Map the button color to black (same behavior as PayPal SDK script)\n         *\n         * @param buttonStyles\n         * @returns {(*&{color: string})|*}\n         */\n        mapButtonColorForApplePay: function (buttonStyles) {\n            let buttonColor = buttonStyles.color;\n\n            if (buttonColor === 'black' || buttonColor === 'white') {\n                return buttonStyles;\n            }\n            return {\n                ...buttonStyles,\n                color: 'black'\n            };\n        },\n\n        /**\n         * Set up the smart buttons.\n         *\n         * @param {HTMLElement} element\n         * @returns {*}\n         */\n        setup: function (element) {\n            let buttonsConfig;\n\n            if (typeof this.paypal === 'undefined' || !this.paypal.Buttons) {\n                return null;\n            }\n\n            if (element) {\n                this.element = element;\n            }\n\n            buttonsConfig = {\n                appSwitchWhenAvailable: this.appSwitchWhenAvailable,\n                element: this.element,\n                paymentRequest: this.paymentRequest,\n                style: this.styles,\n                onClick: this.onClick,\n                createOrder: this.createOrder,\n                onApprove: this.onApprove,\n                onError: this.onError,\n                onCancel: this.onCancel,\n                onInit: this.onInit\n            };\n\n            if (this.onShippingChange) {\n                buttonsConfig.onShippingChange = this.onShippingChange.bind(this);\n            }\n            if (this.fundingSource) {\n                buttonsConfig.fundingSource = this.fundingSource;\n                if (this.fundingSource === 'applepay') {\n                    buttonsConfig.style = this.mapButtonColorForApplePay(this.styles);\n                }\n            }\n\n            this.instance = this.paypal.Buttons(buttonsConfig);\n        },\n\n        /**\n         * Render Smart Buttons.\n         *\n         * @return {*}\n         */\n        render: function () {\n            if (this.instance.isEligible()) {\n                if (this.instance.hasReturned() && appSwitchDataModel.getData('pageType') === this.pageType) {\n                    this.hasReturned = true;\n                    this.instance.resume();\n                } else {\n                    $(this.element).html('');\n                    this.setup(this.element);\n                    this.instance.render(this.element);\n                }\n            }\n\n            return this.instance;\n        },\n\n        /**\n         * Calls when smart buttons initializing\n         */\n        onInit: function () {\n        },\n\n        /**\n         * Calls when user click PayPal button.\n         */\n        onClick: function () {\n            appSwitchDataModel.setData('pageType', this.pageType);\n        },\n\n        /**\n         * Calls before create order.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            return Promise.resolve();\n        },\n\n        /**\n         * Create order.\n         *\n         * @return {Promise}\n         */\n        createOrder: function (data) {\n            this.paymentSource = data['paymentSource'];\n\n            // add location to the order create request\n            let orderData = new FormData();\n            orderData.append('location', this.location || this.pageType);\n\n            return this.beforeCreateOrder()\n                .then(performCreateOrder.bind(this, this.createOrderUrl, data, orderData))\n                .then(function (orderData) {\n                    return this.afterCreateOrder(orderData);\n                }.bind(this)).catch(function (error) {\n                    return this.catchCreateOrder(error);\n                }.bind(this)).finally(function (error) {\n                    return this.finallyCreateOrder(error);\n                }.bind(this));\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {*}\n         */\n        afterCreateOrder: function (data) {\n            return data.orderId;\n        },\n\n        /**\n         * Catch error on order creation.\n         */\n        catchCreateOrder: function () {\n        },\n\n        /**\n         * Finally for order creation.\n         *\n         */\n        finallyCreateOrder: function () {\n        },\n\n        /**\n         * Before authorization call.\n         *\n         * @return {Promise}\n         */\n        beforeOnAuthorize: function (data, actions) {\n            return Promise.resolve(data);\n        },\n\n        /**\n         * On payment approve.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         * @return {Promise}\n         */\n        onApprove: function (data, actions) {\n            return this.beforeOnAuthorize(data, actions)\n                .then(performAuthorization.bind(this, this.completeOrderUrl))\n                .catch(function (error) {\n                    return this.catchOnAuthorize(error);\n                }.bind(this)).finally(function (error) {\n                    return this.finallyOnAuthorize(error);\n                }.bind(this));\n        },\n\n        /**\n         * Catch payment authorization errors.\n         */\n        catchOnAuthorize: function () {\n        },\n\n        /**\n         * Finally for payment authorization.\n         */\n        finallyOnAuthorize: function () {\n        },\n\n        /**\n         * Calls when shipping address changes..\n         *\n         * @param {Object} data\n         */\n        onShippingChange: undefined,\n\n        handleError: function () {\n            removePayPalUrlToken();\n\n            this.render(this.element);\n        },\n\n        /**\n         * Calls when error happened on PayPal side.\n         *\n         * @param {Error} error\n         */\n        onError: function (error) {\n            console.log('Error: ', error?.message || this.paymentActionError);\n\n            this.handleError();\n        },\n\n        /**\n         * Calls when user canceled payment.\n         */\n        onCancel: function (error) {\n            this.onError(error);\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/methods/hosted-fields.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'uiComponent',\n    'mage/translate',\n    'Magento_PaymentServicesPaypal/js/view/errors/response-error',\n    'scriptLoader'\n], function (_, Class, $t, ResponseError, loadSdkScript) {\n    'use strict';\n\n    return Class.extend({\n        defaults: {\n            sdkNamespace: 'paypal',\n            paypal: null,\n            formId: 'hosted-fields-form',\n            instance: undefined,\n            createOrderUrl: null,\n            orderCreateErrorMessage: {\n                default: $t('Failed to place order. Try again or refresh the page if that does not resolve the issue.'), // eslint-disable-line max-len,\n                //TODO: Update messages\n                'POSTAL_CODE_REQUIRED': $t('Postal code is required.'),\n                'CITY_REQUIRED': $t('City is required.')\n            },\n            styles: {\n                input: {\n                    color: '#ccc',\n                    'font-family': '\"Open Sans\",\"Helvetica Neue\",Helvetica,Arial,sans-serif',\n                    'font-size': '16px',\n                    'font-weight': '400'\n                },\n                ':focus': {\n                    color: '#333'\n                },\n                '.valid': {\n                    color: '#333'\n                }\n            },\n            fields: {\n                number: {\n                    class: 'number',\n                    selector: '#${ $.formId } .${ $.fields.number.class }',\n                    placeholder: ''\n                },\n                expirationDate: {\n                    class: 'expiration-date',\n                    selector: '#${ $.formId } .${ $.fields.expirationDate.class }',\n                    placeholder: 'MM/YY'\n                },\n                cvv: {\n                    class: 'cvv',\n                    selector: '#${ $.formId } .${ $.fields.cvv.class }',\n                    placeholder: ''\n                }\n            },\n            scriptParams: [],\n            sdkLoaded: null,\n            shouldCardBeVaulted: false\n        },\n\n        /** @inheritdoc */\n        initialize: function (config) {\n            _.bindAll(this, 'createOrder');\n\n            if (config.fields) {\n                this.constructor.defaults.fields = config.fields;\n            }\n            this._super();\n            this.sdkLoaded = loadSdkScript(this.scriptParams, this.sdkNamespace).then(function (sdkScript) {\n                this.paypal = sdkScript;\n            }.bind(this));\n            return this;\n        },\n\n        /** @inheritdoc */\n        initObservable: function () {\n            this._super()\n                .observe('shouldCardBeVaulted');\n\n            return this;\n        },\n\n        /**\n         * Check if eligible\n         *\n         * @return {Boolean}\n         */\n        isEligible: function () {\n            return typeof this.paypal !== 'undefined' &&\n                this.paypal.HostedFields &&\n                this.paypal.HostedFields.isEligible();\n        },\n\n        /**\n         * Render fields.\n         *\n         * @return {*}\n         */\n        render: function () {\n            return this.paypal.HostedFields.render({\n                createOrder: this.createOrder,\n                styles: this.styles,\n                fields: this.fields\n            }).then(function (instance) {\n                this.instance = instance;\n\n                return instance;\n            }.bind(this));\n        },\n\n        /**\n         * Calls before create order.\n         *\n         * @return {Promise}\n         */\n        beforeCreateOrder: function () {\n            return Promise.resolve();\n        },\n\n        /**\n         * Create order in payment service / PayPal\n         *\n         * @returns {Promise<any>}\n         */\n        createOrder: function () {\n            return this.beforeCreateOrder()\n                .then(function () {\n                    const shouldCardBeVaulted = this.shouldCardBeVaulted(),\n                        orderData = new FormData();\n\n                    orderData.append('payment_source', this.paymentSource);\n\n                    return fetch(`${this.createOrderUrl}?vault=${shouldCardBeVaulted}`, {\n                        method: 'POST',\n                        headers: {},\n                        body: orderData\n                    });\n                }.bind(this)).then(function (res) {\n                    return res.json();\n                }).then(function (data) {\n                    if (data.response['is_successful']) {\n                        this.onOrderSuccess(data.response['paypal-order']);\n                    } else {\n                        throw new ResponseError(\n                            this.orderCreateErrorMessage[data.response.message] || this.orderCreateErrorMessage.default\n                        );\n                    }\n\n                    return data.response['paypal-order'].id;\n                }.bind(this)).catch(function (error) {\n                    if (error instanceof ResponseError) {\n                        throw error;\n                    }\n                    throw new ResponseError(this.orderCreateErrorMessage.default);\n                }.bind(this));\n        },\n\n        /**\n         * Customizable handler for order creation.\n         */\n        onOrderSuccess: function () {}\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/payment/methods/google-pay.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'underscore',\n    'uiComponent',\n    'scriptLoader',\n    'Magento_PaymentServicesPaypal/js/lib/script-loader',\n    'mage/translate',\n    'mage/cookies'\n], function ($, _, Component, loadSdkScript, scriptLoader, $t) {\n    'use strict';\n\n    const HTTP_STATUS_CREATED = 201;\n\n    const googleSDKSrc = 'https://pay.google.com/gp/p/js/pay.js',\n        baseRequest = {\n            apiVersion: 2,\n            apiVersionMinor: 0,\n            callbackIntents: ['PAYMENT_AUTHORIZATION'],\n            emailRequired: true,\n            shippingAddressParameters: {phoneNumberRequired: true}\n        };\n\n    /**\n     * Create order request.\n     *\n     * @param {String} url\n     * @param {Object} payPalOrderData\n     * @param {FormData} orderData\n     * @param {String | false} threeDSMode\n     * @return {Object}\n     */\n    var performCreateOrder = function (url, payPalOrderData, orderData, threeDSMode) {\n\n            orderData = orderData || new FormData();\n            orderData.append('form_key', $.mage.cookies.get('form_key'));\n            orderData.append('payment_source', payPalOrderData['paymentSource']);\n\n            if (threeDSMode) {\n                orderData.append('three_ds_mode', threeDSMode);\n            }\n\n            let xhr = new XMLHttpRequest();\n            xhr.open('POST', url, false);\n            xhr.send(orderData);\n\n            if (xhr.status !== HTTP_STATUS_CREATED) {\n                throw new Error('Request failed');\n            } else {\n                return JSON.parse(xhr.responseText);\n            }\n        },\n\n        /**\n         * Payment authorization request.\n         *\n         * @return {Promise<Object>}\n         */\n        performOnAuthorize = function (url, data) {\n            var orderData = new FormData();\n\n            orderData.append('form_key', $.mage.cookies.get('form_key'));\n            orderData.append('paypal_order_id', data.orderID);\n\n            return fetch(url, {\n                method: 'POST',\n                headers: {},\n                body: orderData,\n                credentials: 'same-origin'\n            }).then(function (response) {\n                return response.json();\n            });\n        };\n\n    return Component.extend({\n        defaults: {\n            sdkNamespace: 'paypal',\n            paypal: null,\n            paymentSource: 'googlepay',\n            createOrderUrl: '',\n            updateQuoteUrl: '',\n            setQuoteAsInactiveUrl: '',\n            instance: null,\n            scriptParams: {},\n            allowedPaymentMethods: null,\n            merchantInfo: null,\n            buttonContainerId: null,\n            paypalOrderId: null,\n            eligible: false,\n            mode: 'TEST',\n            shippingAddressRequired: true,\n            getOrderDetailsUrl: '',\n            threeDSMode: '',\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            _.bindAll(this, 'createOrder', 'onApprove', 'onError', 'initGoogleSDK', 'performAuthorization',\n                'onClick', 'beforeOnAuthorize', 'afterOnAuthorize', 'onCancel');\n            this._super();\n            this.sdkLoaded = Promise.all([this.loadPayPalSDK(), this.loadGoogleSDK()]);\n\n            return this;\n        },\n\n        loadPayPalSDK: function () {\n            return loadSdkScript(this.scriptParams, this.sdkNamespace)\n                .then(function (sdkScript) {\n                    this.paypal = sdkScript;\n                }.bind(this))\n                .catch(function (e) {\n                    this.onError(e);\n                });\n        },\n\n        loadGoogleSDK: function () {\n            return scriptLoader.loadCustom({url: googleSDKSrc})\n                .catch(function (e) {\n                    this.onError(e);\n                });\n        },\n\n        initGoogleSDK: function () {\n            return this.getGooglePayConfig()\n                .then(config =>\n                    this.getGooglePaymentsClient()\n                        .isReadyToPay(this.getGoogleIsReadyToPayRequest(config.allowedPaymentMethods))\n                        .then(function (response) {\n                            if (response.result) {\n                                this.renderGooglePayButton();\n                            }\n                        }.bind(this))\n                ).catch(function (e) {\n                    this.onError({\n                        hidden: true,\n                        error: e\n                    });\n                }.bind(this));\n        },\n\n        getGooglePaymentsClient: function () {\n            if (this.instance === null) {\n                this.instance = new google.payments.api.PaymentsClient({\n                    environment: this.mode,\n                    paymentDataCallbacks: {\n                        onPaymentAuthorized: this.performAuthorization\n                    }\n                });\n            }\n            return this.instance;\n        },\n\n        showPopup: function (paymentData) {\n            this.getGooglePaymentDataRequest(paymentData)\n                .then((data) => {\n                    this.getGooglePaymentsClient()\n                        .loadPaymentData(data)\n                        .catch(this.onCancel);\n                }).catch((error) => this.onError(error));\n        },\n\n        onCancel: function () {\n            this.showLoader(false);\n        },\n\n        getGooglePaymentDataRequest: async function (transactionInfo) {\n            const paymentDataRequest = Object.assign({}, baseRequest),\n                {allowedPaymentMethods, merchantInfo} = await this.getGooglePayConfig();\n\n            paymentDataRequest.allowedPaymentMethods = allowedPaymentMethods;\n            paymentDataRequest.transactionInfo = transactionInfo;\n            paymentDataRequest.merchantInfo = merchantInfo;\n            paymentDataRequest.shippingAddressRequired = this.shippingAddressRequired;\n\n            return paymentDataRequest;\n        },\n\n        getGooglePayConfig: async function () {\n            if (this.allowedPaymentMethods === null || this.merchantInfo === null) {\n                const googlePayConfig = await this.paypal.Googlepay().config();\n\n                this.allowedPaymentMethods = googlePayConfig.allowedPaymentMethods;\n                this.merchantInfo = googlePayConfig.merchantInfo;\n            }\n\n            return {\n                allowedPaymentMethods: this.allowedPaymentMethods,\n                merchantInfo: this.merchantInfo\n            };\n        },\n\n        getGoogleIsReadyToPayRequest: function (allowedPaymentMethods) {\n            return Object.assign({}, baseRequest, {\n                allowedPaymentMethods: allowedPaymentMethods\n            });\n        },\n\n        renderGooglePayButton: function () {\n            const buttonContainer = $('#' + this.buttonContainerId);\n\n            let buttonProps = {\n                onClick: this.onClick,\n                buttonColor: this.styles.button_color,\n                buttonType: this.styles.button_type\n            };\n\n            buttonProps.buttonSizeMode = 'fill';\n\n            if (this.styles.button_custom_height) {\n                buttonContainer.height(this.styles.button_custom_height);\n            }\n\n            buttonContainer.append(\n                this.getGooglePaymentsClient().createButton(buttonProps)\n            );\n            this.eligible = true;\n        },\n\n        enableButton: function () {\n            $('#' + this.buttonContainerId).find('button').prop('disabled', false);\n        },\n\n        disableButton: function () {\n            $('#' + this.buttonContainerId).find('button').prop('disabled', true);\n        },\n\n        performAuthorization: function (paymentData) {\n            return new Promise(function (resolve) {\n                this.processPayment(paymentData)\n                    .then(resolve)\n                    .catch(function () {\n                        this.onError(new Error('couldn\\'t process payment'));\n                        resolve({transactionState: 'ERROR'});\n                    }.bind(this));\n            }.bind(this));\n        },\n\n        processPayment: async function (paymentData) {\n            try {\n                const {status} = await this.paypal.Googlepay().confirmOrder({\n                    orderId: this.paypalOrderId,\n                    paymentMethodData: paymentData.paymentMethodData,\n                    shippingAddress: paymentData.shippingAddress,\n                    email: paymentData.email\n                });\n\n                if (status === 'APPROVED') {\n                    this.onApprove(paymentData);\n                    return {transactionState: 'SUCCESS'};\n                }\n\n                if (status === 'PAYER_ACTION_REQUIRED') {\n                    this.paypal.Googlepay().initiatePayerAction({orderId: this.paypalOrderId}).then(\n                        async () => {\n                            return fetch(`${this.getOrderDetailsUrl}`, {\n                                method: 'GET'\n                            }).then((res) => {\n                                return res.json();\n                            }).then((data) => {\n                                if (data.response['is_successful'] && data.response['paypal-order']) {\n                                    const order = data.response['paypal-order'];\n                                    let authenticationResult = order.payment_source_details.card.authentication_result;\n                                    if (authenticationResult\n                                        && (\n                                            authenticationResult.liability_shift === 'POSSIBLE'\n                                            || authenticationResult.liability_shift === \"YES\"\n                                            || authenticationResult.liability_shift === undefined\n                                        )\n                                    ) {\n                                        this.onApprove(paymentData);\n                                    } else {\n                                        this.onError(new Error('couldn\\'t approve order using 3DS'));\n                                    }\n                                }\n                            }).catch((error) => {\n                                console.log(\"ERROR: \", error)\n                                this.onError(new Error('couldn\\'t approve order using 3DS'));\n                            })\n                        }\n                    ).catch((error) => {\n                        console.log(\"ERROR: \", error)\n                        this.onError(new Error('couldn\\'t approve order using 3DS'));\n                    });\n\n                    return {transactionState: 'SUCCESS'};\n                }\n\n                this.onError(new Error('couldn\\'t process payment'));\n\n                return {transactionState: 'ERROR'};\n            } catch (err) {\n                this.onError(err);\n                return {\n                    transactionState: 'ERROR',\n                    error: {\n                        message: err.message\n                    }\n                };\n            }\n        },\n\n        onClick: function () {\n        },\n\n        /**\n         * Calls before create order.\n         */\n        beforeCreateOrder: function () {\n        },\n\n        /**\n         * Create order.\n         *\n         * @return {String}\n         */\n        createOrder: function () {\n            let data = {'paymentSource': this.paymentSource};\n\n            try {\n                this.beforeCreateOrder();\n\n                // add location to the order create request\n                let formData = new FormData();\n                formData.append('location', this.location);\n\n                let orderData = performCreateOrder(this.createOrderUrl, data, formData, this.threeDSMode);\n                this.paypalOrderId = this.afterCreateOrder(orderData);\n                return this.paypalOrderId;\n            } catch (error) {\n                return this.catchCreateOrder(error);\n            }\n        },\n\n        /**\n         * After order created.\n         *\n         * @param {Object} data\n         * @return {String}\n         */\n        afterCreateOrder: function (data) {\n            if (data.response['paypal-order'] && data.response['paypal-order']['mp_order_id']) {\n                this.paymentsOrderId = data.response['paypal-order']['mp_order_id'];\n                this.paypalOrderId = data.response['paypal-order'].id;\n\n                this.showPopup({\n                    displayItems: [],\n                    currencyCode: data.response['paypal-order']['currency_code'],\n                    totalPriceStatus: 'FINAL',\n                    totalPrice: Number(data.response['paypal-order']['amount']).toString(),\n                    totalPriceLabel: $t('Total')\n                });\n\n                return this.paypalOrderId;\n            }\n\n            throw new Error();\n        },\n\n        /**\n         * Catch error on order creation.\n         */\n        catchCreateOrder: function () {\n        },\n\n        /**\n         * On payment approve.\n         *\n         * @param {Object} data\n         * @param {Object} actions\n         * @return {Promise}\n         */\n        onApprove: function () {\n            const data = {orderID: this.paypalOrderId};\n\n            return this.beforeOnAuthorize()\n                .then(performOnAuthorize.bind(this, this.updateQuoteUrl, data))\n                .then(this.afterOnAuthorize)\n                .catch(this.onError);\n        },\n\n        beforeOnAuthorize: function () {\n            return Promise.resolve();\n        },\n\n        afterOnAuthorize: function () {\n            return Promise.resolve();\n        },\n\n        /**\n         * Calls when error happened on PayPal side.\n         *\n         * @param {Error} error\n         */\n        onError: function (error) {\n            console.log('Error: ', error.message);\n        },\n\n        isEligible: function () {\n            return this.eligible;\n        },\n\n        /**\n         * Async Show/hide loader\n         *\n         * @param {Boolean} show\n         */\n        showLoaderAsync: function (show) {\n            return new Promise(function (resolve, reject) {\n                var event = show ? 'processStart' : 'processStop';\n                $('body').trigger(event);\n\n                // Set minimum time for loader to show\n                setTimeout(() => {\n                    resolve();\n                }, 10);\n            });\n        },\n\n        /**\n         * Show/hide loader.\n         *\n         * @param {Boolean} show\n         */\n        showLoader: function (show) {\n            var event = show ? 'processStart' : 'processStop';\n\n            $('body').trigger(event);\n        },\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/errors/response-error.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([], function () {\n    'use strict';\n\n    /**\n     * Error type to handle response errors.\n     *\n     * @param {String} message\n     * @constructor\n     */\n    function ResponseError(message) {\n        this.name = 'ResponseError';\n        this.message = message;\n        this.stack = new Error().stack;\n    }\n\n    ResponseError.prototype = new Error;\n\n    /**\n     * Return a string representation\n     *\n     * @returns {String}\n     */\n    ResponseError.prototype.toString = function () {\n        return this.message;\n    };\n\n    return ResponseError;\n});\n","Magento_PaymentServicesPaypal/js/view/form/element/change-address.js":"define([\n    'uiComponent',\n    'Magento_PaymentServicesPaypal/js/helpers/is-fastlane-available',\n    'Magento_PaymentServicesPaypal/js/view/payment/fastlane'\n], function (Component, isFastlaneAvailable, fastlaneModel) {\n    'use strict';\n\n    return Component.extend({\n        profileData: null,\n\n        defaults: {\n            template: 'Magento_PaymentServicesPaypal/form/element/change-address'\n        },\n\n        /**\n         * Initialise the change address component.\n         *\n         * @returns {Object} Chainable.\n         */\n        initialize: function () {\n            this._super();\n\n            // Early return if Fastlane is not available\n            if (!isFastlaneAvailable()) {\n                return this;\n            }\n\n            this.profileData = fastlaneModel.profileData;\n\n            return this;\n        },\n\n        /**\n         * Display the shipping address modal from Fastlane.\n         *\n         * @returns {void}\n         */\n        displayChangeShipping: async function () {\n            fastlaneModel.displayChangeShipping();\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/form/element/email-mixin.js":"define([\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/step-navigator',\n    'Magento_PaymentServicesPaypal/js/helpers/is-fastlane-available',\n    'Magento_PaymentServicesPaypal/js/view/payment/fastlane'\n], function (quote, stepsNavigator, isFastlaneAvailable, fastlaneModel) {\n    'use strict';\n\n    var mixin = {\n        shippingServiceSubscription: null,\n\n        /**\n         * Add mixin to the checkEmailAvailability so we can trigger Fastlane.\n         */\n        checkEmailAvailability: async function () {\n            this._super();\n\n            // Early return if this is not the shipping address email input or billing address in case of virtual quote.\n            if ((!quote.isVirtual() && this.name !== 'checkout.steps.shipping-step.shippingAddress.customer-email')\n                || (quote.isVirtual() && this.name !== 'checkout.steps.billing-step.payment.customer-email')\n            ) {\n                return;\n            }\n\n            // Early return if Fastlane is not available\n            if (!isFastlaneAvailable()) {\n                return;\n            }\n\n            // Early return if we are already on the payment page.\n            if (stepsNavigator.getActiveItemIndex() !== 0) {\n                return;\n            }\n\n            await fastlaneModel.setup();\n\n            // Check the entered email against Fastlane to see if we have an account.\n            fastlaneModel.lookupCustomerByEmail(this.email());\n        }\n    };\n\n    return function (target) {\n        return target.extend(mixin);\n    };\n});\n","Magento_PaymentServicesPaypal/js/view/form/element/powered-by.js":"define([\n    'knockout',\n    'uiComponent',\n    'Magento_PaymentServicesPaypal/js/helpers/is-fastlane-available',\n    'Magento_PaymentServicesPaypal/js/view/payment/fastlane'\n], function (ko, Component, isFastlaneAvailable, fastlaneModel) {\n    'use strict';\n\n    return Component.extend({\n        profileData: null,\n\n        defaults: {\n            template: 'Magento_PaymentServicesPaypal/form/element/powered-by'\n        },\n\n        /**\n         * Initialise the watermark component.\n         *\n         * @returns {Object} Chainable.\n         */\n        initialize: function (config) {\n            this._super(config);\n\n            this.id = config.id;\n            this.profileData = fastlaneModel.profileData;\n            this.isVisible = ko.observable(false);\n\n            // Add subscription to profile data changes so we try to render again if needed.\n            this.profileData.subscribe(this.renderWatermark.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Gets whether the watermark is enabled for the email address section.\n         *\n         * @returns {Boolean}\n         */\n        isEmailWatermarkEnabled: function () {\n            return this.id === 'paypal-fastlane-email-watermark'\n                && window.checkoutConfig.payment.payment_services_paypal_fastlane.messaging;\n        },\n\n        /**\n         * Gets whether the watermark is enabled for the shipping address section.\n         *\n         * @returns {Boolean}\n         */\n        isShippingWatermarkEnabled: function () {\n            return this.id !== 'paypal-fastlane-email-watermark' && !!this.profileData();\n        },\n\n        shouldRenderWatermark: async function () {\n            // Early return if Fastlane is not available.\n            if (!isFastlaneAvailable()) {\n                return false;\n            }\n\n            await fastlaneModel.setup();\n\n            // Fastlane Watermark should be rendered based on the following:\n            //   - Email watermark is based on the branding configuration\n            //   - All others are based on whether we have profile data\n            const shouldRender = this.isEmailWatermarkEnabled() || this.isShippingWatermarkEnabled();\n\n            this.isVisible(shouldRender);\n        },\n\n        renderWatermark: async function () {\n            await this.shouldRenderWatermark();\n\n            if (this.isVisible()) {\n                fastlaneModel.renderFastlaneWatermarkComponent(`#${this.id}`);\n            }\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/product/grouped-product-data-provider.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine(['jquery', 'underscore', 'uiClass'], function ($, _, Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            tableWrapperSelector: '.table-wrapper.grouped',\n            qtyFieldSelector: '.input-text.qty',\n            priceBoxSelector: '[data-role=\"priceBox\"]',\n            priceInfo: {}\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function () {\n            this._super();\n            $('tbody tr', this.tableWrapperSelector).each(function (index, element) {\n                var priceBox = $(this.priceBoxSelector, element),\n                    qtyElement = $(this.qtyFieldSelector, element),\n                    productId = priceBox.data('productId'),\n                    priceElement = $('#product-price-' + productId);\n\n                this.priceInfo[productId] = {\n                    qty: this.getQuantity(qtyElement),\n                    price: priceElement.data('priceAmount')\n                };\n            }.bind(this));\n            this.quantitySubscribe();\n\n            return this;\n        },\n\n        /**\n         * Subscribe for quantity changes.\n         */\n        quantitySubscribe: function () {\n            $(this.qtyFieldSelector).on('change', function (event) {\n                var qtyElement = $(event.target),\n                    parent = qtyElement.parents('tr'),\n                    priceBox = $(this.priceBoxSelector, parent),\n                    productId = priceBox.data('productId');\n\n                if (this.priceInfo[productId]) {\n                    this.priceInfo[productId].qty = this.getQuantity(qtyElement);\n                }\n\n                this.updateAmount(this.getAmount());\n            }.bind(this));\n        },\n\n        /**\n         * Get product amount.\n         *\n         * @return {Number}\n         */\n        getAmount: function () {\n            var amount = 0;\n\n            _.each(this.priceInfo, function (info) {\n                amount += info.price * info.qty;\n            });\n\n            return amount;\n        },\n\n        /**\n         * Get product quantity.\n         *\n         * @param {HTMLElement} element\n         * @return {Number}\n         */\n        getQuantity: function (element) {\n            var qty = parseFloat(element.val());\n\n            return !isNaN(qty) && qty ? qty : 0;\n        },\n\n        /**\n         * Checks if product is grouped type.\n         *\n         * @return {Boolean}\n         */\n        isProductGrouped: function () {\n            return !!$(this.constructor.defaults.tableWrapperSelector).length;\n        },\n\n        /**\n         * Subscribe for price change.\n         */\n        priceSubscribe: function () {\n        },\n\n        /**\n         * Trigger price update.\n         */\n        updatePrice: function () {\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/product/gift-card-product-data-provider.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'underscore',\n    'Magento_PaymentServicesPaypal/js/view/product/product-data-provider'\n], function ($, _, Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            priceBoxContextSelector: '.giftcard-amount',\n            priceBoxSelector: '#giftcard-amount, #giftcard-amount-input'\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            this._super();\n            this.price = $(this.priceBoxSelector, this.priceBoxContextSelector).val();\n\n            return this;\n        },\n\n        /**\n         * Subscribe for price change.\n         */\n        priceSubscribe: function () {\n            $(this.priceBoxSelector, this.priceBoxContextSelector).on('change', function (event) {\n                this.price = event.target.value;\n                this.updateAmount(this.getAmount());\n            }.bind(this));\n        },\n\n        /**\n         * Checks if product is grouped type.\n         *\n         * @return {Boolean}\n         */\n        isProductGiftCard: function () {\n            return !!$(this.constructor.defaults.priceBoxContextSelector).length;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/product/bundle-product-data-provider.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'underscore',\n    'Magento_PaymentServicesPaypal/js/view/product/product-data-provider'\n], function ($, _, Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            priceBoxContextSelector: '#bundleSummary',\n            slideSelector: '#bundle-slide'\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            this._super();\n\n            // Need to track bundle product slide to trigger amount update to make message visible.\n            $(this.slideSelector).on('click', function () {\n                setTimeout(function () {\n                    this.updateAmount(this.getAmount());\n                }.bind(this), 300);\n            }.bind(this));\n            this.updateAmount(this.getAmount());\n\n            return this;\n        },\n\n        /**\n         * Checks if product is grouped type.\n         *\n         * @return {Boolean}\n         */\n        isBundleProduct: function () {\n            return !!$(this.constructor.defaults.priceBoxContextSelector).length;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/product/product-data-provider.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine(['jquery', 'uiClass', 'priceBox'], function ($, Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            qtyFieldSelector: '#qty',\n            priceBoxSelector: '.price-box',\n            priceBoxContextSelector: '.product-info-main',\n            finalPriceSelector: '[data-price-type=\"finalPrice\"]',\n            price: 0,\n            qty: 0\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            this._super();\n            this.price = $(this.finalPriceSelector, this.priceBoxContextSelector).attr('data-price-amount');\n            this.qty = $(this.qtyFieldSelector).val();\n            this.quantitySubscribe();\n            this.priceSubscribe();\n\n            return this;\n        },\n\n        /**\n         * Subscribe for quantity changes.\n         */\n        quantitySubscribe: function () {\n            $(this.qtyFieldSelector).on('change', function () {\n                this.qty = $(this.qtyFieldSelector).val();\n                this.updateAmount(this.getAmount());\n            }.bind(this));\n        },\n\n        /**\n         * Subscribe for price change.\n         */\n        priceSubscribe: function () {\n            $(this.priceBoxSelector, this.priceBoxContextSelector).on('updatePrice', function (event) {\n                var prices = $(event.target).data('magePriceBox').cache.displayPrices;\n\n                this.price = prices.finalPrice.amount;\n                this.updateAmount(this.getAmount());\n            }.bind(this));\n        },\n\n        /**\n         * Trigger price update.\n         */\n        updatePrice: function () {\n            $(this.priceBoxSelector).trigger('updatePrice');\n        },\n\n        /**\n         * Get product amount.\n         *\n         * @return {Number}\n         */\n        getAmount: function () {\n            return this.qty * this.price;\n        }\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/customer_account/vault/add-card-form.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    \"jquery\",\n    \"underscore\",\n    \"uiComponent\",\n    \"scriptLoader\",\n    'Magento_PaymentServicesPaypal/js/lib/script-loader',\n    'mage/translate',\n    'Magento_Customer/js/customer-data',\n], function ($, _, Component, loadSdkScript, scriptLoader, $t, customerData) {\n    \"use strict\";\n\n    const cardFormSubmitButton = document.getElementById(\"paymentservices-add-card-button\");\n    const paymentServicesAddVaultCardContainer = document.getElementById(\"paymentservices_add_vault_card\");\n    const cardFormAddress = $(\".form-address-edit\")\n\n    return Component.extend({\n        defaults: {\n            template: \"Magento_PaymentServicesPaypal/customer_account/vault/add-card-form\",\n            componentParams: null,\n            paymentsSdk: null,\n            paymentsSdkInitPromise: null,\n            invalidFields: [],\n            emptyErrorMessage: $t('This is a required field.'),\n            fields: {\n                number: {\n                    errorMessage: $t('Please enter a valid credit card number.'),\n                },\n                expirationDate: {\n                    errorMessage: $t('Incorrect credit card expiration date.'),\n                },\n                cvv: {\n                    errorMessage: $t('Please enter a valid credit card security code.'),\n                }\n            }\n        },\n\n        /**\n         * @inheritdoc\n         */\n        initialize: function () {\n            this._super()\n                .observe('invalidFields');\n\n            this.initPaymentsSDK(this.componentParams);\n\n            return this;\n        },\n\n        initPaymentsSDK: function ({ paymentsSDKUrl, storeViewCode, oauthToken, graphQLEndpointUrl }) {\n            this.showLoader(true);\n            this.paymentsSdkInitPromise = scriptLoader\n                .loadCustom({url: paymentsSDKUrl})\n                .then(async () => {\n                    const sdkConfig = {\n                        storeViewCode: storeViewCode\n                    }\n\n                    if (oauthToken) {\n                        sdkConfig.getCustomerToken = () => oauthToken;\n                    }\n\n                    if (graphQLEndpointUrl) {\n                        sdkConfig.apiUrl = graphQLEndpointUrl;\n                    }\n\n                    this.paymentsSdk = new PaymentServicesSDK(sdkConfig)\n                    await this.paymentsSdk.Vault.init()\n                });\n        },\n\n        /**\n         * @inheritdoc\n         */\n        afterRender: function () {\n            this.paymentsSdkInitPromise.then(async () => {\n\n                this.showLoader(false);\n\n                if (!this.paymentsSdk.Vault.CreditCard.isAvailable()) {\n                    paymentServicesAddVaultCardContainer.innerHTML = this.displayMessage($t(\"CreditCard Vault is not available.\"), 'error');\n                    return;\n                }\n\n                await this.paymentsSdk.Vault.CreditCard.render({\n                    styles: {\n                        input: {\n                            'font-family': '\"Open Sans\",\"Helvetica Neue\",Helvetica,Arial,sans-serif',\n                            'font-size': '14px',\n                            'font-weight': '400',\n                            'border': '1px solid #c2c2c2',\n                            'border-radius': '1px',\n                            'padding': '0 9px',\n                            'height': '32px',\n                            'width': '100%',\n                            'box-sizing': 'border-box',\n                        },\n                        ':focus': {\n                            color: '#333'\n                        },\n                        '.valid': {\n                            color: '#333'\n                        },\n                        '.invalid': {\n                            'color': '#ed8380',\n                            'box-shadow': 'none'\n                        },\n                        body: {\n                            'margin': '0',\n                            'padding': '0',\n                        },\n                        // Remove card icon\n                        \"input.card-field-number.display-icon + .card-icon\": {\n                            display: \"none !important\",\n                            height: \"0\",\n                        },\n                        // Unindent card number\n                        \"input.card-field-number.display-icon\": {\n                            padding: \"0 9px !important\",\n                        },\n                    },\n                    fields: {\n                        description: {selector: \"#card-vault-container #vault-card-description\"},\n                        number: {selector: \"#card-vault-container #vault-card-number\"},\n                        expirationDate: {selector: \"#card-vault-container #vault-expiration-date\"},\n                        cvv: {selector: \"#card-vault-container #vault-cvv\"},\n                    },\n                    onError: (error) => {\n                        this.addMessage($t(\"Error while vaulting the card, please try again.\"), \"error\");\n                        console.error(error.message)\n                        this.showLoader(false);\n                    },\n                    onCancel: () => {\n                        console.debug(\"user cancelled the card vaulting process\");\n                        this.showLoader(false);\n                    },\n                    getBillingAddress: this.getBillingAddress.bind(this),\n                    onSuccess: () => {\n                        this.showLoader(false);\n                        paymentServicesAddVaultCardContainer.innerHTML = this.displayMessage($t('Card vaulted successfully. Please wait to be redirected to the Stored Payment Methods page.'), 'success');\n\n                        // Redirect to saved card list page\n                        setTimeout(() => {\n                            window.location.replace(this.componentParams.savedCardListUrl);\n                        }, 3000);\n                    },\n                    onValidityChange: this.onValidityChange.bind(this),\n                }).then((creditCardVault) => {\n                    cardFormSubmitButton.addEventListener(\"click\", () => {\n\n                        // Display errors for card fields\n                        if (!creditCardVault.isFormValid()) {\n                            var fields = creditCardVault.getFormState();\n                            Object.keys(fields).forEach((field) => {\n                                this.onValidityChange(fields, field);\n                            })\n                            creditCardVault.submit();\n                        }\n\n                        // Validate the address form\n                        if (!cardFormAddress.validation() || !cardFormAddress.validation('isValid')) {\n                            this.showLoader(false);\n                            return;\n                        }\n\n                        if (creditCardVault.isFormValid()) {\n                            this.showLoader(true);\n                            creditCardVault.submit();\n                        }\n                    });\n                }).catch((e) => {\n                    this.showLoader(false);\n                    this.addMessage($t(\"Error rendering Payment SDK, please reload the page and try again.\"), \"error\");\n                    console.error('Error rendering Payments SDK', e);\n                });\n            }).catch((error) => {\n                this.showLoader(false);\n                paymentServicesAddVaultCardContainer.innerHTML = this.displayMessage($t(\"Error initializing Payment SDK, please reload the page and try again.\"), 'error');\n                console.error(\"Error initializing Payment SDK:\", error);\n            });\n        },\n\n        /**\n         * Provide the billing address from the form\n         */\n        getBillingAddress: function () {\n            const regionInput = cardFormAddress.find(\"[name='region']\").val();\n            const regionIdDropdown = cardFormAddress.find(\"[name='region_id']\");\n            const regionIdValue = regionIdDropdown.val();\n            const regionIdLabel = regionIdDropdown.val() ? regionIdDropdown.find(`option[value='${regionIdValue}']`).text() : \"\";\n\n            return {\n                firstName: cardFormAddress.find(\"[name='firstname']\").val(),\n                lastName: cardFormAddress.find(\"[name='lastname']\").val(),\n                streetAddress: cardFormAddress.find(\"[name='street[0]']\").val(),\n                extendedAddress: cardFormAddress.find(\"[name='street[1]']\").val(),\n                region: regionIdDropdown.prop('disabled') ? regionInput : regionIdLabel,\n                locality: cardFormAddress.find(\"[name='city']\").val(),\n                postalCode: cardFormAddress.find(\"[name='postcode']\").val(),\n                countryCodeAlpha2: cardFormAddress.find(\"[name='country_id']\").val(),\n            };\n        },\n\n        /**\n         * Show/hide loader.\n         *\n         * @param {Boolean} show\n         */\n        showLoader: function (show) {\n            var event = show ? 'processStart' : 'processStop';\n\n            $('body').trigger(event);\n        },\n\n        /**\n         * Add message to customer data.\n         *\n         * @param {String} message\n         * @param {String} [type]\n         */\n        addMessage: function (message, type) {\n            type = type || 'error';\n            customerData.set('messages', {\n                messages: [{\n                    type: type,\n                    text: message\n                }],\n                'data_id': Math.floor(Date.now() / 1000)\n            });\n        },\n\n        onValidityChange: function (fields, emittedBy) {\n            var valid = _.every(fields, function (field) {\n                return field.isValid\n            });\n\n            var invalidFields = this.invalidFields().filter(field => field.name !== emittedBy);\n\n            if (!valid) {\n                if (fields[emittedBy] && !fields[emittedBy].isValid) {\n                    invalidFields.push({\n                        name: emittedBy,\n                        message: fields[emittedBy].isEmpty ? this.emptyErrorMessage : this.fields[emittedBy].errorMessage\n                    });\n                }\n                this.invalidFields(invalidFields)\n            } else {\n                this.invalidFields([]);\n            }\n        },\n\n        isFieldValid: function (fieldName) {\n            return !this.invalidFields.findWhere({\n                name: fieldName\n            });\n        },\n\n        getFieldErrorMessage: function (fieldName) {\n            return !this.isFieldValid(fieldName) ? this.invalidFields.findWhere({\n                name: fieldName\n            }).message : '';\n        },\n\n        displayMessage: function (text, type) {\n            return `<div class=\"${type} message\"><div>${$t(text)}</div></div>`;\n        },\n    });\n});\n","Magento_PaymentServicesPaypal/js/view/customer_account/vault/add-card-button.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget',\n    'mage/translate'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.cards', {\n        /**\n         * Bind event handlers for adding cards.\n         * @private\n         */\n        _create: function () {\n            let options = this.options;\n            let addCard = options.addCard;\n\n            if (addCard) {\n                $(document).on('click', addCard, this._addCard.bind(this));\n            }\n        },\n\n        /**\n         * Add a new card.\n         * @private\n         */\n        _addCard: function () {\n            window.location = this.options.addCardLocation;\n        }\n    });\n\n    return $.mage.cards;\n});\n","Magento_PaymentServicesPaypal/js/model/step-navigator-mixin.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'mage/utils/wrapper',\n    'Magento_Checkout/js/model/quote',\n    'Magento_PaymentServicesPaypal/js/model/app-switch-data'\n], function (wrapper, quote, appSwitchDataModel) {\n    'use strict';\n\n    let mixin = {\n        handleHash: function (originalFn) {\n            var hashString = window.location.hash.replace('#', '');\n\n            // If the URL hash contains `onApprove` or 'onCancel' or 'token'\n            // then we've come from PayPal App Switch and the hash isn't\n            // going to match with any registered step.\n            if (hashString.includes('onApprove')\n                || hashString.includes('onCancel')\n                || hashString.includes('token')\n            ) {\n                // If this is a virtual quote then set the payment step to visible.\n                if (quote.isVirtual()) {\n                    const paymentStep = this.steps().find(({ code }) => code === 'payment');\n\n                    paymentStep.isVisible(true);\n                    return;\n                }\n\n                // Check if the User has come from the end of the checkout.\n                // If so then take them back there.\n                if (appSwitchDataModel.getData('paymentsOrderId')) {\n                    const paymentStep = this.steps().find(({ code }) => code === 'payment');\n\n                    paymentStep.navigate(paymentStep);\n                    return;\n                }\n\n                const firstStep = this.steps().sort(this.sortItems)?.[0];\n\n                if (firstStep) {\n                    firstStep.navigate(firstStep);\n\n                    return;\n                }\n            }\n\n            return originalFn();\n        }\n    };\n\n    return function (target) {\n        return wrapper.extend(target, mixin);\n    };\n});\n","Magento_PaymentServicesPaypal/js/model/payment-service-mixin.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine([\n    'underscore',\n    'mage/utils/wrapper'\n], function (_, wrapper) {\n    'use strict';\n\n    /**\n     * Free method filter\n     * @param {Object} paymentMethod\n     * @return {Boolean}\n     */\n    var paymentServicesMethods = [\n            'payment_services_paypal_smart_buttons',\n            'payment_services_paypal_apple_pay',\n            'payment_services_paypal_google_pay',\n            'payment_services_paypal_hosted_fields',\n            'payment_services_paypal_fastlane'\n        ],\n\n        /**\n         * Check if payment method is from payment services.\n         *\n         * @param {String} needleName\n         * @param {String} paymentMethod\n         * @returns {Boolean}\n         */\n        isPaymentServicesButtonsPaymentMethod = function (needleName, paymentMethod) {\n            return paymentMethod.method === needleName;\n        },\n\n        /**\n         * Check if Apple Pay method is available.\n         */\n        checkApplePayAvailability = function () {\n            window.checkoutConfig.payment['payment_services_paypal_apple_pay'].isVisible = !!(\n                window.checkoutConfig.payment['payment_services_paypal_apple_pay'].isVisible &&\n                window.ApplePaySession\n            );\n            !window.ApplePaySession && console.log('Apple Pay is not supported or not available');\n        },\n\n        extender = {\n            /**\n             * Filter hidden payment methods.\n             *\n             * @param {Function} originFn - Original method.\n             * @param {Array} methods\n             */\n            setPaymentMethods: function (originFn, methods) {\n                var paymentServicesButtonMethodIndex;\n\n                checkApplePayAvailability();\n\n                _.each(paymentServicesMethods, function (paymentMethod) {\n                    if (!window.checkoutConfig.payment[paymentMethod].isVisible) {\n                        paymentServicesButtonMethodIndex = _.findIndex(\n                            methods,\n                            isPaymentServicesButtonsPaymentMethod.bind(null, paymentMethod)\n                        );\n                        paymentServicesButtonMethodIndex >= 0 && methods.splice(paymentServicesButtonMethodIndex, 1);\n                    }\n                });\n\n                return originFn(methods);\n            }\n    };\n\n    return function (target) {\n        return wrapper.extend(target, extender);\n    };\n});\n","Magento_PaymentServicesPaypal/js/model/app-switch-data.js":"/**\n * ADOBE CONFIDENTIAL\n *\n * Copyright 2025 Adobe\n * All Rights Reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\ndefine(function () {\n    'use strict';\n\n    const appSwitchKey = 'paypal-app-switch';\n\n    return {\n        clearData: () => {\n            window.localStorage.removeItem(appSwitchKey);\n        },\n\n        getData: (key) => {\n            return JSON.parse(window.localStorage.getItem(appSwitchKey) || '{}')[key];\n        },\n\n        setData: (key, value) => {\n            const data = JSON.parse(window.localStorage.getItem(appSwitchKey) || '{}');\n\n            data[key] = value;\n\n            window.localStorage.setItem(appSwitchKey, JSON.stringify(data));\n        }\n    };\n});\n","Magento_PaymentServicesPaypal/js/lib/script-loader.min.js":"/*!\n * paypal-js v3.1.1 (2021-03-14T21:08:07.006Z)\n * Copyright 2020-present, PayPal, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar paypalLoadScript=function(t){\"use strict\";function e(t,e){var r=document.querySelector('script[src=\"'.concat(t,'\"]'));if(null===r)return null;var n=a(t,e);if(Object.keys(r.dataset).length!==Object.keys(n.dataset).length)return null;var o=!0;return Object.keys(r.dataset).forEach((function(t){r.dataset[t]!==n.dataset[t]&&(o=!1)})),o?r:null}function r(t){var e=t.url,r=t.attributes,n=t.onSuccess,o=t.onError,i=a(e,r);i.onerror=o,i.onload=n,document.head.insertBefore(i,document.head.firstElementChild)}function n(t){var e=\"https://www.paypal.com/sdk/js\";t.sdkBaseURL&&(e=t.sdkBaseURL,delete t.sdkBaseURL);var r=function(t,e){var r=\"\",n=\"\";Array.isArray(t)?t.length>1?(r=\"*\",n=t.toString()):r=t.toString():\"string\"==typeof t&&t.length>0?r=t:\"string\"==typeof e&&e.length>0&&(r=\"*\",n=e);return{\"merchant-id\":r,\"data-merchant-id\":n}}(t[\"merchant-id\"],t[\"data-merchant-id\"]),n=Object.assign(t,r),a=Object.keys(n).filter((function(t){return void 0!==n[t]&&null!==n[t]&&\"\"!==n[t]})).reduce((function(t,e){var r=n[e].toString();return\"data-\"===e.substring(0,5)?t.dataAttributes[e]=r:t.queryParams[e]=r,t}),{queryParams:{},dataAttributes:{}}),i=a.queryParams,u=a.dataAttributes;return{url:\"\".concat(e,\"?\").concat(o(i)),dataAttributes:u}}function o(t){var e=\"\";return Object.keys(t).forEach((function(r){0!==e.length&&(e+=\"&\"),e+=r+\"=\"+t[r]})),e}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(\"script\");return r.src=t,Object.keys(e).forEach((function(t){r.setAttribute(t,e[t]),\"data-csp-nonce\"===t&&r.setAttribute(\"nonce\",e[\"data-csp-nonce\"])})),r}function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u();s(t,e);var n=t.url,o=t.attributes;if(\"string\"!=typeof n||0===n.length)throw new Error(\"Invalid url.\");if(void 0!==o&&\"object\"!=typeof o)throw new Error(\"Expected attributes to be an object.\");return new e((function(t,e){if(\"undefined\"==typeof window)return t();r({url:n,attributes:o,onSuccess:function(){return t()},onError:function(){return e(new Error('The script \"'.concat(n,'\" failed to load.')))}})}))}function u(){if(\"undefined\"==typeof Promise)throw new Error(\"Promise is undefined. To resolve the issue, use a Promise polyfill.\");return Promise}function c(t){return window[t]}function s(t,e){if(\"object\"!=typeof t||null===t)throw new Error(\"Expected an options object.\");if(void 0!==e&&\"function\"!=typeof e)throw new Error(\"Expected PromisePonyfill to be a function.\")}return t.loadCustomScript=i,t.loadScript=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u();if(s(t,r),\"undefined\"==typeof window)return r.resolve(null);var o=n(t),a=o.url,d=o.dataAttributes,l=d[\"data-namespace\"]||\"paypal\",f=c(l);return e(a,d)&&f?r.resolve(f):i({url:a,attributes:d},r).then((function(){var t=c(l);if(t)return t;throw new Error(\"The window.\".concat(l,\" global variable is not available.\"))}))},t.version=\"3.1.1\",Object.defineProperty(t,\"__esModule\",{value:!0}),t}({});window.paypalLoadCustomScript=paypalLoadScript.loadCustomScript,window.paypalLoadScript=paypalLoadScript.loadScript;\n","Magento_PaymentServicesPaypal/js/lib/script-loader-wrapper.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* eslint-disable no-undef */\ndefine(['underscore', 'Magento_PaymentServicesPaypal/js/lib/script-loader'], function (_, scriptLoader) {\n    'use strict';\n\n    var promises = {},\n        defaultNamespace = 'paypal';\n\n    /**\n     * Parse src query string and move all params to object\n     *\n     * @param {Object} params\n     * @return {Object}\n     */\n    function processParamsSrc(params) {\n        var processedParams = _.clone(params),\n            url = new URL(params.src),\n            queryString = url.search.substring(1),\n            urlParams = JSON.parse('{\"' +\n                decodeURI(queryString).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g, '\":\"') +\n                '\"}');\n\n        _.extend(processedParams, urlParams);\n        delete processedParams.src;\n\n        return processedParams;\n    }\n\n    /**\n     * Convert params to object key => value format\n     *\n     * @param {Object} params\n     * @return {Object}\n     */\n    function convertToParamsObject(params) {\n        var processedParams = {};\n\n        _.each(params, function (param) {\n            processedParams[param.name] = param.value;\n        });\n\n        return processedParams;\n    }\n\n    /**\n     * Load PayPal sdk with params.\n     *\n     * @param {Array} params\n     * @param {String} sdkNamespace\n     * @return {Promise}\n     */\n    return function (params, sdkNamespace) {\n        var src;\n\n        if (!params || !params.length) {\n            return Promise.reject();\n        }\n\n        params = convertToParamsObject(params);\n        params['data-namespace'] = sdkNamespace || defaultNamespace;\n\n        if (!params || !params.src) {\n            return Promise.reject();\n        }\n\n        src = params.src;\n\n        if (!promises[src]) {\n            params = processParamsSrc(params);\n\n            promises[src] = scriptLoader.load(params);\n        }\n\n        return promises[src];\n    };\n});\n","Amasty_CheckoutCore/js/checkout-collapsible.js":"define([\n    'jquery',\n    'mage/collapsible'\n], function ($) {\n\n    $.widget('mage.amCheckoutCollapsible', $.mage.collapsible, {\n        _create: function () {\n            // WCAG compatibility\n            this.options.content = $(this.element).find(this.options.content);\n            this._super();\n        }\n    });\n\n    return $.mage.amCheckoutCollapsible;\n});\n","Amasty_CheckoutCore/js/view/onepage.js":"define(\n    [\n        'jquery',\n        'underscore',\n        'uiComponent',\n        'ko',\n        'uiRegistry',\n        'consoleLogger',\n        'Magento_Customer/js/model/customer',\n        'Magento_Checkout/js/action/select-billing-address',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Checkout/js/model/payment/additional-validators',\n        'Magento_Checkout/js/model/payment/method-converter',\n        'Magento_Checkout/js/model/payment-service',\n        'Magento_Checkout/js/model/checkout-data-resolver',\n        'Amasty_CheckoutCore/js/model/one-step-layout',\n        'Amasty_CheckoutCore/js/model/payment-validators/shipping-validator',\n        'Amasty_CheckoutCore/js/model/address-form-state',\n        'Amasty_CheckoutCore/js/model/statistic',\n        'Amasty_CheckoutCore/js/model/shipping-registry',\n        'Amasty_CheckoutCore/js/action/recollect-shipping-rates',\n        'Amasty_CheckoutCore/js/model/payment/salesrule-observer',\n        'Amasty_CheckoutCore/js/action/update-items-content'\n    ],\n    function (\n        $,\n        _,\n        Component,\n        ko,\n        registry,\n        consoleLogger,\n        customer,\n        selectBillingAddress,\n        quote,\n        paymentValidatorRegistry,\n        paymentMethodConverter,\n        paymentService,\n        checkoutDataResolver,\n        oneStepLayout,\n        shippingValidator,\n        addressFormState,\n        statistic,\n        shippingRegistry,\n        recollectRates,\n        salesRuleObserver,\n        getEditableItemsData\n    ) {\n        'use strict';\n\n        return Component.extend({\n            /** @inheritdoc */\n            initialize: function () {\n                this._super();\n\n                oneStepLayout.checkoutDesign = window.checkoutDesign;\n                oneStepLayout.checkoutLayout = !quote.isVirtual() ? window.checkoutLayout : '2columns';\n                oneStepLayout.mainAdditionalClasses = this.additionalClasses;\n                oneStepLayout.setContainerClassNames();\n\n                this.initCheckoutLayout();\n                this.initChangePlaceButtonText();\n\n                statistic.initialize();\n            },\n\n            initObservable: function () {\n                var addressComponentPromise;\n\n                this._super().observe({\n                    isAmazonLoggedIn: null\n                });\n\n                if (!quote.isVirtual()) {\n                    quote.shippingAddress.subscribe(this.shippingAddressObserver.bind(this));\n                    paymentValidatorRegistry.registerValidator(shippingValidator);\n                }\n                shippingRegistry.setInitialValues();\n                addressComponentPromise = registry.promise('checkout.steps.shipping-step.shippingAddress');\n\n                registry.get('checkout.steps.billing-step.payment', function (component) {\n                    if (addressComponentPromise.state() !== 'pending') {\n                        this.initializePaymentStep(component);\n                        return;\n                    }\n                    addressComponentPromise.done(this.initializePaymentStep.bind(this, component));\n\n                }.bind(this));\n\n                registry.get('checkout.sidebar.summary_additional.discount', function (couponView) {\n                    try {\n                        //recollect shipping rates on apply/cancel coupon code\n                        couponView.isApplied.subscribe(recollectRates);\n                    } catch (e) {\n                        consoleLogger.error(\n                            'Coupon field failed. Cannot subscribe on isApplied for recollect shipping rates.'\n                        );\n                    }\n                });\n\n                return this;\n            },\n\n            /**\n             * Set initial payment information.\n             * payment information should be setted after shipping address.\n             * @param {Collection} component\n             */\n            initializePaymentStep: function (component) {\n                if (_.isNull(quote.guestEmail) && !customer.isLoggedIn()) {\n                    quote.guestEmail = '';\n                }\n\n                if (window.checkoutConfig.isCheckoutItemsEditable) {\n                    getEditableItemsData(window.checkoutConfig.quoteData.initPayment.totals);\n                } else {\n                    quote.setTotals(window.checkoutConfig.quoteData.initPayment.totals);\n                }\n\n                paymentService.setPaymentMethods(\n                    paymentMethodConverter(window.checkoutConfig.quoteData.initPayment.payment_methods)\n                );\n                // subscribes to payment method\n                salesRuleObserver.initialize();\n                component.isVisible(true);\n            },\n\n            /**\n             * Init checkout layout by quote type\n             * @returns {void}\n             */\n            initCheckoutLayout: function () {\n                if (!quote.isVirtual()) {\n                    oneStepLayout.selectedLayout = window.checkoutConfig.checkoutBlocksConfig;\n                } else {\n                    oneStepLayout.selectedLayout = oneStepLayout.getVirtualLayout();\n                }\n            },\n\n            /**\n             * [ Used it template ]\n             * Getting oneStepLayout model in view\n             * @returns {Object}\n             */\n            getOneStepModel: function () {\n                return oneStepLayout;\n            },\n\n            shippingAddressObserver: function (address) {\n                if (!address) {\n                    return;\n                }\n\n                this.isAccountLoggedInAmazon();\n\n                this.setShippingToBilling(address);\n            },\n\n            /**\n             * fix default \"My billing and shipping address are the same\" checkbox behaviour\n             *\n             * @param {object|null} address\n             * @returns {void}\n             */\n            setShippingToBilling: function (address) {\n                if (!address) {\n                    return;\n                }\n\n                if (!address.canUseForBilling()) {\n                    checkoutDataResolver.resolveBillingAddress();\n\n                    return;\n                }\n\n                if (_.isNull(address.street) || _.isUndefined(address.street)) {\n                    // fix: some payments (paypal) takes street.0 without checking\n                    address.street = [];\n                }\n\n                if (!addressFormState.isFormRendered()) {\n                    addressFormState.isFormRendered.subscribe(this.setShippingToBilling.bind(this, address));\n\n                    return;\n                }\n\n                if (addressFormState.isBillingSameAsShipping()) {\n                    selectBillingAddress(address);\n                }\n            },\n\n            /**\n             * Set customer Amazon logged in status and hide billing address if customer logged in Amazon\n             * @returns {void}\n             */\n            isAccountLoggedInAmazon: function () {\n                if (require.defined('Amazon_Payment/js/model/storage')) {\n                    if (this.isAmazonLoggedIn()) {\n                        $('.checkout-billing-address').hide();\n                    } else {\n                        require([ 'Amazon_Payment/js/model/storage' ], function (amazonStorage) {\n                            amazonStorage.isAmazonAccountLoggedIn.subscribe(function (isLoggedIn) {\n                                this.isAmazonLoggedIn(isLoggedIn);\n                            }, this);\n                            this.isAmazonLoggedIn(amazonStorage.isAmazonAccountLoggedIn());\n                        }.bind(this));\n                    }\n                }\n            },\n\n            initChangePlaceButtonText: function () {\n                var placeOrderButtonSelector = '.payment-method .action.primary.checkout';\n\n                if (!this.customPlaceButtonText) {\n                    return;\n                }\n\n                $.async(placeOrderButtonSelector, function (element) {\n                    $(element).attr('title', this.customPlaceButtonText);\n                    $(element).attr('aria-label', this.customPlaceButtonText);\n                    $(element).text(this.customPlaceButtonText);\n                }.bind(this));\n            }\n        });\n    }\n);\n","Amasty_CheckoutCore/js/view/gdpr-consent.js":"/**\n * Gdpr component inheritance to avoid incorrect checkbox displaying by country\n */\ndefine(\n    [\n        'Amasty_Gdpr/js/view/consent',\n        'Magento_Checkout/js/model/quote'\n    ],\n    function (Component, quote) {\n        'use strict';\n\n        return Component.extend({\n\n            initialize: function () {\n                this._super();\n\n                if (quote.billingAddress()) {\n                    quote.billingAddress.valueHasMutated();\n                }\n            }\n        });\n    }\n);\n","Amasty_CheckoutCore/js/view/payment-mixin.js":"define([], function () {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            /**\n             * Force show payment methods block\n             *\n             * @returns {boolean}\n             */\n            hasShippingMethod: function () {\n                return true;\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/billing-address-mixin.js":"/**\n * Billing address view mixin for store flag is billing form in edit mode (visible)\n */\ndefine([\n    'underscore',\n    'Magento_Checkout/js/model/quote',\n    'Amasty_CheckoutCore/js/model/address-form-state'\n], function (_, quote, formService) {\n    'use strict';\n\n    return function (billingAddress) {\n        /**\n         * force initialization for correct isAddressSameAsShipping working\n         * @see Magento_Checkout/js/view/billing-address\n         */\n        var updateDependenciesBounced = _.debounce(function () {\n            quote.billingAddress.valueHasMutated();\n        }, 50);\n\n        return billingAddress.extend({\n            initialize: function () {\n                this._super();\n\n                /**\n                 * Vendor Module Fix\n                 * Magento EE 2.4.2\n                 * Module: Vertex_AddressValidation\n                 * File: view/frontend/web/js/billing-validation-mixin.js; method addressDetailsVisibilityChanged\n                 * Issue: observable isAddressDetailsVisible could be changed by other components\n                 * before registry.get() is executed => this.addressValidator is null =>\n                 * => this.addressValidator.message is browser console error\n                 */\n                if (!this.addressValidator) {\n                    this.addressValidator = {\n                        message: {\n                            hasMessage: function () {\n                                return false;\n                            }\n                        }\n                    }\n                }\n\n                return this;\n            },\n\n            initObservable: function () {\n                this._super();\n\n                if (quote.billingAddress() && this.isAddressSameAsShipping.getVersion() <= 1) {\n                    updateDependenciesBounced();\n                }\n\n                this.isAddressSameAsShipping.subscribe(formService.updateBillingFormStates, formService);\n                this.isAddressDetailsVisible.subscribe(formService.updateBillingFormStates, formService);\n\n                if (window.checkoutConfig.displayBillingOnPaymentMethod) {\n                    quote.paymentMethod.subscribe(formService.updateBillingFormStates, formService);\n                }\n\n                formService.updateBillingFormStates();\n                formService.isFormRendered(true);\n\n                return this;\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/checkout-agreements-mixin.js":"/**\n * compatibility with 'braintree_paypal' payment method\n * when 'Terms and Conditions Checkbox Positioning' = 'Below the Order Total'\n * paymentMethodRenderer.item is empty\n * but 'braintree_paypal' require specific CheckboxId\n * @see Paypal_Braintree/js/view/payment/method-renderer/paypal.js:onInit()\n */\ndefine([\n], function () {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            getCheckboxId: function (context, agreementId) {\n                let paymentMethodRenderer = context.$parents[1];\n\n                if (paymentMethodRenderer && !paymentMethodRenderer.item) {\n                    return 'agreement_' + 'braintree_paypal' + '_' + agreementId;\n                }\n\n                return this._super(context, agreementId);\n            }\n        })\n    }\n});\n","Amasty_CheckoutCore/js/view/messages-mixin.js":"//when new error message added - scroll page to message block\ndefine([\n    'jquery',\n    'underscore',\n    'Magento_Ui/js/lib/knockout/extender/bound-nodes'\n], function ($, _, boundNodes) {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            defaults: {\n                scrollAllowed: true,\n                scrollOffset: 0\n            },\n            initialize: function () {\n                this._super();\n\n                if (this.scrollAllowed === true && this.messageContainer.errorMessages) {\n                    this.messageContainer.errorMessages.subscribe(function (changes) {\n                        try {\n                            _.find(changes, function (change) {\n                                if (change.status === 'added') {\n                                    this._scrollToMessageBlock();\n\n                                    return true;//break\n                                }\n                            }, this);\n                        } catch (e) {\n                            console.log('Unable to scroll to error message.');\n                            console.debug(e);\n                        }\n                    }, this, 'arrayChange');\n                }\n\n                return this;\n            },\n\n            /**\n             * Scroll page to the message block\n             * @private\n             */\n            _scrollToMessageBlock: function () {\n                var componentNodes = boundNodes.get(this),\n                    $element = $(componentNodes),\n                    offset = $element.offset().top,\n                    scrollTo = false,\n                    windowTop = $(window).scrollTop(),\n                    windowHeight = $(window).height(),\n                    windowBottom = windowTop + windowHeight;\n\n                if (offset < 0 || !$element.is(':visible')) {\n                    return;\n                }\n\n                if (windowTop > offset) {\n                    scrollTo = offset;\n                } else if (windowBottom < offset) {\n                    //scroll page to bottom screen border\n                    scrollTo = offset - windowHeight * 0.7;\n                }\n\n                if (scrollTo !== false) {\n                    $([document.documentElement, document.body]).animate({\n                        scrollTop: scrollTo + this.scrollOffset\n                    }, 250);\n                }\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/utils.js":"// Checkout views utility methods\ndefine(['underscore'], function (_) {\n    'use strict';\n\n    return {\n        /**\n         * Find checkout block layout config in window.checkoutConfig\n         * @param {string} blockNames\n         * @returns {null|{title:string, name:string}}\n         */\n        getBlockLayoutConfig: function (blockNames) {\n            var resultBlock = null;\n\n            _.find(window.checkoutConfig.checkoutBlocksConfig, function (column) {\n                return _.find(column, function (block) {\n                    if (blockNames === block.name) {\n                        resultBlock = block;\n\n                        return true;\n                    }\n                });\n            });\n\n            return resultBlock;\n        },\n\n        /**\n         * Get checkout block title from window.checkoutConfig\n         * @param {String} blockName\n         * @returns {String}\n         */\n        getBlockTitle: function (blockName) {\n            var blockConfig = this.getBlockLayoutConfig(blockName);\n\n            return blockConfig ? blockConfig.title : '';\n        }\n    };\n});\n","Amasty_CheckoutCore/js/view/shipping-mixin.js":"define(\n    [\n        'underscore',\n        'ko',\n        'jquery',\n        'Magento_Ui/js/lib/view/utils/async',\n        'Magento_Customer/js/model/customer',\n        'Magento_Checkout/js/model/address-converter',\n        'Magento_Customer/js/customer-data',\n        'Magento_Checkout/js/checkout-data',\n        'Magento_Checkout/js/model/shipping-service',\n        'Magento_Checkout/js/action/select-shipping-address',\n        'Magento_Checkout/js/action/select-shipping-method',\n        'Magento_Checkout/js/action/set-shipping-information',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Checkout/js/model/customer-email-validator',\n        'Amasty_CheckoutCore/js/view/utils',\n        'Amasty_CheckoutCore/js/model/payment/payment-loading',\n        'Amasty_CheckoutCore/js/action/get-totals',\n        'Amasty_CheckoutCore/js/model/shipping-registry',\n        'Amasty_CheckoutCore/js/model/address-form-state',\n        'Amasty_CheckoutCore/js/model/events',\n        'uiRegistry',\n        'rjsResolver',\n        'mage/translate'\n    ],\n    function (\n        _,\n        ko,\n        $,\n        async,\n        customer,\n        addressConverter,\n        storage,\n        checkoutData,\n        shippingService,\n        selectShippingAddress,\n        selectShippingMethod,\n        setShippingInformationAction,\n        quote,\n        emailValidator,\n        viewUtils,\n        paymentLoader,\n        totalsProcessor,\n        shippingRegistry,\n        addressFormState,\n        events,\n        registry,\n        onLoad,\n        $t\n    ) {\n        'use strict';\n\n        var instance = null;\n\n        function removeAmazonPayButton() {\n            var amazonPaymentButton = $('#PayWithAmazon_amazon-pay-button img');\n\n            if (amazonPaymentButton.length > 1) {\n                amazonPaymentButton.not(':first').remove();\n            }\n        }\n\n        return function (Shipping) {\n            return Shipping.extend({\n                allowedDynamicalSave: false,\n                allowedDynamicalValidation: true,\n                isUpdateCancelledByBilling: false,\n                isInitialDataSaved: false,\n                previousShippingMethodData: {},\n\n                initialize: function () {\n                    this._super();\n\n                    instance = this;\n                    onLoad(shippingRegistry.initObservers.bind(shippingRegistry, this.elems));\n                    onLoad(this.registerObserversAfterLoad.bind(this));\n\n                    if (!this.isFormInline) {\n                        shippingRegistry.excludedCollectionNames.push(\n                            'shipping-address-fieldset',\n                            'additional-fieldsets'\n                        );\n                    }\n\n                    registry.get(\n                        // eslint-disable-next-line max-len\n                        'checkout.steps.shipping-step.shippingAddress.before-form.amazon-widget-address.before-widget-address.amazon-checkout-revert',\n                        function (component) {\n                            component.isAmazonAccountLoggedIn.subscribe(this.amazonLoginStatusObserver);\n                        }.bind(this)\n                    );\n\n                    registry.get(\n                        'checkout.steps.billing-step.payment.payments-list.amazon_payment',\n                        function (component) {\n                            if (component.isAmazonAccountLoggedIn()) {\n                                $('button.action-show-popup').hide();\n                            }\n                        }\n                    );\n\n                    registry.get(\n                        // eslint-disable-next-line max-len\n                        'checkout.steps.shipping-step.shippingAddress.customer-email.amazon-button-region.amazon-button',\n                        function (component) {\n                            async.async({\n                                selector: '#PayWithAmazon_amazon-pay-button img'\n                            }, function () {\n                                removeAmazonPayButton();\n                            });\n\n                            component.isAmazonAccountLoggedIn.subscribe(function (loggedIn) {\n                                if (!loggedIn) {\n                                    removeAmazonPayButton();\n                                }\n                            });\n                        }\n                    );\n\n                    quote.billingAddress.subscribe(function () {\n                        if (this.isUpdateCancelledByBilling) {\n                            this.validateAndSaveIfChanged(true);\n                        }\n                    }, this);\n                },\n\n                initObservable: function () {\n                    this._super();\n\n                    quote.shippingMethod.subscribe(this.shippingMethodObserver.bind(this));\n\n                    if (quote.shippingMethod.getVersion() > 1) {\n                        this.shippingMethodObserver(quote.shippingMethod());\n                    }\n\n                    this.allowedDynamicalSave = true;\n\n                    events.onBeforeShippingSave(shippingRegistry.register.bind(shippingRegistry));\n                    events.onBeforeShippingSave(paymentLoader.bind(null, true));\n                    events.onAfterShippingSave(paymentLoader.bind(null, false));\n\n                    return this;\n                },\n\n                /**\n                 * Register subscribers who save shipping.\n                 * Register after full load.\n                 * @returns {void}\n                 */\n                registerObserversAfterLoad: function () {\n                    this.isInitialDataSaved = true;\n\n                    shippingRegistry.isAddressChanged.subscribe(this.additionalFieldsObserver.bind(this));\n                    shippingService.isLoading.subscribe(function (isLoading) {\n                        if (!isLoading) {\n                            this.validateAndSaveIfChanged(true);\n                        }\n                    }, this);\n                },\n\n                /**\n                 * If checkout already have all shipping information\n                 * then execute validate and save process because we dont have any triggers\n                 * and save should be executed on storefront for 3rd party extensions compatibility\n                 * @returns {void}\n                 */\n                saveInitialData: function () {\n                    if (!this.isInitialDataSaved) {\n                        onLoad(\n                            function () {\n                                shippingRegistry.initializedPromise.then(function () {\n                                    if (this.silentValidation()) {\n                                        this.validateAndSaveIfChanged(true);\n                                    }\n                                }.bind(this));\n                            }.bind(this)\n                        );\n\n                        this.isInitialDataSaved = true;\n                    }\n                },\n\n                /**\n                 * Validate shipping without showing any errors\n                 * @return {Boolean} result Validation result\n                 */\n                silentValidation: function () {\n                    var invalidElement,\n                        result = !_.isEmpty(quote.shippingMethod()) && !_.isEmpty(quote.shippingAddress());\n\n                    if (result && this.isFormInline) {\n                        invalidElement = _.find(shippingRegistry.addressComponents, function (module) {\n                            return ko.isObservable(module.required)\n                                && ko.isObservable(module.value)\n                                && ko.isObservable(module.visible)\n                                && ko.isObservable(module.disabled)\n                                && module.required.peek()\n                                && module.visible.peek()\n                                && !module.disabled.peek()\n                                && this._isValueEmpty(module.value.peek());\n                        }, this);\n\n                        result = _.isUndefined(invalidElement);\n                    }\n\n                    return result;\n                },\n\n                /**\n                 * @param {String|Number|Object|*} value\n                 * @return {boolean}\n                 * @private\n                 */\n                _isValueEmpty: function (value) {\n                    if (_.isNumber(value)) {\n                        return !value;\n                    }\n\n                    return _.isEmpty(value);\n                },\n\n                setShippingInformation: function () {\n                    var result;\n\n                    this.allowedDynamicalSave = false;\n                    result = this._super();\n                    this.allowedDynamicalSave = true;\n\n                    return result;\n                },\n\n                selectShippingMethod: function (method) {\n                    window.loaderIsNotAllowed = true;\n                    this._super(method);\n                    instance.validateAndSaveIfChanged();\n                    delete window.loaderIsNotAllowed;\n\n                    return true;\n                },\n\n                /**\n                 * Copy of parent method validateShippingInformation()\n                 * without focus to email field\n                 * @param {Boolean} hideError\n                 * @return {Boolean}\n                 */\n                validateShipping: function (hideError) {\n                    var shippingAddress,\n                        addressData,\n                        emailValidationResult = customer.isLoggedIn(),\n                        field,\n                        option = _.isObject(this.countryOptions)\n                                && this.countryOptions[quote.shippingAddress().countryId],\n                        messageContainer = registry.get('checkout.errors').messageContainer;\n\n                    if (!quote.shippingMethod()) {\n                        this.errorValidationMessage(\n                            $t('The shipping method is missing. Select the shipping method and try again.')\n                        );\n\n                        return false;\n                    }\n\n                    if (!customer.isLoggedIn()) {\n                        emailValidationResult = emailValidator.validate(hideError);\n                    }\n\n                    if (this.isFormInline) {\n                        this.source.set('params.invalid', false);\n                        this.triggerShippingDataValidateEvent();\n\n                        if (!quote.shippingMethod()['method_code']) {\n                            this.errorValidationMessage(\n                                $t('The shipping method is missing. Select the shipping method and try again.')\n                            );\n                        }\n\n                        if ((emailValidationResult\n                            && this.source.get('params.invalid'))\n                            || !quote.shippingMethod()['method_code']\n                            || !quote.shippingMethod()['carrier_code']\n                        ) {\n                            this.focusInvalid();\n\n                            return false;\n                        }\n\n                        if (this.source.get('params.invalid')) {\n                            return false;\n                        }\n\n                        shippingAddress = quote.shippingAddress();\n                        addressData = addressConverter.formAddressDataToQuoteAddress(\n                            this.source.get('shippingAddress')\n                        );\n\n                        // Copy form data to quote shipping address object\n                        // eslint-disable-next-line no-restricted-syntax\n                        for (field in addressData) {\n                            if (addressData.hasOwnProperty(field)\n                                && shippingAddress.hasOwnProperty(field)\n                                && typeof addressData[field] != 'function'\n                                && _.isEqual(shippingAddress[field], addressData[field])\n                            ) {\n                                shippingAddress[field] = addressData[field];\n                            } else if (typeof addressData[field] != 'function'\n                                && !_.isEqual(shippingAddress[field], addressData[field])) {\n                                shippingAddress = addressData;\n                                break;\n                            }\n                        }\n\n                        if (customer.isLoggedIn()) {\n                            shippingAddress['save_in_address_book'] = 1;\n                        }\n\n                        selectShippingAddress(shippingAddress);\n                    } else if (customer.isLoggedIn()\n                        && option\n                        && option['is_region_required']\n                        && !quote.shippingAddress().region\n                    ) {\n                        messageContainer.addErrorMessage({\n                            message: $t('Please specify a regionId in shipping address.')\n                        });\n\n                        return false;\n                    }\n\n                    return true;\n                },\n\n                /**\n                 * @param {Boolean} hideError\n                 * @returns {Boolean}\n                 */\n                validateShippingInformation: function (hideError) {\n                    var result;\n\n                    if (hideError && (shippingRegistry.isEstimationHaveError() || !this.silentValidation())) {\n                        return false;\n                    }\n\n                    this.allowedDynamicalValidation = false;\n                    result = this.validateShipping(hideError);\n                    if (hideError && !result && !window.shippingErrorHideIsNotAllowed) {\n                        if (this.isFormInline && this.source.get('params.invalid')) {\n                            //set current value as initialValue\n                            this.source.trigger('data.overload');\n                            //set initialValue to value and reset errors\n                            this.source.trigger('data.reset');\n                        }\n\n                        this.errorValidationMessage(false);\n                    }\n                    this.allowedDynamicalValidation = true;\n\n                    return result;\n                },\n\n                /**\n                 * Calculate Totals for changed shipping method.\n                 * Necessary only if dynamical shipping save is not working (i.e. shipping is not valid)\n                 *\n                 * @param {Object} method Shipping method\n                 * @returns {void}\n                 */\n                shippingMethodObserver: function (method) {\n                    this.saveInitialData();\n\n                    if (method\n                        && shippingRegistry.isEstimationHaveError()\n                        || this.source.get('params.invalid')\n                        || shippingRegistry.isEstimationHaveError.getVersion() === 1\n                        && shippingRegistry.isHaveUnsavedShipping()\n                        && !window.checkoutConfig.isNegotiableQuote\n                    ) {\n                        totalsProcessor();\n                    }\n                },\n\n                /**\n                 * Reselect shipping method when customer logs out of Amazon\n                 * @param {Boolean} loggedIn Amazon account login status\n                 * @returns {void}\n                 */\n                amazonLoginStatusObserver: function (loggedIn) {\n                    if (!loggedIn) {\n                        registry.get('checkout.steps.shipping-step.shippingAddress', function (component) {\n                            if (component.isSelected()) {\n                                component.selectShippingMethod(quote.shippingMethod());\n                            }\n                        });\n                    }\n                },\n\n                /**\n                 * Trigger shipping address validation and save on additional address fields change\n                 * @param {Boolean} isChanged Change status\n                 * @returns {void}\n                 */\n                additionalFieldsObserver: function (isChanged) {\n                    var versionBeforeChange;\n\n                    if (!isChanged || shippingRegistry.isEstimationHaveError()) {\n                        paymentLoader(false);\n\n                        return;\n                    }\n\n                    if (this.isFormInline) {\n                        versionBeforeChange = shippingService.isLoading.getVersion();\n\n                        if ((this.validateShippingInformation(true) || !this.source.get('params.invalid'))\n                            && shippingService.isLoading.hasChanged(versionBeforeChange)\n                        ) {\n                            return;\n                        }\n                    }\n\n                    this.validateAndSaveIfChanged(true);\n                },\n\n                validateAndSaveIfChanged: function (hideError) {\n                    var isShippingValid;\n\n                    if (!this.allowedDynamicalSave\n                        || this.isBillingAddressFormVisible()\n                        || !shippingRegistry.isHaveUnsavedShipping()\n                    ) {\n                        paymentLoader(false);\n\n                        return;\n                    }\n\n                    isShippingValid = !this.allowedDynamicalValidation;\n\n                    // allowedDynamicalValidation - for avoid circular dependency\n                    if (this.allowedDynamicalValidation) {\n                        this.allowedDynamicalSave = false;\n                        isShippingValid = this.validateShippingInformation(hideError);\n                        this.allowedDynamicalSave = true;\n                    }\n\n                    /*\n                     if isFormInline = true, method validateShippingInformation\n                     will set shipping address and this observer will be executed.\n                     validateShippingInformation - also validate email, which is not part of Shipping information.\n                    */\n                    if (isShippingValid || (this.isFormInline && !this.source.get('params.invalid'))) {\n                        window.loaderIsNotAllowed = true;\n                        events.trigger('before_shipping_save');\n                        setShippingInformationAction();\n                        delete window.loaderIsNotAllowed;\n                    } else {\n                        paymentLoader(false);\n                    }\n                },\n\n                getNameShippingAddress: function () {\n                    return viewUtils.getBlockTitle('shipping_address');\n                },\n\n                getNameShippingMethod: function () {\n                    return viewUtils.getBlockTitle('shipping_method');\n                },\n\n                isPostNlEnable: function () {\n                    return window.checkoutConfig.quoteData.posnt_nl_enable;\n                },\n\n                /**\n                 * Trigger Shipping data Validate Event.\n                 * @returns {void}\n                 */\n                triggerShippingDataValidateEvent: function () {\n                    this.source.trigger('shippingAddress.data.validate');\n\n                    if (this.source.get('shippingAddress.custom_attributes')) {\n                        this.source.trigger('shippingAddress.custom_attributes.data.validate');\n                    }\n                },\n\n                validatePlaceOrder: function () {\n                    var loginFormSelector = 'form[data-role=email-with-possible-login]',\n                        emailValidationResult = this.isCustomerLoggedIn();\n\n                    if (!emailValidationResult) {\n                        $(loginFormSelector).validation();\n                        emailValidationResult = Boolean($(loginFormSelector + ' input[name=username]').valid());\n                    }\n\n                    if (!emailValidationResult) {\n                        $(loginFormSelector + ' input[name=username]').focus();\n\n                        return false;\n                    }\n\n                    if (this.isFormInline) {\n                        this.source.set('params.invalid', false);\n                        this.triggerShippingDataValidateEvent();\n\n                        if (\n                            this.source.get('params.invalid')\n                        ) {\n                            return false;\n                        }\n                    }\n\n                    return true;\n                },\n\n                isModernDesign: function () {\n                    return window.checkoutDesign === 'modern';\n                },\n\n                /**\n                 * @param {Object} method - shipping method\n                 * @return {String} comment Tooltip text\n                 */\n                getMethodTooltipText: function (method) {\n                    var comment = '';\n\n                    if (this.isModernDesign() && method.error_message) {\n                        comment = method.error_message;\n                    }\n\n                    if (!comment) {\n                        comment = this.getCommentShippingMethod(method);\n                    }\n\n                    return comment;\n                },\n\n                /**\n                 * Compatibility with Amasty_ShippingTableRates and Amasty_StorePickup\n                 * @param {Object} method Shipping method\n                 * @returns {String} Shipping method comment\n                 */\n                getCommentShippingMethod: function (method) {\n                    if (!method) {\n                        return '';\n                    }\n\n                    if (method.comment && typeof method.comment === 'string') {\n                        return method.comment;\n                    }\n\n                    if (method.extension_attributes) {\n                        if (method.extension_attributes.amstorepick_comment) {\n                            return method.extension_attributes.amstorepick_comment;\n                        }\n\n                        if (method.extension_attributes.amstartes_comment) {\n                            return method.extension_attributes.amstartes_comment;\n                        }\n                    }\n\n                    return '';\n                },\n\n                getAdditionalClassForIcons: function (method) {\n                    if (this.isModernDesign()\n                        && Object.prototype.hasOwnProperty.call(method, 'error_message')\n                        && method.error_message\n                    ) {\n                        return '-error';\n                    }\n\n                    return '';\n                },\n\n                isShippingMethodTooltip: function (method) {\n                    return this.isModernDesign() && this.getMethodTooltipText(method);\n                },\n\n                getColspanCarrier: function (method) {\n                    if (this.isShippingMethodTooltip(method)) {\n                        return 1;\n                    }\n\n                    return 2;\n                },\n\n                /**\n                 * Disable focus on validation\n                 * Override parents function\n                 * @returns {Function}\n                 */\n                focusInvalid: function () {\n                    return this;\n                },\n\n                /**\n                 * Check on visible billing address form\n                 * @returns {Boolean} Billing address form visibility state\n                 */\n                isBillingAddressFormVisible: function () {\n                    this.isUpdateCancelledByBilling = !addressFormState.isBillingSameAsShipping()\n                        && addressFormState.isBillingFormVisible();\n\n                    return this.isUpdateCancelledByBilling;\n                },\n\n                /**\n                 * Can be used as override for getPopUp function\n                 * to suppress new shipping address popup.\n                 * Used in 'list-mixin.js'\n                 *\n                 * @return {{openModal: openModal, closeModal: closeModal}}\n                 */\n                getPopUpOverride: function () {\n                    var self = this;\n\n                    return {\n                        openModal: function () {\n                            self.isFormPopUpVisible(true);\n                        },\n                        closeModal: function () {\n                            self.isFormPopUpVisible(false);\n                        }\n                    };\n                }\n            });\n        };\n    }\n);\n","Amasty_CheckoutCore/js/view/summary-mixin.js":"define([\n    'Amasty_CheckoutCore/js/view/utils'\n], function (viewUtils) {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            getNameSummary: function () {\n                return viewUtils.getBlockTitle('summary');\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/form/element/email.js":"define([\n    'jquery',\n    'uiRegistry',\n    'ko',\n    'underscore',\n    'Magento_Checkout/js/view/form/element/email',\n    'Magento_Customer/js/model/customer',\n    'Magento_Customer/js/customer-data',\n    'Magento_Checkout/js/checkout-data',\n    'Amasty_CheckoutCore/js/model/payment-validators/login-form-validator',\n    'Amasty_CheckoutCore/js/action/save-password',\n    'Amasty_CheckoutCore/js/model/payment/place-order-state',\n    'Magento_Ui/js/lib/view/utils/async'\n], function (\n    $,\n    registry,\n    ko,\n    _,\n    Component,\n    customer,\n    customerData,\n    checkoutData,\n    loginFormValidator,\n    saveAction,\n    placeOrderState\n) {\n    'use strict';\n\n    /**\n     * Setting 'Let Customers Create an Account at Checkout'\n     * Decryption of codes for this.createAcc:\n     * 0 - No\n     * 1 - After Placing an Order\n     * 2 - While Placing an Order, Optional\n     * 3 - While Placing an Order, Required\n     */\n\n    /**\n     * @return {*}\n     */\n    var getData = function () {\n        return customerData.get('checkout-data')();\n    };\n\n    return Component.extend({\n        defaults: {\n            isCreateAccountAction: ko.observable(true),\n            isPassword: ko.observable(false),\n            createAcc: +window.checkoutConfig.quoteData.additional_options.create_account,\n            passwordConfirmation: '',\n            passValidationDelay: 500,\n            loginFormSelector: 'form[data-role=\"email-with-possible-login\"]',\n            modules: {\n                dateOfBirth: 'checkout.sidebar.additional.checkboxes.date_of_birth',\n                loginCaptcha: '${ $.name }.additional-login-form-fields.captcha',\n                mspRecaptcha: '${ $.name }.msp_recaptcha',\n                recaptcha: '${ $.name }.recaptcha',\n                createAccountRecaptcha: '${ $.name }.recaptcha-customer-create'\n            },\n            listens: {\n                passwordConfirmation: 'validateAndSaveRegistration'\n            }\n        },\n        passValidationTimeout: 0,\n\n        initialize: function () {\n            this._super();\n\n            if (this.createAcc <= '1') {\n                return;\n            }\n\n            this.template = 'Amasty_CheckoutCore/form/element/email';\n            this._renderLoginForm(this._resolveInitialPasswordVisibility());\n\n            this.isLoading.subscribe(function (isLoading) {\n                if (isLoading === false) {\n                    $.when(this.isEmailCheckComplete)\n                        .done(function () {\n                            this._isNeededCreateAccountFunc(true);\n                        }.bind(this))\n                        .fail(function () {\n                            this._isNeededCreateAccountFunc(false);\n                        }.bind(this));\n                }\n            }.bind(this));\n\n            if (this.createAcc === 3 && !customer.isLoggedIn()) {\n                this.isPassword(true);\n                placeOrderState(false);\n\n                this.isLoading.subscribe(function () {\n                    $.when(this.isEmailCheckComplete).done(function () {\n                        this.isPassword(true);\n                    }.bind(this)).fail(function () {\n                        this.isPassword(false);\n                    }.bind(this)).always(function () {\n                        placeOrderState(true);\n                    });\n                }.bind(this));\n\n                this.\u0441heckEnteredEmail();\n            }\n        },\n\n        initObservable: function () {\n            this._super().observe('passwordConfirmation');\n\n            if (this.createAcc <= 1) {\n                return this;\n            }\n\n            this.validate = ko.computed(function () {\n                $.async('#customer-password', function (elem) {\n                    if (this.isPasswordVisible() && this.isCreateAccountAction() === true) {\n                        $(elem).rules('add', 'validate-customer-password');\n                    } else if ($.data(elem.form, 'validator')\n                        && $(elem).rules().hasOwnProperty('validate-customer-password')\n                    ) {\n                        $(elem).rules('remove', 'validate-customer-password');\n                    }\n                }.bind(this));\n\n                loginFormValidator.validate();\n\n                return this.isPasswordVisible() && this.isCreateAccountAction() === true;\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Checks the email entered before reloading the page\n         *\n         * @returns {void}\n         */\n        \u0441heckEnteredEmail: _.once(function () {\n            if (this.email()) {\n                this.checkEmailAvailability();\n            }\n        }),\n\n        isPasswordRequired: function () {\n            this._visibleDateOfBirth();\n            this._visibleLoginCaptcha();\n            this._visibleReCaptcha();\n        },\n\n        getTooltip: function () {\n            return this.tooltip;\n        },\n\n        isPasswordSet: function (element) {\n            this.isPassword(!!element.value);\n\n            this._visibleDateOfBirth();\n            this._visibleLoginCaptcha();\n            this._visibleReCaptcha();\n        },\n\n        emailHasChanged: function () {\n            this._super();\n\n            if (this.createAcc <= 1) {\n                return;\n            }\n\n            if (!this.validateEmail()) {\n                this.isCreateAccountAction(false)\n            }\n\n            setTimeout(function () {\n                this._visibleLoginCaptcha();\n                this._visibleReCaptcha();\n            }.bind(this), this.checkDelay);\n        },\n\n        getRequiredCharacterClassesNumber: function () {\n            return parseInt(registry.get('checkoutProvider').requiredCharacterClassesNumber, 10);\n        },\n\n        getMinimumPasswordLength: function () {\n            return parseInt(registry.get('checkoutProvider').minimumPasswordLength, 10);\n        },\n\n        validateAndSaveRegistration: function () {\n            if (loginFormValidator.validate()) {\n                saveAction();\n            }\n        },\n\n        /**\n         * Override submit action\n         * on create account action - just validate and save\n         * @returns {void|UIClass}\n         */\n        login: function () {\n            if (this.createAcc >= 2\n                && this.isPasswordVisible()\n                && this.isCreateAccountAction() === true) {\n                this.validateAndSaveRegistration();\n            } else {\n                return this._super();\n            }\n        },\n\n        _isNeededCreateAccountFunc: function (state) {\n            this.isCreateAccountAction(state);\n            this.isPasswordVisible(true);\n\n            this._visibleLoginCaptcha();\n            this._visibleReCaptcha();\n        },\n\n        _renderLoginForm: function (state) {\n            if (state) {\n                this.isPasswordVisible(true);\n                this.isCreateAccountAction(false);\n            } else {\n                $.async(this.loginFormSelector, function () {\n                    if (this.validateEmail()) {\n                        this.isPasswordVisible(true);\n                        this.isCreateAccountAction(true);\n                    } else {\n                        this.isPasswordVisible(false);\n                        this.isCreateAccountAction(false);\n                    }\n                }.bind(this));\n            }\n        },\n\n        /**\n         * Resolves an initial sate of a login form.\n         *\n         * @returns {Boolean} - initial visibility state.\n         */\n        _resolveInitialPasswordVisibility: function () {\n            if (checkoutData.getInputFieldEmailValue() !== '') {\n                return checkoutData.getInputFieldEmailValue() === this._getCheckedEmailValue();\n            }\n\n            return false;\n        },\n\n        _getCheckedEmailValue: function () {\n            return getData().checkedEmailValue || '';\n        },\n\n        _visibleLoginCaptcha: function () {\n            if (this.loginCaptcha()) {\n                this.loginCaptcha().currentCaptcha.setIsVisible(\n                    (this.isPasswordVisible() && !this.isCreateAccountAction() && window.checkoutConfig.amastyOscCaptcha.isLoginCaptcha)\n                    || (this.isCreateAccountAction() && window.checkoutConfig.amastyOscCaptcha.isCreateAccountCaptcha)\n                );\n            }\n        },\n\n        _visibleReCaptcha: function () {\n            // for magento < 2.4.0\n            if (this.mspRecaptcha()) {\n                $.async({\n                    selector: '#msp-recaptcha-checkout-inline-login-wrapper'\n                }, function (loginWrapper) {\n                    $(loginWrapper).toggle(\n                        this.isReCaptchaVisible()\n                    );\n                }.bind(this));\n            }\n            //for magento >= 2.4.0\n            if (this.recaptcha()) {\n                $.async({\n                    // customer_login recaptcha\n                    selector: '#recaptcha-checkout-inline-login-wrapper'\n                }, function (loginWrapper) {\n                    $(loginWrapper).toggle(\n                        this.isPasswordVisible() && !this.isCreateAccountAction() && window.checkoutConfig.amastyOscCaptcha.isLoginReCaptcha\n                    );\n                }.bind(this));\n            }\n            if (this.createAccountRecaptcha()) {\n                $.async({\n                    // customer_create recaptcha\n                    selector: '#recaptcha-checkout-inline-create-wrapper'\n                }, function (loginWrapper) {\n                    $(loginWrapper).toggle(\n                        this.isCreateAccountAction() && window.checkoutConfig.amastyOscCaptcha.isCreateAccountReCaptcha\n                    );\n                }.bind(this));\n            }\n        },\n\n        isReCaptchaVisible: function() {\n            return (this.isPasswordVisible() && !this.isCreateAccountAction() && window.checkoutConfig.amastyOscCaptcha.isLoginReCaptcha)\n                || (this.isCreateAccountAction() && window.checkoutConfig.amastyOscCaptcha.isCreateAccountReCaptcha);\n        },\n\n        _visibleDateOfBirth: function () {\n            if (this.dateOfBirth()) {\n                this.dateOfBirth().visible(this.isPassword() && this.isCreateAccountAction());\n            }\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/form/element/tooltip.js":"/**\n * Custom tooltip initializer\n */\ndefine([\n    'jquery',\n    'uiElement',\n    'Amasty_CheckoutCore/vendor/tooltipster/js/tooltipster.min'\n], function (\n    $,\n    Element\n) {\n    'use strict';\n\n    return Element.extend({\n        defaults: {\n            selectors: {\n                tooltipElement: '[data-amcheckout-js=\"tooltip\"]'\n            },\n            keycodes: {\n                escape: 27\n            }\n        },\n\n        initialize: function () {\n            this._super();\n\n            this.initTooltip();\n\n            return this;\n        },\n\n        initTooltip: function () {\n            $.async(this.selectors.tooltipElement, function (element) {\n                $(element).tooltipster({\n                    position: 'right',\n                    contentAsHtml: true,\n                    interactive: true,\n                    trigger: 'click',\n                    theme: 'amcheckout-default-tooltip'\n                });\n\n                $(element).focus(function() {\n                    $(this).tooltipster('open');\n                });\n\n                $(element).blur(function() {\n                    $(this).tooltipster('close');\n                });\n\n                $(element).keydown(function(event) {\n                    (event.keyCode === this.keycodes.escape) && $(this).tooltipster('close');\n                });\n            });\n        },\n\n        isTouchDevice: function () {\n            return ('ontouchstart' in window)\n                || (navigator.maxTouchPoints > 0)\n                || (navigator.msMaxTouchPoints > 0);\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/summary/summary-widget.js":"define([\n    'jquery',\n    'stickyWidget',\n    'checkoutCollapsibleSteps'\n], function ($) {\n    'use strict';\n\n    $.widget('amasty.summaryWidget', {\n        options: {\n            desktopBreakpoint: 1024,\n        },\n\n        _create: function () {\n            if ($(this.element).parents('[data-amcheckout-js=\"main-container\"]').length) {\n                this.summaryByLayout();\n            }\n        },\n\n        summaryByLayout: function () {\n            switch (window.checkoutLayout) {\n                case '1column':\n                    $(this.element).checkoutCollapsibleSteps();\n                    break;\n\n                case '2columns':\n                    this.manageCollapsible();\n                    if (!$(this.element).data('amastyStickyWidget')) {\n                        $(this.element).stickyWidget({\n                            parentContainer: '[data-amcheckout-js=\"main-container\"]',\n                            element: '[data-amcheckout-js=\"sidebar-column\"]',\n                            scrollContentContainer: '[data-amcheckout-js=\"main-column\"]',\n                            stickyOffset: {\n                                top: 0,\n                                left: 60\n                            },\n                            stickyPosition: 'right'\n                        });\n                    }\n                    break;\n\n                default:\n                    break;\n            }\n        },\n\n        manageCollapsible: function () {\n            if ($(window).width() < this.options.desktopBreakpoint) {\n                $(this.element).checkoutCollapsibleSteps();\n            } else {\n                $('[data-amcheckout-js=\"step-container\"]').on(\"dimensionsChanged\", function () {\n                    $(window).trigger('scroll');\n                });\n            }\n\n            $(window).on('resize', function () {\n                if ($(window).width() < this.options.desktopBreakpoint) {\n                    $(this.element).checkoutCollapsibleSteps().checkoutCollapsibleSteps('createCollapsible');\n                } else {\n                    if ($(this.element).data('amastyCheckoutCollapsibleSteps')) {\n                        $(this.element).checkoutCollapsibleSteps('destroyCollapsible');\n                    }\n                }\n            }.bind(this));\n        }\n    });\n\n    return $.amasty.summaryWidget;\n});\n","Amasty_CheckoutCore/js/view/summary/cart-items-mixin.js":"define([], function () {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            /**\n             * After Magento 2.2.4 items is not expanded by default.\n             * return true for expanded by default\n             */\n            isItemsBlockExpanded: function () {\n                return true;\n            }\n        });\n    }\n});","Amasty_CheckoutCore/js/view/summary/sticky-widget.js":"define([\n    'jquery'\n], function ($) {\n    'use strict';\n\n    $.widget('amasty.stickyWidget', {\n        options: {\n            //selectors\n            parentContainer: '[data-amsticky-js=\"main-container\"]',\n            element: '[data-amsticky-js=\"sticky-element\"]',\n            scrollContentContainer: '[data-amsticky-js=\"scroll-element\"]',\n            stopper: '[data-amsticky-js=\"stopper\"]',\n\n            //sticky options\n            stickyOffset: {\n                top: 0,\n                left: 0\n            },\n            stickyPosition: 'right',\n            stickyClass: '-sticky',\n            disableBreakpoint: 1024\n        },\n\n        _create: function () {\n            var toggleSticky = this.stickyToggle.bind(this),\n                windowGlobal = window;\n\n            if ($(windowGlobal).width() >= this.options.disableBreakpoint) {\n                if ($(this.options.scrollContentContainer).length) {\n                    this.stickyPosition(this.options.stickyPosition);\n                };\n\n                $(windowGlobal).off('scroll', toggleSticky).on('scroll', toggleSticky);\n            }\n\n            $(windowGlobal).on('resize', function () {\n                this.stickyToggle();\n                if ($(windowGlobal).width() >= this.options.disableBreakpoint) {\n                    this.stickyPosition(this.options.stickyPosition);\n                    $(windowGlobal).off('scroll', toggleSticky).on('scroll', toggleSticky);\n                } else {\n                    $(windowGlobal).off('scroll', toggleSticky);\n                }\n            }.bind(this));\n        },\n\n        stickyToggle: function () {\n            var stickyOptions = this.options,\n                parentIsSet = $(stickyOptions.parentContainer).length,\n                parentContainer = (parentIsSet)\n                    ? $(stickyOptions.parentContainer)\n                    : $('body'),\n                parentContainerOffset = parentContainer.offset(),\n                scrollContentIsSet = $(stickyOptions.scrollContentContainer).length,\n                scrollContent = (scrollContentIsSet)\n                    ? $(stickyOptions.scrollContentContainer)\n                    : $('body'),\n                stickyElement = $(stickyOptions.element),\n                stickyIsRight = stickyOptions.stickyPosition == 'right',\n                stickyOffset = stickyOptions.stickyOffset,\n                stickyOffsetLeft = (scrollContentIsSet)\n                    ? scrollContent.offset().left + scrollContent.outerWidth() + stickyOffset.left\n                    : stickyOffset.left,\n                stopperOffset = ($(stickyOptions.stopper).length)\n                    ? $(stickyOptions.stopper).offset()\n                    :   {\n                            top: parentContainerOffset.top + parentContainer.height(),\n                            left: parentContainerOffset.left\n                        },\n                windowScrollTop = $(window).scrollTop();\n\n            if ($(window).width() < stickyOptions.disableBreakpoint) {\n                this.enableMobileLayout();\n\n                return;\n            }\n\n            if (parentContainer.height() <= stickyElement.height()) {\n                this.stickyDisable(stickyElement);\n\n                return;\n            }\n\n            if (stopperOffset.top - stickyElement[0].scrollHeight < windowScrollTop) {\n                if (stickyElement.css('position') != 'absolute') {\n                    stickyElement.css({\n                        position: 'absolute',\n                        top: 'initial',\n                        right: stickyIsRight ? 0 : 'initial',\n                        bottom: parentContainer.height() - (stopperOffset.top - parentContainerOffset.top),\n                        left: stickyIsRight ? 'initial' : 0\n                    });\n                    stickyElement.removeClass(stickyOptions.stickyClass);\n                }\n            } else if (parentContainerOffset.top < windowScrollTop + stickyOffset.top) {\n                if (stickyElement.css('position') != 'fixed') {\n                    stickyElement.css({\n                        position: 'fixed',\n                        top: stickyOffset.top,\n                        right: 'initial',\n                        bottom: 'initial',\n                        left: stickyIsRight ? stickyOffsetLeft : (parentContainerOffset.left + stickyOffset.left)\n                    });\n                    stickyElement.addClass(this.options.stickyClass);\n                }\n            } else {\n                this.stickyDisable(stickyElement);\n            }\n        },\n\n        stickyPosition: function (position) {\n            var stickyElement = $(this.options.element),\n                stickyFloat = (position == 'right') ? 'right' : 'left',\n                scrollContent = $(this.options.scrollContentContainer),\n                scrollContentFloat = (stickyFloat == 'right') ? 'left' : 'right';\n\n            stickyElement.css('float', stickyFloat);\n            scrollContent.css('float', scrollContentFloat);\n        },\n\n        stickyDisable: function (stickyElement) {\n            if (stickyElement.css('position') != 'static') {\n                stickyElement.css({\n                    position: 'static',\n                    top: 'initial',\n                    right: 'initial',\n                    bottom: 'initial',\n                    left: 'initial'\n                });\n                stickyElement.removeClass(this.options.stickyClass);\n            }\n        },\n\n        enableMobileLayout: function () {\n            var stickyElement = $(this.options.element),\n                scrollContent = $(this.options.scrollContentContainer);\n\n            this.stickyDisable(stickyElement);\n            stickyElement.css('float', 'none');\n            if (scrollContent.length) scrollContent.css('float', 'none');\n        }\n    });\n\n    return $.amasty.stickyWidget;\n});\n","Amasty_CheckoutCore/js/view/summary/abstract-total.js":"define([], function () {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            isFullMode: function () {\n                return this.getTotals();\n            }\n        });\n    }\n});","Amasty_CheckoutCore/js/view/checkout/datepicker.js":"define([\n    'moment',\n    'ko',\n    'underscore',\n    'jquery',\n    'mage/translate',\n    'mage/calendar'\n], function (moment, ko, _, $, $t) {\n    'use strict';\n\n    var defaults = {\n        showsTime: false,\n        timeFormat: null,\n        buttonImage: null,\n        buttonImageOnly: null,\n        buttonText: $t('Select Date')\n    };\n\n    ko.bindingHandlers.amastydatepicker = {\n\n        init: function (el, valueAccessor) {\n\n            var config = valueAccessor(),\n                observable,\n                options = {};\n\n            _.extend(options, defaults);\n\n            if (typeof config === 'object') {\n                observable = config.storage;\n\n                _.extend(options, config.options);\n            } else {\n                observable = config;\n            }\n\n            var date = moment(observable(), config.elem.pickerDateTimeFormat);\n\n            $(el).calendar(options);\n            observable() && $(el).datepicker('setDate', date.format(config.elem.pickerDateTimeFormat));\n            $(el).blur();\n\n            ko.utils.registerEventHandler(el, 'change', function () {\n                observable(this.value);\n            });\n        }\n    };\n});\n","Amasty_CheckoutCore/js/view/checkout/summary/cart-items.js":"/**\n * Checkout cart items view.\n */\ndefine([\n    'ko',\n    'Magento_Checkout/js/model/totals',\n    'Magento_Checkout/js/view/summary/cart-items'\n], function (ko, totals, Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            template: 'Amasty_CheckoutCore/checkout/summary/cart-items'\n        },\n\n        itemsQty: ko.observable(),\n\n        initialize: function () {\n            this._super();\n\n            this.itemsQty(this.getItemsQty());\n            totals.totals.subscribe(function () {\n                this.itemsQty(this.getItemsQty());\n            }, this);\n\n            return this;\n        },\n\n        getItemsQty: function () {\n            return parseFloat(totals.totals().items_qty);\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/checkout/summary/item/details.js":"define(\n    [\n        'jquery',\n        'Magento_Checkout/js/view/summary/item/details',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Ui/js/modal/confirm',\n        'Amasty_CheckoutCore/js/action/remove-item',\n        'Amasty_CheckoutCore/js/action/update-item',\n        'mage/translate',\n        'ko',\n        'Amasty_CheckoutCore/js/options/configurable',\n        'priceOptions',\n        'mage/validation'\n    ],\n    function ($, Component, quote, confirm, removeItemAction, updateItemAction, $t, ko, configurable, priceOptions) {\n        'use strict';\n\n        return Component.extend({\n            defaults: {\n                template: 'Amasty_CheckoutCore/checkout/summary/item/details',\n                messages: {\n                    deleteItem: $t('Are you sure you would like to remove this item from the shopping cart?')\n                }\n            },\n\n            /**\n             * @param {Object} item\n             * @return {*}\n             */\n            getItemConfig: function (item) {\n                return this.getPropertyDataFromItem(item, 'amcheckout');\n            },\n\n            /**\n             *\n             * @param {Object} item\n             * @param {Object} propertyName\n             * @return {*}\n             */\n            getPropertyDataFromItem: function (item, propertyName) {\n                var property,\n                    itemDetails,\n                    quoteItem;\n\n                if (item.hasOwnProperty(propertyName)) {\n                    property = item[propertyName];\n                }\n\n                quoteItem = this.getItemFromQuote(item);\n\n                if (quoteItem.hasOwnProperty(propertyName)) {\n                    property = quoteItem[propertyName];\n                }\n\n                if (property) {\n                    this.storage().set('item_details' + item.item_id + propertyName, property);\n\n                    return property;\n                }\n\n                itemDetails = this.storage().get('item_details' + item.item_id + propertyName);\n\n                return itemDetails || false;\n            },\n\n            /**\n             *\n             * @param {Object} item\n             * @return {*}\n             */\n            getItemFromQuote: function (item) {\n                var items = quote.getItems(),\n                    quoteItems = items.filter(function (quoteItem) {\n                        return +quoteItem.item_id === item.item_id;\n                    });\n\n                if (quoteItems.length === 0) {\n                    return false;\n                }\n\n                return quoteItems[0];\n            },\n\n            getConfigurableOptions: function (item) {\n                var itemConfig = this.getItemConfig(item);\n\n                if (itemConfig.hasOwnProperty('configurableAttributes')) {\n                    return itemConfig.configurableAttributes.template;\n                }\n\n                return '';\n            },\n\n            getCustomOptions: function (item, element) {\n                var itemConfig = this.getItemConfig(item),\n                    template = '';\n\n                if (itemConfig.hasOwnProperty('customOptions')) {\n                    template = itemConfig.customOptions.template;\n                }\n\n                $(element).html(template).trigger('contentUpdated');\n            },\n\n            optionsAfterRender: function (item, element) {\n                $(element).one('beforeOpen', this.initOnOpen.bind(this, item));\n            },\n\n            initOnOpen: function (item) {\n                const itemConfig = this.getItemConfig(item);\n\n                if (itemConfig.hasOwnProperty('configurableAttributes')) {\n                    this.preSelectOptions(itemConfig, item);\n                }\n            },\n\n            preSelectOptions: function (itemConfig, item) {\n                const container = item.form;\n\n                container.amcheckoutConfigurable({\n                    spConfig: JSON.parse(itemConfig.configurableAttributes.spConfig),\n                    superSelector: '[data-role=\"product-attributes\"][data-item-id=' + item.item_id + ']' + ' .super-attribute-select'\n                });\n\n                item.preSelect = true;\n            },\n\n            isDecimal: function (item) {\n                var quoteItem = this.getItemFromQuote(item);\n\n                return quoteItem.is_qty_decimal;\n            },\n\n            isEditingAvailable: function (item) {\n                return this.isEditable(item) && !this.isNegotiableQuote();\n            },\n\n            isEditingLocked: function (item) {\n                return this.isEditable(item) && this.isNegotiableQuote();\n            },\n\n            isEditable: function (item) {\n                var itemConfig = this.getItemConfig(item);\n\n                return itemConfig.isEditable;\n            },\n\n            isNegotiableQuote: function () {\n                return window.checkoutConfig.isNegotiableQuote && this.backQuoteUrl();\n            },\n\n            backQuoteUrl: function () {\n                return window.checkoutConfig.backQuoteUrl;\n            },\n\n            initOptions: function (item) {\n                const itemConfig = this.getItemConfig(item),\n                    containerSelector = '[data-role=\"product-attributes\"][data-item-id=' + item.item_id + ']',\n                    container = $(containerSelector);\n\n                if (itemConfig.hasOwnProperty('customOptions')) {\n                    container.priceOptions({\n                        optionConfig: JSON.parse(itemConfig.customOptions.optionConfig)\n                    });\n                }\n\n                item.form = container;\n                item.isUpdated = ko.observable(false);\n                item.validation = container.validation();\n\n                container.find('input, select, textarea').change(function () {\n                    item.isUpdated(true);\n                });\n            },\n\n            updateItem: function (item) {\n                if (item.validation.valid()) {\n                    const itemConfig = this.getItemConfig(item);\n\n                    if (itemConfig.hasOwnProperty('configurableAttributes') && !item.preSelect) {\n                        this.preSelectOptions(itemConfig, item);\n                    }\n\n                    updateItemAction(item.item_id, item.form.serialize());\n                }\n            },\n\n            /**\n             * Automatically updates the order form if it`s changed\n             *\n             * @param {Object} item\n             * @return {*}\n             */\n            updateItemAuto: function (item) {\n                const itemConfig = this.getItemConfig(item);\n                let isNotEmpty = true,\n                    options;\n\n                if (!Object.prototype.hasOwnProperty.call(item, 'form')) {\n                    return;\n                }\n\n                if (itemConfig.hasOwnProperty('configurableAttributes') && !item.preSelect) {\n                    this.preSelectOptions(itemConfig, item);\n                }\n\n                options = item.form.serializeArray();\n                $.each(options, function () {\n                    if (this.value === '') {\n                        isNotEmpty = false;\n                    }\n                });\n\n                if (isNotEmpty) {\n                    item.validation.valid();\n                    updateItemAction(item.item_id, item.form.serialize());\n                }\n            },\n\n            deleteItem: function (item) {\n                confirm({\n                    content: this.messages.deleteItem,\n                    actions: {\n                        confirm: function () {\n                            removeItemAction(item.item_id);\n                        },\n                        always: function (event) {\n                            event.stopImmediatePropagation();\n                        }\n                    }\n                });\n            },\n\n            canShowDeleteButton: function () {\n                return this.isCheckoutItemsEditable() && quote.getItems().length >= 1 && !this.isNegotiableQuote();\n            },\n\n            isCheckoutItemsEditable: function () {\n                return window.checkoutConfig.isCheckoutItemsEditable;\n            }\n        });\n    }\n);\n","Amasty_CheckoutCore/js/view/checkout/summary/item/price/unit_incl_tax.js":"define([\n    'Magento_Weee/js/view/checkout/summary/item/price/row_incl_tax'\n], function (Component) {\n    'use strict';\n\n    return Component.extend({\n        /**\n         * @param {Object} item\n         * @return {Number}\n         */\n        getUnitPriceInclTax: function (item) {\n            var unitPriceInclTax = parseFloat(item['price_incl_tax']);\n\n            if (window.checkoutConfig.getIncludeWeeeFlag) {\n                unitPriceInclTax += this.getUnitWeeeTaxInclTax(item);\n            }\n\n            return unitPriceInclTax;\n        },\n\n        /**\n         * @param {Object}item\n         * @return {Number}\n         */\n        getUnitWeeeTaxInclTax: function (item) {\n            var totalWeeeTaxInclTaxApplied = 0,\n                weeeTaxAppliedAmounts;\n\n            if (item['weee_tax_applied']) {\n                weeeTaxAppliedAmounts = JSON.parse(item['weee_tax_applied']);\n                weeeTaxAppliedAmounts.forEach(function (weeeTaxAppliedAmount) {\n                    totalWeeeTaxInclTaxApplied += parseFloat(Math.max(weeeTaxAppliedAmount['amount_incl_tax'], 0));\n                });\n            }\n\n            return totalWeeeTaxInclTaxApplied;\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/checkout/summary/item/price/unit_excl_tax.js":"/* eslint-disable dot-notation */\ndefine([\n    'Magento_Weee/js/view/checkout/summary/item/price/row_excl_tax'\n], function (Component) {\n    'use strict';\n\n    return Component.extend({\n        /**\n         * @param {Object} item\n         * @return {Number}\n         */\n        getUnitPriceExclTax: function (item) {\n            var unitPriceExclTax = parseFloat(item['row_total']) / parseFloat(item['qty']);\n\n            if (window.checkoutConfig.getIncludeWeeeFlag) {\n                unitPriceExclTax += this.getUnitWeeeTaxExclTax(item);\n            }\n\n            return unitPriceExclTax;\n        },\n\n        /**\n         * @param {Object} item\n         * @return {Number}\n         */\n        getUnitWeeeTaxExclTax: function (item) {\n            var totalWeeeTaxExclTaxApplied = 0,\n                weeeTaxAppliedAmounts;\n\n            if (item['weee_tax_applied']) {\n                weeeTaxAppliedAmounts = JSON.parse(item['weee_tax_applied']);\n                weeeTaxAppliedAmounts.forEach(function (weeeTaxAppliedAmount) {\n                    totalWeeeTaxExclTaxApplied += parseFloat(Math.max(weeeTaxAppliedAmount.amount, 0));\n                });\n            }\n\n            return totalWeeeTaxExclTaxApplied;\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/checkout/design/collapsible-steps.js":"define([\n    'jquery',\n    'mage/collapsible',\n    'Magento_Ui/js/modal/modal'\n], function ($) {\n    'use strict';\n\n    $.widget('amasty.checkoutCollapsibleSteps', $.mage.collapsible, {\n        _create: function () {\n            this.createCollapsible();\n            this.trigger = this.element.find(this.options.header);\n        },\n\n        initCollapsible: function () {\n            $(this.element).parent().collapsible({\n                header: '[data-amcheckout-js=\"step-title\"]',\n                content: $(this.element).parent().find('[data-amcheckout-js=\"step-content\"]'),\n                active: true,\n                openedState: '-collapsible -opened',\n                closedState: '-collapsible -closed',\n                icons: {\n                    header: 'amcheckout-icon -plus',\n                    activeHeader: 'amcheckout-icon -minus'\n                },\n                animate: 300\n            });\n        },\n\n        createCollapsible: function () {\n            var checkoutWindow = window;\n\n            if (!$(this.element).parent().data('mageCollapsible')\n                && checkoutWindow.checkoutDesign == 'modern'\n                && (checkoutWindow.checkoutLayout == '1column' || checkoutWindow.checkoutLayout == '2columns')) {\n                this.initCollapsible();\n            }\n        },\n\n        destroyCollapsible: function () {\n            var collapsibleElement = $(this.element).parent();\n\n            if (collapsibleElement.data('mageCollapsible')) {\n                collapsibleElement.collapsible(\"forceActivate\").collapsible(\"destroy\");\n            }\n        }\n    });\n\n    return $.amasty.checkoutCollapsibleSteps;\n});\n","Amasty_CheckoutCore/js/view/shipping-address/list-mixin.js":"/**\n * Change shipping address list view.\n */\ndefine([\n    'ko',\n    'underscore',\n    'Amasty_CheckoutCore/js/model/address-form-state',\n    'Amasty_CheckoutCore/js/model/shipping-registry',\n    'Magento_Customer/js/model/address-list',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/shipping-address/form-popup-state',\n    'Magento_Checkout/js/action/select-shipping-address',\n    'Magento_Checkout/js/checkout-data',\n    'mage/translate',\n    'jquery'\n], function (\n    ko,\n    _,\n    addressFormState,\n    shippingRegistry,\n    addressList,\n    quote,\n    formPopUpState,\n    selectShippingAddress,\n    checkoutData,\n    $t\n) {\n    'use strict';\n\n    var newAddressOption = {\n        /**\n         * Get new address label\n         * @returns {String}\n         */\n        getAddressInline: function () {\n            return $t('New Address');\n        },\n        customerAddressId: null\n    };\n\n    function isAddressNew(address) {\n        return address && (address === newAddressOption || address.getType() === 'new-customer-address');\n    }\n\n    return function (Component) {\n        return Component.extend({\n            defaults: {\n                dropdownTemplate: 'Amasty_CheckoutCore/shipping-address/shipping-address',\n                modules: {\n                    shippingInformationComponent: 'index = ship-to',\n                    shippingAddressComponent: '${ $.parentName }'\n                }\n            },\n\n            initialize: function () {\n                _.bindAll(\n                    this,\n                    'addressOptionsText',\n                    'changeAddress',\n                    'onAddressChange',\n                    'updateAddress',\n                    'cancelAddressEdit'\n                );\n\n                this._super();\n\n                if (this.getVisible()) {\n                    window.isShippingAddressFormOverridden(true);\n                    this.shippingAddressComponent(this.overrideNewShippingAddress);\n                    shippingRegistry.excludedCollectionNames.push('shipping-address-fieldset');\n                }\n\n                return this;\n            },\n\n            initObservable: function () {\n                this._super()\n                    .observe({\n                        /**\n                         * Current dropdown value\n                         */\n                        selectedAddress: quote.shippingAddress(),\n\n                        /**\n                         * On true shows current shipping address information as plain text\n                         */\n                        isAddressDetailsVisible: quote.shippingAddress() != null,\n\n                        /**\n                         * On true shows new address form if isAddressListVisible is also true\n                         */\n                        isAddressFormVisible: false,\n\n                        /**\n                         * On true shows dropdown and new address form\n                         */\n                        isAddressListVisible: !quote.shippingAddress(),\n                    });\n\n                this.initSubscribers();\n\n                return this;\n            },\n\n            /**\n             * Set subscribers to observables\n             */\n            initSubscribers: function () {\n                if (this.getVisible()) {\n                    quote.shippingAddress.subscribe(this.onShippingAddressUpdate, this);\n                    this.selectedAddress.subscribe(this.onAddressChange, this);\n                    this.isAddressFormVisible.subscribe(this.updatePopupState, this);\n                    this.isAddressListVisible.subscribe(this.isShippingFormVisibleUpdate, this);\n                }\n            },\n\n            /**\n             * Modify new shipping address for registered customer functionality.\n             *  Old behavior - popup; new - inline form\n             *\n             * @param {object} shippingComponent\n             */\n            overrideNewShippingAddress: function (shippingComponent) {\n                //override popup functionality\n                shippingComponent.getPopUp = shippingComponent.getPopUpOverride;\n            },\n\n            /**\n             * Override for better compatibility.\n             * Magento_NegotiableQuote compatibility.\n             *\n             * @return {string}\n             */\n            getTemplate: function () {\n                this._super();\n\n                return this.dropdownTemplate;\n            },\n\n            /**\n             * Override to prevent not used functionality render (performance save)\n             */\n            initChildren: function () {\n                return this;\n            },\n\n            /**\n             * Override to prevent not used functionality render (performance save).\n             * This list uses ship-to component instead origin\n             */\n            createRendererComponent: function () {},\n\n            /**\n             * Visible by default is usual variable,\n             * but it can be changed to observable or computed by vendors (amazon)\n             *\n             * @return {boolean}\n             */\n            getVisible: function () {\n                return ko.utils.unwrapObservable(this.visible);\n            },\n\n            /**\n             * Subscriber\n             * updates new shipping address core state\n             * required to suppress address update before save\n             */\n            updatePopupState: function () {\n                if (this.getVisible()) {\n                    formPopUpState.isVisible(this.isAddressListVisible() && this.isAddressFormVisible());\n                }\n            },\n\n            /**\n             * Shipping address subscriber\n             * Close form on shipping address change\n             *\n             * @param {object} newAddress\n             */\n            onShippingAddressUpdate: function (newAddress) {\n                if (newAddress != null) {\n                    this.isAddressDetailsVisible(true);\n                    this.isAddressListVisible(false);\n                }\n            },\n\n            /**\n             * New Address form visibility subscriber\n             */\n            isShippingFormVisibleUpdate: function () {\n                this.updatePopupState();\n\n                if (this.getVisible()) {\n                    addressFormState.isShippingFormVisible(\n                        this.isAddressListVisible()\n                    );\n                }\n            },\n\n            /*\n             * html Select binding methods\n             */\n\n            /**\n             * Options array\n             */\n            addressOptions: ko.pureComputed(function () {\n                var addressOptions = _.clone(addressList()),\n                    newAddressAdded;\n\n                _.find(addressOptions, function (address) {\n                    if (isAddressNew(address)) {\n                        newAddressAdded = true;\n\n                        return true;//break\n                    }\n                });\n\n                if (!newAddressAdded) {\n                    addressOptions.push(newAddressOption);\n                }\n\n                return addressOptions;\n            }),\n\n            /**\n             * For html option text binding\n             *\n             * @param {Object} address\n             * @return {string}\n             */\n            addressOptionsText: function (address) {\n                if (address.getAddressInline) {\n                    return address.getAddressInline();\n                }\n\n                if (isAddressNew(address)) {\n                    return $t('New Address');\n                }\n\n                return this.getCaptionByAddressType(address);\n            },\n\n            /**\n             * @param {Object} address\n             * @returns {*}\n             */\n            getCaptionByAddressType: function (address) {\n                switch (address.getType()) {\n                    case 'gift-registry':\n                        return $t('Recipient Address');\n                    default:\n                        return address.getKey();\n                }\n            },\n\n            /**\n             * Update address action\n             */\n            updateAddress: function () {\n                var canCloseForm = false;\n\n                if (this.selectedAddress() != null) {\n                    if (this.isAddressFormVisible()) {\n                        this.shippingAddressComponent().saveNewAddress();\n                    } else {\n                        selectShippingAddress(this.selectedAddress());\n                        checkoutData.setSelectedShippingAddress(this.selectedAddress().getKey());\n                        canCloseForm = true;\n                    }\n                }\n\n                if (this.shippingAddressComponent().source.get('params.invalid') !== true || canCloseForm === true) {\n                    this.cancelAddressEdit();\n                }\n            },\n\n            /**\n             * Update dropdown selected value. Should same as current shipping address.\n             */\n            updateDropdownAddress: function () {\n                var shippingAddress = quote.shippingAddress(),\n                    list = addressList(),\n                    addressIndex,\n                    selectedAddress;\n\n                selectedAddress = _.find(list, function (address) {\n                    return address === shippingAddress;\n                });\n\n                if (!selectedAddress && isAddressNew(shippingAddress)) {\n                    //Resolve when shipping address and selectedAddress different objects with same value.\n                    addressIndex = _.findIndex(list, function (address) {\n                        return isAddressNew(address);\n                    });\n\n                    if (addressIndex !== -1) {\n                        list[addressIndex] = shippingAddress;\n                        addressList(list);\n                    }\n                }\n\n                this.selectedAddress(shippingAddress);\n            },\n\n            /**\n             * Show address dropdown\n             */\n            changeAddress: function () {\n                this.updateDropdownAddress();\n                this.isAddressListVisible(true);\n                this.isAddressDetailsVisible(false);\n            },\n\n            /**\n             * Cancel address edit action.\n             */\n            cancelAddressEdit: function () {\n                this.updateDropdownAddress();\n                this.isAddressDetailsVisible(true);\n                this.isAddressListVisible(false);\n            },\n\n            /**\n             * On dropdown value change\n             *\n             * @param {Object} address\n             */\n            onAddressChange: function (address) {\n                this.isAddressFormVisible(isAddressNew(address));\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/shipping-address/address-renderer/default-mixin.js":"define([\n    'underscore',\n    'uiRegistry'\n], function (_) {\n    'use strict';\n\n    return function (targetModule) {\n        return targetModule.extend({\n            getCustomAttributeLabel: function (attribute) {\n                if (_.isObject(attribute)\n                    && _.isString(attribute.attribute_code)\n                    && attribute.attribute_code.indexOf('custom_field_') !== -1\n                ) {\n                    return this._super(attribute.value);\n                }\n\n                return this._super();\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/payment/list.js":"// Checkout payment methods view mixin\ndefine([\n    'Magento_Checkout/js/model/payment-service',\n    'Amasty_CheckoutCore/js/view/utils'\n], function (paymentService, viewUtils) {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            /**\n             * add loader block for payment\n             */\n            isLoading: paymentService.isLoading,\n\n            getGroupTitle: function (newValue) {\n                var paymentMethodLayoutConfig = viewUtils.getBlockLayoutConfig('payment_method');\n\n                if (newValue().index === 'methodGroup'\n                    && paymentMethodLayoutConfig !== null\n                ) {\n                    return paymentMethodLayoutConfig.title;\n                }\n\n                return this._super(newValue);\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/payment/method-renderer/default-mixin.js":"/**\n * By default Magento flow, when payment method selected billing address is updates.\n * And when billing address updates, isPlaceOrderActionAllowed also update.\n * But One Step Checkout optimize billing address KO update. @see onepage.replaceEqualityComparer\n * So we need update isPlaceOrderActionAllowed on payment method change, to emulate default flow.\n * Also we added placeOrderState for Place Order button. Thus, we can flexibly manage its state.\n */\ndefine([\n    'jquery',\n    'ko',\n    'underscore',\n    'Magento_Checkout/js/model/quote',\n    'Amasty_CheckoutCore/js/model/payment/place-order-state',\n    'Amasty_CheckoutCore/js/model/payment/payment-loading'\n], function ($, ko, _, quote, placeOrderState, paymentLoader) {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            initObservable: function () {\n                this._super();\n\n                this.isPlaceOrderActionAllowed = ko.pureComputed({\n                    read: this.isPlaceOrderActionAllowedRead,\n                    write: this.isPlaceOrderActionAllowedWrite,\n                    owner: this\n                });\n\n                return this;\n            },\n\n            /**\n             * Read function for KO computed isPlaceOrderActionAllowed.\n             *\n             * Don't call this function directly.\n             * Use isPlaceOrderActionAllowed().\n             *\n             * @returns {boolean}\n             */\n            isPlaceOrderActionAllowedRead: function () {\n                return quote.billingAddress() !== null && placeOrderState() && !paymentLoader();\n            },\n\n            /**\n             * Write function for KO computed isPlaceOrderActionAllowed.\n             *\n             * Don't call this function directly.\n             * Use isPlaceOrderActionAllowed(value).\n             *\n             * @param {boolean} value\n             * @returns {boolean}\n             */\n            isPlaceOrderActionAllowedWrite: function (value) {\n                return placeOrderState(!!value);\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/payment/method-renderer/in-context/checkout-express-mixin.js":"define([\n    'ko',\n    'underscore',\n    'uiRegistry',\n    'rjsResolver',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/payment/method-list'\n], function (ko, _, registry, onJsLoad, quote, paymentMethods) {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            validationTimeout: 0,\n\n            /**\n             * fix paypal behavior for one step checkout\n             * reactivate button on shipping save\n             */\n            initListeners: function () {\n                this._super();\n                onJsLoad(function () {\n                    var fields = registry.filter(function (module) {\n                        return ko.isObservable(module.required)\n                            && module.required.peek() === true\n                            && ko.isObservable(module.value)\n                            && ko.isObservable(module.visible)\n                            && ko.isObservable(module.disabled);\n                    });\n\n                    paymentMethods.subscribe(this.amDeferredValidation, this);\n                    _.each(fields, function (element) {\n                        element.value.subscribe(function (value) {\n                            if ((value || value === 0 || value === false)\n                                && element.required()\n                                && element.visible()\n                                && !element.disabled()\n                            ) {\n                                this.amDeferredValidation();\n                            }\n                        }.bind(this));\n                    }.bind(this));\n\n                }.bind(this));\n            },\n\n            validate: function () {\n                this._super();\n                clearTimeout(this.validationTimeout);\n            },\n\n            amDeferredValidation: function () {\n                clearTimeout(this.validationTimeout);\n\n                if (quote.paymentMethod() && quote.paymentMethod().method === this.item.method) {\n                    this.validationTimeout = setTimeout(function () {\n                        window.shippingErrorHideIsNotAllowed = true;\n                        this.validate();\n                        delete window.shippingErrorHideIsNotAllowed;\n                    }.bind(this), 200);\n                }\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/payment/method-renderer/braintree/cc-form-mixin.js":"// upgrade Braintree flow for One Step Checkout\ndefine([\n], function () {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            /**\n             * Brantree harcoded disallow order place on initialization.\n             * By default Magento flow, payment method cannot be preselected.\n             * Dnd when payment method selected billing address is updates.\n             * And when billing address updates, isPlaceOrderActionAllowed also update.\n             * But One Step Checkout optimize billing address KO update.\n             */\n            initFormValidationEvents: function () {\n                this._super();\n                this.updateIsPlaceOrderActionAllowed();\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/payment/method-renderer/braintree/paypal-mixin.js":"define([\n    'underscore',\n    'Magento_Checkout/js/model/quote',\n    'Amasty_CheckoutCore/js/model/events'\n], function (_, quote, events) {\n    'use strict';\n\n    return function (Component) {\n        return Component.extend({\n            /**\n             * fix braintree paypal behavior for one step checkout\n             */\n            initObservable: function () {\n                var self = this;\n\n                this._super();\n\n                events.onAfterShippingSave(_.debounce(function () {\n                    var method = quote.paymentMethod();\n\n                    if (method && method.method === self.code) {\n                        self.reInitPayPal();\n                    }\n                }, 50));\n\n                return this;\n            }\n        });\n    };\n});\n","Amasty_CheckoutCore/js/view/additional/fieldset.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'uiComponent',\n    'Amasty_CheckoutCore/js/action/save-additional-fields',\n    'Magento_Checkout/js/checkout-data'\n], function (Component, saveAction) {\n    'use strict';\n\n    return Component.extend({\n        saveAllowed: false,\n\n        initialize: function () {\n            this._super();\n            this.source.on('amcheckout.additional:save', this.saveForm.bind(this));\n        },\n\n        saveForm: function () {\n            saveAction();\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/additional/subscribe.js":"define([\n    'jquery',\n    'Magento_Ui/js/form/element/single-checkbox'\n], function ($,  SingleCheckbox) {\n    'use strict';\n\n    return SingleCheckbox.extend({\n        defaults: {\n            valueMap: {\n                'true': true,\n                'false': false\n            }\n        },\n        onUpdate: function (newValue) {\n            this._super();\n            if (this.initialChecked !== newValue) {\n                this.source.trigger('amcheckout.additional:save');\n                this.initialChecked = newValue;\n            }\n        }\n    });\n});","Amasty_CheckoutCore/js/view/additional/date-of-birth.js":"define([\n    'Magento_Ui/js/form/element/date',\n    'jquery',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Amasty_CheckoutCore/js/model/payment-validators/dob-validator',\n    'Amasty_CheckoutCore/js/view/additional/register',\n    'Amasty_CheckoutCore/js/view/checkout/datepicker'\n], function (Component, $, paymentValidatorRegistry, dobValidator) {\n    'use strict';\n    return Component.extend({\n        defaults: {\n            template: 'Amasty_CheckoutCore/form/date',\n            listens: {\n                '${ $.parentName }.register:checked': 'visible'\n            },\n            modules: {\n                registerComponent: '${ $.parentName }.register'\n            }\n        },\n\n        /**\n         * initialize\n         */\n        initialize: function () {\n            this._super();\n            paymentValidatorRegistry.registerValidator(dobValidator);\n            this.options.maxDate = '-1d';\n            this.options.changeMonth = true;\n            this.options.changeYear = true;\n            this.options.yearRange = \"-120y:c+nn\";\n            this.options.showButtonPanel = true;\n            this.options.showOn = 'both';\n            this.registerComponent(function (component) {\n                this.visible(component.checked() && component.visible());\n            }.bind(this))\n        },\n        onUpdate: function (newValue) {\n            this._super();\n            if (this.hasChanged()) {\n                this.source.trigger('amcheckout.additional:save');\n            }\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/additional/register.js":"define([\n    'jquery',\n    'Magento_Ui/js/form/element/single-checkbox'\n], function ($, SingleCheckbox) {\n    'use strict';\n\n    return SingleCheckbox.extend({\n        defaults: {\n            templates: {\n                checkbox: 'Amasty_CheckoutCore/form/components/single/checkbox'\n            },\n            modules: {\n                email: 'checkout.steps.shipping-step.shippingAddress.customer-email'\n            },\n            listens: {\n                'visible': 'onVisibilityChange'\n            },\n            valueMap: {\n                'true': true,\n                'false': false\n            }\n        },\n\n        initialize: function () {\n            this._super();\n            this.email(this.emailObserver.bind(this));\n        },\n        onUpdate: function (newValue) {\n            this._super();\n            this.source.trigger('amcheckout.additional:save');\n        },\n        onVisibilityChange: function (visibility) {\n            if (!visibility) {\n                this.checked(false);\n                this.checked.valueHasMutated();\n            } else {\n                this.checked(this.initialChecked);\n            }\n        },\n        emailObserver: function (component) {\n            this.visible(!component.isPasswordVisible());\n\n            component.isLoading.subscribe(function (isLoading) {\n                if (isLoading === true) {\n                    $.when(component.isEmailCheckComplete).done(function () {\n                        this.visible(true);\n                    }.bind(this)).fail(function () {\n                        this.visible(false);\n                    }.bind(this));\n                }\n            }.bind(this));\n        }\n    });\n});","Amasty_CheckoutCore/js/view/additional/comment.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'Magento_Ui/js/form/element/textarea'\n], function (Component) {\n    'use strict';\n\n    return Component.extend({\n        onUpdate: function (newValue) {\n            this._super();\n            if (this.isDifferedFromDefault()) {\n                this.source.trigger('amcheckout.additional:save');\n            }\n        }\n    });\n});\n","Amasty_CheckoutCore/js/view/validators/order-summary-validation.js":"define([\n    'uiComponent',\n    'Magento_Checkout/js/model/payment/additional-validators',\n    'Amasty_CheckoutCore/js/model/payment-validators/order-summary-validator'\n], function (Component, additionalValidators, orderSummaryValidator) {\n    'use strict';\n\n    additionalValidators.registerValidator(orderSummaryValidator);\n\n    return Component.extend({});\n});\n","Amasty_CheckoutCore/js/view/validators/agreement-validation.js":"define(\n    [\n        'uiComponent',\n        'Magento_Checkout/js/model/payment/additional-validators',\n        'Amasty_CheckoutCore/js/model/payment-validators/agreement-validator'\n    ],\n    function (Component, additionalValidators, agreementValidator) {\n        'use strict';\n        additionalValidators.registerValidator(agreementValidator);\n        return Component.extend({});\n    }\n);\n","Amasty_CheckoutCore/js/model/billing-address-postcode-validator-mixin.js":"define([\n    'jquery',\n    'mage/utils/wrapper'\n], function ($, wrapper) {\n    'use strict';\n\n    return function (target) {\n        const mixin = {\n\n            /**\n             * for Correct Validation of the Billing Address Form\n             *\n             * @param {Function} original\n             * @param {Object} postcodeElement\n             * @returns {*}\n             */\n            postcodeValidation: function (original, postcodeElement) {\n                let shippingAddressCountryNode = $('.form-shipping-address select[name=\"country_id\"]'),\n                    validationResult;\n\n                shippingAddressCountryNode.attr('name', 'amcountry_id');\n                validationResult = original(postcodeElement);\n                shippingAddressCountryNode.attr('name', 'country_id');\n\n                return validationResult;\n            }\n        }\n\n        wrapper._extend(target, mixin);\n\n        return target;\n    };\n});\n","Amasty_CheckoutCore/js/model/one-step-layout.js":"// Checkout layout options model\ndefine([\n    'ko',\n    'uiRegistry',\n    'Amasty_CheckoutCore/js/view/utils',\n    'uiLayout'\n], function (ko, registry, viewUtils, layout) {\n    'use strict';\n\n    const MAPPING_BLOCK_NAME = {\n            shipping_address: 'checkout.steps.shipping-step.shippingAddress',\n            shipping_method: 'checkout.steps.shipping-step.shippingAddress',\n            delivery: 'checkout.steps.shipping-step.amcheckout-delivery-date',\n            payment_method: 'checkout.steps.billing-step',\n            summary: 'checkout.sidebar',\n            additional_checkboxes: 'checkout.sidebar.additional.checkboxes'\n        },\n        CLASS_NAMES = {\n            classic: {\n                main: 'opc-wrapper am-opc-wrapper',\n                column: 'checkout-column opc',\n                block: 'checkout-block'\n            },\n            modern: {\n                main: 'amcheckout-main-container',\n                column: 'amcheckout-column',\n                block: 'amcheckout-block amcheckout-step-container'\n            }\n        },\n        BLOCK_ATTRS = {\n            classic: {},\n            modern: {\n                main: {\n                    'data-amcheckout-js': 'main-container'\n                }\n            }\n        };\n\n    return {\n        containerClassNames: ko.observable(''),\n        selectedLayout: [],\n        checkoutDesign: '',\n        checkoutLayout: '',\n        checkoutBlocks: {},\n        mainAdditionalClasses: '',\n        gdprConsents: window.checkoutConfig.amastyOscGdprConsent,\n        gdprComponents: {},\n\n        /**\n         * Getting checkout block by name\n         * @param {String} blockName\n         * @returns {observable}\n         */\n        getCheckoutBlock: function (blockName) {\n            var requestComponent = this.checkoutBlocks[blockName]\n                || this.requestComponent(MAPPING_BLOCK_NAME[blockName]);\n\n            switch (blockName) {\n                case 'shipping_address':\n                    if (requestComponent()) {\n                        requestComponent().template = 'Amasty_CheckoutCore/onepage/shipping/address';\n                    }\n\n                    break;\n\n                case 'shipping_method':\n                    if (requestComponent()) {\n                        requestComponent().template = 'Amasty_CheckoutCore/onepage/shipping/methods';\n                    }\n\n                    break;\n\n                default: break;\n            }\n\n            return requestComponent;\n        },\n\n        /**\n         * Getting component by name from registry\n         * @param {String} name\n         * @returns {observable}\n         */\n        requestComponent: function (name) {\n            var observable = ko.observable();\n\n            registry.get(name, function (summary) {\n                observable(summary);\n            });\n\n            this.checkoutBlocks[name] = observable;\n\n            return observable;\n        },\n\n        /**\n         * Emulate 2columns layout for virtual quote checkout\n         * @returns {Array}\n         */\n        getVirtualLayout: function () {\n            return [\n                [viewUtils.getBlockLayoutConfig('payment_method')],\n                [viewUtils.getBlockLayoutConfig('summary')]\n            ];\n        },\n\n        /**\n         * Getting checkout container css classes by selected design\n         * @returns {String}\n         */\n        setContainerClassNames: function () {\n            var classNames = this.containerClassNames() + ' ' + CLASS_NAMES[this.checkoutDesign].main;\n\n            if (this.checkoutDesign === 'modern') {\n                classNames += ' -' + this.checkoutDesign + ' -layout-' + this.checkoutLayout;\n            } else {\n                classNames += ' layout-' + this.checkoutLayout;\n            }\n\n            classNames += ' ' + this.mainAdditionalClasses;\n\n            this.containerClassNames(classNames);\n        },\n\n        /**\n         * Getting checkout container attributes by selected design\n         * @returns {Object}\n         */\n        getContainerAttrs: function () {\n            return BLOCK_ATTRS[this.checkoutDesign].main;\n        },\n\n        /**\n         * Getting checkout column css classes by design\n         * @param {Number} columnIndex\n         * @returns {String}\n         */\n        getColumnClassNames: function (columnIndex) {\n            var classNames = '',\n                defaultClassNames = CLASS_NAMES;\n\n            classNames = defaultClassNames[this.checkoutDesign].column\n                + this.getAdditionalColumnClassNames(columnIndex);\n\n            return classNames;\n        },\n\n        /**\n         * Getting checkout column additional css classes by design, layout and column type\n         * @param {Number} columnIndex\n         * @returns {String}\n         */\n        getAdditionalColumnClassNames: function (columnIndex) {\n            var additionalColumnsClasses = '';\n\n            if (this.checkoutDesign === 'modern' && this.checkoutLayout === '2columns') {\n                if (columnIndex === 0) {\n                    additionalColumnsClasses += ' -main';\n                } else if (columnIndex === 1) {\n                    additionalColumnsClasses += ' -sidebar';\n                }\n            }\n\n            return additionalColumnsClasses;\n        },\n\n        /**\n         * Getting checkout column tag attributes by design, layout and column type\n         * @param {Number} columnIndex\n         * @returns {Object}\n         */\n        getColumnAttrs: function (columnIndex) {\n            var columnAttrs = {},\n                checkoutJsPrefix = 'data-amcheckout-js',\n                defaultAttrs = BLOCK_ATTRS[this.checkoutDesign].column;\n\n            columnAttrs = defaultAttrs || {};\n\n            if (this.checkoutDesign === 'modern' && this.checkoutLayout === '2columns') {\n                if (columnIndex === 0) {\n                    columnAttrs[checkoutJsPrefix] = 'main-column';\n                } else if (columnIndex === 1) {\n                    columnAttrs[checkoutJsPrefix] = 'sidebar-column';\n                }\n            }\n\n            return columnAttrs;\n        },\n\n        /**\n         * Getting checkout block css classes\n         * @param {String} blockName\n         * @returns {*}\n         */\n        getBlockClassNames: function (blockName) {\n            var defaultClassNames = CLASS_NAMES,\n                classNames = defaultClassNames[this.checkoutDesign].block;\n\n            if (blockName === 'summary') {\n                classNames += ' -summary';\n            }\n\n            return classNames;\n        },\n\n        /**\n         * Getting checkout block tag attributes by design and layout\n         * @returns {Object}\n         */\n        getBlockAttrs: function () {\n            var blockAttrs = {},\n                checkoutJsPrefix = 'data-amcheckout-js',\n                defaultAttrs = BLOCK_ATTRS[this.checkoutDesign].block;\n\n            blockAttrs = defaultAttrs || {};\n\n            if (this.checkoutDesign === 'modern' && this.checkoutLayout !== '3columns') {\n                blockAttrs[checkoutJsPrefix] = 'step-container';\n            }\n\n            return blockAttrs;\n        },\n\n        /**\n         * Check modern 2 columns design\n         * @returns {boolean}\n         */\n        isModernTwoColumns: function () {\n            return this.checkoutDesign === 'modern' && this.checkoutLayout === '2columns';\n        },\n\n        /**\n         * @param {String} blockName\n         * @param {Object|null} componentConfig\n         * @return {observable}\n         */\n        getGdprComponent: function (blockName, componentConfig) {\n            var name = componentConfig ? componentConfig.name + '-' + blockName : '',\n                component = this.gdprComponents[name],\n                config = {};\n\n            if (this.gdprConsents[blockName] && name && !component) {\n                component = ko.observable();\n                config = Object.assign(\n                    config,\n                    componentConfig,\n                    {\n                        name: name,\n                        items: this.gdprConsents[blockName]['consents'],\n                        meta: this.gdprConsents[blockName]['meta']\n                    }\n                );\n\n                // move checkbox before place order button\n                if (blockName === 'summary') {\n                    config.parent = MAPPING_BLOCK_NAME.additional_checkboxes;\n                }\n\n                layout([config]);\n                registry.get(name, function (target) {\n                    component(target);\n                });\n\n                this.gdprComponents[name] = component;\n            }\n\n            return component;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment-service-mixin.js":"define([\n    'ko',\n    'mage/utils/wrapper',\n    'Magento_Checkout/js/model/quote',\n    'Amasty_CheckoutCore/js/model/payment/vault-payment-resolver'\n],function (ko, wrapper, quote, vaultResolver) {\n    'use strict';\n    return function (target) {\n        /**\n         * Fix unselection of saved vault payment method\n         */\n        target.setPaymentMethods = wrapper.wrapSuper(target.setPaymentMethods, function (methods) {\n            if (methods && quote.paymentMethod()) {\n                var selectedMethod = quote.paymentMethod().method;\n\n                if (vaultResolver.isVaultMethodAvailable(selectedMethod, methods)) {\n                    methods.push({\n                        method: selectedMethod\n                    });\n                }\n            }\n\n            this._super(methods);\n        });\n\n        return target;\n    };\n});\n","Amasty_CheckoutCore/js/model/default-shipping-rate-processor-mixin.js":"define(\n    [\n        'mage/utils/wrapper',\n        'Magento_Checkout/js/model/shipping-rate-registry',\n        'Magento_Checkout/js/model/shipping-service',\n        'Amasty_CheckoutCore/js/action/get-address-cache-key'\n    ],\n    function (wrapper, rateRegistry, shippingService, getAddressCacheKey) {\n        'use strict';\n\n        /**\n         * Modify shippingRegistry guest cache.\n         * Reduce quantity of requests to server.\n         * @since 3.0.0\n         * @since 3.0.5 fixed\n         */\n        return function (target) {\n            target.getRates = wrapper.wrapSuper(target.getRates, function (address) {\n                var cacheKey, cache;\n\n                if (address.getType() !== 'new-address' && address.getType() !== 'new-customer-address') {\n                    return this._super();\n                }\n\n                cacheKey = getAddressCacheKey(address);\n                cache = rateRegistry.get(cacheKey);\n                if (cache) {\n                    rateRegistry.set(address.getCacheKey(), cache);\n                } else if (!rateRegistry.get(address.getCacheKey())) {\n                    shippingService.getShippingRates().subscribe(function (rates) {\n                        rateRegistry.set(cacheKey, rates);\n                        this.dispose();\n                    });\n                }\n\n                return this._super();\n            });\n\n            return target;\n        };\n    }\n);\n\n","Amasty_CheckoutCore/js/model/resource-url-manager.js":"/*jshint browser:true jquery:true*/\n/*global alert*/\ndefine(\n    [\n        'Magento_Customer/js/model/customer',\n        'Magento_Checkout/js/model/url-builder',\n        'Magento_Checkout/js/model/resource-url-manager',\n        'mageUtils'\n    ],\n    function (customer, urlBuilder, resourceUrlManager, utils) {\n        \"use strict\";\n        return {\n            getUrlForDelivery: function (quote) {\n                var params = (this.getCheckoutMethod() == 'guest') ? {cartId: quote.getQuoteId()} : {};\n                var urls = {\n                    'guest': '/amasty_checkout/guest-carts/:cartId/delivery',\n                    'customer': '/amasty_checkout/carts/mine/delivery'\n                };\n\n                return this.getUrl(urls, params);\n            },\n\n            getUrlForRemoveItem: function (quote) {\n                var params = (this.getCheckoutMethod() == 'guest') ? {cartId: quote.getQuoteId()} : {};\n                var urls = {\n                    'guest': '/amasty_checkout/guest-carts/:cartId/remove-item',\n                    'customer': '/amasty_checkout/carts/mine/remove-item'\n                };\n\n                return this.getUrl(urls, params);\n            },\n\n            getUrlForUpdateItem: function (quote) {\n                var params = (this.getCheckoutMethod() == 'guest') ? {cartId: quote.getQuoteId()} : {};\n                var urls = {\n                    'guest': '/amasty_checkout/guest-carts/:cartId/update-item',\n                    'customer': '/amasty_checkout/carts/mine/update-item'\n                };\n\n                return this.getUrl(urls, params);\n            },\n\n            getUrlForAdditionalFields: function (quote) {\n                var params = (this.getCheckoutMethod() == 'guest') ? {cartId: quote.getQuoteId()} : {};\n                var urls = {\n                    'guest': '/amasty_checkout/guest-carts/:cartId/amcheckoutFields',\n                    'customer': '/amasty_checkout/carts/mine/amcheckoutFields'\n                };\n\n                return this.getUrl(urls, params);\n            },\n\n            getUrlForSavePassword: function (quote) {\n                var params = (this.getCheckoutMethod() == 'guest') ? {cartId: quote.getQuoteId()} : {},\n                    urls = {\n                        'guest': '/amasty_checkout/guest-carts/:cartId/save-password'\n                };\n\n                return this.getUrl(urls, params);\n            },\n\n            /** Get url for service */\n            getUrl: function (urls, urlParams) {\n                var url;\n\n                if (utils.isEmpty(urls)) {\n                    return 'Provided service call does not exist.';\n                }\n\n                if (!utils.isEmpty(urls['default'])) {\n                    url = urls['default'];\n                } else {\n                    url = urls[this.getCheckoutMethod()];\n                }\n                return urlBuilder.createUrl(url, urlParams);\n            },\n\n            getCheckoutMethod: function () {\n                return customer.isLoggedIn() ? 'customer' : 'guest';\n            },\n\n            /**\n             * Making url for total estimation request.\n             *\n             * @param {Object} quote - Quote model.\n             * @returns {String} Result url.\n             */\n            getUrlForTotalsEstimationForNewAddress: function (quote) {\n                if (window.checkoutConfig.isNegotiableQuote) {\n                    var params = {\n                            quoteId: quote.getQuoteId()\n                        },\n                        urls = {\n                            'negotiable': '/negotiable-carts/:quoteId/totals/?isNegotiableQuote=true'\n                        };\n\n                    return resourceUrlManager.getUrl(urls, params);\n                }\n\n                return resourceUrlManager.getUrlForTotalsEstimationForNewAddress(quote);\n            }\n        };\n    }\n);\n","Amasty_CheckoutCore/js/model/customer-email-validator-mixin.js":"/**\n * Add functionality to hide validation errors (\"silent\" validation).\n */\ndefine([\n    'jquery',\n    'mage/utils/wrapper',\n    'Magento_Customer/js/model/customer'\n], function ($, wrapper, customer) {\n    'use strict';\n\n    return function (target) {\n        target.validate = wrapper.wrapSuper(target.validate, function (hideError) {\n            let result = this._super();\n\n            if (!result && (hideError || window.silentShippingValidation) && !customer.isLoggedIn()) {\n                $('form[data-role=email-with-possible-login]').validation('clearError');\n            }\n\n            return result;\n        });\n\n        return target;\n    };\n});\n","Amasty_CheckoutCore/js/model/statistic.js":"define([\n    'jquery',\n    'mage/storage',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/url-builder',\n    'Magento_Customer/js/model/customer'\n], function ($, storage, quote, urlBuilder, customer) {\n    'use strict';\n\n    return {\n        canSave: true,\n        paymentMethod: null,\n        quoteId: quote.getQuoteId(),\n        isLoggedIn:customer.isLoggedIn(),\n        saveUrl: '',\n\n        initialize: function () {\n            quote.paymentMethod.subscribe(function (method) {\n                this.paymentMethod = null;\n                if (method) {\n                    this.paymentMethod = method.method;\n                }\n            }, this);\n\n            if (this.isLoggedIn) {\n                this.saveUrl = urlBuilder.createUrl('/checkout/saveInsertedInfo', {});\n            } else {\n                this.saveUrl = urlBuilder.createUrl('/checkout/:cartId/saveInsertedInfo', {cartId: this.quoteId});\n            }\n\n            $(window).on('beforeunload', this.saveStatistic.bind(this));\n\n            return this;\n        },\n\n        saveStatistic: function () {\n            var cashStorage = JSON.parse(window.localStorage.getItem('mage-cache-storage')),\n                checkoutData,\n                shippingAddress = quote.shippingAddress(),\n                request = {quote_id: this.quoteId},\n                isQuoteActive;\n\n            if (window.checkoutConfig.isNegotiableQuote\n                || !this.canSave\n                || !cashStorage\n                || !cashStorage.hasOwnProperty('checkout-data')\n                || !this.quoteId\n            ) {\n                return;\n            }\n\n            checkoutData = cashStorage['checkout-data'];\n            isQuoteActive = Object.keys(checkoutData).some(function (value) {\n                return checkoutData[value] != null;\n            });\n\n            if (!isQuoteActive) {\n                return;\n            }\n\n            if (shippingAddress && shippingAddress.getType() === 'new-customer-address') {\n                request.shippingAddressFromData = {\n                    'street': shippingAddress.street,\n                    'city': shippingAddress.city,\n                    'region_id': shippingAddress.regionId,\n                    'region': shippingAddress.region,\n                    'country_id': shippingAddress.countryId,\n                    'postcode': shippingAddress.postcode,\n                    'email': shippingAddress.email,\n                    'customer_id': shippingAddress.customerId,\n                    'firstname': shippingAddress.firstname,\n                    'lastname': shippingAddress.lastname,\n                    'middlename': shippingAddress.middlename,\n                    'prefix': shippingAddress.prefix,\n                    'suffix': shippingAddress.suffix,\n                    'vat_id': shippingAddress.vatId,\n                    'company': shippingAddress.company,\n                    'telephone': shippingAddress.telephone,\n                    'fax': shippingAddress.fax,\n                    'custom_attributes': shippingAddress.customAttributes,\n                    'save_in_address_book': shippingAddress.saveInAddressBook\n                };\n            }\n\n            if (checkoutData.newCustomerBillingAddress) {\n                request.newCustomerBillingAddress = checkoutData.newCustomerBillingAddress;\n            }\n\n            if (checkoutData.selectedPaymentMethod) {\n                if (checkoutData.selectedPaymentMethod.includes('braintree_cc_vault_')) {\n                    checkoutData.selectedPaymentMethod = 'braintree_cc_vault';\n                }\n                request.selectedPaymentMethod = checkoutData.selectedPaymentMethod;\n            }\n\n            if (checkoutData.selectedShippingRate) {\n                request.selectedShippingRate = checkoutData.selectedShippingRate;\n            }\n\n            if (checkoutData.validatedEmailValue) {\n                request.validatedEmailValue = checkoutData.validatedEmailValue;\n            }\n\n            if (!request.selectedPaymentMethod && this.paymentMethod) {\n                request.selectedPaymentMethod = this.paymentMethod;\n            }\n\n            storage.post(\n                this.saveUrl,\n                JSON.stringify(request),\n                false\n            );\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/shipping-registry.js":"define([\n    'ko',\n    'underscore',\n    'jquery',\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/shipping-rates-validation-rules',\n    'Magento_Checkout/js/model/shipping-address/form-popup-state',\n    'Magento_Checkout/js/model/address-converter',\n    'Magento_Customer/js/model/address-list',\n    'Amasty_CheckoutCore/js/model/address-form-state',\n    'Amasty_CheckoutCore/js/action/get-address-cache-key',\n    'Amasty_CheckoutCore/js/model/payment/payment-loading',\n    'Magento_Ui/js/lib/validation/validator'\n], function (\n    ko,\n    _,\n    $,\n    quote,\n    validationRules,\n    formPopUpState,\n    addressConverter,\n    addressList,\n    addressFormState,\n    getAddressCacheKey,\n    paymentLoader,\n    validator\n) {\n    'use strict';\n\n    return {\n        savedAddress: '',\n        shippingMethod: '',\n        shippingCarrier: '',\n\n        /**\n         * list of shipping address\n         * it also can contains third party extension fields\n         */\n        addressComponents: [],\n\n        /**\n         * filtered addressComponents\n         *  modules that are not used in shipping estimation (not in observable)\n         */\n        observedComponents: [],\n\n        /**\n         * Saved values of observable address.\n         * Update on shipping address save\n         */\n        additionalAddressValues: {},\n\n        /**\n         * @api\n         * Excluded components by name (index)\n         * Additional excludes should be added before initObservers executed\n         */\n        excludedFieldsNames: [],\n\n        /**\n         * @api\n         * Excluded collection components by name (index)\n         * Additional excludes should be added before initObservers executed\n         */\n        excludedCollectionNames: ['billing-address-form', 'customer-email'],\n        isEstimationHaveError: ko.observable(false),\n        isAddressChanged: ko.observable(false).extend({ notify: 'always', rateLimit: 20 }),\n        validationTimeout: 0,\n        checkDelay: 1000,\n\n        /**\n         * @property jQuery.Deferred\n         */\n        initializedPromise: $.Deferred(),\n\n        /**\n         * Register additional shipping fields observers\n         * @param {Function} elems - observable array of shipping elements\n         * @returns {void}\n         */\n        initObservers: function (elems) {\n            if (_.isEmpty(this.addressComponents)) {\n                this.excludedFieldsNames = _.union(this.excludedFieldsNames, validationRules.getObservableFields());\n                this.filterElements(elems());\n\n                _.each(this.addressComponents, function (element) {\n                    if (this.excludedFieldsNames.indexOf(element.index) === -1) {\n                        this.observedComponents.push(element);\n                        this.additionalAddressValues[element.index] = this.getInitialValue(element.index);\n                    }\n\n                    element.on('value', this.triggerValidation.bind(this, element));\n                }, this);\n\n                this.initializedPromise.resolve();\n            }\n        },\n\n        /**\n         * Set saved values on page load (saved on server)\n         * @returns {void}\n         */\n        setInitialValues: function () {\n            var savedAddress = window.checkoutConfig.shippingAddressFromData,\n                savedMethod = window.checkoutConfig.selectedShippingMethod,\n                subscriber;\n\n            if (savedAddress) {\n                this.savedAddress = addressConverter.formAddressDataToQuoteAddress(savedAddress);\n            } else if (window.checkoutConfig.selectedShippingAddressId) {\n                if (addressList.getLength()) {\n                    this._setCustomerAddress(addressList());\n                    this.isAddressChanged(true);\n                } else {\n                    subscriber = addressList.subscribe(function (addreses) {\n                        this._setCustomerAddress(addreses);\n                        subscriber.dispose();\n                    }, this);\n                }\n            }\n\n            if (savedMethod) {\n                if (_.isObject(savedMethod)) {\n                    this.shippingMethod = savedMethod.method_code;\n                    this.shippingCarrier = savedMethod.carrier_code;\n                } else if (_.isString(savedMethod)) {\n                    savedMethod = savedMethod.split('_');\n                    this.shippingMethod = savedMethod[0];\n                    this.shippingCarrier = savedMethod[1];\n                }\n            }\n        },\n\n        /**\n         * Set shipping rates and saved address by customer address\n         * @param {Array} addresses\n         * @private\n         * @returns {void}\n         */\n        _setCustomerAddress: function (addresses) {\n            var selectedAddress;\n\n            selectedAddress = _.find(addresses, function (address) {\n                return address.customerAddressId * 1 === window.checkoutConfig.selectedShippingAddressId * 1;\n            });\n\n            if (selectedAddress) {\n                this.savedAddress = selectedAddress;\n            }\n        },\n\n        /**\n         * Get initial value for additional shipping fields.\n         * @param {String} index\n         * @return {null|*}\n         */\n        getInitialValue: function (index) {\n            var savedAddress = window.checkoutConfig.shippingAddressFromData;\n\n            if (savedAddress) {\n                if (savedAddress.custom_attributes\n                    && savedAddress.custom_attributes[index]\n                ) {\n                    return savedAddress.custom_attributes[index];\n                }\n\n                if (savedAddress[index]) {\n                    return savedAddress[index];\n                }\n            }\n\n            return null;\n        },\n\n        /**\n         * Extract all fields wich can be observable from fields\n         * @param {Array} elems\n         * @returns {void}\n         */\n        filterElements: function (elems) {\n            if (!elems || !elems.length) {\n                return;\n            }\n\n            _.each(elems, function (element) {\n                if (this._isCollection(element)) {\n                    try {\n                        if (this._isCollectionValid(element)) {\n                            this.filterElements(element.elems());\n                        }\n                    } catch (e) {\n                        // continue\n                    }\n\n                    return;// continue\n                }\n\n                if (this._isModuleValid(element)) {\n                    this.addressComponents.push(element);\n                }\n            }.bind(this));\n        },\n\n        /**\n         * Is component are collection\n         *\n         * @param {Object} element\n         * @returns {Boolean}\n         * @private\n         */\n        _isCollection: function (element) {\n            return typeof element.initChildCount === 'number';\n        },\n\n        /**\n         * Is component collection is valid\n         *\n         * @param {Object} element\n         * @returns {Boolean}\n         * @private\n         */\n        _isCollectionValid: function (element) {\n            return this.excludedCollectionNames.indexOf(element.index) === -1;\n        },\n\n        /**\n         * Is component can be observable\n         *\n         * @param {Object} module\n         * @returns {Boolean}\n         * @private\n         */\n        _isModuleValid: function (module) {\n            return ko.isObservable(module.error)\n                && ko.isObservable(module.value);\n        },\n\n        /**\n         * Debounce validation\n         * @returns {void}\n         */\n        triggerValidation: function () {\n            clearTimeout(this.validationTimeout);\n\n            if (!formPopUpState.isVisible() && !addressFormState.isShippingFormVisible()) {\n                paymentLoader(true);\n\n                this.validationTimeout = setTimeout(this.validation.bind(this), this.checkDelay);\n            }\n        },\n\n        validation: function () {\n            var isError = false,\n                valueChanged = false,\n                result;\n\n            _.find(this.observedComponents, function (element) {\n                if (element.visible && !element.visible() || element.disabled && element.disabled()) {\n                    return false;// continue\n                }\n\n                if (element.error()) {\n                    isError = true;\n\n                    return true;// break\n                }\n\n                if (_.isObject(element.validation)) {\n                    result = validator(element.validation, element.value(), element.validationParams);\n\n                    if (!result.passed) {\n                        isError = true;\n\n                        return true;// break\n                    }\n                }\n\n                if (this.additionalAddressValues[element.index] !== element.value()) {\n                    valueChanged = true;\n                }\n\n                return false;\n            }, this);\n\n            this.isEstimationHaveError(isError);\n\n            if (!isError) {\n                this.isAddressChanged(valueChanged);\n            } else {\n                paymentLoader(false);\n            }\n        },\n\n        /**\n         * Store saved values for tracking changes\n         * @returns {void}\n         */\n        registerAdditionAddressValues: function () {\n            clearTimeout(this.validationTimeout);\n            _.each(this.observedComponents, function (element) {\n                this.additionalAddressValues[element.index] = element.value();\n            }.bind(this));\n        },\n\n        /**\n         * Set saved data\n         * @param {object} address\n         * @returns {void}\n         */\n        register: function (address) {\n            if (!address) {\n                address = quote.shippingAddress();\n            }\n\n            this.savedAddress = address;\n            this.shippingMethod = quote.shippingMethod().method_code;\n            this.shippingCarrier = quote.shippingMethod().carrier_code;\n            this.isAddressChanged(false);\n            this.registerAdditionAddressValues();\n        },\n\n        /**\n         * Compare current Shipping Data with saved and determines is need to save it\n         *\n         * @returns {boolean}\n         */\n        isHaveUnsavedShipping: function () {\n            var methodData = quote.shippingMethod();\n\n            if (!methodData) {\n                return false;\n            }\n\n            if (!this.savedAddress) {\n                return true;\n            }\n\n            return this.isAddressChanged()\n                || !this._compareObjectsData(quote.shippingAddress(), this.savedAddress)\n                || this.shippingMethod !== methodData.method_code\n                || this.shippingCarrier !== methodData.carrier_code;\n        },\n\n        /**\n         * Is address objects are equal\n         *\n         * @param {*} quoteAddress\n         * @param {*} savedAddress\n         * @returns {boolean}\n         * @private\n         * @since 2.0.0\n         * @since 3.0.0 - empty values removed from comparable objects, customer address compare optimization\n         */\n        _compareObjectsData: function (quoteAddress, savedAddress) {\n            if (quoteAddress.getType && quoteAddress.getType() === 'customer-address') {\n                // customer address is not editable, compare only ids.\n                return quoteAddress.customerAddressId === savedAddress.customerAddressId;\n            }\n\n            // objects for isEqual should not contain functions. Same for objects of their objects.\n            return _.isEqual(this._prepareAddressToCompare(quoteAddress), this._prepareAddressToCompare(savedAddress));\n        },\n\n        _prepareAddressToCompare: function (address) {\n            let filteredAddress = _.pick(address, this._cleanupAddressFunction);\n\n            if (filteredAddress.regionId) {\n                filteredAddress.regionId *= 1;\n            }\n\n            if (filteredAddress.postcode === '-') {\n                delete filteredAddress.postcode;\n            }\n\n            if (filteredAddress.street) {\n                filteredAddress.street = _.compact(filteredAddress.street); // remove empty strings elements\n            }\n\n            return filteredAddress;\n        },\n\n        /**\n         * Iterate function.\n         * Remove functions and empty values.\n         * Leave only acceptable array cells for comparing.\n         *\n         * @param {*} value\n         * @param {string} key\n         * @return {boolean}\n         * @private\n         */\n        _cleanupAddressFunction: function (value, key) {\n            return !_.isFunction(value)\n                && key !== 'save_in_address_book'\n                && value\n                && (!_.isEmpty(value) || _.isNumber(value))// isEmpty - returns true for any number type (int/float)\n                && (!_.isArray(value) || _.compact(value).length > 0);// delete arrays with empty strings (like street)\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/quote-mixin.js":"/**\n * Main observables equality comparer replacement\n */\n\ndefine([\n    'Amasty_CheckoutCore/js/action/is-equal-ignore-functions'\n], function (isEqualIgnoreFunctions) {\n    'use strict';\n\n    return function (quote) {\n        quote.shippingAddress.equalityComparer = isEqualIgnoreFunctions;\n        quote.billingAddress.equalityComparer = isEqualIgnoreFunctions;\n        quote.shippingMethod.equalityComparer = isEqualIgnoreFunctions;\n        quote.paymentMethod.equalityComparer = isEqualIgnoreFunctions;\n\n        return quote;\n    };\n});\n","Amasty_CheckoutCore/js/model/shipping-rates-validator-mixin.js":"/*global define*/\ndefine(\n    [\n        'jquery',\n        'mage/utils/wrapper',\n        'Magento_Checkout/js/model/shipping-service'\n    ],\n    function (\n        $,\n        wrapper,\n        shippingService\n    ) {\n        'use strict';\n        return function (target) {\n            var mixin = {\n                validateAddressDataState: true,\n\n                /**\n                 * @return {*}\n                 */\n                postcodeValidation: function (original) {\n                    original();\n\n                    return true;\n                },\n\n                /**\n                 * Fix validation for billing address\n                 *\n                 * @param {Function} original\n                 * @param {Object} element\n                 * @param {Number} delay\n                 */\n                bindHandler: function (original, element, delay) {\n                    if (element.component.indexOf('/group') !== -1\n                        || (element.name.indexOf('billing') === -1 && element.dataScope.indexOf('billing') === -1)\n                    ) {\n                        return original(element, delay);\n                    }\n\n                    if (element.index === 'postcode') {\n                        var self = this;\n\n                        delay = typeof delay === 'undefined' ? 1000 : delay;\n\n                        element.on('value', function () {\n                            clearTimeout(self.validateZipCodeTimeout);\n                            self.validateZipCodeTimeout = setTimeout(function () {\n                                self.postcodeValidation(element);\n                            }, delay);\n                        });\n                    }\n                },\n\n                /**\n                 * Save Validation State\n                 *\n                 * @param {Function} original\n                 * @param {Object} address\n                 * @return {Boolean}\n                 */\n                validateAddressData: function (original, address) {\n                    this.validateAddressDataState = original(address);\n\n                    return this.validateAddressDataState;\n                },\n\n                /**\n                 * Hide Loader with disabled fields (ex. Country) - compatibility with 2.4.7\n                 *\n                 * @param {Function} original\n                 * @returns {void}\n                 */\n                validateFields: function (original) {\n                    original();\n\n                    if (!this.validateAddressDataState) {\n                        shippingService.isLoading(false);\n                    }\n                }\n            };\n\n            wrapper._extend(target, mixin);\n            return target;\n        };\n    }\n);\n","Amasty_CheckoutCore/js/model/events.js":"define([\n    'underscore',\n    'uiEvents'\n], function (_, uiEvents) {\n    'use strict';\n\n    // events to use\n    const eventBeforeShippingSave = 'before_shipping_save',\n        eventAfterShippingSave = 'after_shipping_save';\n\n    /**\n     * object undependable event manager\n     */\n    return _.extend(uiEvents, {\n        onBeforeShippingSave: function (callback) {\n            this.on(eventBeforeShippingSave, callback);\n        },\n        onAfterShippingSave: function (callback) {\n            this.on(eventAfterShippingSave, callback);\n        }\n    });\n});\n","Amasty_CheckoutCore/js/model/checkout-data-resolver-mixin.js":"define(\n    [\n        'jquery',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Checkout/js/checkout-data',\n        'Magento_Checkout/js/action/select-shipping-method',\n        'Magento_Checkout/js/model/address-converter',\n        'Magento_Customer/js/model/address-list',\n        'Magento_Checkout/js/model/payment-service',\n        'Magento_Checkout/js/action/select-payment-method',\n        'Magento_Checkout/js/action/select-shipping-address',\n        'Amasty_CheckoutCore/js/model/payment/vault-payment-resolver',\n        'uiRegistry',\n        'underscore',\n        'mage/utils/wrapper'\n    ],\n    function (\n        $,\n        quote,\n        checkoutData,\n        selectShippingMethodAction,\n        addressConverter,\n        addressList,\n        paymentService,\n        selectPaymentMethodAction,\n        selectShippingAddress,\n        vaultResolver,\n        registry,\n        _,\n        wrapper\n    ) {\n        'use strict';\n\n        var defaultShippingMethod = null;\n\n        /**\n         * Get default shipping method.\n         * Store default shipping method to speedup check.\n         *\n         * @return {String|false}\n         * @private\n         */\n        function _getDefaultShippingMethod () {\n            var provider, defaultMethod;\n\n            if (defaultShippingMethod === null) {\n                provider = registry.get('checkoutProvider');\n                defaultMethod = checkoutConfig.selectedShippingMethod;\n\n                if (provider && provider.defaultShippingMethod) {\n                    defaultShippingMethod = provider.defaultShippingMethod;\n                } else {\n\n                    if (defaultMethod !== null){\n                        defaultShippingMethod = defaultMethod.carrier_code + '_' + defaultMethod.method_code;\n\n                        return defaultShippingMethod;\n                    }\n\n                    defaultShippingMethod = false;\n                }\n            }\n\n            return defaultShippingMethod;\n        }\n\n        return function (target) {\n            var mixin = {\n                /**\n                 * @param {Function} original\n                 * @param {Object} ratesData\n                 */\n                resolveShippingRates: function (original, ratesData) {\n                    if (!ratesData || ratesData.length === 0) {\n                        selectShippingMethodAction(null);\n\n                        return;\n                    }\n\n                    if (ratesData.length === 1) {\n\n                        if (ratesData[0].error_message) {\n                            selectShippingMethodAction(null);\n\n                            return;\n                        }\n\n                        //set shipping rate if we have only one available shipping rate\n                        selectShippingMethodAction(ratesData[0]);\n\n                        return;\n                    }\n                    var selectedShippingRate = checkoutData.getSelectedShippingRate(),\n                        availableRate = false;\n\n                    if (quote.shippingMethod()) {\n                        availableRate = _.find(ratesData, function (rate) {\n                            return rate['carrier_code'] == quote.shippingMethod()['carrier_code'] && //eslint-disable-line\n                                rate['method_code'] == quote.shippingMethod()['method_code']; //eslint-disable-line eqeqeq\n                        });\n                    }\n\n                    if (!availableRate && selectedShippingRate) {\n                        availableRate = _.find(ratesData, function (rate) {\n                            return rate['carrier_code'] + '_' + rate['method_code'] === selectedShippingRate;\n                        });\n                    }\n\n                    if (!availableRate && window.checkoutConfig.selectedShippingMethod) {\n                        availableRate = _.find(ratesData, function (rate) {\n                            return rate['carrier_code'] + '_' + rate['method_code'] === window.checkoutConfig.selectedShippingMethod;\n                        });\n                    }\n\n                    if (!availableRate && _getDefaultShippingMethod()) {\n                        availableRate = _.find(ratesData, function (rate) {\n                            return rate['carrier_code'] + '_' + rate['method_code'] === _getDefaultShippingMethod();\n                        });\n                        if (!availableRate) {\n                            availableRate = _.find(ratesData, function (rate) {\n                                return !!rate.available;\n                            });\n                        }\n                    }\n\n                    if (availableRate) {\n                        selectShippingMethodAction(availableRate);\n                    } else {\n                        selectShippingMethodAction(null);\n                    }\n                },\n\n                /**\n                 * Resolve payment method. Used local storage\n                 * @param {Function} original\n                 */\n                resolvePaymentMethod: function (original) {\n                    original();\n                    if (quote.paymentMethod()) {\n                        return;\n                    }\n                    var paymentMethod = checkoutData.getSelectedPaymentMethod();\n                    if (vaultResolver.isSavedVaultPayment(paymentMethod) && vaultResolver.resolve(paymentMethod)) {\n                        return;\n                    }\n                    var provider = registry.get('checkoutProvider');\n                    if (provider && provider.defaultPaymentMethod) {\n                        var availablePaymentMethods = paymentService.getAvailablePaymentMethods();\n                        availablePaymentMethods.some(function (payment) {\n                            if (payment.method === provider.defaultPaymentMethod) {\n                                selectPaymentMethodAction(payment);\n                                return true;\n                            }\n                        });\n                    }\n                },\n\n                /**\n                 * Resolve estimation address. Used local storage\n                 * @param {Function} original\n                 */\n                resolveEstimationAddress: function (original) {\n                    original();\n                    var shippingAddressData = checkoutData.getShippingAddressFromData(),\n                        checkoutProvider = registry.get('checkoutProvider');\n\n                    if (shippingAddressData) {\n                        checkoutProvider.set(\n                            'shippingAddress',\n                            $.extend(true, {}, checkoutProvider.get('shippingAddress'), shippingAddressData)\n                        );\n                    }\n                },\n\n                /**\n                 * Apply resolved estimated address to quote\n                 *\n                 * @param {Function} original\n                 * @param {Object} isEstimatedAddress\n                 */\n                applyShippingAddress: function (original, isEstimatedAddress) {\n                    var addressData = addressList()[0];\n\n                    original();\n\n                    if (quote.shippingAddress()) {\n                        return;\n                    }\n\n                    if (isEstimatedAddress) {\n                        addressData = addressConverter.addressToEstimationAddress(addressData);\n                    }\n\n                    if (addressList().length > 1) {\n                        selectShippingAddress(addressData);\n                    }\n                }\n            };\n\n            wrapper._extend(target, mixin);\n            return target;\n        };\n    }\n);\n","Amasty_CheckoutCore/js/model/address-converter-mixin.js":"define([\n    'underscore', 'mage/utils/wrapper'\n], function (_, wrapper) {\n    'use strict';\n\n    return function (target) {\n        /**\n         * If custom attributes array, convert to object\n         */\n        target.quoteAddressToFormAddressData = wrapper.wrapSuper(\n            target.quoteAddressToFormAddressData,\n            function (inputModelAddress) {\n                var modelAddress = _.clone(inputModelAddress),\n                    shippingAddress,\n                    customAttributes;\n\n                if (modelAddress.customAttributes) {\n                    customAttributes = {};\n                    _.each(modelAddress.customAttributes, function (attribute, key) {\n                        if (_.isObject(attribute) && _.has(attribute, 'attribute_code')) {\n                            customAttributes[attribute.attribute_code] = attribute.value;\n                        } else if (!_.isNumber(key)) {\n                            customAttributes[key] = attribute;\n                        }\n                    });\n\n                    delete modelAddress.customAttributes;\n                }\n\n                shippingAddress = this._super(modelAddress);\n\n                if (customAttributes) {\n                    shippingAddress['custom_attributes'] = customAttributes;\n                }\n\n                return shippingAddress;\n            }\n        );\n\n        return target;\n    };\n});\n","Amasty_CheckoutCore/js/model/new-customer-address-mixin.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n/*jshint browser:true jquery:true*/\n/*global alert*/\ndefine([\n    'underscore',\n    'mage/utils/wrapper'\n], function (_, wrapper) {\n    'use strict';\n\n    return function (newAddressFunction) {\n        return wrapper.wrap(newAddressFunction, function (origin, addressData) {\n            if (window.checkoutConfig.amdefault) {\n                _.each(window.checkoutConfig.amdefault, function (defaultValue, name) {\n                    if (!addressData[name] && name !== 'region_id' && name !== 'region') {\n                        addressData[name] = defaultValue;\n                    }\n                });\n                if (addressData.country_id === window.checkoutConfig.amdefault.country_id) {\n                    if (!addressData.region) {\n                        addressData.region = {};\n                    }\n                    if (!addressData.region.region_id) {\n                        addressData.region.region_id = window.checkoutConfig.amdefault.region_id;\n                    }\n                    if (!addressData.region.region) {\n                        addressData.region.region = window.checkoutConfig.amdefault.region;\n                    }\n                }\n            }\n\n            return origin(addressData);\n        });\n    }\n});\n","Amasty_CheckoutCore/js/model/shipping-rate-registry-mixin.js":"define(['mage/utils/wrapper'], function (wrapper) {\n    'use strict';\n\n    /**\n     * Add clear registry cache functionality.\n     */\n    return function (target) {\n        return wrapper.extend(target, {\n            usedKeys: [],\n            set: function (origin, addressKey) {\n                if (addressKey && this.usedKeys.indexOf(addressKey) === -1) {\n                    this.usedKeys.push(addressKey);\n                }\n\n                return origin();\n            },\n            clearStorage: function () {\n                this.usedKeys.forEach(function (key) {\n                    this.set(key, null);\n                }, this);\n\n                this.usedKeys = [];\n            }\n        });\n    };\n});\n\n","Amasty_CheckoutCore/js/model/agreements-assigner-mixin.js":"define([\n    'mage/utils/wrapper',\n    'jquery'\n], function (wrapper, $) {\n    'use strict';\n\n    return function (agreementsAssignerAction) {\n        return wrapper.wrap(agreementsAssignerAction, function (originalAction, paymentData) {\n            originalAction(paymentData);\n\n            var amcheckoutFormData = $('.additional-options input, .additional-options textarea').serializeArray(),\n                data = {},\n                agreements = [],\n                re = /^agreement\\[\\d+?\\]$/;\n            amcheckoutFormData.forEach(function(item){\n                data[item.name] = item.value;\n                if (re.test(item.name)) {\n                    agreements.push(item.value);\n                }\n            });\n\n            if (agreements.length) {\n                if (paymentData['extension_attributes'] === undefined) {\n                    paymentData['extension_attributes'] = {};\n                }\n\n                paymentData['extension_attributes']['agreement_ids'] = agreements;\n            }\n\n            return paymentData;\n        });\n    };\n});","Amasty_CheckoutCore/js/model/address-form-state.js":"define([\n    'ko',\n    'underscore',\n    'uiRegistry',\n    'Magento_Checkout/js/model/quote'\n], function (ko, _, registry, quote) {\n    'use strict';\n\n    /**\n     * States of Billing Address and Shipping Address Forms which can change checkout behaviour.\n     * You cant change state of form by changing this observables (one way links)\n     */\n    return {\n        /**\n         * is Billing address form in edit mode\n         */\n        isBillingFormVisible: ko.observable(false),\n\n        /**\n         * is Billing Same As Shipping\n         */\n        isBillingSameAsShipping: ko.observable(true),\n\n        /**\n         * is Shipping address form in edit mode\n         */\n        isShippingFormVisible: ko.observable(false),\n\n        isFormRendered: ko.observable(false).extend({ rateLimit: { timeout: 100, method: 'notifyWhenChangesStop' } }),\n\n        /**\n         * Update states by billing form view\n         */\n        updateBillingFormStates: function () {\n            var billingAddressFormComponent,\n                billingFormCacheKey = 'billing-address-form',\n                paymentMethod;\n\n            if (window.checkoutConfig.displayBillingOnPaymentMethod) {\n                paymentMethod = quote.paymentMethod();\n                billingFormCacheKey = false;\n\n                if (paymentMethod) {\n                    billingFormCacheKey = paymentMethod.method + '-form';\n                }\n            }\n\n            billingAddressFormComponent = this.getBillingForm(billingFormCacheKey);\n\n            if (billingAddressFormComponent) {\n                this.isBillingSameAsShipping(Boolean(billingAddressFormComponent.isAddressSameAsShipping()));\n                this.isBillingFormVisible(!billingAddressFormComponent.isAddressDetailsVisible());\n            } else {\n                this.isBillingSameAsShipping(true);\n                this.isBillingFormVisible(false);\n\n                if (!window.checkoutConfig.displayBillingOnPaymentMethod && quote.isVirtual() ||\n                    !quote.billingAddress() && quote.isVirtual()) {\n                    this.isBillingSameAsShipping(false);\n                    this.isBillingFormVisible(true);\n                }\n            }\n        },\n\n        _indexedBillingForm: {},\n\n        getBillingForm: function (index) {\n            if (index && _.isUndefined(this._indexedBillingForm[index])) {\n                this._indexedBillingForm[index] = registry.get({index: index});\n            }\n\n            return this._indexedBillingForm[index];\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/full-screen-loader-mixin.js":"define(\n    [\n        'mage/utils/wrapper',\n        'Amasty_CheckoutCore/js/model/payment/payment-loading'\n    ],\n    function (wrapper, paymentLoader) {\n        'use strict';\n\n        return function (target) {\n            /**\n             * Override for avoid full screen on shipping dynamic save\n             */\n            target.startLoader =  wrapper.wrapSuper(target.startLoader, function () {\n                if (window.loaderIsNotAllowed) {\n                    paymentLoader(true);\n                } else {\n                    this._super();\n                }\n            });\n\n            return target;\n        };\n    }\n);\n\n","Amasty_CheckoutCore/js/model/quote-ext-override.js":"/**\n * Override store pickup quote mixin to set equalityComparer for shipping address before it override with computed\n */\ndefine([\n    'ko',\n    'Magento_InventoryInStorePickupFrontend/js/model/pickup-address-converter',\n    './quote-mixin'\n], function (ko, pickupAddressConverter, quoteMixin) {\n    'use strict';\n\n    return function (quote) {\n        // amasty fix start\n        quote = quoteMixin(quote);\n        // amasty fix finish\n        var shippingAddress = quote.shippingAddress;\n\n        /**\n         * Makes sure that shipping address gets appropriate type when it points\n         * to a store pickup location.\n         */\n        quote.shippingAddress = ko.pureComputed({\n            /**\n             * Return quote shipping address\n             */\n            read: function () {\n                return shippingAddress();\n            },\n\n            /**\n             * Set quote shipping address\n             */\n            write: function (address) {\n                shippingAddress(\n                    pickupAddressConverter.formatAddressToPickupAddress(address)\n                );\n            }\n        });\n\n        return quote;\n    };\n});\n","Amasty_CheckoutCore/js/model/shipping-rate-service-override.js":"/**\n * Rate request moved to separate method to be able to request methods without update shipping address.\n */\ndefine([\n    'Magento_Checkout/js/model/quote',\n    'Magento_Checkout/js/model/shipping-rate-processor/new-address',\n    'Magento_Checkout/js/model/shipping-rate-processor/customer-address',\n    'Magento_Checkout/js/model/shipping-rate-registry',\n    'Magento_Checkout/js/action/select-billing-address',\n    'Amasty_CheckoutCore/js/model/address-form-state'\n], function (\n    quote,\n    defaultProcessor,\n    customerAddressProcessor,\n    rateRegistry,\n    selectBillingAddress,\n    addressFormState\n) {\n    'use strict';\n\n    var RateService = {\n        processors: {},\n\n        /**\n         * @private\n         */\n        _initialize: function () {\n            this.processors.default = defaultProcessor;\n            this.processors['customer-address'] = customerAddressProcessor;\n\n            if (!quote.isVirtual()) {\n                quote.shippingAddress.subscribe(this.updateRates, this);\n            }\n        },\n\n        /**\n         * @param {object|null|undefined} address\n         * @param {boolean|null|undefined} forceUpdate\n         */\n        updateRates: function (address, forceUpdate) {\n            var shippingAddress = address || quote.shippingAddress(),\n                type = shippingAddress.getType();\n\n            if (addressFormState.isBillingSameAsShipping()\n                && (!_.isFunction(shippingAddress.canUseForBilling) || shippingAddress.canUseForBilling())\n            ) {\n                selectBillingAddress(shippingAddress);\n            }\n\n            if (forceUpdate) {\n                rateRegistry.clearStorage();\n            }\n\n            if (this.processors[type]) {\n                this.processors[type].getRates(shippingAddress);\n            } else {\n                this.processors.default.getRates(shippingAddress);\n            }\n        },\n\n        /**\n         * @param {String} type\n         * @param {*} processor\n         */\n        registerProcessor: function (type, processor) {\n            this.processors[type] = processor;\n        }\n    };\n\n    RateService._initialize();\n\n    return RateService;\n});\n","Amasty_CheckoutCore/js/model/step-navigator-mixin.js":"define(\n    [\n        'knockout',\n        'mage/utils/wrapper'\n    ],\n    function (ko, wrapper) {\n        'use strict';\n\n        return function (target) {\n            /**\n             * Override isVisible to isActive function;\n             * because in onestepcheckout all steps should be visible\n             */\n            target.registerStep = wrapper.wrapSuper(target.registerStep, function (code, alias, title, isVisible, navigate, sortOrder) {\n                var isActive = ko.observable(isVisible());\n                this._super(code, alias, title, isActive, navigate, sortOrder);\n            });\n\n            /**\n             * Override for avoid hash in url because in our checkout all doing in one step\n             */\n            target.setHash = wrapper.wrapSuper(target.setHash, function (hash) {\n                hash = '';\n                this._super(hash);\n            });\n\n            return target;\n        };\n    }\n);\n\n","Amasty_CheckoutCore/js/model/consents-assigner-mixin.js":"/**\n * Mixin for Gdpr assigner to collect checkbox values by position\n */\ndefine([\n    'underscore',\n    'mage/utils/wrapper',\n    './gdpr/consent-processor'\n], function (_, wrapper, processor) {\n    'use strict';\n\n    return function (agreementsAssignerAction) {\n        return wrapper.wrap(agreementsAssignerAction, function (originalAction, paymentData) {\n            var consents = window.checkoutConfig.amastyOscGdprConsent || [];\n\n            if (_.isEmpty(consents)) {\n                originalAction(paymentData);\n\n                return;\n            }\n\n            if (!paymentData['additional_data']) {\n                paymentData['additional_data'] = {};\n            }\n\n            paymentData['additional_data']['amgdpr_agreement'] = JSON.stringify(processor.getConsentsData());\n\n            return paymentData;\n        });\n    };\n});\n","Amasty_CheckoutCore/js/model/payment/vault-payment-resolver.js":"define([\n    'underscore',\n    'mageUtils',\n    'uiRegistry',\n    'Magento_Checkout/js/model/payment/method-list'\n],function (_, utils, registry, availableMethods) {\n    'use strict';\n\n    return {\n        /**\n         * Is pyment method are saved valt payment\n         *\n         * @param {String} method\n         * @returns {boolean}\n         */\n        isSavedVaultPayment: function (method) {\n            try {\n                if (method\n                    && utils.nested(window, 'checkoutConfig.payment.vault.' + method)\n                ) {\n                    return true;\n                }\n            } catch (e) {\n\n            }\n\n            return false;\n        },\n\n        /**\n         * Is pyment method are saved valt payment and available\n         *\n         * @param {String} method\n         * @param {Array} methodlist optional\n         * @returns {boolean}\n         */\n        isVaultMethodAvailable: function (vaultMethod, methodlist) {\n            if (!vaultMethod) {\n                return false;\n            }\n\n            var vaultCode = utils.nested(window, 'checkoutConfig.payment.vault.' + vaultMethod + '.config.code');\n            if (!vaultCode) {\n                return false;\n            }\n\n            if (_.isUndefined(methodlist)) {\n                methodlist = availableMethods;\n            }\n            return !! _.some(methodlist, function (method) {\n                return method.method === vaultCode;\n            });\n        },\n\n        /**\n         * Fix Magento bug with preselect saved vault payment\n         * @param {String} method\n         * @returns {boolean}\n         */\n        resolve: function (method) {\n            if (this.isVaultMethodAvailable(method)) {\n                registry.get({index: method}, function (vaultView) {\n                    if (_.isFunction(vaultView.selectPaymentMethod)) {\n                        vaultView.selectPaymentMethod();\n                    }\n                });\n                return true\n            }\n\n            return false;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment/salesrule-observer.js":"/**\n * Optimized replacement of Magento_SalesRule/js/action/select-payment-method-mixin\n * Payment save will be triggered only if object of payment method is changed.\n * Originally, payment save was triggered on any update action, even if there was same data.\n * Which causes a lot of unnecessary requests for One Step Checkout\n */\ndefine([\n    'jquery',\n    'Magento_Checkout/js/model/quote',\n    'Magento_SalesRule/js/model/payment/discount-messages',\n    'Magento_Checkout/js/action/set-payment-information-extended',\n    'Magento_Checkout/js/action/get-totals',\n    'Magento_SalesRule/js/model/coupon'\n],function ($, quote, messageContainer, setPaymentInformationExtended, getTotalsAction, coupon) {\n    'use strict';\n\n    return {\n        /**\n         * @var {string|null}\n         */\n        savedMethod: null,\n\n        /**\n         * @returns {void}\n         */\n        initialize: function () {\n            let currentMethod = quote.paymentMethod();\n\n            quote.paymentMethod.subscribe(this.observer.bind(this));\n\n            if (currentMethod) {\n                this.observer(currentMethod);\n            }\n        },\n\n        /**\n         * Quote payment method subscriber.\n         *\n         * @param {Object|null} paymentMethod\n         * @returns {void}\n         */\n        observer: function (paymentMethod) {\n            if (paymentMethod === null || paymentMethod.method === this.savedMethod) {\n                return;\n            }\n\n            $.when(\n                setPaymentInformationExtended(\n                    messageContainer,\n                    {\n                        method: paymentMethod.method\n                    },\n                    true\n                )\n            ).done(\n                this.updateTotals.bind(this)\n            );\n\n            this.savedMethod = paymentMethod.method;\n        },\n\n        /**\n         * Emulate Magento behavior\n         *\n         * @returns {void}\n         */\n        updateTotals: function () {\n            let deferred = $.Deferred();\n\n            getTotalsAction([], deferred);\n            $.when(deferred).done(this.updateCoupon.bind(this));\n        },\n\n        /**\n         * Emulate Magento behavior\n         *\n         * @returns {void}\n         */\n        updateCoupon: function () {\n            if (quote.totals() && !quote.totals()['coupon_code']) {\n                coupon.setCouponCode('');\n                coupon.setIsApplied(false);\n            }\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment/payment-loading.js":"define([\n    'ko'\n], function (ko) {\n    'use strict';\n\n    /**\n     * Loader for payment block\n     * @see payment-service-mixin.js\n     */\n    return ko.observable(false);\n});\n","Amasty_CheckoutCore/js/model/payment/place-order-state.js":"define([\n    'ko'\n], function (ko) {\n    'use strict';\n\n    /**\n     * State for Place Order button\n     *\n     * @returns {observable}\n     */\n    return ko.observable(true);\n});\n","Amasty_CheckoutCore/js/model/gdpr/consent-processor.js":"/**\n * Processor for collect consent checkboxes data by each checkout block\n */\ndefine([\n    'mage/utils/wrapper',\n    'jquery',\n    'underscore'\n], function (wrapper, $, _) {\n    'use strict';\n\n    return {\n\n        /**\n         * @return {Object}\n         */\n        getConsentsData: function () {\n            var consents = window.checkoutConfig.amastyOscGdprConsent || [],\n                consentsData = {},\n                consentData,\n                consentElements,\n                checked;\n\n            _.each(consents, function (consentByBlock, blockCode) {\n                _.each(consentByBlock.consents, function (consent) {\n                    consentElements = $('input[data-gdpr-checkbox-code=\"' + consent.checkbox_code + '\"]:visible');\n\n                    _.each(consentElements, function (consentElement) {\n                        consentData = consentsData[consent.checkbox_code];\n                        checked = Boolean($(consentElement).prop('checked'));\n\n                        if (!consentData || !consentData.checked) {\n                            consentsData[consent.checkbox_code] = {\n                                checked: checked,\n                                from: blockCode\n                            };\n                        }\n                    });\n                });\n            });\n\n            return consentsData;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment-validators/order-summary-validator.js":"define([\n    'jquery',\n    'uiRegistry'\n], function ($, registry) {\n    'use strict';\n\n    return {\n        /**\n         * Validate Summary order form if automatic update setting is enabled\n         *\n         * @returns {Boolean}\n         */\n        validate: function () {\n            var forms = $('[data-amcheckout-js=\"order-form\"]'),\n                result = true;\n\n            registry.get('checkout.sidebar.summary.cart_items.details', function (details) {\n                if (!details.isAutomatically) {\n                    return result;\n                }\n\n                $.each(forms, function () {\n                    if (!$(this).valid()) {\n                        result = false;\n                    }\n                });\n\n                return result;\n            });\n\n            return result;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment-validators/dob-validator.js":"\ndefine([\n    'uiRegistry'\n], function (registry) {\n    'use strict';\n\n    return {\n        /**\n         * Validate Date of Birth if available\n         *\n         * @returns {Boolean}\n         */\n        validate: function () {\n            var amastyDob = registry.get('checkout.sidebar.additional.checkboxes.date_of_birth');\n\n            if (amastyDob && amastyDob.visible()) {\n                var validate = amastyDob.validate();\n                if (validate == false) {\n                    return false;\n                }\n                return validate.valid;\n            }\n\n            return true;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment-validators/shipping-validator.js":"define([\n    'uiRegistry', 'Amasty_CheckoutCore/js/model/shipping-registry'\n], function (registry, shippingRegistry) {\n    'use strict';\n\n    return {\n        /**\n         * Validate checkout shipping step\n         *\n         * @returns {Boolean}\n         */\n        validate: function (hideError) {\n            let shipping = registry.get('checkout.steps.shipping-step.shippingAddress'),\n                result;\n\n            if (hideError && (shippingRegistry.isEstimationHaveError() || !shipping.silentValidation())) {\n                return false;\n            }\n\n            shipping.allowedDynamicalSave = false;\n            window.silentShippingValidation = !!hideError;\n            result = shipping.validateShippingInformation(hideError);\n\n            delete window.silentShippingValidation;\n            shipping.allowedDynamicalSave = true;\n\n            return result;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/model/payment-validators/login-form-validator.js":"define(\n    [\n        'jquery',\n        'underscore',\n        'uiRegistry',\n        'Magento_Customer/js/model/customer'\n    ],\n    function ($, _, registry, customer) {\n        'use strict';\n\n        return {\n            /**\n             * Validate Login Form on checkout if available\n             *\n             * @returns {Boolean}\n             */\n            validate: function (hideError) {\n                let createAcc = +window?.checkoutConfig?.quoteData?.additional_options?.create_account,\n                    $loginForm,\n                    customerEmail;\n\n                if (customer.isLoggedIn() || createAcc <= 1) {\n                    return true;\n                }\n\n                $loginForm = $('form[data-role=email-with-possible-login]');\n\n                if (createAcc === 3) {\n                    customerEmail = registry.get('checkout.steps.shipping-step.shippingAddress.customer-email')\n                    if (!_.isUndefined(customerEmail) && customerEmail.isPassword()) {\n                        return this._validateElement($loginForm, hideError);\n                    }\n                }\n\n                if ($loginForm.find('#customer-password').val()) {\n                    return this._validateElement($loginForm, hideError);\n                }\n\n                return true;\n            },\n\n            _validateElement: function ($loginForm, hideError) {\n                let isValid = $loginForm.validation() && $loginForm.validation('isValid');\n\n                if (hideError) {\n                    $loginForm.validation('clearError');\n                }\n\n                return isValid;\n            }\n        };\n    }\n);\n","Amasty_CheckoutCore/js/model/payment-validators/additional-validators-mixin.js":"define(\n    [\n        'mage/utils/wrapper',\n        'Amasty_CheckoutCore/js/action/focus-first-error',\n        'Amasty_CheckoutCore/js/model/payment-validators/login-form-validator'\n    ],\n    function (wrapper, focusFirstError, loginFormValidator) {\n        'use strict';\n\n        return function (target) {\n            /**\n             * Focus first error after validation\n             */\n            target.validate = wrapper.wrapSuper(target.validate, function (hideError) {\n                var result;\n\n                if (!loginFormValidator.validate(hideError)) {\n                    if (!hideError) {\n                        focusFirstError();\n                    }\n\n                    return false;\n                }\n\n                result = this._super();\n\n                if (!result && !hideError) {\n                    focusFirstError();\n                }\n\n                return result;\n            });\n\n            return target;\n        };\n    }\n);\n","Amasty_CheckoutCore/js/model/payment-validators/agreement-validator.js":"define([\n    'jquery',\n    'mage/validation'\n], function ($) {\n    'use strict';\n\n    var checkoutConfig = window.checkoutConfig,\n        agreementsConfig = checkoutConfig ? checkoutConfig.checkoutAgreements : {},\n        agreementsInputPath = '.additional-options .checkout-agreements .checkout-agreement.required input',\n        agreementsInputPathPayment = '.payment-method._active div.checkout-agreements input',\n        agreementsError = '.additional-options .checkout-agreements .checkout-agreement div.mage-error',\n        agreementsInputPathOld = '.additional-options .checkout-agreements .checkout-agreement input';\n\n    return {\n        /**\n         * Validate checkout agreements\n         *\n         * @param {boolean} hideError\n         * @returns {Boolean}\n         */\n        validate: function (hideError) {\n            var isValid = true,\n                agreementsForValidate = agreementsInputPath;\n\n            if (!agreementsConfig || !agreementsConfig.isEnabled) {\n                return true;\n            }\n            if ($(agreementsInputPath).length === 0) {\n                if ($(agreementsInputPathPayment).length !== 0) {\n                    agreementsForValidate = agreementsInputPathPayment;\n                } else {\n                    return this.validateOld(hideError);\n                }\n            }\n\n            $(agreementsForValidate).each(function (index, element) {\n                if (!$.validator.validateSingleElement(\n                    element,\n                    {\n                        errorElement: 'div',\n                        hideError: hideError || false,\n                        errorPlacement: function (error, element) {\n                            let errorPlacement = element;\n                            if (element.is(':checkbox') || element.is(':radio')) {\n                                errorPlacement = element.siblings('label').last();\n                            }\n                            errorPlacement.after(error);\n                        }\n                    }\n                )) {\n                    isValid = false;\n                }\n            });\n\n            return isValid;\n        },\n        /**\n         * Validate checkout agreements with old version of magento\n         *\n         * @param {boolean} hideError\n         * @returns {Boolean}\n         */\n        validateOld: function (hideError) {\n            if ($(agreementsInputPathOld).length === 0) {\n                return true;\n            }\n\n            var isValid = true,\n                element = $(agreementsInputPathOld),\n                validator = $('#checkout').validate({\n                    errorClass: 'mage-error',\n                    errorElement: 'div',\n                    meta: 'validate',\n                    hideError: hideError || false,\n                    errorPlacement: function (error, element) {\n                        var errorPlacement = element;\n                        if (element.is(':checkbox') || element.is(':radio')) {\n                            errorPlacement = element.siblings('label').last();\n                        }\n                        errorPlacement.after(error);\n                    }\n                });\n\n            if (element.is(':checked') == false) {\n                isValid = false;\n                if (!$(agreementsError).length && !hideError) {\n                    validator.showLabel(element, $.mage.__('This is a required field.'));\n                }\n            }\n\n            return isValid;\n        }\n    };\n});\n","Amasty_CheckoutCore/js/options/configurable.js":"/*jshint browser:true jquery:true*/\ndefine([\n    'jquery',\n    'Magento_ConfigurableProduct/js/configurable',\n    'Magento_Ui/js/modal/modal'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.amcheckoutConfigurable', $.mage.configurable, {\n        options: {\n            selectorProduct: '.product'\n        },\n\n        /**\n          * Initialize tax configuration, initial settings, and options values.\n          * https://github.com/magento/magento2/issues/14211\n          * @private\n          */\n        _initializeOptions: function () {\n            const element = $(this.options.selectorProductPrice ?? this.options.priceHolderSelector);\n\n            if (!element.data('magePriceBox')) {\n                element.priceBox();\n            }\n\n            return this._super();\n        },\n\n        /**\n         * Initialize tax configuration, initial settings, and options values.\n         * https://github.com/magento/magento2/issues/14211\n         * @private\n         */\n        _calculatePrice: function (config) {\n            var element = $(this.options.priceHolderSelector);\n\n            if (!element.data('magePriceBox')) {\n                element.priceBox();\n            }\n\n            return this._super(config);\n        },\n\n        configureElement: function (element) {\n            return this._configureElement(element);\n        },\n\n        _getAttributeId: function (element) {\n            return +$(element).data('attribute-id');\n        },\n\n        _fillState: function () {\n            $.each(this.options.settings, $.proxy(function (index, element) {\n                var attributeId = this._getAttributeId(element);\n\n                if (attributeId && this.options.spConfig.attributes[attributeId]) {\n                    element.config = this.options.spConfig.attributes[attributeId];\n                    element.attributeId = attributeId;\n                    this.options.state[attributeId] = false;\n                }\n            }, this));\n        },\n\n        _fillSelect: function (element) {\n            var attributeId = this._getAttributeId(element),\n                options = this._getAttributeOptions(attributeId),\n                prevConfig,\n                index = 1,\n                allowedProducts,\n                i,\n                j;\n\n            this._clearSelect(element);\n            element.options[0] = new Option('', '');\n            element.options[0].innerHTML = this.options.spConfig.chooseText;\n            prevConfig = false;\n\n            if (element.prevSetting) {\n                prevConfig = element.prevSetting.options[element.prevSetting.selectedIndex];\n            }\n\n            if (options) {\n                for (i = 0; i < options.length; i++) {\n                    allowedProducts = [];\n\n                    if (prevConfig) {\n                        for (j = 0; j < options[i].products.length; j++) {\n                            // prevConfig.config can be undefined\n                            if (prevConfig.config &&\n                                prevConfig.config.allowedProducts &&\n                                prevConfig.config.allowedProducts.indexOf(options[i].products[j]) > -1) {\n                                allowedProducts.push(options[i].products[j]);\n                            }\n                        }\n                    } else {\n                        allowedProducts = options[i].products.slice(0);\n                    }\n\n                    if (allowedProducts.length > 0) {\n                        options[i].allowedProducts = allowedProducts;\n                        element.options[index] = new Option(this._getOptionLabel(options[i]), options[i].id);\n\n                        if (typeof options[i].price !== 'undefined') {\n                            element.options[index].setAttribute('price', options[i].prices);\n                        }\n\n                        element.options[index].config = options[i];\n                        index++;\n                    }\n                }\n            }\n        }\n    });\n\n    return $.mage.amcheckoutConfigurable;\n});\n","Amasty_CheckoutCore/js/action/set-payment-method-mixin.js":"define([\n    'uiRegistry',\n    'Magento_Checkout/js/model/quote',\n    'mage/utils/wrapper',\n    'Magento_CheckoutAgreements/js/model/agreements-assigner'\n], function (registry, quote, wrapper, agreementsAssigner) {\n    'use strict';\n\n    return function (setPaymentMethodAction) {\n        return wrapper.wrap(setPaymentMethodAction, function (originalAction, messageContainer) {\n            agreementsAssigner(quote.paymentMethod());\n\n            return originalAction(messageContainer);\n        });\n    };\n});\n","Amasty_CheckoutCore/js/action/update-item.js":"define(\n    [\n        'Amasty_CheckoutCore/js/model/resource-url-manager',\n        'Magento_Checkout/js/model/totals',\n        'Magento_Checkout/js/model/quote',\n        'mage/storage',\n        'Magento_Checkout/js/model/error-processor',\n        'Amasty_CheckoutCore/js/action/recollect-shipping-rates',\n        'Magento_Checkout/js/model/payment-service',\n        'Magento_Checkout/js/model/payment/method-converter',\n        'Magento_Customer/js/customer-data',\n        'Amasty_CheckoutCore/js/action/update-items-content',\n        'uiRegistry'\n    ],\n    function (\n        resourceUrlManager,\n        totals,\n        quote,\n        storage,\n        errorProcessor,\n        recollectShippingRates,\n        paymentService,\n        methodConverter,\n        customerData,\n        updateItemsContent,\n        registry\n    ) {\n        \"use strict\";\n\n\n        return function (itemId, formData) {\n            if (totals.isLoading()) {\n                return;\n            }\n\n            totals.isLoading(true);\n\n            storage.post(\n                resourceUrlManager.getUrlForUpdateItem(quote),\n                JSON.stringify({\n                    itemId: itemId,\n                    formData: formData\n                }), false\n            ).done(\n                function (result) {\n                    if (!result) {\n                        window.location.reload();\n                    }\n\n                    recollectShippingRates();\n\n                    paymentService.setPaymentMethods(methodConverter(result.payment));\n                    customerData.reload(['cart']);\n                    totals.isLoading(false);\n                    \n                    const quoteMessages = JSON.parse(result.quote_messages);\n                    if (quoteMessages) {\n                        const cartItemsMessages = registry.get('checkout.sidebar.summary.cart_items.details.message');\n                        Object.keys(quoteMessages).forEach((id) => {\n                            window.checkoutConfig.quoteMessages[id] = quoteMessages[id];\n                            cartItemsMessages.quoteMessages[id] = quoteMessages[id];\n                        });\n                    }\n\n                    updateItemsContent(result.totals);\n                }\n            ).fail(\n                function (response) {\n                    errorProcessor.process(response);\n                    totals.isLoading(false);\n                }\n            );\n        };\n    }\n);\n","Amasty_CheckoutCore/js/action/get-totals.js":"define([\n    'jquery',\n    'mage/utils/wrapper',\n    'underscore',\n    'Amasty_CheckoutCore/js/model/resource-url-manager',\n    'Magento_Checkout/js/model/quote',\n    'mage/storage',\n    'Magento_Checkout/js/model/totals',\n    'Magento_Checkout/js/model/error-processor'\n], function ($, wrapper, _, resourceUrlManager, quote, storage, totalsService, errorProcessor) {\n    'use strict';\n\n    return function (callbacks, deferred) {\n        var serviceUrl = resourceUrlManager.getUrlForTotalsEstimationForNewAddress(quote),\n            request,\n            payload,\n            requiredFields = ['countryId', 'region', 'regionId', 'postcode'],\n            address = quote.isVirtual() ? quote.billingAddress() : quote.shippingAddress(),\n            deferredObject = deferred || $.Deferred();\n\n        address = _.pick(address, requiredFields);\n\n        payload = {\n            addressInformation: {\n                address: address\n            }\n        };\n\n        if (quote.shippingMethod() && quote.shippingMethod()['method_code']) {\n            payload.addressInformation['shipping_method_code'] = quote.shippingMethod()['method_code'];\n            payload.addressInformation['shipping_carrier_code'] = quote.shippingMethod()['carrier_code'];\n        }\n\n        totalsService.isLoading(true);\n\n        request = window.checkoutConfig.isNegotiableQuote ?\n            storage.get.bind(this, serviceUrl, false) :\n            storage.post.bind(this, serviceUrl, JSON.stringify(payload), false);\n\n        return request().done(function (response) {\n            var proceed = true;\n\n            if (callbacks && callbacks.length > 0) {\n                _.each(callbacks, function (callback) {\n                    proceed = proceed && callback();\n                });\n            }\n\n            if (proceed) {\n                quote.setTotals(response);\n                deferredObject.resolve();\n            }\n        }).fail(function (response) {\n            if (response.responseText || response.status) {\n                errorProcessor.process(response);\n            }\n\n            deferredObject.reject();\n        }).always(function () {\n            totalsService.isLoading(false);\n        });\n    };\n});\n","Amasty_CheckoutCore/js/action/get-address-cache-key.js":"define(\n    [\n        'underscore',\n        'Magento_Checkout/js/model/shipping-rates-validation-rules',\n        'Magento_Checkout/js/model/address-converter'\n    ],\n    function (_, validationRules, addressConverter) {\n        'use strict';\n\n        /**\n         * Return cache string by guest address.\n         * Improve guest cache string key generation.\n         * Collecting by shipping carriers required fields.\n         *\n         * @param {Object} address - quote model address\n         * @return {String}\n         * @since 3.0.0\n         */\n        function getAddressCacheKey (address) {\n            var fields,\n                formAddress,\n                cacheKey = '',\n                postcodeElementName = 'postcode';\n\n            if (address.getType() !== 'new-address' && address.getType() !== 'new-customer-address') {\n                return address.getCacheKey();\n            }\n\n            fields = validationRules.getObservableFields();\n\n            if (!_.include(fields, postcodeElementName)){\n                fields.push(postcodeElementName);\n            }\n\n            formAddress = addressConverter.quoteAddressToFormAddressData(address);\n            _.each(fields, function (name) {\n                if (formAddress.hasOwnProperty(name)) {\n                    if (_.isObject(formAddress[name]) || _.isArray(formAddress[name])) {\n                        _.each(formAddress[name], function (streetLine) {\n                            cacheKey += '|' + streetLine;\n                        });\n                    } else if (_.isString(formAddress[name])){\n                        cacheKey += '|' + formAddress[name];\n                    }\n                } else if(formAddress['custom_attributes']) {\n                    cacheKey += '|' + formAddress['custom_attributes'][name];\n                }\n            });\n\n            return cacheKey;\n        }\n\n        return getAddressCacheKey;\n    }\n);\n","Amasty_CheckoutCore/js/action/select-shipping-address-mixin.js":"define([\n    'Magento_Checkout/js/model/quote',\n    'mage/utils/wrapper'\n], function (quote, wrapper) {\n    'use strict';\n\n    return function (setShippingAddressAction) {\n        return wrapper.wrap(setShippingAddressAction, function (originalAction, shippingAddress) {\n\n            if (quote.shippingAddress.equalityComparer(quote.shippingAddress(), shippingAddress)) {\n                // prevent infinity shipping loader\n                require(['Magento_Checkout/js/model/shipping-service'], function (shippingService) {\n                    shippingService.isLoading(false);\n                });\n            }\n\n            return originalAction(shippingAddress);\n        });\n    };\n});\n","Amasty_CheckoutCore/js/action/update-items-content.js":"define(\n    [\n        'Magento_Checkout/js/model/totals',\n        'Magento_Checkout/js/model/error-processor',\n        'uiRegistry',\n        'Magento_Checkout/js/model/quote',\n        'mage/storage'\n    ],\n    function (\n        totals,\n        errorProcessor,\n        registry,\n        quote,\n        storage\n    ) {\n        \"use strict\";\n\n        return function (quoteTotals) {\n            waitForTotals().then(function () {\n                    totals.isLoading(true);\n\n                    storage.get('/checkout/ajax/getItemsData').done(\n                        function (result) {\n                            if (!result) {\n                                window.location.reload();\n                            }\n\n                            if (result.image_data) {\n                                registry.get('checkout.sidebar.summary.cart_items.details.thumbnail').imageData\n                                    = result.image_data;\n                            }\n\n                            if (result.options_data) {\n                                var options = result.options_data;\n                                quoteTotals.items.forEach(function (item) {\n                                    item.amcheckout = options[item.item_id];\n                                });\n                            }\n                            quote.setTotals(quoteTotals);\n                        }\n                    ).fail(\n                        function (response) {\n                            errorProcessor.process(response);\n                        }\n                    ).always(\n                        function () {\n                            totals.isLoading(false);\n                        }\n                    );\n                }\n            );\n        };\n\n        function waitForTotals() {\n            return new Promise(function (resolve) {\n                if (!totals.isLoading()) {\n                    resolve();\n                } else {\n                    const subscription = totals.isLoading.subscribe(function (loading) {\n                        if (!loading) {\n                            subscription.dispose();\n                            resolve();\n                        }\n                    });\n                }\n            });\n        }\n    });\n","Amasty_CheckoutCore/js/action/focus-first-error.js":"define(\n    ['jquery'],\n    function ($) {\n        'use strict';\n\n        function toggleErrorCollapsible(errors) {\n            $.each(errors, function (index, error) {\n                if ($(error).css('display') != 'none'\n                    && $(error).parents('[data-amcheckout-js=\"step-content\"]').length) {\n                    var stepContainer = $(error).parents('[data-amcheckout-js=\"step-content\"]').parent(),\n                        stepContainerIsActive = stepContainer.data('mageCollapsible')\n                            ? stepContainer.data('mageCollapsible').options.active\n                            : true;\n\n                    if (!stepContainerIsActive) {\n                        var animate = stepContainer.collapsible(\"option\", \"animate\");\n\n                        stepContainer\n                            .collapsible('option', 'animate', false)\n                            .collapsible('activate')\n                            .collapsible('option', 'animate', animate);\n                    }\n                }\n            })\n        }\n\n        return function () {\n            var checkoutWindow = window;\n\n            if (checkoutWindow.checkoutDesign == 'modern'\n                && (checkoutWindow.checkoutLayout == '1column' || checkoutWindow.checkoutLayout == '2columns')) {\n                var allErrors = $('.mage-error, .field-error');\n\n                if (allErrors.length) {\n                    toggleErrorCollapsible(allErrors);\n                }\n            }\n\n            var errorField = $('.mage-error:visible, .field-error:visible').first();\n\n            if (!errorField.length) {\n                return;\n            }\n\n            if (errorField.is('div.mage-error')) {\n                if (errorField.prop('for')) {\n                    errorField = $('#' + errorField.prop('for')).length\n                        ? $('#' + errorField.prop('for'))\n                        : $('[name=\"' + errorField.prop('for') + '\"]');\n                } else {\n                    var input = errorField.prevAll(':input');\n                    if (input.length) {\n                        errorField = input;\n                    }\n                }\n            } else if (errorField.is('div.field-error')) {\n                errorField = $('#' + errorField.prop('id').replace('error-', ''))\n            }\n\n            if (errorField.is('input:not(:visible)')) {\n                errorField = $('label[for=\"' + errorField.prop('id') + '\"]')\n            }\n\n            var offset = errorField.offset().top - (checkoutWindow.innerHeight / 2);\n\n            if (offset < 0) {\n                offset = 0;\n            }\n\n            $(checkoutWindow).scrollTop(offset);\n\n            errorField.focus();\n        };\n    }\n);\n\n","Amasty_CheckoutCore/js/action/create-js-bundle.js":"define([\n    'underscore',\n    'mage/storage',\n    'Magento_Checkout/js/model/url-builder'\n], function (_, storage, urlBuilder) {\n    \"use strict\";\n\n    var API_PATH = '/amasty_checkout/js/create-bundle';\n\n    return function () {\n        var ulr = urlBuilder.createUrl(API_PATH, {}),\n            match = /\\/frontend\\//.exec(Object.keys(require.s.contexts._.urlFetched)[0]),\n            trashStringSize = match.index || 0,\n            data = [];\n\n        _.each(require.s.contexts._.urlFetched, function (val, key) {\n            data.push(key.substr(trashStringSize));\n        });\n\n        _.each(require.s.contexts._.defined, function (val, key) {\n            if (key.substr(0, 5) === \"text!\") {\n                // collect all html\n                data.push(require.toUrl(key.substr(5)).substr(trashStringSize));\n            }\n        });\n\n        storage.post(ulr, JSON.stringify({fileNames: data}), false);\n    };\n});\n","Amasty_CheckoutCore/js/action/save-additional-fields.js":"define(\n    [\n        'jquery',\n        'Amasty_CheckoutCore/js/model/resource-url-manager',\n        'Magento_Checkout/js/model/quote',\n        'uiRegistry',\n        'mage/storage',\n        'Magento_Checkout/js/model/error-processor'\n    ],\n    function ($, resourceUrlManager, quote, registry, storage, errorProcessor) {\n        \"use strict\";\n        var request;\n        return function () {\n            var serviceUrl, payload, data;\n\n            serviceUrl = resourceUrlManager.getUrlForAdditionalFields(quote);\n\n            data = registry.get('checkoutProvider').get('amcheckout.additional');\n\n            payload = {\n                cartId: quote.getQuoteId(),\n                fields: data\n            };\n            if (request) {\n                request.abort();\n            }\n\n            request = storage.post(\n                serviceUrl, JSON.stringify(payload), false\n            ).fail(\n                function (response) {\n                    if (response.responseText) {\n                        errorProcessor.process(response);\n                    }\n                }\n            );\n\n            return request;\n        }\n    }\n);\n","Amasty_CheckoutCore/js/action/save-password.js":"define(\n    [\n        'jquery',\n        'Amasty_CheckoutCore/js/model/resource-url-manager',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Checkout/js/model/error-processor',\n        'mage/storage'\n    ],\n    function (\n        $,\n        resourceUrlManager,\n        quote,\n        errorProcessor,\n        storage\n    ) {\n        \"use strict\";\n\n        return function () {\n            var serviceUrl = resourceUrlManager.getUrlForSavePassword(quote),\n                password = $('form[data-role=email-with-possible-login]').find('#customer-password'),\n                payload = {\n                    password: password ? password.val() : ''\n            };\n\n            return storage.post(\n                serviceUrl,\n                JSON.stringify(payload),\n                false\n            ).fail(\n                function (response) {\n                    errorProcessor.process(response);\n                }\n            );\n        };\n    }\n);\n","Amasty_CheckoutCore/js/action/recollect-shipping-rates.js":"define([\n    'underscore',\n    'Magento_Checkout/js/model/quote',\n    'Amasty_CheckoutCore/js/model/shipping-rate-service-override'\n], function (_, quote,  rateService) {\n    'use strict';\n\n    /**\n     * Clear shipping rates cache and request new rates for current shipping address\n     */\n    return _.throttle(function () {\n        if (!quote.isVirtual()) {\n            rateService.updateRates(quote.shippingAddress(), true);\n        }\n    }, 500);\n});\n","Amasty_CheckoutCore/js/action/is-equal-ignore-functions.js":"/**\n * Extended copy of underscore comparison function for `isEqual` with.\n * Underscore's 'isEqual' doesn't compare functions correctly.\n */\ndefine([\n    'underscore'\n], function (_) {\n    'use strict';\n\n    var isEqualIgnoreFunctions = function (a, b, aStack, bStack) {\n        var className,\n            areArrays,\n            key,\n            length,\n            aCtor,\n            bCtor,\n            keys,\n            isFunction;\n\n        if (a === b) {\n            return a !== 0 || 1 / a === 1 / b;\n        }\n\n        if (a == null || b == null) {\n            return a === b;\n        }\n\n        if (a instanceof _) {\n            a = a._wrapped;\n        }\n\n        if (b instanceof _) {\n            b = b._wrapped;\n        }\n\n        className = Object.prototype.toString.call(a);\n\n        if (className !== Object.prototype.toString.call(b)) {\n            return false;\n        }\n\n        switch (className) {\n            case '[object RegExp]':\n            case '[object String]':\n                return '' + a === '' + b;\n            case '[object Number]':\n                if (+a !== +a) {\n                    return +b !== +b;\n                }\n\n                return +a === 0 ? 1 / +a === 1 / b : +a === +b;\n            case '[object Date]':\n            case '[object Boolean]':\n                return +a === +b;\n            default:\n                break;\n        }\n\n        areArrays = className === '[object Array]';\n\n        if (!areArrays) {\n            if (typeof a != 'object' || typeof b != 'object') { return false; }\n\n            aCtor = a.constructor;\n            bCtor = b.constructor;\n\n            if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor &&\n                _.isFunction(bCtor) && bCtor instanceof bCtor) &&\n                ('constructor' in a && 'constructor' in b)) {\n                return false;\n            }\n        }\n\n        aStack = aStack || [];\n        bStack = bStack || [];\n        length = aStack.length;\n\n        while (length--) {\n            if (aStack[length] === a) {\n                return bStack[length] === b;\n            }\n        }\n\n        aStack.push(a);\n        bStack.push(b);\n\n        if (areArrays) {\n            length = a.length;\n\n            if (length !== b.length) {\n                return false;\n            }\n\n            while (length--) {\n                if (!isEqualIgnoreFunctions(a[length], b[length], aStack, bStack)) {\n                    return false;\n                }\n            }\n        } else {\n            keys = _.keys(a);\n            length = keys.length;\n\n            if (_.keys(b).length !== length) {\n                return false;\n            }\n\n            while (length--) {\n                key = keys[length];\n\n                // Custom Amasty check\n                isFunction = _.isFunction(a[key]) || _.isFunction(b[key]);\n\n                if (!isFunction &&\n                    !(_.has(b, key) && isEqualIgnoreFunctions(a[key], b[key], aStack, bStack))) {\n                    return false;\n                }\n            }\n        }\n\n        aStack.pop();\n        bStack.pop();\n\n        return true;\n    }\n\n    return isEqualIgnoreFunctions;\n});\n","Amasty_CheckoutCore/js/action/set-shipping-information-mixin.js":"define([\n    'jquery',\n    'mage/utils/wrapper',\n    'Amasty_CheckoutCore/js/model/events',\n    'Magento_Checkout/js/model/totals'\n], function ($, wrapper, events, totals) {\n    'use strict';\n\n    return function (setShippingInformationAction) {\n        return wrapper.wrap(setShippingInformationAction, function (original) {\n            events.trigger('before_shipping_save');\n            totals.isLoading(true);\n            return original().always(function(){\n                events.trigger('after_shipping_save');\n                totals.isLoading(false);\n            });\n        });\n    };\n});\n","Amasty_CheckoutCore/js/action/remove-item.js":"define(\n    [\n        'Amasty_CheckoutCore/js/model/resource-url-manager',\n        'Magento_Checkout/js/model/totals',\n        'Magento_Checkout/js/model/quote',\n        'mage/storage',\n        'Magento_Checkout/js/model/error-processor',\n        'Magento_Checkout/js/model/shipping-service',\n        'Magento_Checkout/js/model/shipping-rate-registry',\n        'Magento_Checkout/js/model/payment-service',\n        'Magento_Checkout/js/model/payment/method-converter',\n        'Magento_Customer/js/customer-data',\n        'mage/url'\n    ],\n    function (\n        resourceUrlManager,\n        totals,\n        quote,\n        storage,\n        errorProcessor,\n        shippingService,\n        rateRegistry,\n        paymentService,\n        methodConverter,\n        customerData,\n        urlBuilder\n    ) {\n        \"use strict\";\n        return function (itemId) {\n            if (totals.isLoading())\n                return;\n\n            totals.isLoading(true);\n            shippingService.isLoading(true);\n            var serviceUrl = resourceUrlManager.getUrlForRemoveItem(quote);\n            var shipppingAddress = quote.shippingAddress();\n\n            //Fix for magento 2.2.2\n            if (shipppingAddress.extensionAttributes\n                && shipppingAddress.extensionAttributes.checkoutFields\n                && Object.keys(shipppingAddress.extensionAttributes.checkoutFields).length === 0\n            ) {\n                shipppingAddress.extensionAttributes.checkoutFields = [];\n            }\n\n            storage.post(\n                serviceUrl, JSON.stringify({\n                    itemId: itemId,\n                    address: shipppingAddress\n                }), false\n            ).done(\n                function (result) {\n                    if (!result) {\n                        return window.location.reload();\n                    }\n\n                    var itemIds = result.totals.items.map(function (value, index) {\n                        return value.item_id;\n                    });\n                    customerData.reload(['cart']);\n\n                    if  (!itemIds.length) {\n                        window.location.href = urlBuilder.build(\"checkout/cart/index\");\n                        return this;\n                    }\n                    window.checkoutConfig.quoteItemData = window.checkoutConfig.quoteItemData.filter(function (item) {\n                        return itemIds.indexOf(+item.item_id) !== -1;\n                    });\n\n                    shippingService.setShippingRates(result.shipping);\n                    rateRegistry.set(quote.shippingAddress().getKey(), result.shipping);\n                    quote.setTotals(result.totals);\n\n                    paymentService.setPaymentMethods(methodConverter(result.payment));\n                }\n            ).fail(\n                function (response) {\n                    errorProcessor.process(response);\n                }\n            ).always(\n                function () {\n                    shippingService.isLoading(false);\n                    totals.isLoading(false);\n                }\n            );\n        }\n    }\n);\n","Amasty_CheckoutCore/js/form/element/region.js":"define(\n    [\n        'Magento_Ui/js/form/element/region',\n        'uiRegistry'\n    ],\n    function (\n        Component,\n        registry\n    ) {\n        'use strict';\n\n        return Component.extend({\n            /**\n             * Set default region value\n             */\n            initialize: function (config) {\n                this._super();\n\n                if (window.checkoutConfig.amdefault && window.checkoutConfig.amdefault.region) {\n                    registry.get(this.parentName + '.' + 'region_id_input', function (region) {\n                        if (!region.value() ) {\n                            var country = registry.get(this.parentName + '.' + 'country_id');\n                            if (country.value() == window.checkoutConfig.amdefault.country_id) {\n                                region.value(window.checkoutConfig.amdefault.region);\n                            }\n                        }\n                    }.bind(this));\n                }\n\n                return this;\n            }\n        });\n    }\n);\n","Amasty_CheckoutCore/vendor/tooltipster/js/tooltipster.min.js":"!function(t,i){\"function\"==typeof define&&define.amd?define([\"jquery\"],function(t){return i(t)}):\"object\"==typeof exports?module.exports=i(require(\"jquery\")):i(jQuery)}(0,function(t){var i={animation:\"fade\",animationDuration:350,content:null,contentAsHTML:!1,contentCloning:!1,debug:!0,delay:300,delayTouch:[300,500],functionInit:null,functionBefore:null,functionReady:null,functionAfter:null,functionFormat:null,IEmin:6,interactive:!1,multiple:!1,parent:null,plugins:[\"sideTip\"],repositionOnScroll:!1,restoration:\"none\",selfDestruction:!0,theme:[],timer:0,trackerInterval:500,trackOrigin:!1,trackTooltip:!1,trigger:\"hover\",triggerClose:{click:!1,mouseleave:!1,originClick:!1,scroll:!1,tap:!1,touchleave:!1},triggerOpen:{click:!1,mouseenter:!1,tap:!1,touchstart:!1},updateAnimation:\"rotate\",zIndex:9999999,styles:{backgroundColor:\"\",textColor:\"\"}},o=\"undefined\"!=typeof window?window:null,e={hasTouchCapability:!(!o||!(\"ontouchstart\"in o||o.DocumentTouch&&o.document instanceof o.DocumentTouch||o.navigator.maxTouchPoints)),hasTransitions:function(){if(!o)return!1;var t=(o.document.body||o.document.documentElement).style,i=\"transition\",e=[\"Moz\",\"Webkit\",\"Khtml\",\"O\",\"ms\"];if(\"string\"==typeof t[i])return!0;i=i.charAt(0).toUpperCase()+i.substr(1);for(var n=0;n<e.length;n++)if(\"string\"==typeof t[e[n]+i])return!0;return!1}(),IE:!1,semVer:\"4.2.8\",window:o},n=function(){this.__$emitterPrivate=t({}),this.__$emitterPublic=t({}),this.__instancesLatestArr=[],this.__plugins={},this._env=e};function s(t){this.$container,this.constraints=null,this.__$tooltip,this.__init(t)}function r(i,o){var e=!0;return t.each(i,function(t,n){if(void 0===o[t]||i[t]!==o[t])return e=!1,!1}),e}function _(i){var o=i.attr(\"id\"),n=o?e.window.document.getElementById(o):null;return n?n===i[0]:t.contains(e.window.document.body,i[0])}n.prototype={__bridge:function(o,e,n){if(!e[n]){var s=function(){};s.prototype=o;var r=new s;r.__init&&r.__init(e),t.each(o,function(t,o){0!=t.indexOf(\"__\")&&(e[t]?i.debug&&console.log(\"The \"+t+\" method of the \"+n+\" plugin conflicts with another plugin or native methods\"):(e[t]=function(){return r[t].apply(r,Array.prototype.slice.apply(arguments))},e[t].bridged=r))}),e[n]=r}return this},__setWindow:function(t){return e.window=t,this},_getRuler:function(t){return new s(t)},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_plugin:function(i){if(\"string\"==typeof i){var o=i,e=null;return o.indexOf(\".\")>0?e=this.__plugins[o]:t.each(this.__plugins,function(t,i){if(i.name.substring(i.name.length-o.length-1)==\".\"+o)return e=i,!1}),e}if(i.name.indexOf(\".\")<0)throw new Error(\"Plugins must be namespaced\");return this.__plugins[i.name]=i,i.core&&this.__bridge(i.core,this,i.name),this},_trigger:function(){var t=Array.prototype.slice.apply(arguments);return\"string\"==typeof t[0]&&(t[0]={type:t[0]}),this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,t),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,t),this},instances:function(i){var o=[];return t(i||\".tooltipstered\").each(function(){var i=t(this),e=i.data(\"tooltipster-ns\");e&&t.each(e,function(t,e){o.push(i.data(e))})}),o},instancesLatest:function(){return this.__instancesLatestArr},off:function(){return this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},origins:function(i){return t((i?i+\" \":\"\")+\".tooltipstered\").toArray()},setDefaults:function(o){return t.extend(i,o),this},triggerHandler:function(){return this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},t.tooltipster=new n,t.Tooltipster=function(i,o){this.__callbacks={close:[],open:[]},this.__closingTime,this.__Content,this.__contentBcr,this.__destroyed=!1,this.__$emitterPrivate=t({}),this.__$emitterPublic=t({}),this.__enabled=!0,this.__garbageCollector,this.__Geometry,this.__lastPosition,this.__namespace=\"tooltipster-\"+Math.round(1e6*Math.random()),this.__options,this.__$originParents,this.__pointerIsOverOrigin=!1,this.__previousThemes=[],this.__state=\"closed\",this.__timeouts={close:[],open:null},this.__touchEvents=[],this.__tracker=null,this._$origin,this._$tooltip,this.__init(i,o)},t.Tooltipster.prototype={__init:function(o,n){var s=this;if(s._$origin=t(o),s.__options=t.extend(!0,{},i,n),s.__optionsFormat(),!e.IE||e.IE>=s.__options.IEmin){var r=null;if(void 0===s._$origin.data(\"tooltipster-initialTitle\")&&(void 0===(r=s._$origin.attr(\"title\"))&&(r=null),s._$origin.data(\"tooltipster-initialTitle\",r)),null!==s.__options.content)s.__contentSet(s.__options.content);else{var _,a=s._$origin.attr(\"data-tooltip-content\");a&&(_=t(a)),_&&_[0]?s.__contentSet(_.first()):s.__contentSet(r)}s._$origin.removeAttr(\"title\").addClass(\"tooltipstered\"),s.__prepareOrigin(),s.__prepareGC(),t.each(s.__options.plugins,function(t,i){s._plug(i)}),e.hasTouchCapability&&t(e.window.document.body).on(\"touchmove.\"+s.__namespace+\"-triggerOpen\",function(t){s._touchRecordEvent(t)}),s._on(\"created\",function(){s.__prepareTooltip()})._on(\"repositioned\",function(t){s.__lastPosition=t.position})}else s.__options.disabled=!0},__contentInsert:function(){var t=this._$tooltip.find(\".tooltipster-content\"),i=this.__Content;return this._trigger({type:\"format\",content:this.__Content,format:function(t){i=t}}),this.__options.functionFormat&&(i=this.__options.functionFormat.call(this,this,{origin:this._$origin[0]},this.__Content)),\"string\"!=typeof i||this.__options.contentAsHTML?t.empty().append(i):t.text(i),this},__contentSet:function(i){return i instanceof t&&this.__options.contentCloning&&(i=i.clone(!0)),this.__Content=i,this._trigger({type:\"updated\",content:i}),this},__destroyError:function(){throw new Error(\"This tooltip has been destroyed and cannot execute your method call.\")},__geometry:function(){var i=this._$origin,o=this._$origin.is(\"area\");if(o){var n=this._$origin.parent().attr(\"name\");i=t('img[usemap=\"#'+n+'\"]')}var s=i[0].getBoundingClientRect(),r=t(e.window.document),_=t(e.window),a=i,l={available:{document:null,window:null},document:{size:{height:r.height(),width:r.width()}},window:{scroll:{left:e.window.scrollX||e.window.document.documentElement.scrollLeft,top:e.window.scrollY||e.window.document.documentElement.scrollTop},size:{height:_.height(),width:_.width()}},origin:{fixedLineage:!1,offset:{},size:{height:s.bottom-s.top,width:s.right-s.left},usemapImage:o?i[0]:null,windowOffset:{bottom:s.bottom,left:s.left,right:s.right,top:s.top}}};if(o){var p=this._$origin.attr(\"shape\"),c=this._$origin.attr(\"coords\");if(c&&(c=c.split(\",\"),t.map(c,function(t,i){c[i]=parseInt(t)})),\"default\"!=p)switch(p){case\"circle\":var h=c[0],d=c[1],u=c[2],g=d-u,f=h-u;l.origin.size.height=2*u,l.origin.size.width=l.origin.size.height,l.origin.windowOffset.left+=f,l.origin.windowOffset.top+=g;break;case\"rect\":var m=c[0],w=c[1],v=c[2],y=c[3];l.origin.size.height=y-w,l.origin.size.width=v-m,l.origin.windowOffset.left+=m,l.origin.windowOffset.top+=w;break;case\"poly\":for(var b=0,$=0,C=0,O=0,T=\"even\",z=0;z<c.length;z++){var E=c[z];\"even\"==T?(E>C&&(C=E,0===z&&(b=C)),E<b&&(b=E),T=\"odd\"):(E>O&&(O=E,1==z&&($=O)),E<$&&($=E),T=\"even\")}l.origin.size.height=O-$,l.origin.size.width=C-b,l.origin.windowOffset.left+=b,l.origin.windowOffset.top+=$}}for(this._trigger({type:\"geometry\",edit:function(t){l.origin.size.height=t.height,l.origin.windowOffset.left=t.left,l.origin.windowOffset.top=t.top,l.origin.size.width=t.width},geometry:{height:l.origin.size.height,left:l.origin.windowOffset.left,top:l.origin.windowOffset.top,width:l.origin.size.width}}),l.origin.windowOffset.right=l.origin.windowOffset.left+l.origin.size.width,l.origin.windowOffset.bottom=l.origin.windowOffset.top+l.origin.size.height,l.origin.offset.left=l.origin.windowOffset.left+l.window.scroll.left,l.origin.offset.top=l.origin.windowOffset.top+l.window.scroll.top,l.origin.offset.bottom=l.origin.offset.top+l.origin.size.height,l.origin.offset.right=l.origin.offset.left+l.origin.size.width,l.available.document={bottom:{height:l.document.size.height-l.origin.offset.bottom,width:l.document.size.width},left:{height:l.document.size.height,width:l.origin.offset.left},right:{height:l.document.size.height,width:l.document.size.width-l.origin.offset.right},top:{height:l.origin.offset.top,width:l.document.size.width}},l.available.window={bottom:{height:Math.max(l.window.size.height-Math.max(l.origin.windowOffset.bottom,0),0),width:l.window.size.width},left:{height:l.window.size.height,width:Math.max(l.origin.windowOffset.left,0)},right:{height:l.window.size.height,width:Math.max(l.window.size.width-Math.max(l.origin.windowOffset.right,0),0)},top:{height:Math.max(l.origin.windowOffset.top,0),width:l.window.size.width}};\"html\"!=a[0].tagName.toLowerCase();){if(\"fixed\"==a.css(\"position\")){l.origin.fixedLineage=!0;break}a=a.parent()}return l},__optionsFormat:function(){return\"number\"==typeof this.__options.animationDuration&&(this.__options.animationDuration=[this.__options.animationDuration,this.__options.animationDuration]),\"number\"==typeof this.__options.delay&&(this.__options.delay=[this.__options.delay,this.__options.delay]),\"number\"==typeof this.__options.delayTouch&&(this.__options.delayTouch=[this.__options.delayTouch,this.__options.delayTouch]),\"string\"==typeof this.__options.theme&&(this.__options.theme=[this.__options.theme]),null===this.__options.parent?this.__options.parent=t(e.window.document.body):\"string\"==typeof this.__options.parent&&(this.__options.parent=t(this.__options.parent)),\"hover\"==this.__options.trigger?(this.__options.triggerOpen={mouseenter:!0,touchstart:!0},this.__options.triggerClose={mouseleave:!0,originClick:!0,touchleave:!0}):\"click\"==this.__options.trigger&&(this.__options.triggerOpen={click:!0,tap:!0},this.__options.triggerClose={click:!0,tap:!0}),this._trigger(\"options\"),this},__prepareGC:function(){var i=this;return i.__options.selfDestruction?i.__garbageCollector=setInterval(function(){var o=(new Date).getTime();i.__touchEvents=t.grep(i.__touchEvents,function(t,i){return o-t.time>6e4}),_(i._$origin)||i.close(function(){i.destroy()})},2e4):clearInterval(i.__garbageCollector),i},__prepareOrigin:function(){var t=this;if(t._$origin.off(\".\"+t.__namespace+\"-triggerOpen\"),e.hasTouchCapability&&t._$origin.on(\"touchstart.\"+t.__namespace+\"-triggerOpen touchend.\"+t.__namespace+\"-triggerOpen touchcancel.\"+t.__namespace+\"-triggerOpen\",function(i){t._touchRecordEvent(i)}),t.__options.triggerOpen.click||t.__options.triggerOpen.tap&&e.hasTouchCapability){var i=\"\";t.__options.triggerOpen.click&&(i+=\"click.\"+t.__namespace+\"-triggerOpen \"),t.__options.triggerOpen.tap&&e.hasTouchCapability&&(i+=\"touchend.\"+t.__namespace+\"-triggerOpen\"),t._$origin.on(i,function(i){t._touchIsMeaningfulEvent(i)&&t._open(i)})}if(t.__options.triggerOpen.mouseenter||t.__options.triggerOpen.touchstart&&e.hasTouchCapability){i=\"\";t.__options.triggerOpen.mouseenter&&(i+=\"mouseenter.\"+t.__namespace+\"-triggerOpen \"),t.__options.triggerOpen.touchstart&&e.hasTouchCapability&&(i+=\"touchstart.\"+t.__namespace+\"-triggerOpen\"),t._$origin.on(i,function(i){!t._touchIsTouchEvent(i)&&t._touchIsEmulatedEvent(i)||(t.__pointerIsOverOrigin=!0,t._openShortly(i))})}if(t.__options.triggerClose.mouseleave||t.__options.triggerClose.touchleave&&e.hasTouchCapability){i=\"\";t.__options.triggerClose.mouseleave&&(i+=\"mouseleave.\"+t.__namespace+\"-triggerOpen \"),t.__options.triggerClose.touchleave&&e.hasTouchCapability&&(i+=\"touchend.\"+t.__namespace+\"-triggerOpen touchcancel.\"+t.__namespace+\"-triggerOpen\"),t._$origin.on(i,function(i){t._touchIsMeaningfulEvent(i)&&(t.__pointerIsOverOrigin=!1)})}return t},__prepareTooltip:function(){var i=this,o=i.__options.interactive?\"auto\":\"\";return i._$tooltip.attr(\"id\",i.__namespace).css({\"pointer-events\":o,zIndex:i.__options.zIndex}),t.each(i.__previousThemes,function(t,o){i._$tooltip.removeClass(o)}),t.each(i.__options.theme,function(t,o){i._$tooltip.addClass(o)}),i.__previousThemes=t.merge([],i.__options.theme),i},__scrollHandler:function(i){if(this.__options.triggerClose.scroll)this._close(i);else if(_(this._$origin)&&_(this._$tooltip)){var o=null;if(i.target===e.window.document)this.__Geometry.origin.fixedLineage||this.__options.repositionOnScroll&&this.reposition(i);else{o=this.__geometry();var n=!1;if(\"fixed\"!=this._$origin.css(\"position\")&&this.__$originParents.each(function(i,e){var s=t(e),r=s.css(\"overflow-x\"),_=s.css(\"overflow-y\");if(\"visible\"!=r||\"visible\"!=_){var a=e.getBoundingClientRect();if(\"visible\"!=r&&(o.origin.windowOffset.left<a.left||o.origin.windowOffset.right>a.right))return n=!0,!1;if(\"visible\"!=_&&(o.origin.windowOffset.top<a.top||o.origin.windowOffset.bottom>a.bottom))return n=!0,!1}if(\"fixed\"==s.css(\"position\"))return!1}),n)this._$tooltip.css(\"visibility\",\"hidden\");else if(this._$tooltip.css(\"visibility\",\"visible\"),this.__options.repositionOnScroll)this.reposition(i);else{var s=o.origin.offset.left-this.__Geometry.origin.offset.left,r=o.origin.offset.top-this.__Geometry.origin.offset.top;this._$tooltip.css({left:this.__lastPosition.coord.left+s,top:this.__lastPosition.coord.top+r})}}this._trigger({type:\"scroll\",event:i,geo:o})}return this},__stateSet:function(t){return this.__state=t,this._trigger({type:\"state\",state:t}),this},__timeoutsClear:function(){return clearTimeout(this.__timeouts.open),this.__timeouts.open=null,t.each(this.__timeouts.close,function(t,i){clearTimeout(i)}),this.__timeouts.close=[],this},__trackerStart:function(){var t=this,i=t._$tooltip.find(\".tooltipster-content\");return t.__options.trackTooltip&&(t.__contentBcr=i[0].getBoundingClientRect()),t.__tracker=setInterval(function(){if(_(t._$origin)&&_(t._$tooltip)){if(t.__options.trackOrigin){var o=t.__geometry(),e=!1;r(o.origin.size,t.__Geometry.origin.size)&&(t.__Geometry.origin.fixedLineage?r(o.origin.windowOffset,t.__Geometry.origin.windowOffset)&&(e=!0):r(o.origin.offset,t.__Geometry.origin.offset)&&(e=!0)),e||(t.__options.triggerClose.mouseleave?t._close():t.reposition())}if(t.__options.trackTooltip){var n=i[0].getBoundingClientRect();n.height===t.__contentBcr.height&&n.width===t.__contentBcr.width||(t.reposition(),t.__contentBcr=n)}}else t._close()},t.__options.trackerInterval),t},_close:function(i,o,n){var s=this,r=!0;if(s._trigger({type:\"close\",event:i,stop:function(){r=!1}}),r||n){o&&s.__callbacks.close.push(o),s.__callbacks.open=[],s.__timeoutsClear();var _=function(){t.each(s.__callbacks.close,function(t,o){o.call(s,s,{event:i,origin:s._$origin[0]})}),s.__callbacks.close=[]};if(\"closed\"!=s.__state){var a=!0,l=(new Date).getTime()+s.__options.animationDuration[1];if(\"disappearing\"==s.__state&&l>s.__closingTime&&s.__options.animationDuration[1]>0&&(a=!1),a){s.__closingTime=l,\"disappearing\"!=s.__state&&s.__stateSet(\"disappearing\");var p=function(){clearInterval(s.__tracker),s._trigger({type:\"closing\",event:i}),s._$tooltip.off(\".\"+s.__namespace+\"-triggerClose\").removeClass(\"tooltipster-dying\"),t(e.window).off(\".\"+s.__namespace+\"-triggerClose\"),s.__$originParents.each(function(i,o){t(o).off(\"scroll.\"+s.__namespace+\"-triggerClose\")}),s.__$originParents=null,t(e.window.document.body).off(\".\"+s.__namespace+\"-triggerClose\"),s._$origin.off(\".\"+s.__namespace+\"-triggerClose\"),s._off(\"dismissable\"),s.__stateSet(\"closed\"),s._trigger({type:\"after\",event:i}),s.__options.functionAfter&&s.__options.functionAfter.call(s,s,{event:i,origin:s._$origin[0]}),_()};e.hasTransitions?(s._$tooltip.css({\"-moz-animation-duration\":s.__options.animationDuration[1]+\"ms\",\"-ms-animation-duration\":s.__options.animationDuration[1]+\"ms\",\"-o-animation-duration\":s.__options.animationDuration[1]+\"ms\",\"-webkit-animation-duration\":s.__options.animationDuration[1]+\"ms\",\"animation-duration\":s.__options.animationDuration[1]+\"ms\",\"transition-duration\":s.__options.animationDuration[1]+\"ms\"}),s._$tooltip.clearQueue().removeClass(\"tooltipster-show\").addClass(\"tooltipster-dying\"),s.__options.animationDuration[1]>0&&s._$tooltip.delay(s.__options.animationDuration[1]),s._$tooltip.queue(p)):s._$tooltip.stop().fadeOut(s.__options.animationDuration[1],p)}}else _()}return s},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_open:function(i,o){var n=this;if(!n.__destroying&&_(n._$origin)&&n.__enabled){var s=!0;if(\"closed\"==n.__state&&(n._trigger({type:\"before\",event:i,stop:function(){s=!1}}),s&&n.__options.functionBefore&&(s=n.__options.functionBefore.call(n,n,{event:i,origin:n._$origin[0]}))),!1!==s&&null!==n.__Content){o&&n.__callbacks.open.push(o),n.__callbacks.close=[],n.__timeoutsClear();var r,a=function(){\"stable\"!=n.__state&&n.__stateSet(\"stable\"),t.each(n.__callbacks.open,function(t,i){i.call(n,n,{origin:n._$origin[0],tooltip:n._$tooltip[0]})}),n.__callbacks.open=[]};if(\"closed\"!==n.__state)r=0,\"disappearing\"===n.__state?(n.__stateSet(\"appearing\"),e.hasTransitions?(n._$tooltip.clearQueue().removeClass(\"tooltipster-dying\").addClass(\"tooltipster-show\"),n.__options.animationDuration[0]>0&&n._$tooltip.delay(n.__options.animationDuration[0]),n._$tooltip.queue(a)):n._$tooltip.stop().fadeIn(a)):\"stable\"==n.__state&&a();else{if(n.__stateSet(\"appearing\"),r=n.__options.animationDuration[0],n.__contentInsert(),n.reposition(i,!0),e.hasTransitions?(n._$tooltip.addClass(\"tooltipster-\"+n.__options.animation).addClass(\"tooltipster-initial\").css({\"-moz-animation-duration\":n.__options.animationDuration[0]+\"ms\",\"-ms-animation-duration\":n.__options.animationDuration[0]+\"ms\",\"-o-animation-duration\":n.__options.animationDuration[0]+\"ms\",\"-webkit-animation-duration\":n.__options.animationDuration[0]+\"ms\",\"animation-duration\":n.__options.animationDuration[0]+\"ms\",\"transition-duration\":n.__options.animationDuration[0]+\"ms\"}),setTimeout(function(){\"closed\"!=n.__state&&(n._$tooltip.addClass(\"tooltipster-show\").removeClass(\"tooltipster-initial\"),n.__options.animationDuration[0]>0&&n._$tooltip.delay(n.__options.animationDuration[0]),n._$tooltip.queue(a))},0)):n._$tooltip.css(\"display\",\"none\").fadeIn(n.__options.animationDuration[0],a),n.__trackerStart(),t(e.window).on(\"resize.\"+n.__namespace+\"-triggerClose\",function(i){var o=t(document.activeElement);(o.is(\"input\")||o.is(\"textarea\"))&&t.contains(n._$tooltip[0],o[0])||n.reposition(i)}).on(\"scroll.\"+n.__namespace+\"-triggerClose\",function(t){n.__scrollHandler(t)}),n.__$originParents=n._$origin.parents(),n.__$originParents.each(function(i,o){t(o).on(\"scroll.\"+n.__namespace+\"-triggerClose\",function(t){n.__scrollHandler(t)})}),n.__options.triggerClose.mouseleave||n.__options.triggerClose.touchleave&&e.hasTouchCapability){n._on(\"dismissable\",function(t){t.dismissable?t.delay?(h=setTimeout(function(){n._close(t.event)},t.delay),n.__timeouts.close.push(h)):n._close(t):clearTimeout(h)});var l=n._$origin,p=\"\",c=\"\",h=null;n.__options.interactive&&(l=l.add(n._$tooltip)),n.__options.triggerClose.mouseleave&&(p+=\"mouseenter.\"+n.__namespace+\"-triggerClose \",c+=\"mouseleave.\"+n.__namespace+\"-triggerClose \"),n.__options.triggerClose.touchleave&&e.hasTouchCapability&&(p+=\"touchstart.\"+n.__namespace+\"-triggerClose\",c+=\"touchend.\"+n.__namespace+\"-triggerClose touchcancel.\"+n.__namespace+\"-triggerClose\"),l.on(c,function(t){if(n._touchIsTouchEvent(t)||!n._touchIsEmulatedEvent(t)){var i=\"mouseleave\"==t.type?n.__options.delay:n.__options.delayTouch;n._trigger({delay:i[1],dismissable:!0,event:t,type:\"dismissable\"})}}).on(p,function(t){!n._touchIsTouchEvent(t)&&n._touchIsEmulatedEvent(t)||n._trigger({dismissable:!1,event:t,type:\"dismissable\"})})}n.__options.triggerClose.originClick&&n._$origin.on(\"click.\"+n.__namespace+\"-triggerClose\",function(t){n._touchIsTouchEvent(t)||n._touchIsEmulatedEvent(t)||n._close(t)}),(n.__options.triggerClose.click||n.__options.triggerClose.tap&&e.hasTouchCapability)&&setTimeout(function(){if(\"closed\"!=n.__state){var i=\"\",o=t(e.window.document.body);n.__options.triggerClose.click&&(i+=\"click.\"+n.__namespace+\"-triggerClose \"),n.__options.triggerClose.tap&&e.hasTouchCapability&&(i+=\"touchend.\"+n.__namespace+\"-triggerClose\"),o.on(i,function(i){n._touchIsMeaningfulEvent(i)&&(n._touchRecordEvent(i),n.__options.interactive&&t.contains(n._$tooltip[0],i.target)||n._close(i))}),n.__options.triggerClose.tap&&e.hasTouchCapability&&o.on(\"touchstart.\"+n.__namespace+\"-triggerClose\",function(t){n._touchRecordEvent(t)})}},0),n._trigger(\"ready\"),n.__options.functionReady&&n.__options.functionReady.call(n,n,{origin:n._$origin[0],tooltip:n._$tooltip[0]})}if(n.__options.timer>0){h=setTimeout(function(){n._close()},n.__options.timer+r);n.__timeouts.close.push(h)}}}return n},_openShortly:function(t){var i=this,o=!0;if(\"stable\"!=i.__state&&\"appearing\"!=i.__state&&!i.__timeouts.open&&(i._trigger({type:\"start\",event:t,stop:function(){o=!1}}),o)){var e=0==t.type.indexOf(\"touch\")?i.__options.delayTouch:i.__options.delay;e[0]?i.__timeouts.open=setTimeout(function(){i.__timeouts.open=null,i.__pointerIsOverOrigin&&i._touchIsMeaningfulEvent(t)?(i._trigger(\"startend\"),i._open(t)):i._trigger(\"startcancel\")},e[0]):(i._trigger(\"startend\"),i._open(t))}return i},_optionsExtract:function(i,o){var e=this,n=t.extend(!0,{},o),s=e.__options[i];return s||(s={},t.each(o,function(t,i){var o=e.__options[t];void 0!==o&&(s[t]=o)})),t.each(n,function(i,o){void 0!==s[i]&&(\"object\"!=typeof o||o instanceof Array||null==o||\"object\"!=typeof s[i]||s[i]instanceof Array||null==s[i]?n[i]=s[i]:t.extend(n[i],s[i]))}),n},_plug:function(i){var o=t.tooltipster._plugin(i);if(!o)throw new Error('The \"'+i+'\" plugin is not defined');return o.instance&&t.tooltipster.__bridge(o.instance,this,o.name),this},_touchIsEmulatedEvent:function(t){for(var i=!1,o=(new Date).getTime(),e=this.__touchEvents.length-1;e>=0;e--){var n=this.__touchEvents[e];if(!(o-n.time<500))break;n.target===t.target&&(i=!0)}return i},_touchIsMeaningfulEvent:function(t){return this._touchIsTouchEvent(t)&&!this._touchSwiped(t.target)||!this._touchIsTouchEvent(t)&&!this._touchIsEmulatedEvent(t)},_touchIsTouchEvent:function(t){return 0==t.type.indexOf(\"touch\")},_touchRecordEvent:function(t){return this._touchIsTouchEvent(t)&&(t.time=(new Date).getTime(),this.__touchEvents.push(t)),this},_touchSwiped:function(t){for(var i=!1,o=this.__touchEvents.length-1;o>=0;o--){var e=this.__touchEvents[o];if(\"touchmove\"==e.type){i=!0;break}if(\"touchstart\"==e.type&&t===e.target)break}return i},_trigger:function(){var i=Array.prototype.slice.apply(arguments);return\"string\"==typeof i[0]&&(i[0]={type:i[0]}),i[0].instance=this,i[0].origin=this._$origin?this._$origin[0]:null,i[0].tooltip=this._$tooltip?this._$tooltip[0]:null,this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,i),t.tooltipster._trigger.apply(t.tooltipster,i),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,i),this},_unplug:function(i){var o=this;if(o[i]){var e=t.tooltipster._plugin(i);e.instance&&t.each(e.instance,function(t,e){o[t]&&o[t].bridged===o[i]&&delete o[t]}),o[i].__destroy&&o[i].__destroy(),delete o[i]}return o},close:function(t){return this.__destroyed?this.__destroyError():this._close(null,t),this},content:function(t){var i=this;if(void 0===t)return i.__Content;if(i.__destroyed)i.__destroyError();else if(i.__contentSet(t),null!==i.__Content){if(\"closed\"!==i.__state&&(i.__contentInsert(),i.reposition(),i.__options.updateAnimation))if(e.hasTransitions){var o=i.__options.updateAnimation;i._$tooltip.addClass(\"tooltipster-update-\"+o),setTimeout(function(){\"closed\"!=i.__state&&i._$tooltip.removeClass(\"tooltipster-update-\"+o)},1e3)}else i._$tooltip.fadeTo(200,.5,function(){\"closed\"!=i.__state&&i._$tooltip.fadeTo(200,1)})}else i._close();return i},destroy:function(){var i=this;if(i.__destroyed)i.__destroyError();else{\"closed\"!=i.__state?i.option(\"animationDuration\",0)._close(null,null,!0):i.__timeoutsClear(),i._trigger(\"destroy\"),i.__destroyed=!0,i._$origin.removeData(i.__namespace).off(\".\"+i.__namespace+\"-triggerOpen\"),t(e.window.document.body).off(\".\"+i.__namespace+\"-triggerOpen\");var o=i._$origin.data(\"tooltipster-ns\");if(o)if(1===o.length){var n=null;\"previous\"==i.__options.restoration?n=i._$origin.data(\"tooltipster-initialTitle\"):\"current\"==i.__options.restoration&&(n=\"string\"==typeof i.__Content?i.__Content:t(\"<div></div>\").append(i.__Content).html()),n&&i._$origin.attr(\"title\",n),i._$origin.removeClass(\"tooltipstered\"),i._$origin.removeData(\"tooltipster-ns\").removeData(\"tooltipster-initialTitle\")}else o=t.grep(o,function(t,o){return t!==i.__namespace}),i._$origin.data(\"tooltipster-ns\",o);i._trigger(\"destroyed\"),i._off(),i.off(),i.__Content=null,i.__$emitterPrivate=null,i.__$emitterPublic=null,i.__options.parent=null,i._$origin=null,i._$tooltip=null,t.tooltipster.__instancesLatestArr=t.grep(t.tooltipster.__instancesLatestArr,function(t,o){return i!==t}),clearInterval(i.__garbageCollector)}return i},disable:function(){return this.__destroyed?(this.__destroyError(),this):(this._close(),this.__enabled=!1,this)},elementOrigin:function(){if(!this.__destroyed)return this._$origin[0];this.__destroyError()},elementTooltip:function(){return this._$tooltip?this._$tooltip[0]:null},enable:function(){return this.__enabled=!0,this},hide:function(t){return this.close(t)},instance:function(){return this},off:function(){return this.__destroyed||this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},open:function(t){return this.__destroyed?this.__destroyError():this._open(null,t),this},option:function(i,o){return void 0===o?this.__options[i]:(this.__destroyed?this.__destroyError():(this.__options[i]=o,this.__optionsFormat(),t.inArray(i,[\"trigger\",\"triggerClose\",\"triggerOpen\"])>=0&&this.__prepareOrigin(),\"selfDestruction\"===i&&this.__prepareGC()),this)},reposition:function(t,i){return this.__destroyed?this.__destroyError():\"closed\"!=this.__state&&_(this._$origin)&&(i||_(this._$tooltip))&&(i||this._$tooltip.detach(),this.__Geometry=this.__geometry(),this._trigger({type:\"reposition\",event:t,helper:{geo:this.__Geometry}})),this},show:function(t){return this.open(t)},status:function(){return{destroyed:this.__destroyed,enabled:this.__enabled,open:\"closed\"!==this.__state,state:this.__state}},triggerHandler:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},t.fn.tooltipster=function(){var o=Array.prototype.slice.apply(arguments),e=\"You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE.\";if(0===this.length)return this;if(\"string\"==typeof o[0]){var n=\"#*$~&\";return this.each(function(){var i=t(this).data(\"tooltipster-ns\"),s=i?t(this).data(i[0]):null;if(!s)throw new Error(\"You called Tooltipster's \\\"\"+o[0]+'\" method on an uninitialized element');if(\"function\"!=typeof s[o[0]])throw new Error('Unknown method \"'+o[0]+'\"');this.length>1&&\"content\"==o[0]&&(o[1]instanceof t||\"object\"==typeof o[1]&&null!=o[1]&&o[1].tagName)&&!s.__options.contentCloning&&s.__options.debug&&console.log(e);var r=s[o[0]](o[1],o[2]);if(r!==s||\"instance\"===o[0])return n=r,!1}),\"#*$~&\"!==n?n:this}t.tooltipster.__instancesLatestArr=[];var s=o[0]&&void 0!==o[0].multiple,r=s&&o[0].multiple||!s&&i.multiple,_=o[0]&&void 0!==o[0].content,a=_&&o[0].content||!_&&i.content,l=o[0]&&void 0!==o[0].contentCloning,p=l&&o[0].contentCloning||!l&&i.contentCloning,c=o[0]&&void 0!==o[0].debug,h=c&&o[0].debug||!c&&i.debug;return this.length>1&&(a instanceof t||\"object\"==typeof a&&null!=a&&a.tagName)&&!p&&h&&console.log(e),this.each(function(){var i=!1,e=t(this),n=e.data(\"tooltipster-ns\"),s=null;n?r?i=!0:h&&(console.log(\"Tooltipster: one or more tooltips are already attached to the element below. Ignoring.\"),console.log(this)):i=!0,i&&(s=new t.Tooltipster(this,o[0]),n||(n=[]),n.push(s.__namespace),e.data(\"tooltipster-ns\",n),e.data(s.__namespace,s),s.__options.functionInit&&s.__options.functionInit.call(s,s,{origin:this}),s._trigger(\"init\")),t.tooltipster.__instancesLatestArr.push(s)}),this},s.prototype={__init:function(i){this.__$tooltip=i,this.__$tooltip.css({left:0,overflow:\"hidden\",position:\"absolute\",top:0}).find(\".tooltipster-content\").css(\"overflow\",\"auto\"),this.$container=t('<div class=\"tooltipster-ruler\"></div>').append(this.__$tooltip).appendTo(e.window.document.body)},__forceRedraw:function(){var t=this.__$tooltip.parent();this.__$tooltip.detach(),this.__$tooltip.appendTo(t)},constrain:function(t,i){return this.constraints={width:t,height:i},this.__$tooltip.css({display:\"block\",height:\"\",overflow:\"auto\",width:t}),this},destroy:function(){this.__$tooltip.detach().find(\".tooltipster-content\").css({display:\"\",overflow:\"\"}),this.$container.remove()},free:function(){return this.constraints=null,this.__$tooltip.css({display:\"\",height:\"\",overflow:\"visible\",width:\"\"}),this},measure:function(){this.__forceRedraw();var t=this.__$tooltip[0].getBoundingClientRect(),i={size:{height:t.height||t.bottom-t.top,width:t.width||t.right-t.left}};if(this.constraints){var o=this.__$tooltip.find(\".tooltipster-content\"),n=this.__$tooltip.outerHeight(),s=o[0].getBoundingClientRect(),r={height:n<=this.constraints.height,width:t.width<=this.constraints.width&&s.width>=o[0].scrollWidth-1};i.fits=r.height&&r.width}return e.IE&&e.IE<=11&&i.size.width!==e.window.document.documentElement.clientWidth&&(i.size.width=Math.ceil(i.size.width)+1),i}};var a=navigator.userAgent.toLowerCase();-1!=a.indexOf(\"msie\")?e.IE=parseInt(a.split(\"msie\")[1]):-1!==a.toLowerCase().indexOf(\"trident\")&&-1!==a.indexOf(\" rv:11\")?e.IE=11:-1!=a.toLowerCase().indexOf(\"edge/\")&&(e.IE=parseInt(a.toLowerCase().split(\"edge/\")[1]));return t.tooltipster._plugin({name:\"tooltipster.sideTip\",instance:{__defaults:function(){return{arrow:!0,distance:6,functionPosition:null,maxWidth:null,minIntersection:16,minWidth:0,position:null,side:\"top\",viewportAware:!0,defaultStyles:{backgroundColor:\"#fff\",textColor:\"#000\"}}},__init:function(t){var i=this;i.__instance=t,i.__namespace=\"tooltipster-sideTip-\"+Math.round(1e6*Math.random()),i.__previousState=\"closed\",i.__options,i.__optionsFormat(),i.__instance._on(\"state.\"+i.__namespace,function(t){\"closed\"==t.state?i.__close():\"appearing\"==t.state&&\"closed\"==i.__previousState&&i.__create(),i.__previousState=t.state}),i.__instance._on(\"options.\"+i.__namespace,function(){i.__optionsFormat()}),i.__instance._on(\"reposition.\"+i.__namespace,function(t){i.__reposition(t.event,t.helper)})},__close:function(){this.__instance.content()instanceof t&&this.__instance.content().detach(),this.__instance._$tooltip.remove(),this.__instance._$tooltip=null},__create:function(){var i=this.__instance.__options.styles,o=t('<div class=\"tooltipster-base tooltipster-sidetip\"><div class=\"tooltipster-box\"><div class=\"tooltipster-content\"></div></div><div class=\"tooltipster-arrow\"><div class=\"tooltipster-arrow-uncropped\"><div class=\"tooltipster-arrow-border\"></div><div class=\"tooltipster-arrow-background\"></div></div></div></div>');o.find(\".tooltipster-box\").css({color:i.textColor?i.textColor:this.__options.defaultStyles.textColor,backgroundColor:i.backgroundColor?i.backgroundColor:this.__options.defaultStyles.backgroundColor}),o.find(\".tooltipster-arrow-border\").css({backgroundColor:i.backgroundColor?i.backgroundColor:this.__options.defaultStyles.backgroundColor}),this.__options.arrow||o.find(\".tooltipster-box\").css(\"margin\",0).end().find(\".tooltipster-arrow\").hide(),this.__options.minWidth&&o.css(\"min-width\",this.__options.minWidth+\"px\"),this.__options.maxWidth&&o.css(\"max-width\",this.__options.maxWidth+\"px\"),this.__instance._$tooltip=o,this.__instance._trigger(\"created\")},__destroy:function(){this.__instance._off(\".\"+self.__namespace)},__optionsFormat:function(){if(this.__options=this.__instance._optionsExtract(\"tooltipster.sideTip\",this.__defaults()),this.__options.position&&(this.__options.side=this.__options.position),\"object\"!=typeof this.__options.distance&&(this.__options.distance=[this.__options.distance]),this.__options.distance.length<4&&(void 0===this.__options.distance[1]&&(this.__options.distance[1]=this.__options.distance[0]),void 0===this.__options.distance[2]&&(this.__options.distance[2]=this.__options.distance[0]),void 0===this.__options.distance[3]&&(this.__options.distance[3]=this.__options.distance[1])),this.__options.distance={top:this.__options.distance[0],right:this.__options.distance[1],bottom:this.__options.distance[2],left:this.__options.distance[3]},\"string\"==typeof this.__options.side){this.__options.side=[this.__options.side,{top:\"bottom\",right:\"left\",bottom:\"top\",left:\"right\"}[this.__options.side]],\"left\"==this.__options.side[0]||\"right\"==this.__options.side[0]?this.__options.side.push(\"top\",\"bottom\"):this.__options.side.push(\"right\",\"left\")}6===t.tooltipster._env.IE&&!0!==this.__options.arrow&&(this.__options.arrow=!1)},__reposition:function(i,o){var e,n=this,s=n.__targetFind(o),r=[];n.__instance._$tooltip.detach();var _=n.__instance._$tooltip.clone(),a=t.tooltipster._getRuler(_),l=!1,p=n.__instance.option(\"animation\");switch(p&&_.removeClass(\"tooltipster-\"+p),t.each([\"window\",\"document\"],function(e,p){var c=null;if(n.__instance._trigger({container:p,helper:o,satisfied:l,takeTest:function(t){c=t},results:r,type:\"positionTest\"}),1==c||0!=c&&0==l&&(\"window\"!=p||n.__options.viewportAware))for(e=0;e<n.__options.side.length;e++){var h={horizontal:0,vertical:0},d=n.__options.side[e];\"top\"==d||\"bottom\"==d?h.vertical=n.__options.distance[d]:h.horizontal=n.__options.distance[d],n.__sideChange(_,d),t.each([\"natural\",\"constrained\"],function(t,e){if(c=null,n.__instance._trigger({container:p,event:i,helper:o,mode:e,results:r,satisfied:l,side:d,takeTest:function(t){c=t},type:\"positionTest\"}),1==c||0!=c&&0==l){var _={container:p,distance:h,fits:null,mode:e,outerSize:null,side:d,size:null,target:s[d],whole:null},u=(\"natural\"==e?a.free():a.constrain(o.geo.available[p][d].width-h.horizontal,o.geo.available[p][d].height-h.vertical)).measure();if(_.size=u.size,_.outerSize={height:u.size.height+h.vertical,width:u.size.width+h.horizontal},\"natural\"==e?o.geo.available[p][d].width>=_.outerSize.width&&o.geo.available[p][d].height>=_.outerSize.height?_.fits=!0:_.fits=!1:_.fits=u.fits,\"window\"==p&&(_.fits?_.whole=\"top\"==d||\"bottom\"==d?o.geo.origin.windowOffset.right>=n.__options.minIntersection&&o.geo.window.size.width-o.geo.origin.windowOffset.left>=n.__options.minIntersection:o.geo.origin.windowOffset.bottom>=n.__options.minIntersection&&o.geo.window.size.height-o.geo.origin.windowOffset.top>=n.__options.minIntersection:_.whole=!1),r.push(_),_.whole)l=!0;else if(\"natural\"==_.mode&&(_.fits||_.size.width<=o.geo.available[p][d].width))return!1}})}}),n.__instance._trigger({edit:function(t){r=t},event:i,helper:o,results:r,type:\"positionTested\"}),r.sort(function(t,i){return t.whole&&!i.whole?-1:!t.whole&&i.whole?1:t.whole&&i.whole?(o=n.__options.side.indexOf(t.side))<(e=n.__options.side.indexOf(i.side))?-1:o>e?1:\"natural\"==t.mode?-1:1:t.fits&&!i.fits?-1:!t.fits&&i.fits?1:t.fits&&i.fits?(o=n.__options.side.indexOf(t.side))<(e=n.__options.side.indexOf(i.side))?-1:o>e?1:\"natural\"==t.mode?-1:1:\"document\"==t.container&&\"bottom\"==t.side&&\"natural\"==t.mode?-1:1;var o,e}),(e=r[0]).coord={},e.side){case\"left\":case\"right\":e.coord.top=Math.floor(e.target-e.size.height/2);break;case\"bottom\":case\"top\":e.coord.left=Math.floor(e.target-e.size.width/2)}switch(e.side){case\"left\":e.coord.left=o.geo.origin.windowOffset.left-e.outerSize.width;break;case\"right\":e.coord.left=o.geo.origin.windowOffset.right+e.distance.horizontal;break;case\"top\":e.coord.top=o.geo.origin.windowOffset.top-e.outerSize.height;break;case\"bottom\":e.coord.top=o.geo.origin.windowOffset.bottom+e.distance.vertical}\"window\"==e.container?\"top\"==e.side||\"bottom\"==e.side?e.coord.left<0?o.geo.origin.windowOffset.right-this.__options.minIntersection>=0?e.coord.left=0:e.coord.left=o.geo.origin.windowOffset.right-this.__options.minIntersection-1:e.coord.left>o.geo.window.size.width-e.size.width&&(o.geo.origin.windowOffset.left+this.__options.minIntersection<=o.geo.window.size.width?e.coord.left=o.geo.window.size.width-e.size.width:e.coord.left=o.geo.origin.windowOffset.left+this.__options.minIntersection+1-e.size.width):e.coord.top<0?o.geo.origin.windowOffset.bottom-this.__options.minIntersection>=0?e.coord.top=0:e.coord.top=o.geo.origin.windowOffset.bottom-this.__options.minIntersection-1:e.coord.top>o.geo.window.size.height-e.size.height&&(o.geo.origin.windowOffset.top+this.__options.minIntersection<=o.geo.window.size.height?e.coord.top=o.geo.window.size.height-e.size.height:e.coord.top=o.geo.origin.windowOffset.top+this.__options.minIntersection+1-e.size.height):(e.coord.left>o.geo.window.size.width-e.size.width&&(e.coord.left=o.geo.window.size.width-e.size.width),e.coord.left<0&&(e.coord.left=0)),n.__sideChange(_,e.side),o.tooltipClone=_[0],o.tooltipParent=n.__instance.option(\"parent\").parent[0],o.mode=e.mode,o.whole=e.whole,o.origin=n.__instance._$origin[0],o.tooltip=n.__instance._$tooltip[0],delete e.container,delete e.fits,delete e.mode,delete e.outerSize,delete e.whole,e.distance=e.distance.horizontal||e.distance.vertical;var c,h,d,u=t.extend(!0,{},e);if(n.__instance._trigger({edit:function(t){e=t},event:i,helper:o,position:u,type:\"position\"}),n.__options.functionPosition){var g=n.__options.functionPosition.call(n,n.__instance,o,u);g&&(e=g)}a.destroy(),\"top\"==e.side||\"bottom\"==e.side?(c={prop:\"left\",val:e.target-e.coord.left},h=e.size.width-this.__options.minIntersection):(c={prop:\"top\",val:e.target-e.coord.top},h=e.size.height-this.__options.minIntersection),c.val<this.__options.minIntersection?c.val=this.__options.minIntersection:c.val>h&&(c.val=h),d=o.geo.origin.fixedLineage?o.geo.origin.windowOffset:{left:o.geo.origin.windowOffset.left+o.geo.window.scroll.left,top:o.geo.origin.windowOffset.top+o.geo.window.scroll.top},e.coord={left:d.left+(e.coord.left-o.geo.origin.windowOffset.left),top:d.top+(e.coord.top-o.geo.origin.windowOffset.top)},n.__sideChange(n.__instance._$tooltip,e.side),o.geo.origin.fixedLineage?n.__instance._$tooltip.css(\"position\",\"fixed\"):n.__instance._$tooltip.css(\"position\",\"\"),n.__instance._$tooltip.css({left:e.coord.left,top:e.coord.top,height:e.size.height,width:e.size.width}).find(\".tooltipster-arrow\").css({left:\"\",top:\"\"}).css(c.prop,c.val),n.__instance._$tooltip.appendTo(n.__instance.option(\"parent\")),n.__instance._trigger({type:\"repositioned\",event:i,position:e})},__sideChange:function(t,i){t.removeClass(\"tooltipster-bottom\").removeClass(\"tooltipster-left\").removeClass(\"tooltipster-right\").removeClass(\"tooltipster-top\").addClass(\"tooltipster-\"+i)},__targetFind:function(t){var i={},o=this.__instance._$origin[0].getClientRects();o.length>1&&(1==this.__instance._$origin.css(\"opacity\")&&(this.__instance._$origin.css(\"opacity\",.99),o=this.__instance._$origin[0].getClientRects(),this.__instance._$origin.css(\"opacity\",1)));if(o.length<2)i.top=Math.floor(t.geo.origin.windowOffset.left+t.geo.origin.size.width/2),i.bottom=i.top,i.left=Math.floor(t.geo.origin.windowOffset.top+t.geo.origin.size.height/2),i.right=i.left;else{var e=o[0];i.top=Math.floor(e.left+(e.right-e.left)/2),e=o.length>2?o[Math.ceil(o.length/2)-1]:o[0],i.right=Math.floor(e.top+(e.bottom-e.top)/2),e=o[o.length-1],i.bottom=Math.floor(e.left+(e.right-e.left)/2),e=o.length>2?o[Math.ceil((o.length+1)/2)-1]:o[o.length-1],i.left=Math.floor(e.top+(e.bottom-e.top)/2)}return i}}}),t});\n","Staempfli_CheckoutNewsletterSubscription/js/model/newsletter-validator.js":"define(\n    [\n        'jquery',\n        'Magento_Customer/js/model/customer',\n        'Magento_Checkout/js/model/quote',\n        'Magento_Checkout/js/model/url-builder',\n        'Magento_Checkout/js/model/error-processor',\n        'mage/url'\n\n    ],\n    function ($, customer, quote, urlBuilder, errorProcessor, urlFormatter) {\n        'use strict';\n\n        return {\n            validate: function () {\n                var isCustomer = customer.isLoggedIn();\n                var status = $('#newsletter-subscription').is(':checked');\n                var quoteId = quote.getQuoteId();\n                var url;\n\n                if (isCustomer) {\n                    url = urlBuilder.createUrl('/carts/mine/newsletter-subscribe', {})\n                } else {\n                    url = urlBuilder.createUrl('/guest-carts/:cartId/newsletter-subscribe', {cartId: quoteId});\n                }\n\n                var payload = {\n                    cartId: quoteId,\n                    newsletterSubscription: {\n                        subscribe: status\n                    }\n                };\n\n                if (!payload.newsletterSubscription.subscribe) {\n                    return true;\n                }\n\n                var result = true;\n\n                $.ajax({\n                    url: urlFormatter.build(url),\n                    data: JSON.stringify(payload),\n                    global: false,\n                    contentType: 'application/json',\n                    type: 'PUT',\n                    async: false\n                }).done(\n                    function () {\n                        result = true;\n                    }\n                ).fail(\n                    function (response) {\n                        result = false;\n                        errorProcessor.process(response);\n                    }\n                );\n                return result;\n            }\n        };\n    }\n);","Staempfli_CheckoutNewsletterSubscription/js/view/newsletter-validator.js":"define(\n    [\n        'uiComponent',\n        'Magento_Checkout/js/model/payment/additional-validators',\n        'Staempfli_CheckoutNewsletterSubscription/js/model/newsletter-validator'\n    ],\n    function (Component, additionalValidators, newsletterValidator) {\n        'use strict';\n\n        additionalValidators.registerValidator(newsletterValidator);\n\n        return Component.extend({});\n    }\n);","Staempfli_CheckoutNewsletterSubscription/js/view/newsletter.js":"define([\n    'ko',\n    'jquery',\n    'uiComponent'\n], function (ko, $, Component) {\n    'use strict';\n    return Component.extend({\n        defaults: {\n            template: 'Staempfli_CheckoutNewsletterSubscription/newsletter'\n        }\n    });\n});\n","Magento_OfflinePayments/js/view/payment/offline-payments.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* @api */\ndefine([\n    'uiComponent',\n    'Magento_Checkout/js/model/payment/renderer-list'\n], function (Component, rendererList) {\n    'use strict';\n\n    rendererList.push(\n        {\n            type: 'checkmo',\n            component: 'Magento_OfflinePayments/js/view/payment/method-renderer/checkmo-method'\n        },\n        {\n            type: 'banktransfer',\n            component: 'Magento_OfflinePayments/js/view/payment/method-renderer/banktransfer-method'\n        },\n        {\n            type: 'cashondelivery',\n            component: 'Magento_OfflinePayments/js/view/payment/method-renderer/cashondelivery-method'\n        },\n        {\n            type: 'purchaseorder',\n            component: 'Magento_OfflinePayments/js/view/payment/method-renderer/purchaseorder-method'\n        }\n    );\n\n    /** Add view logic here if needed */\n    return Component.extend({});\n});\n","Magento_OfflinePayments/js/view/payment/method-renderer/purchaseorder-method.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* @api */\ndefine([\n    'Magento_Checkout/js/view/payment/default',\n    'jquery',\n    'mage/validation'\n], function (Component, $) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            template: 'Magento_OfflinePayments/payment/purchaseorder-form',\n            purchaseOrderNumber: ''\n        },\n\n        /** @inheritdoc */\n        initObservable: function () {\n            this._super()\n                .observe('purchaseOrderNumber');\n\n            return this;\n        },\n\n        /**\n         * @return {Object}\n         */\n        getData: function () {\n            return {\n                method: this.item.method,\n                'po_number': this.purchaseOrderNumber(),\n                'additional_data': null\n            };\n        },\n\n        /**\n         * @return {jQuery}\n         */\n        validate: function () {\n            var form = 'form[data-role=purchaseorder-form]';\n\n            return $(form).validation() && $(form).validation('isValid');\n        }\n    });\n});\n","Magento_OfflinePayments/js/view/payment/method-renderer/checkmo-method.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* @api */\ndefine([\n    'Magento_Checkout/js/view/payment/default'\n], function (Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            template: 'Magento_OfflinePayments/payment/checkmo'\n        },\n\n        /**\n         * Returns send check to info.\n         *\n         * @return {*}\n         */\n        getMailingAddress: function () {\n            return window.checkoutConfig.payment.checkmo.mailingAddress;\n        },\n\n        /**\n         * Returns payable to info.\n         *\n         * @return {*}\n         */\n        getPayableTo: function () {\n            return window.checkoutConfig.payment.checkmo.payableTo;\n        }\n    });\n});\n","Magento_OfflinePayments/js/view/payment/method-renderer/cashondelivery-method.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* @api */\ndefine([\n    'Magento_Checkout/js/view/payment/default'\n], function (Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            template: 'Magento_OfflinePayments/payment/cashondelivery'\n        },\n\n        /**\n         * Returns payment method instructions.\n         *\n         * @return {*}\n         */\n        getInstructions: function () {\n            return window.checkoutConfig.payment.instructions[this.item.method];\n        }\n    });\n});\n","Magento_OfflinePayments/js/view/payment/method-renderer/banktransfer-method.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* @api */\ndefine([\n    'ko',\n    'Magento_Checkout/js/view/payment/default'\n], function (ko, Component) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            template: 'Magento_OfflinePayments/payment/banktransfer'\n        },\n\n        /**\n         * Get value of instruction field.\n         * @returns {String}\n         */\n        getInstructions: function () {\n            return window.checkoutConfig.payment.instructions[this.item.method];\n        }\n    });\n});\n","js/navigation-menu.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n/**\n * @deprecated\n * @see lib/web/mage/menu.js\n */\ndefine([\n    'jquery',\n    'matchMedia',\n    'mage/template',\n    'mage/dropdowns',\n    'mage/terms'\n], function ($, mediaCheck, mageTemplate) {\n    'use strict';\n\n    $.widget('mage.navigationMenu', {\n        options: {\n            itemsContainer: '> ul',\n            topLevel: 'li.level0',\n            topLevelSubmenu: '> .submenu',\n            topLevelHoverClass: 'hover',\n            expandedTopLevel: '.more',\n            hoverInTimeout: 300,\n            hoverOutTimeout: 500,\n            submenuAnimationSpeed: 200,\n            collapsable: true,\n            collapsableDropdownTemplate:\n                '<script type=\"text/x-magento-template\">' +\n                    '<li class=\"level0 level-top more parent\">' +\n                        '<div class=\"submenu\">' +\n                            '<ul><%= elems %></ul>' +\n                        '</div>' +\n                    '</li>' +\n                '</script>'\n        },\n\n        /** @inheritdoc */\n        _create: function () {\n            this.itemsContainer = $(this.options.itemsContainer, this.element);\n            this.topLevel = $(this.options.topLevel, this.element);\n            this.topLevelSubmenu = $(this.options.topLevelSubmenu, this.topLevel);\n\n            this._bind();\n        },\n\n        /**\n         * @private\n         */\n        _init: function () {\n            if (this.options.collapsable) {\n                setTimeout($.proxy(function () {\n                    this._checkToCollapseOrExpand();\n                }, this), 100);\n            }\n        },\n\n        /**\n         * @private\n         */\n        _bind: function () {\n            this._on({\n                /**\n                 * @param {jQuery.Event} e\n                 */\n                'mouseenter > ul > li.level0': function (e) {\n                    if (!this.entered) { // fix IE bug with 'mouseenter' event\n                        this.timeoutId && clearTimeout(this.timeoutId);\n                        this.timeoutId = setTimeout($.proxy(function () {\n                            this._openSubmenu(e);\n                        }, this), this.options.hoverInTimeout);\n                        this.entered = true;\n                    }\n                },\n\n                /**\n                 * @param {jQuery.Event} e\n                 */\n                'mouseleave > ul > li.level0': function (e) {\n                    this.entered = null;\n\n                    this.timeoutId && clearTimeout(this.timeoutId);\n                    this.timeoutId = setTimeout($.proxy(function () {\n                        this._closeSubmenu(e.currentTarget);\n                    }, this), this.options.hoverOutTimeout);\n                },\n\n                /**\n                 * @param {jQuert.Event} e\n                 */\n                'click': function (e) {\n                    e.stopPropagation();\n                }\n            });\n\n            $(document)\n                .on('click.hideMenu', $.proxy(function () {\n                    var isOpened = this.topLevel.filter(function () {\n                        return $(this).data('opened');\n                    });\n\n                    if (isOpened) {\n                        this._closeSubmenu(null, false);\n                    }\n                }, this));\n\n            $(window)\n                .on('resize', $.proxy(function () {\n                    this.timeoutOnResize && clearTimeout(this.timeoutOnResize);\n                    this.timeoutOnResize = setTimeout($.proxy(function () {\n                        if (this.options.collapsable) {\n                            if ($(this.options.expandedTopLevel, this.element).length) {\n                                this._expandMenu();\n                            }\n                            this._checkToCollapseOrExpand();\n                        }\n                    }, this), 300);\n                }, this));\n        },\n\n        /**\n         * @param {jQuery.Event} e\n         * @private\n         */\n        _openSubmenu: function (e) {\n            var menuItem = e.currentTarget;\n\n            if (!$(menuItem).data('opened')) {\n                this._closeSubmenu(menuItem, true, true);\n\n                $(this.options.topLevelSubmenu, menuItem)\n                    .slideDown(this.options.submenuAnimationSpeed, $.proxy(function () {\n                        $(menuItem).addClass(this.options.topLevelHoverClass);\n                        $(menuItem).data('opened', true);\n                    }, this));\n            } else if ($(e.target).closest(this.options.topLevel)) {\n                $(e.target)\n                    .addClass(this.options.topLevelHoverClass)\n                    .siblings(this.options.topLevel)\n                        .removeClass(this.options.topLevelHoverClass);\n            }\n        },\n\n        /**\n         * @param {*} menuItem\n         * @param {*} excludeCurrent\n         * @param {*} fast\n         * @private\n         */\n        _closeSubmenu: function (menuItem, excludeCurrent, fast) {\n            var topLevel = $(this.options.topLevel, this.element),\n                activeSubmenu = $(this.options.topLevelSubmenu, menuItem || null);\n\n            $(this.options.topLevelSubmenu, topLevel)\n                .filter(function () {\n                    return excludeCurrent ? $(this).not(activeSubmenu) : true;\n                })\n                .slideUp(fast ? 0 : this.options.submenuAnimationSpeed);\n\n            topLevel\n                .removeClass(this.options.topLevelHoverClass)\n                .data('opened', false);\n        },\n\n        /**\n         * @private\n         */\n        _checkToCollapseOrExpand: function () {\n            var navWidth, totalWidth, startCollapseIndex;\n\n            if ($('html').hasClass('lt-640') || $('html').hasClass('w-640')) {\n                return;\n            }\n\n            navWidth = this.itemsContainer.width();\n            totalWidth = 0;\n            startCollapseIndex = 0;\n\n            $.each($(this.options.topLevel, this.element), function (index, item) {\n                totalWidth += $(item).outerWidth(true);\n\n                if (totalWidth > navWidth && !startCollapseIndex) {\n                    startCollapseIndex = index - 2;\n                }\n            });\n\n            this[startCollapseIndex ? '_collapseMenu' : '_expandMenu'](startCollapseIndex);\n        },\n\n        /**\n         * @param {*} startCollapseIndex\n         * @private\n         */\n        _collapseMenu: function (startCollapseIndex) {\n            this.elemsToCollapse = this.topLevel.filter(function (index) {\n                return index > startCollapseIndex;\n            });\n            this.elemsToCollapseClone = $('<div></div>').append(this.elemsToCollapse.clone()).html();\n\n            this.collapsableDropdown = $(\n                mageTemplate(\n                    this.options.collapsableDropdownTemplate,\n                    {\n                        elems: this.elemsToCollapseClone\n                    }\n                )\n            );\n\n            this.itemsContainer.append(this.collapsableDropdown);\n            this.elemsToCollapse.detach();\n        },\n\n        /**\n         * @private\n         */\n        _expandMenu: function () {\n            this.elemsToCollapse && this.elemsToCollapse.appendTo(this.itemsContainer);\n            this.collapsableDropdown && this.collapsableDropdown.remove();\n        },\n\n        /**\n         * @private\n         */\n        _destroy: function () {\n            this._expandMenu();\n        }\n    });\n\n    /*\n     * Provides \"Continium\" effect for submenu\n     * */\n    $.widget('mage.navigationMenu', $.mage.navigationMenu, {\n        options: {\n            parentLevel: '> ul > li.level0',\n            submenuAnimationSpeed: 150,\n            submenuContiniumEffect: false\n        },\n\n        /**\n         * @private\n         */\n        _init: function () {\n            this._super();\n            this._applySubmenuStyles();\n        },\n\n        /**\n         * @private\n         */\n        _applySubmenuStyles: function () {\n            $(this.options.topLevelSubmenu, $(this.options.topLevel, this.element))\n                .removeAttr('style');\n\n            $(this.options.topLevelSubmenu, $(this.options.parentLevel, this.element))\n                .css({\n                    display: 'block',\n                    height: 0,\n                    overflow: 'hidden'\n                });\n        },\n\n        /**\n         * @param {jQuery.Event} e\n         * @private\n         */\n        _openSubmenu: function (e) {\n            var menuItem = e.currentTarget,\n                submenu = $(this.options.topLevelSubmenu, menuItem),\n                openedItems = $(this.options.topLevel, this.element).filter(function () {\n                    return $(this).data('opened');\n                });\n\n            if (submenu.length) {\n                this.heightToAnimate = $(this.options.itemsContainer, submenu).outerHeight(true);\n\n                if (openedItems.length) {\n                    this._closeSubmenu(menuItem, true, this.heightToAnimate, $.proxy(function () {\n                        submenu.css({\n                            height: 'auto'\n                        });\n                        $(menuItem)\n                            .addClass(this.options.topLevelHoverClass);\n                    }, this), e);\n                } else {\n                    submenu.animate({\n                        height: this.heightToAnimate\n                    }, this.options.submenuAnimationSpeed, $.proxy(function () {\n                        $(menuItem)\n                            .addClass(this.options.topLevelHoverClass);\n                    }, this));\n                }\n\n                $(menuItem)\n                    .data('opened', true);\n            } else {\n                this._closeSubmenu(menuItem);\n            }\n        },\n\n        /**\n         * @param {*} menuItem\n         * @param {*} excludeCurrent\n         * @param {*} heightToAnimate\n         * @param {Function} callback\n         * @private\n         */\n        _closeSubmenu: function (menuItem, excludeCurrent, heightToAnimate, callback) {\n            var topLevel = $(this.options.topLevel, this.itemsContainer),\n                prevOpenedItem, prevOpenedSubmenu;\n\n            if (!excludeCurrent) {\n                $(this.options.topLevelSubmenu, $(this.options.parentLevel, this.element))\n                    .animate({\n                        height: 0\n                    });\n\n                topLevel\n                    .data('opened', false)\n                    .removeClass(this.options.topLevelHoverClass);\n            } else {\n                prevOpenedItem = topLevel.filter(function () {\n                    return $(this).data('opened');\n                });\n                prevOpenedSubmenu = $(this.options.topLevelSubmenu, prevOpenedItem);\n\n                prevOpenedSubmenu.animate({\n                    height: heightToAnimate\n                }, this.options.submenuAnimationSpeed, 'linear', function () {\n                    $(this).css({\n                        height: 0\n                    });\n                    callback && callback();\n                });\n\n                prevOpenedItem\n                    .data('opened', false)\n                    .removeClass(this.options.topLevelHoverClass);\n            }\n        },\n\n        /**\n         * @private\n         */\n        _collapseMenu: function () {\n            this._superApply(arguments);\n            this._applySubmenuStyles();\n        }\n    });\n\n    //  Responsive menu\n    $.widget('mage.navigationMenu', $.mage.navigationMenu, {\n        options: {\n            responsive: false,\n            origNavPlaceholder: '.page-header',\n            mainContainer: 'body',\n            pageWrapper: '.page-wrapper',\n            openedMenuClass: 'opened',\n            toggleActionPlaceholder: '.block-search',\n            itemWithSubmenu: 'li.parent',\n            titleWithSubmenu: 'li.parent > a',\n            submenu: 'li.parent > .submenu',\n            toggleActionTemplate:\n                '<script type=\"text/x-magento-template\">' +\n                    '<span data-action=\"toggle-nav\" class=\"action toggle nav\">Toggle Nav</span>' +\n                '</script>',\n            submenuActionsTemplate:\n                '<script type=\"text/x-magento-template\">' +\n                    '<li class=\"action all\">' +\n                        '<a href=\"<%= categoryURL %>\"><span>All <%= category %></span></a>' +\n                    '</li>' +\n                '</script>',\n            navigationSectionsWrapperTemplate:\n                '<script type=\"text/x-magento-template\">' +\n                    '<dl class=\"navigation-tabs\" data-sections=\"tabs\">' +\n                    '</dl>' +\n                '</script>',\n            navigationItemWrapperTemplate:\n                '<script type=\"text/x-magento-template\">' +\n                    '<dt class=\"item title <% if (active) { %>active<% } %>\" data-section=\"title\">' +\n                        '<a class=\"switch\" data-toggle=\"switch\" href=\"#TODO\"><%= title %></a>' +\n                    '</dt>' +\n                    '<dd class=\"item content <% if (active) { %>active<%}%>\" data-section=\"content\">' +\n                    '</dd>' +\n                '</script>'\n        },\n\n        /**\n         * @private\n         */\n        _init: function () {\n            this._super();\n\n            this.mainContainer = $(this.options.mainContainer);\n            this.pageWrapper = $(this.options.pageWrapper);\n            this.toggleAction = $(mageTemplate(this.options.toggleActionTemplate, {}));\n\n            if (this.options.responsive) {\n                mediaCheck({\n                    media: '(min-width: 768px)',\n                    entry: $.proxy(function () {\n                        this._toggleDesktopMode();\n                    }, this),\n                    exit: $.proxy(function () {\n                        this._toggleMobileMode();\n                    }, this)\n                });\n            }\n        },\n\n        /**\n         * @private\n         */\n        _bind: function () {\n            this._super();\n            this._bindDocumentEvents();\n        },\n\n        /**\n         * @private\n         */\n        _bindDocumentEvents: function () {\n            if (!this.eventsBound) {\n                $(document)\n                    .on('click.toggleMenu', '.action.toggle.nav', $.proxy(function (e) {\n                        if ($(this.element).data('opened')) {\n                            this._hideMenu();\n                        } else {\n                            this._showMenu();\n                        }\n                        e.stopPropagation();\n                        this.mobileNav.scrollTop(0);\n                        this._fixedBackLink();\n                    }, this))\n                    .on('click.hideMenu', this.options.pageWrapper, $.proxy(function () {\n                        if ($(this.element).data('opened')) {\n                            this._hideMenu();\n                            this.mobileNav.scrollTop(0);\n                            this._fixedBackLink();\n                        }\n                    }, this))\n                    .on('click.showSubmenu', this.options.titleWithSubmenu, $.proxy(function (e) {\n                        this._showSubmenu(e);\n\n                        e.preventDefault();\n                        this.mobileNav.scrollTop(0);\n                        this._fixedBackLink();\n                    }, this))\n                    .on('click.hideSubmenu', '.action.back', $.proxy(function (e) {\n                        this._hideSubmenu(e);\n                        this.mobileNav.scrollTop(0);\n                        this._fixedBackLink();\n                    }, this));\n\n                this.eventsBound = true;\n            }\n        },\n\n        /**\n         * @private\n         */\n        _showMenu: function () {\n            $(this.element).data('opened', true);\n            this.mainContainer.add('html').addClass(this.options.openedMenuClass);\n        },\n\n        /**\n         * @private\n         */\n        _hideMenu: function () {\n            $(this.element).data('opened', false);\n            this.mainContainer.add('html').removeClass(this.options.openedMenuClass);\n        },\n\n        /**\n         * @param {jQuery.Event} e\n         * @private\n         */\n        _showSubmenu: function (e) {\n            var submenu;\n\n            $(e.currentTarget).addClass('action back');\n            submenu = $(e.currentTarget).siblings('.submenu');\n\n            submenu.addClass('opened');\n        },\n\n        /**\n         * @param {jQuery.Event} e\n         * @private\n         */\n        _hideSubmenu: function (e) {\n            var submenuSelector = '.submenu',\n                submenu = $(e.currentTarget).next(submenuSelector);\n\n            $(e.currentTarget).removeClass('action back');\n            submenu.removeClass('opened');\n        },\n\n        /**\n         * @private\n         */\n        _renderSubmenuActions: function () {\n            $.each(\n                $(this.options.itemWithSubmenu),\n                $.proxy(function (index, item) {\n                    var actions = $(mageTemplate(\n                            this.options.submenuActionsTemplate,\n                            {\n                                category: $('> a > span', item).text(),\n                                categoryURL: $('> a', item).attr('href')\n                            }\n                        )),\n                        submenu = $('> .submenu', item),\n                        items = $('> ul', submenu);\n\n                    items.prepend(actions);\n                }, this)\n            );\n        },\n\n        /**\n         * @private\n         */\n        _toggleMobileMode: function () {\n            this._expandMenu();\n\n            $(this.options.topLevelSubmenu, $(this.options.topLevel, this.element))\n                .removeAttr('style');\n\n            this.toggleAction.insertBefore(this.options.toggleActionPlaceholder);\n            this.mobileNav = $(this.element).detach().clone();\n            this.mainContainer.prepend(this.mobileNav);\n            this.mobileNav.find('> ul').addClass('nav');\n            this._insertExtraItems();\n            this._wrapItemsInSections();\n            this.mobileNav.scroll($.proxy(function () {\n                this._fixedBackLink();\n            }, this));\n\n            this._renderSubmenuActions();\n            this._bindDocumentEvents();\n        },\n\n        /**\n         * @private\n         */\n        _toggleDesktopMode: function () {\n            this.mobileNav && this.mobileNav.remove();\n            this.toggleAction.detach();\n            $(this.element).insertAfter(this.options.origNavPlaceholder);\n\n            $(document)\n                .off('click.toggleMenu', '.action.toggle.nav')\n                .off('click.hideMenu', this.options.pageWrapper)\n                .off('click.showSubmenu', this.options.titleWithSubmenu)\n                .off('click.hideSubmenu', '.action.back');\n\n            this.eventsBound = false;\n\n            this._applySubmenuStyles();\n        },\n\n        /**\n         * @private\n         */\n        _insertExtraItems: function () {\n            var settings, footerSettings, account;\n\n            if ($('.header.panel .switcher').length) {\n                settings = $('.header.panel .switcher')\n                    .clone()\n                    .addClass('settings');\n\n                this.mobileNav.prepend(settings);\n            }\n\n            if ($('.footer .switcher').length) {\n                footerSettings = $('.footer .switcher')\n                    .clone()\n                    .addClass('settings');\n\n                this.mobileNav.prepend(footerSettings);\n            }\n\n            if ($('.header.panel .header.links li').length) {\n                account = $('.header.panel > .header.links')\n                    .clone()\n                    .addClass('account');\n\n                this.mobileNav.prepend(account);\n            }\n        },\n\n        /**\n         * @private\n         */\n        _wrapItemsInSections: function () {\n            var account = $('> .account', this.mobileNav),\n                settings = $('> .settings', this.mobileNav),\n                nav = $('> .nav', this.mobileNav),\n                navigationSectionsWrapper = $(mageTemplate(this.options.navigationSectionsWrapperTemplate, {})),\n                navigationItemWrapper;\n\n            this.mobileNav.append(navigationSectionsWrapper);\n\n            if (nav.length) {\n                navigationItemWrapper = $(mageTemplate(this.options.navigationItemWrapperTemplate, {\n                    title: 'Menu'\n                }));\n                navigationSectionsWrapper.append(navigationItemWrapper);\n                navigationItemWrapper.eq(1).append(nav);\n            }\n\n            if (account.length) {\n                navigationItemWrapper = $(mageTemplate(this.options.navigationItemWrapperTemplate, {\n                    title: 'Account'\n                }));\n                navigationSectionsWrapper.append(navigationItemWrapper);\n                navigationItemWrapper.eq(1).append(account);\n            }\n\n            if (settings.length) {\n                navigationItemWrapper = $(\n                    mageTemplate(this.options.navigationItemWrapperTemplate, {\n                        title: 'Settings'\n                    })\n                );\n                navigationSectionsWrapper.append(navigationItemWrapper);\n                navigationItemWrapper.eq(1).append(settings);\n            }\n\n            navigationSectionsWrapper.addClass(\n                'navigation-tabs-' + navigationSectionsWrapper.find('[data-section=\"title\"]').length\n            );\n            navigationSectionsWrapper.terms();\n        },\n\n        /**\n         * @private\n         */\n        _fixedBackLink: function () {\n            var linksBack = this.mobileNav.find('.submenu .action.back'),\n                linkBack = this.mobileNav.find('.submenu.opened > ul > .action.back').last(),\n                subMenu, navOffset, linkBackHeight;\n\n            linksBack.removeClass('fixed');\n\n            if (linkBack.length) {\n                subMenu = linkBack.parent();\n                navOffset = this.mobileNav.find('.nav').position().top;\n                linkBackHeight = linkBack.height();\n\n                if (navOffset <= 0) {\n                    linkBack.addClass('fixed');\n                    subMenu.css({\n                        paddingTop: linkBackHeight\n                    });\n                } else {\n                    linkBack.removeClass('fixed');\n                    subMenu.css({\n                        paddingTop: 0\n                    });\n                }\n            }\n        }\n    });\n\n    return $.mage.navigationMenu;\n});\n","js/mixins/reCaptcha-mixin.js":"define([\n    'uiComponent',\n    'jquery',\n    'ko',\n    'underscore',\n    'Magento_ReCaptchaFrontendUi/js/registry',\n    'Magento_ReCaptchaFrontendUi/js/reCaptchaScriptLoader',\n    'Magento_ReCaptchaFrontendUi/js/nonInlineReCaptchaRenderer'\n], function (Component, $, ko, _, registry, reCaptchaLoader, nonInlineReCaptchaRenderer) {\n    'use strict';\n\n    return function(Component) {\n        return Component.extend({\n            initCaptcha: function () {\n                if (typeof this.settings === 'undefined') { \n                    return; \n                }\n                this._super();\n            },\n            \n            getIsInvisibleRecaptcha: function () {\n                if (typeof this.settings === 'undefined') { \n                    return; \n                }\n                return this.settings.invisible;\n            }\n        });   \n    }\n});","Magento_Reports/js/recently-viewed.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/**\n * @api\n */\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.recentlyViewedProducts', {\n        options: {\n            localStorageKey: 'recently-viewed-products',\n            productBlock: '#widget_viewed_item',\n            viewedContainer: 'ol'\n        },\n\n        /**\n         * Bind events to the appropriate handlers.\n         * @private\n         */\n        _create: function () {\n            var productHtml = $(this.options.productBlock).html(),\n                productSku = $(this.options.productBlock).data('sku'),\n                products = JSON.parse(window.localStorage.getItem(this.options.localStorageKey)),\n                productsLength, maximum, showed, index;\n\n            if (products) {\n                productsLength = products.sku.length;\n                maximum = $(this.element).data('count');\n                showed = 0;\n\n                for (index = 0; index <= productsLength; index++) {\n                    if (products.sku[index] == productSku || showed >= maximum) { //eslint-disable-line\n                        products.sku.splice(index, 1);\n                        products.html.splice(index, 1);\n                    } else {\n                        $(this.element).find(this.options.viewedContainer).append(products.html[index]);\n                        $(this.element).show();\n                        showed++;\n                    }\n                }\n                $(this.element).find(this.options.productBlock).show();\n            } else {\n                products = {};\n                products.sku = [];\n                products.html = [];\n            }\n            products.sku.unshift(productSku);\n            products.html.unshift(productHtml);\n            window.localStorage.setItem(this.options.localStorageKey, JSON.stringify(products));\n        }\n    });\n\n    return $.mage.recentlyViewedProducts;\n});\n","Magiccart_Campaignbar/js/campaign-bar.js":"if (!customElements.get(\"campaign-bar\")) {\n    class CampaignBar extends HTMLElement {\n        constructor() {\n            super();\n        }\n        connectedCallback() {\n            this.load();\n            if (document.currentScript && document.currentScript.src) {\n                this.getAppVersion(document.currentScript.src.split('/js/')[0].split('/').pop(), 'https://magepow.com/magento-campaign-bar.html');\n            }\n        }\n        load() {\n            let self = this,\n            closeX = this.querySelector('.close-x');\n            if(closeX){\n                closeX.addEventListener('click', (event) => {\n                    self.classList.add('close-bar');\n                    self.classList.remove('show');\n                });\n            }\n        }\n        getAppVersion(appName, href) {\n            // this expression is to get the version string\n            let regx = new RegExp('.*\\/(.*?)\\/assets\\/', 'i');\n            let result = regx.exec(href);\n            let version = result ? result[1].replace(/\\D/g, '') : '1.0.0';\n            console.log(`%c ${appName} %c v${version}  %c`, \"background: #555555; padding: 1px; margin-bottom: 2px; border-radius: 3px 0 0 3px; color: #fff\", \"background: #44cc11; padding: 1px; margin-bottom: 2px; border-radius: 0 3px 3px 0; color: #fff\", \"background:transparent\", `\ud83d\ude80 ${href}`);\n\n            return version;\n        }\n    }\n    customElements.define(\"campaign-bar\", CampaignBar);\n    customElements.define(\"top-bar\", class extends CampaignBar { });\n    customElements.define(\"footer-bar\", class extends CampaignBar { });\n}\n","Craftyclicks_Ukpostcodelookup/crafty_postcode.class.js":"/*\n// This is a collection of JavaScript code to allow easy integration of\n// postcode / address finder functionality into any website\n//\n// Provided by www.CraftyClicks.co.uk\n//\n// Version - 4.9.5 (26/11/2018)\n//\n// Feel free to copy/use/modify this code any way you see fit. Please keep this\n// comment header in place when you do.\n//\n// To integrate UK postcode / address lookup on your website, please visit www.craftyclicks.co.uk for\n// details of how to sign up for an account.\n//\n**********************************************************************************/\nif(!_cp_js_included){var _cp_js_included=1;var _cp_instances=[],_cp_instance_idx=0,_cp_pl=[\"FLAT\",\"SHOP\",\"UNIT\",\"BLOCK\",\"STALL\",\"SUITE\",\"APARTMENT\",\"MAISONETTE\",\"HOUSE NUMBER\"];function CraftyPostcodeCreate(){_cp_instance_idx++;_cp_instances[_cp_instance_idx]=new CraftyPostcodeClass();_cp_instances[_cp_instance_idx].obj_idx=_cp_instance_idx;return _cp_instances[_cp_instance_idx]}function _cp_sp(b){var d=\"\",c;for(c=0;c<_cp_pl.length;c++){d=_cp_pl[c];if(d==b.substr(0,d.length).toUpperCase()){return(b.substr(d.length))}}return(\"\")}function _cp_eh(a){var b=\"\";while(b=a.shift()){if(!isNaN(parseInt(b))){return(parseInt(b))}}return\"\"}function _cp_kp(a){var b;if(!a){a=window.event}if(a.keyCode){b=a.keyCode}else{if(a.which){b=a.which}}if(b==13){this.onclick()}}function CraftyPostcodeClass(){this.config={lookup_url:\"pcls1.craftyclicks.co.uk/js/\",access_token:\"\",basic_address:0,traditional_county:0,busy_img_url:\"crafty_postcode_busy.gif\",hide_result:0,org_uppercase:1,town_uppercase:1,county_uppercase:0,addr_uppercase:0,delimiter:\", \",msg1:\"Please wait while we find the address\",err_msg1:\"This postcode could not be found, please try again or enter your address manually\",err_msg2:\"This postcode is not valid, please try again or enter your address manually\",err_msg3:\"Unable to connect to address lookup server, please enter your address manually.\",err_msg4:\"An unexpected error occured, please enter your address manually.\",res_autoselect:1,res_select_on_change:1,debug_mode:0,lookup_timeout:10000,form:\"\",elements:\"\",max_width:\"400px\",max_lines:1,first_res_line:\"---- please select your address ----\",result_elem_id:\"\",on_result_ready:null,on_result_selected:null,on_error:null,pre_populate_common_address_parts:0,elem_company:\"crafty_out_company\",elem_house_num:\"\",elem_street1:\"crafty_out_street1\",elem_street2:\"crafty_out_street2\",elem_street3:\"crafty_out_street3\",elem_town:\"crafty_out_town\",elem_county:\"crafty_out_county\",elem_postcode:\"crafty_in_out_postcode\",elem_udprn:\"crafty_out_udprn\",single_res_autoselect:0,single_res_notice:\"---- address found, see below ----\",elem_search_house:\"crafty_in_search_house\",elem_search_street:\"crafty_in_search_street\",elem_search_town:\"crafty_in_search_town\",max_results:25,err_msg5:\"The house name/number could not be found, please try again.\",err_msg6:\"No results found, please modify your search and try again.\",err_msg7:\"Too many results, please modify your search and try again.\",err_msg9:\"Please provide more data and try again.\",err_msg8:\"Trial account limit reached, please use AA11AA, AA11AB, AA11AD or AA11AE.\"};this.xmlhttp=null;this.res_arr=null;this.disp_arr=null;this.res_arr_idx=0;this.dummy_1st_line=0;this.cc=0;this.flexi_search=0;this.lookup_timeout=null;this.obj_name=\"\";this.house_search=0;this.set=function(a,b){this.config[a]=b};this.res_clicked=function(a){this.cc++;if(this.res_selected(a)){if(0!=this.config.hide_result&&((2>=this.config.max_lines&&1<this.cc)||(2<this.config.max_lines))){this.update_res(null);this.cc=0}}};this.res_selected=function(a){if(1==this.dummy_1st_line){if(0==a){return 0}else{a--}}a=this.disp_arr[a][\"index\"];this.populate_form_fields(this.res_arr[a]);if(this.config.on_result_selected){this.config.on_result_selected(a)}return 1};this.populate_form_fields=function(l){var d=[];var p=this.config.delimiter;for(var g=0;g<8;g++){d[g]=this.get_elem(g)}d[11]=this.get_elem(11);if(d[11]){d[11].value=l.udprn}var c=null;if(d[0]){if(d[0]==d[1]&&\"\"!=l.org){d[1].value=l.org;c=d[1];d[1]=d[2];d[2]=d[3];d[3]=null}else{d[0].value=l.org}}var o=l.housename2;if(\"\"!=o&&\"\"!=l.housename1){o+=p}o+=l.housename1;var m=l.housenumber;if(d[7]){d[7].value=o;if(\"\"!=o&&\"\"!=m){d[7].value+=p}d[7].value+=m;o=\"\";m=\"\"}var f=l.street1;var e=l.street2;if(\"\"!=m){if(\"\"!=e){e=m+\" \"+e}else{if(\"\"!=f){f=m+\" \"+f}else{f=m}}}var j=e+(e==\"\"?\"\":(f==\"\"?\"\":p))+f;var n=l.locality_dep;var k=l.locality;if(\"\"!=j&&parseInt(j)==j){if(\"\"!=n){n=parseInt(j)+\" \"+n}else{k=parseInt(j)+\" \"+k}j=\"\";f=\"\"}var h=n+(n==\"\"||k==\"\"?\"\":p)+k;var a=j+(j==\"\"||h==\"\"?\"\":p)+h;if(d[1]&&d[2]&&d[3]){if(\"\"!=l.pobox||\"\"!=o){if(\"\"!=l.pobox){d[1].value=l.pobox}else{d[1].value=o}if(\"\"==h){if(\"\"==e){d[2].value=f;d[3].value=\"\"}else{d[2].value=e;d[3].value=f}}else{if(\"\"==j){if(\"\"==n){d[2].value=k;d[3].value=\"\"}else{d[2].value=n;d[3].value=k}}else{d[2].value=j;d[3].value=h}}}else{if(\"\"==j){if(\"\"==n){d[1].value=k;d[2].value=\"\";d[3].value=\"\"}else{d[1].value=n;d[2].value=k;d[3].value=\"\"}}else{if(\"\"==h){if(\"\"==e){d[1].value=f;d[2].value=\"\";d[3].value=\"\"}else{d[1].value=e;d[2].value=f;d[3].value=\"\"}}else{if(\"\"==e){d[1].value=f;if(\"\"==n){d[2].value=k;d[3].value=\"\"}else{d[2].value=n;d[3].value=k}}else{if(\"\"==n){d[1].value=e;d[2].value=f;d[3].value=k}else{if(j.length<h.length){d[1].value=j;d[2].value=n;d[3].value=k}else{d[1].value=e;d[2].value=f;d[3].value=h}}}}}}}else{if(d[1]&&d[2]){if(\"\"!=l.pobox){d[1].value=l.pobox;d[2].value=a}else{if(\"\"!=o&&\"\"!=j&&\"\"!=h){if((o.length+j.length)<(j.length+h.length)){d[1].value=o+(o==\"\"?\"\":p)+j;d[2].value=h}else{d[1].value=o;d[2].value=j+(j==\"\"?\"\":p)+h}}else{if(\"\"!=o&&\"\"!=j){d[1].value=o;d[2].value=j}else{if(\"\"==o&&\"\"!=j){if(\"\"==h){if(\"\"!=e){d[1].value=e;d[2].value=f}else{d[1].value=j;d[2].value=\"\"}}else{d[1].value=j;d[2].value=h}}else{if(\"\"==j&&\"\"!=o){d[1].value=o;d[2].value=h}else{d[1].value=h;d[2].value=\"\"}}}}}}else{var b=\"\";if(\"\"!=l.pobox){b=l.pobox+p+h}else{b=o+(o==\"\"||a==\"\"?\"\":p)+a}if(d[1]){d[1].value=b}else{if(d[2]){d[2].value=b}else{if(d[3]){d[3].value=b}else{if(c){c.value=l.org+p+b}else{}}}}}}if(d[4]){d[4].value=l.town}if(d[5]){d[5].value=l.county}if(d[6]){d[6].value=l.postcode}return 1};this.show_busy=function(){if(this.config.busy_img_url&&\"\"!=this.config.busy_img_url){var b=document.createElement(\"img\");var a=document.createAttribute(\"src\");a.value=this.config.busy_img_url;b.setAttributeNode(a);a=document.createAttribute(\"title\");a.value=this.config.msg1;b.setAttributeNode(a);this.update_res(b)}else{this.update_res(null)}};this.disp_err=function(d,b){var a=null;var e=\"\";if(\"\"!=d){switch(d){case\"0001\":e=this.config.err_msg1;break;case\"0002\":e=this.config.err_msg2;break;case\"9001\":e=this.config.err_msg3;break;case\"0003\":e=this.config.err_msg9;break;case\"0004\":e=this.config.err_msg6;break;case\"0005\":e=this.config.err_msg7;break;case\"7001\":e=this.config.err_msg8;break;default:e=\"(\"+d+\") \"+this.config.err_msg4;break}if(this.config.debug_mode){var c=\"\";switch(d){case\"8000\":c=\" :: No Access Token \";break;case\"8001\":c=\" :: Invalid Token Format \";break;case\"8002\":c=\" :: Invalid Token \";break;case\"8003\":c=\" :: Out of Credits \";break;case\"8004\":c=\" :: Restricted by rules \";break;case\"8005\":c=\" :: Token suspended \";break}e+=c+\" :: DBG :: \"+b}a=document.createTextNode(e)}this.update_res(a);if(this.config.on_error){this.config.on_error(e)}};this.disp_err_msg=function(b){var a=null;if(\"\"!=b){a=document.createTextNode(b)}this.update_res(a);if(this.config.on_error){this.config.on_error(b)}};this.display_res_line=function(d,c){var b=document.getElementById(\"crafty_postcode_lookup_result_option\"+this.obj_idx);var e=document.createElement(\"option\");e.appendChild(document.createTextNode(d));if(-1==c){e.setAttribute(\"selected\",\"selected\")}if(null!=b){b.appendChild(e)}else{var a=document.createElement(\"select\");a.id=\"crafty_postcode_lookup_result_option\"+this.obj_idx;a.onclick=Function(\"_cp_instances[\"+this.obj_idx+\"].res_clicked(this.selectedIndex);\");a.onkeypress=_cp_kp;if(0!=this.config.res_select_on_change){a.onchange=Function(\"_cp_instances[\"+this.obj_idx+\"].res_selected(this.selectedIndex);\")}if(this.config.max_width&&\"\"!=this.config.max_width){a.style.width=this.config.max_width}var f=this.res_arr_idx;if(1==this.dummy_1st_line){f++}if((navigator.appName==\"Microsoft Internet Explorer\")&&(parseFloat(navigator.appVersion)<=4)){a.size=0}else{if(f>=this.config.max_lines){a.size=this.config.max_lines}else{a.size=f}}a.appendChild(e);this.update_res(a)}};this.update_res=function(a){if(this.lookup_timeout){clearTimeout(this.lookup_timeout)}try{if(document.getElementById){var b=document.getElementById(this.config.result_elem_id);if(b.hasChildNodes()){while(b.firstChild){b.removeChild(b.firstChild)}}if(null!=a){b.appendChild(a)}}}catch(c){}};this.str_trim=function(b){var a=0;var c=b.length-1;while(a<b.length&&b[a]==\" \"){a++}while(c>a&&b[c]==\" \"){c-=1}return b.substring(a,c+1)};this.cp_uc=function(e){if(\"PC\"==e||\"UK\"==e||\"EU\"==e){return(e)}var d=\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";var c=\"\";var f=1;var b=0;for(var a=0;a<e.length;a++){if(-1!=d.indexOf(e.charAt(a))){if(f||b){c=c+e.charAt(a);f=0}else{c=c+e.charAt(a).toLowerCase()}}else{c=c+e.charAt(a);if(a+2>=e.length&&\"'\"==e.charAt(a)){f=0}else{if(\"(\"==e.charAt(a)){close_idx=e.indexOf(\")\",a+1);if(a+3<close_idx){b=0;f=1}else{b=1}}else{if(\")\"==e.charAt(a)){b=0;f=1}else{if(\"-\"==e.charAt(a)){close_idx=e.indexOf(\"-\",a+1);if((-1!=close_idx&&a+3>=close_idx)||a+3>=e.length){b=0;f=0}else{b=0;f=1}}else{if(a+2<e.length&&\"0\"<=e.charAt(a)&&\"9\">=e.charAt(a)){f=0}else{f=1}}}}}}}return(c)};this.leading_caps=function(a,b){if(0!=b||2>a.length){return(a)}var d=\"\";var f=a.split(\" \");for(var c=0;c<f.length;c++){var e=this.str_trim(f[c]);if(\"\"!=e){if(\"\"!=d){d=d+\" \"}d=d+this.cp_uc(e)}}return(d)};this.new_res_line=function(){var a=[];a.org=\"\";a.housename1=\"\";a.housename2=\"\";a.pobox=\"\";a.housenumber=\"\";a.street1=\"\";a.street2=\"\";a.locality_dep=\"\";a.locality=\"\";a.town=\"\";a.county=\"\";a.postcode=\"\";a.udprn=\"\";return(a)};this.res_arr_compare=function(e,c){if(e.match_quality>c.match_quality){return(1)}if(e.match_quality<c.match_quality){return(-1)}if(e.street1>c.street1){return(1)}if(e.street1<c.street1){return(-1)}if(e.street2>c.street2){return(1)}if(e.street2<c.street2){return(-1)}var h;if(\"\"==e.housenumber){h=_cp_eh(Array(e.housename1,e.housename2))}else{h=parseInt(e.housenumber)}var g;if(\"\"==c.housenumber){g=_cp_eh(Array(c.housename1,c.housename2))}else{g=parseInt(c.housenumber)}if(\"\"==h&&\"\"!=g){return(1)}else{if(\"\"!=h&&\"\"==g){return(-1)}else{if(h>g){return(1)}if(h<g){return(-1)}}}var f=_cp_sp(e.housename1);if(!isNaN(parseInt(f))){f=parseInt(f)}var d=_cp_sp(c.housename1);if(!isNaN(parseInt(d))){d=parseInt(d)}if(f>d){return(1)}if(f<d){return(-1)}var f=_cp_sp(e.housename2);if(!isNaN(parseInt(f))){f=parseInt(f)}var d=_cp_sp(c.housename2);if(!isNaN(parseInt(d))){d=parseInt(d)}if(f>d){return(1)}if(f<d){return(-1)}f=e.housename2+e.housename1;d=c.housename2+c.housename1;if(f>d){return(1)}if(f<d){return(-1)}if(e.org>c.org){return(1)}if(e.org<c.org){return(-1)}return(1)};this.disp_res_arr=function(){this.res_arr=this.res_arr.sort(this.res_arr_compare);if(0!=this.config.res_autoselect){this.populate_form_fields(this.res_arr[0])}var a=this.config.delimiter;this.disp_arr=[];for(var c=0;c<this.res_arr_idx;c++){var e=this.res_arr[c];var b=e.org+(e.org!=\"\"?a:\"\")+e.housename2+(e.housename2!=\"\"?a:\"\")+e.housename1+(e.housename1!=\"\"?a:\"\")+e.pobox+(e.pobox!=\"\"?a:\"\")+e.housenumber+(e.housenumber!=\"\"?\" \":\"\")+e.street2+(e.street2!=\"\"?a:\"\")+e.street1+(e.street1!=\"\"?a:\"\")+e.locality_dep+(e.locality_dep!=\"\"?a:\"\")+e.locality+(e.locality!=\"\"?a:\"\")+e.town;if(this.flexi_search){b+=a+e.postcode}var d=[];d.index=c;d.str=b;this.disp_arr[c]=d}this.update_res(null);this.dummy_1st_line=0;if(\"\"!=this.config.first_res_line){this.dummy_1st_line=1;this.display_res_line(this.config.first_res_line,-1)}for(var c=0;c<this.res_arr_idx;c++){this.display_res_line(this.disp_arr[c][\"str\"],c)}if(this.config.pre_populate_common_address_parts){var f=this.new_res_line();f.org=this.res_arr[0][\"org\"];f.housename1=this.res_arr[0][\"housename1\"];f.housename2=this.res_arr[0][\"housename2\"];f.pobox=this.res_arr[0][\"pobox\"];f.housenumber=this.res_arr[0][\"housenumber\"];f.street1=this.res_arr[0][\"street1\"];f.street2=this.res_arr[0][\"street2\"];f.locality_dep=this.res_arr[0][\"locality_dep\"];f.locality=this.res_arr[0][\"locality\"];f.town=this.res_arr[0][\"town\"];f.county=this.res_arr[0][\"county\"];f.postcode=this.res_arr[0][\"postcode\"];f.udprn=this.res_arr[0][\"udprn\"];for(var c=1;c<this.res_arr_idx;c++){if(this.res_arr[c][\"org\"]!=f.org){f.org=\"\"}if(this.res_arr[c][\"housename2\"]!=f.housename2){f.housename2=\"\"}if(this.res_arr[c][\"housename1\"]!=f.housename1){f.housename1=\"\"}if(this.res_arr[c][\"pobox\"]!=f.pobox){f.pobox=\"\"}if(this.res_arr[c][\"housenumber\"]!=f.housenumber){f.housenumber=\"\"}if(this.res_arr[c][\"street1\"]!=f.street1){f.street1=\"\"}if(this.res_arr[c][\"street2\"]!=f.street2){f.street2=\"\"}if(this.res_arr[c][\"locality_dep\"]!=f.locality_dep){f.locality_dep=\"\"}if(this.res_arr[c][\"locality\"]!=f.locality){f.locality=\"\"}if(this.res_arr[c][\"town\"]!=f.town){f.town=\"\"}if(this.res_arr[c][\"county\"]!=f.county){f.county=\"\"}if(this.res_arr[c][\"postcode\"]!=f.postcode){f.postcode=\"\"}if(this.res_arr[c][\"udprn\"]!=f.udprn){f.udprn=\"\"}}this.populate_form_fields(f)}};this.get_elem=function(a){var d=\"\";var c=null;if(\"\"!=this.config.elements){var b=this.config.elements.split(\",\");d=b[a]}else{switch(a){case 0:d=this.config.elem_company;break;case 1:d=this.config.elem_street1;break;case 2:d=this.config.elem_street2;break;case 3:d=this.config.elem_street3;break;case 4:d=this.config.elem_town;break;case 5:d=this.config.elem_county;break;case 6:default:d=this.config.elem_postcode;break;case 7:d=this.config.elem_house_num;break;case 8:d=this.config.elem_search_house;break;case 9:d=this.config.elem_search_street;break;case 10:d=this.config.elem_search_town;break;case 11:d=this.config.elem_udprn;break}}if(\"\"!=d){if(\"\"!=this.config.form){c=document.forms[this.config.form].elements[d]}else{if(document.getElementById){c=document.getElementById(d)}}}return(c)};this.doHouseSearch=function(){var a=this.get_elem(8);if(a&&0<a.value.length){this.house_search=1}this.doLookup()};this.doLookup=function(){this.xmlhttp=null;var a=this.get_elem(6);var b=null;if(a){this.show_busy();this.lookup_timeout=setTimeout(\"_cp_instances[\"+this.obj_idx+\"].lookup_timeout_err()\",this.config.lookup_timeout);b=this.validate_pc(a.value)}if(null!=b){this.direct_xml_fetch(0,b)}else{this.disp_err(\"0002\",\"invalid postcode format\")}};this.flexiSearch=function(){this.xmlhttp=null;var a=\"\";if(this.get_elem(8)&&\"\"!=this.get_elem(8).value){a+=\"&search_house=\"+this.get_elem(8).value}if(this.get_elem(9)&&\"\"!=this.get_elem(9).value){a+=\"&search_street=\"+this.get_elem(9).value}if(this.get_elem(10)&&\"\"!=this.get_elem(10).value){a+=\"&search_town=\"+this.get_elem(10).value}if(\"\"!=a){this.show_busy();this.lookup_timeout=setTimeout(\"_cp_instances[\"+this.obj_idx+\"].lookup_timeout_err()\",this.config.lookup_timeout);this.direct_xml_fetch(1,a)}else{this.disp_err(\"0003\",\"search string too short\")}};this.validate_pc=function(c){var b=\"\";do{b=c;c=c.replace(/[^A-Za-z0-9]/,\"\")}while(b!=c);b=c.toUpperCase();if(7>=b.length&&5<=b.length){var d=b.substring(b.length-3,b.length);var a=b.substring(0,b.length-3);if(true==/[CIKMOV]/.test(d)){return null}if(\"0\"<=d.charAt(0)&&\"9\">=d.charAt(0)&&\"A\"<=d.charAt(1)&&\"Z\">=d.charAt(1)&&\"A\"<=d.charAt(2)&&\"Z\">=d.charAt(2)){switch(a.length){case 2:if(\"A\"<=a.charAt(0)&&\"Z\">=a.charAt(0)&&\"0\"<=a.charAt(1)&&\"9\">=a.charAt(1)){return(b)}break;case 3:if(\"A\"<=a.charAt(0)&&\"Z\">=a.charAt(0)){if(\"0\"<=a.charAt(1)&&\"9\">=a.charAt(1)&&\"0\"<=a.charAt(2)&&\"9\">=a.charAt(2)){return(b)}else{if(\"A\"<=a.charAt(1)&&\"Z\">=a.charAt(1)&&\"0\"<=a.charAt(2)&&\"9\">=a.charAt(2)){return(b)}else{if(\"0\"<=a.charAt(1)&&\"9\">=a.charAt(1)&&\"A\"<=a.charAt(2)&&\"Z\">=a.charAt(2)){return(b)}}}}break;case 4:if(\"A\"<=a.charAt(0)&&\"Z\">=a.charAt(0)&&\"A\"<=a.charAt(1)&&\"Z\">=a.charAt(1)&&\"0\"<=a.charAt(2)&&\"9\">=a.charAt(2)){if(\"0\"<=a.charAt(3)&&\"9\">=a.charAt(3)){return(b)}else{if(\"A\"<=a.charAt(3)&&\"Z\">=a.charAt(3)){return(b)}}}break;default:break}}}return null};this.direct_xml_fetch=function(d,a){try{var e=document.getElementById(this.config.result_elem_id);var b=\"\";if(\"https:\"==document.location.protocol){b=\"https://\"}else{b=\"http://\"}if(0==d){b+=this.config.lookup_url;if(this.config.basic_address){b+=\"basicaddress\"}else{b+=\"rapidaddress\"}b+=\"?postcode=\"+a+\"&callback=_cp_instances[\"+this.obj_idx+\"].handle_js_response&callback_id=0\"}else{if(this.config.basic_address){this.disp_err(\"1207\",\"BasicAddress can't be used for Flexi Search!\");return}else{b+=this.config.lookup_url+\"flexiaddress?callback=_cp_instances[\"+this.obj_idx+\"].handle_js_response&callback_id=1\";b+=\"&max_results=\"+this.config.max_results;b+=a}}if(\"\"!=this.config.access_token){b+=\"&key=\"+this.config.access_token}var c=document.createElement(\"script\");c.src=encodeURI(b);c.type=\"text/javascript\";e.appendChild(c)}catch(f){this.disp_err(\"1206\",f)}};this.handle_js_response=function(c,d,e){if(!d){var f=e.error_code;var a=e.error_msg;this.disp_err(f,a)}else{this.res_arr=[];this.res_arr_idx=0;if(0==c){this.flexi_search=0;if(this.house_search){e=this.filter_data_by_house_name(e);if(null==e){this.disp_err_msg(this.config.err_msg5);return}}this.add_to_res_array(e)}else{this.flexi_search=1;this.res_arr.total_postcode_count=e.total_postcode_count;this.res_arr.total_thoroughfare_count=e.total_thoroughfare_count;this.res_arr.total_delivery_point_count=e.total_delivery_point_count;for(var i=1;i<=e.total_postcode_count;i++){this.add_to_res_array(e[i])}}if(this.res_arr_idx){var b=false;if(1==this.res_arr_idx&&this.config.single_res_autoselect){var g=null;if(\"\"!=this.config.single_res_notice){g=document.createTextNode(this.config.single_res_notice)}this.update_res(g);this.populate_form_fields(this.res_arr[0]);b=true}else{this.disp_res_arr();document.getElementById(\"crafty_postcode_lookup_result_option\"+this.obj_idx).focus()}if(0==c&&\"\"!=e.postcode){var h=this.get_elem(6);h.value=e.postcode}if(this.config.on_result_ready){this.config.on_result_ready()}if(b&&this.config.on_result_selected){this.config.on_result_selected(0)}}else{this.disp_err(\"1205\",\"no result to display\")}}};this.add_to_res_array=function(f){for(var d=1;d<=f.thoroughfare_count;d++){var e=f[d][\"thoroughfare_name\"];if(\"\"!=f[d][\"thoroughfare_descriptor\"]){e+=\" \"+f[d][\"thoroughfare_descriptor\"]}e=this.leading_caps(e,this.config.addr_uppercase);var c=f[d][\"dependent_thoroughfare_name\"];if(\"\"!=f[d][\"dependent_thoroughfare_descriptor\"]){c+=\" \"+f[d][\"dependent_thoroughfare_descriptor\"]}c=this.leading_caps(c,this.config.addr_uppercase);if(\"delivery_point_count\" in f[d]&&0<f[d][\"delivery_point_count\"]){for(var a=1;a<=f[d][\"delivery_point_count\"];a++){var g=this.new_res_line();g.street1=e;g.street2=c;var b=f[d][a];if(\"match_quality\" in b){g.match_quality=b.match_quality}else{g.match_quality=1}g.housenumber=b.building_number;g.housename2=this.leading_caps(b.sub_building_name,this.config.addr_uppercase);g.housename1=this.leading_caps(b.building_name,this.config.addr_uppercase);g.org=b.department_name;if(\"\"!=g.org&&\"\"!=b.organisation_name){g.org+=this.config.delimiter}g.org=this.leading_caps(g.org+b.organisation_name,this.config.org_uppercase);g.pobox=this.leading_caps(b.po_box_number,this.config.addr_uppercase);g.postcode=f.postcode;g.town=this.leading_caps(f.town,this.config.town_uppercase);g.locality=this.leading_caps(f.dependent_locality,this.config.addr_uppercase);g.locality_dep=this.leading_caps(f.double_dependent_locality,this.config.addr_uppercase);if(this.config.traditional_county){g.county=this.leading_caps(f.traditional_county,this.config.county_uppercase)}else{g.county=this.leading_caps(f.postal_county,this.config.county_uppercase)}g.udprn=b.udprn;this.res_arr[this.res_arr_idx]=g;this.res_arr_idx++}}else{var g=this.new_res_line();g.street1=e;g.street2=c;g.postcode=f.postcode;g.town=this.leading_caps(f.town,this.config.town_uppercase);g.locality=this.leading_caps(f.dependent_locality,this.config.addr_uppercase);g.locality_dep=this.leading_caps(f.double_dependent_locality,this.config.addr_uppercase);if(this.config.traditional_county){g.county=this.leading_caps(f.traditional_county,this.config.county_uppercase)}else{g.county=this.leading_caps(f.postal_county,this.config.county_uppercase)}g.match_quality=2;this.res_arr[this.res_arr_idx]=g;this.res_arr_idx++}}};this.filter_data_by_house_name=function(f){var g=this.get_elem(8);if(!g||!g.value.length){return f}var j=g.value.toUpperCase();var k=-1;if(parseInt(j)==j){k=parseInt(j)}var l=\" \"+j;var e=[];var i=1;var b=0;for(var c=1;c<=f.thoroughfare_count;c++){e[i]=[];b=0;for(var d=1;d<=f[c][\"delivery_point_count\"];d++){var h=f[c][d];var a=\" \"+h.sub_building_name+\" \"+h.building_name+\" \";if(-1!=a.indexOf(l)||k==parseInt(h.building_number)){b++;e[i][b]=[];e[i][b][\"building_number\"]=h.building_number;e[i][b][\"sub_building_name\"]=h.sub_building_name;e[i][b][\"building_name\"]=h.building_name;e[i][b][\"department_name\"]=h.department_name;e[i][b][\"organisation_name\"]=h.organisation_name;e[i][b][\"po_box_number\"]=h.po_box_number;e[i][b][\"udprn\"]=h.udprn}}if(b){e[i][\"delivery_point_count\"]=b;e[i][\"thoroughfare_name\"]=f[c][\"thoroughfare_name\"];e[i][\"thoroughfare_descriptor\"]=f[c][\"thoroughfare_descriptor\"];e[i][\"dependent_thoroughfare_name\"]=f[c][\"dependent_thoroughfare_name\"];e[i][\"dependent_thoroughfare_descriptor\"]=f[c][\"dependent_thoroughfare_descriptor\"];i++}}if(1<i){e.thoroughfare_count=i-1;e.town=f.town;e.dependent_locality=f.dependent_locality;e.double_dependent_locality=f.double_dependent_locality;e.traditional_county=f.traditional_county;e.postal_county=f.postal_county;e.postcode=f.postcode;return e}return null};this.lookup_timeout_err=function(){this.disp_err(\"9001\",\"Internal Timeout after \"+this.config.lookup_timeout+\"ms\")}}};","Craftyclicks_Ukpostcodelookup/form_integrations/cc_iwd_checkout.js":"/*\n// This is a collection of JavaScript code to allow easy integration of\n// the Crafty Clicks postcode / address finder functionality into Magento 2\n// custom checkout by IWD. Tested with IWD Checkout Suite version 3.2.0.\n//\n// Provided by www.CraftyClicks.co.uk\n//\n// Requires standard CraftyClicks JS - tested with v4.9.3\n//\n// If you copy/use/modify this code - please keep this\n// comment header in place\n//\n// Copyright (c) 2009-2018 Crafty Clicks (http://www.craftyclicks.com)\n//\n// This code relies on jQuery, you must have a reasonably recent version loaded\n// in your template. Magento should include it as standard.\n//\n// If you need any help, contact support@craftyclicks.co.uk - we will help!\n//\n**********************************************************************************/\n\nfunction CraftyClicksMagento2Class() {\n\tthis.current_setup = 'initial';\n\n\t// initial page setup\n\tthis.initial_setup =function() {\n\t\t// move fields\n\t\tjQuery('#' + this.misc.container_id).find('[name=\"lastname\"]').closest('.field').after(jQuery('#' + this.fields.country_id).closest('.field'));\n\t\tjQuery('#' + this.fields.country_id).closest('.field').before(jQuery('#' + this.fields.company_id).closest('.field'));\n\n\t\t// add cp address class to fields and labels so we can easily grab them for the hide fields feature\n\t\tvar that = this;\n\t\tjQuery.each(this.fields, function(index, value) {\n\t\t\tif (value !== that.fields.postcode_id && value !== that.fields.country_id && value !== that.fields.company_id) {\n\t\t\t\tjQuery('#' + value).closest('.field').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\tif (value == that.fields.address_1_id) {\n\t\t\t\t\tjQuery('#' + value).closest('.field').parent().closest('.field').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tthis.setup_for_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('uk' != this.current_setup) {\n\t\t\t// do the magic for UK\n\n\t\t\t// move postcode to show after country and add placeholder\n\t\t\tjQuery('#' + this.fields.country_id).closest('.field').after(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('placeholder', crafty_cfg.txt.search_placeholder);\n\n\t\t\t// check if button already exists\n\t\t\t// Step 6 - add prefix to button and result display so they are unique\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_button_id').length == 0) {\n\t\t\t\t// add button after postcode input\n\t\t\t\tvar tmp_html = '<div class=\"field\"><div><button id=\"' + this.misc.prefix + '_cp_button_id\" type=\"button\" class=\"iwd_opc_button active iwd_opc_place_order_button\"><span>' + crafty_cfg.txt.search_buttontext + '</span></button></div></div>';\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.field').after(tmp_html);\n\n\t\t\t\t// add click event listener to button\n\t\t\t\tvar el = document.getElementById(this.misc.prefix + '_cp_button_id');\n\t\t\t\tif (el != null) {\n\t\t\t\t\tel.addEventListener('click', this.button_clicked.bind(this));\n\t\t\t\t}\n\n\t\t\t\t// add results after button\n\t\t\t\tjQuery('#'+this.misc.prefix+'_cp_button_id').closest('.field').after('<div class=\"field\" style=\"display: none;\"><div id=\"' + this.misc.prefix + '_cp_result_display\" class=\"search-list\"></div></div>');\n\t\t\t} else {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_button_id').show();\n\t\t\t}\n\n\t\t\t// disable autofill\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('autocomplete', 'new-password')\n\t\t}\n\n\t\tif (crafty_cfg.hide_fields) {\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').hide();\n\t\t}\n\n\t\tthis.current_setup = 'uk';\n\t}\n\n\tthis.setup_for_non_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('non_uk' != this.current_setup) {\n\t\t\t// move postcode field to show after region\n\t\t\tjQuery('#' + this.fields.county_id).closest('.field').after(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\n\t\t\t// hide button and result box if they exist\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_button_id').length == 1) {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_button_id').hide();\n\t\t\t}\n\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_result_display').length == 1) {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').hide();\n\t\t\t}\n\n\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').children('select').remove();\n\n\t\t\t// show fields\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\n\t\t\t// enable autofill\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('autocomplete', 'postal-code')\n\n\t\t\tthis.current_setup = 'non_uk';\n\t\t}\n\t}\n\n\tthis.add_lookup = function(setup) {\n\t\t// Step 5 - make sure we only do add_lookup once per instance\n\t\tif (jQuery('#'+setup.fields.postcode_id).attr('cc-applied') == \"1\") {\n\t\t\treturn\n\t\t}\n\t\tcp_obj = CraftyPostcodeCreate(); // instantiate library magic\n\t\tthis.cp_obj = cp_obj;\n\t\t// config\n\t\tthis.fields = setup.fields;\n\t\tthis.misc = setup.misc;\n\n\t\t// the set method is shorthand and is equivalent to cp_obj.config['configItem'] = configValue;\n\t\tcp_obj.set(\"result_elem_id\", this.misc.prefix + \"_cp_result_display\");\n\t\tcp_obj.set(\"form\", \"\");\n\t\tcp_obj.set(\"elem_company\", this.fields.company_id);\n\t\tcp_obj.set(\"elem_street1\", this.fields.address_1_id);\n\t\tcp_obj.set(\"elem_street2\", this.fields.address_2_id);\n\t\tcp_obj.set(\"elem_postcode\", this.fields.postcode_id);\n\t\tcp_obj.set(\"elem_town\", this.fields.town_id);\n\t\tcp_obj.set(\"elem_country\", this.fields.country_id);\n\t\tcp_obj.set(\"elem_county\", this.fields.county_id);\n\n\t\tcp_obj.set(\"container_elem\", this.misc.container_elem);\n\t\tcp_obj.set(\"prefix\", this.misc.prefix);\n\n\t\tcp_obj.set(\"access_token\", crafty_cfg.key);\n\t\tcp_obj.set(\"res_autoselect\", \"0\");\n\t\tcp_obj.set(\"single_res_autoselect\" , 0);\n\t\tcp_obj.set(\"max_lines\" , 1);\n\n\t\tif (crafty_cfg.advanced.county_data == 'traditional') {\n\t\t\tcp_obj.set(\"traditional_county\" , 1);\n\t\t} else if (crafty_cfg.advanced.county_data == 'former_postal') {\n\t\t\tcp_obj.set(\"traditional_county\" , 0);\n\t\t}\n\n\t\tcp_obj.set(\"busy_img_url\" , null);\n\t\tcp_obj.set(\"hide_result\" , false);\n\t\tcp_obj.set(\"on_result_ready\", this.result_ready.bind(this));\n\t\tcp_obj.set(\"on_result_selected\", this.result_selected.bind(this));\n\t\tcp_obj.set(\"on_error\", this.result_error.bind(this));\n\t\tcp_obj.set(\"first_res_line\", '---- please select your address ----');\n\t\tcp_obj.set(\"err_msg1\", crafty_cfg.error_msg['0001']);\n\t\tcp_obj.set(\"err_msg2\", crafty_cfg.error_msg['0002']);\n\t\tcp_obj.set(\"err_msg3\", crafty_cfg.error_msg['0003']);\n\t\tcp_obj.set(\"err_msg4\", crafty_cfg.error_msg['0004']);\n\t\tcp_obj.set(\"max_width\", \"100%\");\n\n\t\t// do initial setup\n\t\tthis.initial_setup();\n\n\t\t// do setup for current country\n\t\tthis.country_changed();\n\n\t\t// listen for country changes\n\t\tvar countryEl = document.getElementById(this.fields.country_id);\n\t\tcountryEl.addEventListener('change', this.country_changed.bind(this));\n\n\t\tjQuery('#'+setup.fields.postcode_id).attr('cc-applied', '1');\n\t}\n\n\tthis.country_changed = function(e) {\n\t\t// show postcode lookup for:\n\t\t// \"GB\" UK\n\t\t// \"JE\" Jersey\n\t\t// \"GG\" Guernsey\n\t\t// \"IM\" Isle of Man\n\t\tvar curr_country = jQuery('#' + this.fields.country_id).val();\n\t\tif ('GB' == curr_country || 'JE' == curr_country || 'GG' == curr_country || 'IM' == curr_country) {\n\t\t\tthis.setup_for_uk();\n\t\t} else {\n\t\t\tthis.setup_for_non_uk();\n\t\t}\n\t}\n\n\tthis.button_clicked = function(e) {\n\t\te.preventDefault();\n\t\tjQuery('#' + this.misc.prefix +'_cp_result_display').siblings('.field-error').children('.search-subtext').hide();\n\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').closest('.field').show();\n\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').show();\n\t\tthis.cp_obj.doLookup();\n\t}\n\n\tthis.result_ready = function() {\n\n\t}\n\n\tthis.result_selected = function() {\n\t\t// update country field if user selects address from GG/JE, etc.\n\t\tswitch(jQuery('#' + this.fields.postcode_id).val().substring(0,2)){\n\t\t\tcase \"GY\":\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"GG\");\n\t\t\t\tbreak;\n\t\t\tcase \"JE\":\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"JE\");\n\t\t\t\tbreak;\n\t\t\tcase \"IM\":\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"IM\");\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"GB\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (crafty_cfg.advanced.county_data == 'none') {\n\t\t\tjQuery('#'+this.fields.county_id).val('');\n\t\t}\n\n\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\n\t\t// trigger change event on address fields to satisfy magento required fields\n\t\tjQuery('#'+this.fields.company_id).trigger('change');\n\t\tjQuery('#'+this.fields.address_1_id).trigger('change');\n\t\tjQuery('#'+this.fields.address_2_id).trigger('change');\n\t\tjQuery('#'+this.fields.postcode_id).trigger('change');\n\t\tjQuery('#'+this.fields.town_id).trigger('change');\n\t\tjQuery('#'+this.fields.county_id).trigger('change');\n\t\tjQuery('#'+this.fields.country_id).trigger('change');\n\t}\n\n\tthis.result_error = function() {\n\t\t// apply magento error styling\n\t\tjQuery('#shipping_cp_result_display').removeClass('search-list');\n\t\tjQuery('#shipping_cp_result_display').addClass('field-error');\n\n\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\t}\n}\n\n\nactivate_cc = function() {\n\tif (jQuery('#co-shipping-form').find('[name=\"postcode\"]').length == 1) {\n\t\t// Step 3 - now that we know this form exists, create an instance from our constructor\n\t\tvar cc1 = new CraftyClicksMagento2Class();\n\t\t// Step 4 - run the add_lookup method on our instance and pass it field id's\n\t\tcc1.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\tjQuery('#co-shipping-form').find('[name=\"company\"]').attr('id'),\n\t\t\t\t\"address_1_id\":\t\tjQuery('#co-shipping-form').find('[name=\"street[0]\"]').attr('id'),\n\t\t\t\t\"address_2_id\":\t\tjQuery('#co-shipping-form').find('[name=\"street[1]\"]').attr('id'),\n\t\t\t\t\"postcode_id\":\t\tjQuery('#co-shipping-form').find('[name=\"postcode\"]').attr('id'),\n\t\t\t\t\"town_id\":\t\t\t\tjQuery('#co-shipping-form').find('[name=\"city\"]').attr('id'),\n\t\t\t\t\"county_id\":\t\t\tjQuery('#co-shipping-form').find('[name=\"region\"]').attr('id'),\n\t\t\t\t\"country_id\":\t\t\tjQuery('#co-shipping-form').find('[name=\"country_id\"]').attr('id'),\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_id\":\t\t\t\"co-shipping-form\",\n\t\t\t\t\"prefix\":\t\t\t\t\t\t\"shipping\"\n\t\t\t}\n\t\t});\n\t}\n\n\tif (jQuery('#co-payment-form').find('[name=\"postcode\"]').length == 1) {\n\t\tvar cc2 = new CraftyClicksMagento2Class();\n\t\tcc2.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\tjQuery('#co-payment-form').find('[name=\"company\"]').attr('id'),\n\t\t\t\t\"address_1_id\":\t\tjQuery('#co-payment-form').find('[name=\"street[0]\"]').attr('id'),\n\t\t\t\t\"address_2_id\":\t\tjQuery('#co-payment-form').find('[name=\"street[1]\"]').attr('id'),\n\t\t\t\t\"address_3_id\":\t\tjQuery('#co-shipping-form').find('[name=\"street[2]\"]').attr('id'),\n\t\t\t\t\"postcode_id\":\t\tjQuery('#co-payment-form').find('[name=\"postcode\"]').attr('id'),\n\t\t\t\t\"town_id\":\t\t\t\tjQuery('#co-payment-form').find('[name=\"city\"]').attr('id'),\n\t\t\t\t\"county_id\":\t\t\tjQuery('#co-payment-form').find('[name=\"region\"]').attr('id'),\n\t\t\t\t\"country_id\":\t\t\tjQuery('#co-payment-form').find('[name=\"country_id\"]').attr('id'),\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_id\":\t\t\t\"co-payment-form\",\n\t\t\t\t\"prefix\":\t\t\t\t\t\t\"payment\"\n\t\t\t}\n\t\t});\n\t}\n}\n\nrequirejs(['jquery'], function($) {\n\tjQuery(document).ready(function() {\n\t\t// Step 1 - check crafty is enabled\n\t\tif (crafty_cfg.enabled) {\n\t\t\t// Step 2 - page takes a while to load, so continuously check for form\n\t\t\tsetInterval(activate_cc, 200);\n\t\t}\n\n\t});\n});","Craftyclicks_Ukpostcodelookup/form_integrations/cc_default_checkout.js":"/*\n// This is a collection of JavaScript code to allow easy integration of\n// the Crafty Clicks postcode / address finder functionality into Magento 2\n//\n// This file works for the standard magento 2 checkout (both community and enterprise)\n//\n// Provided by www.CraftyClicks.co.uk\n//\n// Requires standard CraftyClicks JS - tested with v4.9.3\n//\n// If you copy/use/modify this code - please keep this\n// comment header in place\n//\n// Copyright (c) 2009-2018 Crafty Clicks (http://www.craftyclicks.com)\n//\n// This code relies on jQuery, you must have a reasonably recent version loaded\n// in your template. Magento should include it as standard.\n//\n// If you need any help, contact support@craftyclicks.co.uk - we will help!\n//\n**********************************************************************************/\n\nfunction CraftyClicksMagento2Class() {\n\tthis.current_setup = 'initial';\n\n\t// initial page setup\n\tthis.initial_setup =function() {\n\t\t// move country field to top\n\t\tjQuery('#' + this.misc.container_id).find('[name=\"lastname\"]').closest('.field').after(jQuery('#' + this.fields.country_id).closest('.field'));\n\t\t// if hide fields is true, move telephone field up\n\t\tif (crafty_cfg.hide_fields) {\n\t\t\tjQuery('#' + this.fields.country_id).closest('.field').before(jQuery('#' + this.misc.container_id).find('[name=\"telephone\"]').closest('.field'));\n\t\t}\n\n\t\t// add cp address class to fields and labels so we can easily grab them for the hide fields feature\n\t\tvar that = this;\n\t\tjQuery.each(this.fields, function(index, value) {\n\t\t\tif (value !== that.fields.postcode_id && value !== that.fields.country_id) {\n\t\t\t\tjQuery('#' + value).closest('.control').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\tjQuery('#' + value).closest('.control').prev('label').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\tif (value == that.fields.address_1_id) {\n\t\t\t\t\tjQuery('#' + value).closest('.control').parent().closest('.control').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\t\tjQuery('#' + value).closest('.control').parent().closest('.control').prev('.label').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tthis.setup_for_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('uk' != this.current_setup) {\n\t\t\t// do the magic for UK\n\n\t\t\t// move postcode to show after country and add placeholder\n\t\t\tjQuery('#' + this.fields.country_id).closest('.field').after(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('placeholder', crafty_cfg.txt.search_placeholder);\n\n\t\t\t// check if button already exists\n\t\t\t// Step 6 - add prefix to button and result display so they are unique\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_button_id').length == 0) {\n\t\t\t\tjQuery('#'+this.fields.postcode_id).wrap('<div class=\"search-bar\"></div>');\n\n\t\t\t\t// add button after postcode input\n\t\t\t\tvar tmp_html = '<button id=\"' + this.misc.prefix + '_cp_button_id\" type=\"button\" class=\"action primary\"><span>' + crafty_cfg.txt.search_buttontext + '</span></button>';\n\t\t\t\tjQuery('#'+this.fields.postcode_id).after(tmp_html);\n\n\t\t\t\t// add click event listener to button\n\t\t\t\tvar el = document.getElementById(this.misc.prefix + '_cp_button_id');\n\t\t\t\tif (el != null) {\n\t\t\t\t\tel.addEventListener('click', this.button_clicked.bind(this));\n\t\t\t\t}\n\n\t\t\t\t// add search-list and mage-error after search-bar\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.search-bar').after('<div id=\"' + this.misc.prefix + '_cp_result_display\" class=\"search-list\"></div>');\n\n\t\t\t\tjQuery('#'+this.misc.prefix + '_cp_result_display').after('<div class=\"search-list\" style=\"display: none;\"><select></select></div>'+\n\t\t\t\t'<div id=\"cc_' + this.misc.prefix + '_error\" class=\"mage-error\" generated><div class=\"search-subtext\"></div></div>');\n\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.field').addClass('search-container type_3')\n\t\t\t} else {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_button_id').show();\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').show();\n\t\t\t\tjQuery('#' + this.fields.postcode_id).closest('.field').addClass(\"search-container type_3\");\n\t\t\t}\n\n\t\t\t// disable autofill\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('autocomplete', 'new-password')\n\t\t}\n\n\t\tif ('initial' == this.current_setup && crafty_cfg.hide_fields) {\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').hide();\n\t\t} else if ('non_uk' == this.current_setup && crafty_cfg.hide_fields && jQuery('#' + this.fields.postcode_id).val() === \"\") {\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').hide();\n\t\t}\n\n\t\tthis.current_setup = 'uk';\n\t}\n\n\tthis.setup_for_non_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('non_uk' != this.current_setup) {\n\t\t\t// move postcode field to show after region\n\t\t\tjQuery('#' + this.fields.county_id).closest('.field').after(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\n\t\t\t// hide button and result box if they exist\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_button_id').length == 1) {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_button_id').hide();\n\t\t\t}\n\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_result_display').length == 1) {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').hide();\n\t\t\t}\n\n\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').children('select').remove();\n\n\t\t\t// reset postcode input width\n\t\t\tjQuery('#' + this.fields.postcode_id).closest('.field').removeClass(\"search-container type_3\");\n\n\t\t\t// show fields\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\n\t\t\t// enable autofill\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('autocomplete', 'postal-code')\n\n\t\t\tthis.current_setup = 'non_uk';\n\t\t}\n\t}\n\n\tthis.add_lookup = function(setup) {\n\t\t// Step 5 - make sure we only do add_lookup once per instance\n\t\tif (jQuery('#'+setup.fields.postcode_id).attr('cc-applied') == \"1\") {\n\t\t\treturn\n\t\t}\n\t\tcp_obj = CraftyPostcodeCreate(); // instantiate library magic\n\t\tthis.cp_obj = cp_obj;\n\t\t// config\n\t\tthis.fields = setup.fields;\n\t\tthis.misc = setup.misc;\n\n\t\t// the set method is shorthand and is equivalent to cp_obj.config['configItem'] = configValue;\n\t\tcp_obj.set(\"result_elem_id\", this.misc.prefix + \"_cp_result_display\");\n\t\tcp_obj.set(\"form\", \"\");\n\t\tcp_obj.set(\"elem_company\", this.fields.company_id);\n\t\tcp_obj.set(\"elem_street1\", this.fields.address_1_id);\n\t\tcp_obj.set(\"elem_street2\", this.fields.address_2_id);\n\t\tcp_obj.set(\"elem_postcode\", this.fields.postcode_id);\n\t\tcp_obj.set(\"elem_town\", this.fields.town_id);\n\t\tcp_obj.set(\"elem_country\", this.fields.country_id);\n\t\tcp_obj.set(\"elem_county\", this.fields.county_id);\n\n\t\tcp_obj.set(\"prefix\", this.misc.prefix);\n\n\t\tcp_obj.set(\"access_token\", crafty_cfg.key);\n\t\tcp_obj.set(\"res_autoselect\", \"0\");\n\t\tcp_obj.set(\"single_res_autoselect\" , 0);\n\t\tcp_obj.set(\"max_lines\" , 1);\n\n\t\tif (crafty_cfg.advanced.county_data == 'traditional') {\n\t\t\tcp_obj.set(\"traditional_county\" , 1);\n\t\t} else if (crafty_cfg.advanced.county_data == 'former_postal') {\n\t\t\tcp_obj.set(\"traditional_county\" , 0);\n\t\t}\n\n\t\tcp_obj.set(\"busy_img_url\" , null);\n\t\tcp_obj.set(\"hide_result\" , false);\n\t\tcp_obj.set(\"on_result_ready\", this.result_ready.bind(this));\n\t\tcp_obj.set(\"on_result_selected\", this.result_selected.bind(this));\n\t\tcp_obj.set(\"on_error\", this.result_error.bind(this));\n\t\tcp_obj.set(\"first_res_line\", '---- please select your address ----');\n\t\tcp_obj.set(\"err_msg1\", crafty_cfg.error_msg['0001']);\n\t\tcp_obj.set(\"err_msg2\", crafty_cfg.error_msg['0002']);\n\t\tcp_obj.set(\"err_msg3\", crafty_cfg.error_msg['0003']);\n\t\tcp_obj.set(\"err_msg4\", crafty_cfg.error_msg['0004']);\n\t\tcp_obj.set(\"max_width\", \"100%\");\n\n\t\t// do initial setup\n\t\tthis.initial_setup();\n\n\t\t// do setup for current country\n\t\tthis.country_changed();\n\n\t\t// listen for country changes\n\t\tvar countryEl = document.getElementById(this.fields.country_id);\n\t\tcountryEl.addEventListener('change', this.country_changed.bind(this));\n\n\t\tjQuery('#'+setup.fields.postcode_id).attr('cc-applied', '1');\n\t}\n\n\tthis.country_changed = function(e) {\n\t\t// show postcode lookup for:\n\t\t// \"GB\" UK\n\t\t// \"JE\" Jersey\n\t\t// \"GG\" Guernsey\n\t\t// \"IM\" Isle of Man\n\t\tvar curr_country = jQuery('#' + this.fields.country_id).val();\n\t\tif ('GB' == curr_country || 'JE' == curr_country || 'GG' == curr_country || 'IM' == curr_country) {\n\t\t\tthis.setup_for_uk();\n\t\t} else {\n\t\t\tthis.setup_for_non_uk();\n\t\t}\n\t}\n\n\tthis.button_clicked = function() {\n\t\tthis.cp_obj.doLookup();\n\t}\n\n\tthis.result_ready = function() {\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').hide();\n\t}\n\n\tthis.result_selected = function() {\n\t\t// update country field if user selects address from GG/JE, etc.\n\t\tswitch(jQuery('#' + this.fields.postcode_id).val().substring(0,2)){\n\t\t\tcase \"GY\":\n\t\t\tjQuery('#' + this.fields.country_id).val(\"GG\");\n\t\t\tbreak;\n\t\t\tcase \"JE\":\n\t\t\tjQuery('#' + this.fields.country_id).val(\"JE\");\n\t\t\tbreak;\n\t\t\tcase \"IM\":\n\t\t\tjQuery('#' + this.fields.country_id).val(\"IM\");\n\t\t\tbreak;\n\t\t\tdefault:\n\t\t\tjQuery('#' + this.fields.country_id).val(\"GB\");\n\t\t\tbreak;\n\t\t}\n\n\t\tif (crafty_cfg.advanced.county_data == 'none') {\n\t\t\tjQuery('#'+this.fields.county_id).val('')\n\t\t}\n\n\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\n\t\t// trigger change event on address fields to satisfy magento required fields\n\t\tjQuery('#'+this.cp_obj.config[\"elem_company\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_street1\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_street2\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_postcode\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_town\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_county\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_country\"]).trigger('change');\n\t}\n\n\tthis.result_error = function() {\n\t\t// apply magento error styling\n\t\tlet error = jQuery('#' + this.misc.prefix + '_cp_result_display').text();\n\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').text('');\n\t\tjQuery('#' + this.misc.prefix +'_cp_result_display').siblings('.mage-error').children('.search-subtext').text(error);\n\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').show();\n\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\t}\n}\n\n\nactivate_cc = function() {\n\tif (jQuery('#checkout-step-shipping').find('[name=\"postcode\"]').length == 1) {\n\t\t// Step 3 - now that we know this form exists, create an instance from our constructor\n\t\tvar cc1 = new CraftyClicksMagento2Class();\n\t\t// Step 4 - run the add_lookup method on our instance and pass it field id's\n\t\tcc1.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\tjQuery('#checkout-step-shipping').find('[name=\"company\"]').attr('id'),\n\t\t\t\t\"address_1_id\":\t\tjQuery('#checkout-step-shipping').find('[name=\"street[0]\"]').attr('id'),\n\t\t\t\t\"address_2_id\":\t\tjQuery('#checkout-step-shipping').find('[name=\"street[1]\"]').attr('id'),\n\t\t\t\t\"postcode_id\":\t\tjQuery('#checkout-step-shipping').find('[name=\"postcode\"]').attr('id'),\n\t\t\t\t\"town_id\":\t\t\t\tjQuery('#checkout-step-shipping').find('[name=\"city\"]').attr('id'),\n\t\t\t\t\"county_id\":\t\t\tjQuery('#checkout-step-shipping').find('[name=\"region\"]').attr('id'),\n\t\t\t\t\"country_id\":\t\t\tjQuery('#checkout-step-shipping').find('[name=\"country_id\"]').attr('id'),\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_id\":\t\t\t\"checkout-step-shipping\",\n\t\t\t\t\"prefix\":\t\t\t\t\t\t\"shipping\"\n\t\t\t}\n\t\t});\n\t}\n\n\tif (jQuery('#checkout-step-payment').find('[name=\"postcode\"]').length == 1) {\n\t\tvar cc2 = new CraftyClicksMagento2Class();\n\t\tcc2.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\tjQuery('#checkout-step-payment').find('[name=\"company\"]').attr('id'),\n\t\t\t\t\"address_1_id\":\t\tjQuery('#checkout-step-payment').find('[name=\"street[0]\"]').attr('id'),\n\t\t\t\t\"address_2_id\":\t\tjQuery('#checkout-step-payment').find('[name=\"street[1]\"]').attr('id'),\n\t\t\t\t\"address_3_id\":\t\tjQuery('#checkout-step-shipping').find('[name=\"street[2]\"]').attr('id'),\n\t\t\t\t\"postcode_id\":\t\tjQuery('#checkout-step-payment').find('[name=\"postcode\"]').attr('id'),\n\t\t\t\t\"town_id\":\t\t\t\tjQuery('#checkout-step-payment').find('[name=\"city\"]').attr('id'),\n\t\t\t\t\"county_id\":\t\t\tjQuery('#checkout-step-payment').find('[name=\"region\"]').attr('id'),\n\t\t\t\t\"country_id\":\t\t\tjQuery('#checkout-step-payment').find('[name=\"country_id\"]').attr('id'),\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_id\":\t\t\t\"checkout-step-payment\",\n\t\t\t\t\"prefix\":\t\t\t\t\t\t\"payment\"\n\t\t\t}\n\t\t});\n\t}\n}\n\nrequirejs(['jquery'], function($) {\n\tjQuery(document).ready(function() {\n\t\t// Step 1 - check crafty is enabled\n\t\tif (crafty_cfg.enabled) {\n\t\t\t// Step 2 - page takes a while to load, so continuously check for forms\n\t\t\tsetInterval(activate_cc, 200);\n\t\t}\n\n\t});\n});","Craftyclicks_Ukpostcodelookup/form_integrations/cc_customer_address.js":"/*\n// This is a collection of JavaScript code to allow easy integration of\n// the Crafty Clicks postcode / address finder functionality into Magento 2\n//\n// Provided by www.CraftyClicks.co.uk\n//\n// Requires standard CraftyClicks JS - tested with v4.9.3\n//\n// If you copy/use/modify this code - please keep this\n// comment header in place\n//\n// Copyright (c) 2009-2018 Crafty Clicks (http://www.craftyclicks.com)\n//\n// This code relies on jQuery, you must have a reasonably recent version loaded\n// in your template. Magento should include it as standard.\n//\n// If you need any help, contact support@craftyclicks.co.uk - we will help!\n//\n**********************************************************************************/\n\nfunction CraftyClicksMagento2Class() {\n\tthis.current_setup = 'initial';\n\n\t// initial page setup\n\tthis.initial_setup =function() {\n\t\t// move fields\n\t\tjQuery('#' + this.fields.company_id).closest('.field').before(jQuery('#' + this.fields.country_id).closest('.field'));\n\t\tjQuery('#' + this.fields.company_id).closest('.field').before(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\t}\n\n\tthis.setup_for_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('uk' != this.current_setup) {\n\t\t\t// do the magic for UK\n\n\t\t\t// add placeholder\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('placeholder', crafty_cfg.txt.search_placeholder);\n\n\t\t\t// check if button already exists\n\t\t\tif (jQuery('#cp_button_id').length == 0) {\n\t\t\t\tjQuery('#'+this.fields.postcode_id).wrap('<div class=\"search-bar\"></div>');\n\n\t\t\t\t// add button BEFORE postcode input (prevents m2 postcode validation from hijacking cc button)\n\t\t\t\tvar tmp_html = '<button id=\"cp_button_id\" type=\"button\" class=\"action primary\"><span>' + crafty_cfg.txt.search_buttontext + '</span></button>';\n\t\t\t\tjQuery('#'+this.fields.postcode_id).before(tmp_html);\n\n\t\t\t\t// add click event listener to button\n\t\t\t\tvar el = document.getElementById('cp_button_id');\n\t\t\t\tif (el != null) {\n\t\t\t\t\tel.addEventListener('click', this.button_clicked.bind(this));\n\t\t\t\t}\n\n\t\t\t\t// add search-list and mage-error after search-bar\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.search-bar').after('<div id=\"cp_result_display\" class=\"search-list\"></div>');\n\n\t\t\t\tjQuery('#cp_result_display').after('<div class=\"search-list\" style=\"display: none;\"><select></select></div>'+\n\t\t\t\t'<div id=\"cc_' + this.misc.prefix + '_error\" class=\"mage-error\" generated><div class=\"search-subtext\"></div></div>');\n\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.field').addClass('search-container type_3')\n\n\t\t\t\t// move m2 error field after zip (fix to prevent m2 postcode validation hijacking cc button)\n\t\t\t\tvar warningElem = jQuery('#'+this.fields.postcode_id).closest('.form-address-edit').find('div .warning')\n\t\t\t\tjQuery('#'+this.fields.postcode_id).after(warningElem)\n\n\t\t\t} else {\n\t\t\t\tjQuery('#cp_button_id').show();\n\t\t\t\tjQuery('#cp_result_display').show();\n\t\t\t\tjQuery('#' + this.fields.postcode_id).closest('.field').addClass(\"search-container type_3\");\n\t\t\t}\n\t\t}\n\n\t\tthis.current_setup = 'uk';\n\t}\n\n\tthis.setup_for_non_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('non_uk' != this.current_setup) {\n\t\t\t// hide button and result box if they exist\n\t\t\tif (jQuery('#cp_button_id').length == 1) {\n\t\t\t\tjQuery('#cp_button_id').hide();\n\t\t\t}\n\n\t\t\tif (jQuery('#cp_result_display').length == 1) {\n\t\t\t\tjQuery('#cp_result_display').hide();\n\t\t\t}\n\n\t\t\tjQuery('#cp_result_display').children('select').remove();\n\n\t\t\t// reset postcode input width\n\t\t\tjQuery('#' + this.fields.postcode_id).closest('.field').removeClass(\"search-container type_3\");\n\n\t\t\tthis.current_setup = 'non_uk';\n\t\t}\n\t}\n\n\tthis.add_lookup = function(setup) {\n\t\t// Step 5 - make sure we only do add_lookup once per instance\n\t\tif (jQuery('#'+setup.fields.postcode_id).attr('cc-applied') == \"1\") {\n\t\t\treturn\n\t\t}\n\t\tcp_obj = CraftyPostcodeCreate(); // instantiate library magic\n\t\tthis.cp_obj = cp_obj;\n\t\t// config\n\t\tthis.fields = setup.fields;\n\t\tthis.misc = setup.misc;\n\n\t\t// the set method is shorthand and is equivalent to cp_obj.config['configItem'] = configValue;\n\t\tcp_obj.set(\"result_elem_id\", \"cp_result_display\");\n\t\tcp_obj.set(\"form\", \"\");\n\t\tcp_obj.set(\"elem_company\", this.fields.company_id);\n\t\tcp_obj.set(\"elem_street1\", this.fields.address_1_id);\n\t\tcp_obj.set(\"elem_street2\", this.fields.address_2_id);\n\t\tcp_obj.set(\"elem_postcode\", this.fields.postcode_id);\n\t\tcp_obj.set(\"elem_town\", this.fields.town_id);\n\t\tcp_obj.set(\"elem_country\", this.fields.country_id);\n\n\t\tif (crafty_cfg.advanced.county_data !== 'none') {\n\t\t\tcp_obj.set(\"elem_county\", this.fields.county_id);\n\t\t}\n\n\t\tcp_obj.set(\"container_elem\", this.misc.container_elem);\n\n\t\tcp_obj.set(\"access_token\", crafty_cfg.key);\n\t\tcp_obj.set(\"res_autoselect\", \"0\");\n\t\tcp_obj.set(\"single_res_autoselect\" , 0);\n\t\tcp_obj.set(\"max_lines\" , 1);\n\n\t\tif (crafty_cfg.advanced.county_data == 'traditional') {\n\t\t\tcp_obj.set(\"traditional_county\" , 1);\n\t\t} else if (crafty_cfg.advanced.county_data == 'former_postal') {\n\t\t\tcp_obj.set(\"traditional_county\" , 0);\n\t\t}\n\n\t\tcp_obj.set(\"busy_img_url\" , null);\n\t\tcp_obj.set(\"hide_result\" , false);\n\t\tcp_obj.set(\"on_result_ready\", this.result_ready.bind(this));\n\t\tcp_obj.set(\"on_result_selected\", this.result_selected.bind(this));\n\t\tcp_obj.set(\"on_error\", this.result_error.bind(this));\n\t\tcp_obj.set(\"first_res_line\", '---- please select your address ----');\n\t\tcp_obj.set(\"err_msg1\", crafty_cfg.error_msg['0001']);\n\t\tcp_obj.set(\"err_msg2\", crafty_cfg.error_msg['0002']);\n\t\tcp_obj.set(\"err_msg3\", crafty_cfg.error_msg['0003']);\n\t\tcp_obj.set(\"err_msg4\", crafty_cfg.error_msg['0004']);\n\t\tcp_obj.set(\"max_width\", \"100%\");\n\n\t\t// do initial setup\n\t\tthis.initial_setup();\n\n\t\t// do setup for current country\n\t\tthis.country_changed();\n\n\t\t// listen for country changes\n\t\tvar countryEl = document.getElementById(this.fields.country_id);\n\t\tcountryEl.addEventListener('change', this.country_changed.bind(this));\n\n\t\tjQuery('#'+setup.fields.postcode_id).attr('cc-applied', '1');\n\t}\n\n\tthis.country_changed = function(e) {\n\t\t// show postcode lookup for:\n\t\t// \"GB\" UK\n\t\t// \"JE\" Jersey\n\t\t// \"GG\" Guernsey\n\t\t// \"IM\" Isle of Man\n\t\tvar curr_country = jQuery('#' + this.fields.country_id).val();\n\t\tif ('GB' == curr_country || 'JE' == curr_country || 'GG' == curr_country || 'IM' == curr_country) {\n\t\t\tthis.setup_for_uk();\n\t\t} else {\n\t\t\tthis.setup_for_non_uk();\n\t\t}\n\t}\n\n\tthis.button_clicked = function() {\n\t\tthis.cp_obj.doLookup();\n\t}\n\n\tthis.result_ready = function() {\n\t\tjQuery('#crafty_postcode_lookup_result_option1').addClass('admin__control-select');\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').hide();\n\t}\n\n\tthis.result_selected = function() {\n\t\t// update country field if user selects address from GG/JE, etc.\n\t\tswitch(jQuery('#' + this.fields.postcode_id).val().substring(0,2)){\n\t\t\tcase \"GY\":\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"GG\");\n\t\t\t\tbreak;\n\t\t\tcase \"JE\":\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"JE\");\n\t\t\t\tbreak;\n\t\t\tcase \"IM\":\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"IM\");\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tjQuery('#' + this.fields.country_id).val(\"GB\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (crafty_cfg.advanced.county_data == 'none') {\n\t\t\tjQuery('#'+this.fields.county_id).val('')\n\t\t}\n\n\t\t// trigger change event on address fields to satisfy magento required fields\n\t\tjQuery('#'+this.fields.company_id).trigger('change');\n\t\tjQuery('#'+this.fields.address_1_id).trigger('change');\n\t\tjQuery('#'+this.fields.address_2_id).trigger('change');\n\t\tjQuery('#'+this.fields.postcode_id).trigger('change');\n\t\tjQuery('#'+this.fields.town_id).trigger('change');\n\t\tjQuery('#'+this.fields.county_id).trigger('change');\n\t\tjQuery('#'+this.fields.country_id).trigger('change');\n\t}\n\n\tthis.result_error = function() {\n\t\t// apply magento error styling\n\t\tlet error = jQuery('#cp_result_display').text();\n\t\tjQuery('#cp_result_display').text('');\n\t\tjQuery('#cp_result_display').siblings('.mage-error').children('.search-subtext').text(error);\n\t\tjQuery('#cp_result_display').siblings('.mage-error').css('display', 'block');\n\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').show();\n\t}\n}\n\n\nactivate_cc = function() {\n\tif (jQuery('#form-validate').find('[name=\"postcode\"]').length == 1) {\n\t\t// Step 3 - now that we know this form exists, create an instance from our constructor\n\t\tvar cc1 = new CraftyClicksMagento2Class();\n\t\t// Step 4 - run the add_lookup method on our instance and pass it field id's\n\t\tcc1.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\t\"company\",\n\t\t\t\t\"address_1_id\":\t\t\"street_1\",\n\t\t\t\t\"address_2_id\":\t\t\"street_2\",\n\t\t\t\t\"postcode_id\":\t\t\"zip\",\n\t\t\t\t\"town_id\":\t\t\t\t\"city\",\n\t\t\t\t\"county_id\":\t\t\t\"region\",\n\t\t\t\t\"country_id\":\t\t\t\"country\",\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_id\":\t\"form-validate\"\n\t\t\t}\n\t\t});\n\t}\n}\n\nrequirejs(['jquery'], function($) {\n\tjQuery(document).ready(function() {\n\t\t// Step 1 - check crafty is enabled\n\t\tif (crafty_cfg.enabled) {\n\t\t\t// Step 2 - page takes a while to load, so continuously check for form\n\t\t\tsetInterval(activate_cc, 200);\n\t\t}\n\t});\n});","Craftyclicks_Ukpostcodelookup/form_integrations/cc_aheadworks_checkout.js":"/*\n// This is a collection of JavaScript code to allow easy integration of\n// the Crafty Clicks postcode / address finder functionality into \n// OneStepCheckout by Aheadworks for Magento 2. Tested with OneStepCheckout\n// version 1.2.0.\n//\n// This file works for the standard magento 2 checkout (both community and enterprise)\n//\n// Provided by www.CraftyClicks.co.uk\n//\n// Requires standard CraftyClicks JS - tested with v4.9.3\n//\n// If you copy/use/modify this code - please keep this\n// comment header in place\n//\n// Copyright (c) 2009-2018 Crafty Clicks (http://www.craftyclicks.com)\n//\n// This code relies on jQuery, you must have a reasonably recent version loaded\n// in your template. Magento should include it as standard.\n//\n// If you need any help, contact support@craftyclicks.co.uk - we will help!\n//\n**********************************************************************************/\nfunction CraftyClicksMagento2Class() {\n\tthis.current_setup = 'initial';\n\n\t// initial page setup\n\tthis.initial_setup =function() {\n\t\t// move country field to top\n\t\tjQuery('#' + this.misc.container_class).find('[name=\"lastname\"]').closest('.field').after(jQuery('#' + this.fields.country_id).closest('.field'));\n\t\t// if hide fields is true, move telephone field up\n\t\tif (crafty_cfg.hide_fields) {\n\t\t\tjQuery('#' + this.fields.country_id).closest('.field').before(jQuery('#' + this.misc.container_class).find('[name=\"telephone\"]').closest('.field'));\n\t\t}\n\n\t\t// add cp address class to fields and labels so we can easily grab them for the hide fields feature\n\t\tvar that = this;\n\t\tjQuery.each(this.fields, function(index, value) {\n\t\t\tif (value !== that.fields.postcode_id && value !== that.fields.country_id) {\n\t\t\t\tjQuery('#' + value).closest('.control').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\tjQuery('#' + value).closest('.control').prev('label').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\tif (value == that.fields.address_1_id) {\n\t\t\t\t\tjQuery('#' + value).closest('.control').parent().closest('.control').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\t\tjQuery('#' + value).closest('.control').parent().closest('.control').prev('.label').addClass(that.misc.prefix + '_cp_address_class');\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tthis.setup_for_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('uk' != this.current_setup) {\n\t\t\t// do the magic for UK\n\n\t\t\t// move postcode to show after country and add placeholder\n\t\t\tjQuery('#' + this.fields.country_id).closest('.field').after(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('placeholder', crafty_cfg.txt.search_placeholder);\n\n\t\t\t// move state to show on same row as city\n\t\t\tjQuery('#' + this.fields.town_id).closest('.field').after(jQuery('#' + this.fields.county_id).closest('.field'))\n\n\t\t\t// move row containing country and postcode to top\n\t\t\tjQuery('#' + this.fields.address_1_id).closest('.field-row').before(jQuery('#' + this.fields.postcode_id).closest('.field-row'))\n\n\t\t\t// disable autofill\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('autocomplete', 'new-password')\n\n\t\t\t// check if button already exists\n\t\t\t// Step 6 - add prefix to button and result display so they are unique\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_button_id').length == 0) {\n\t\t\t\tjQuery('#'+this.fields.postcode_id).wrap('<div class=\"search-bar\"></div>');\n\n\t\t\t\t// add button after postcode input\n\t\t\t\tvar tmp_html = '<button id=\"' + this.misc.prefix + '_cp_button_id\" type=\"button\" class=\"action primary\" style=\"height: 44px\"><span>' + crafty_cfg.txt.search_buttontext + '</span></button>';\n\t\t\t\tjQuery('#'+this.fields.postcode_id).after(tmp_html);\n\n\t\t\t\t// add click event listener to button\n\t\t\t\tvar el = document.getElementById(this.misc.prefix + '_cp_button_id');\n\t\t\t\tif (el != null) {\n\t\t\t\t\tel.addEventListener('click', this.button_clicked.bind(this));\n\t\t\t\t}\n\n\t\t\t\t// add search-list and mage-error after search-bar\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.search-bar').after('<div id=\"' + this.misc.prefix + '_cp_result_display\" class=\"search-list\"></div>');\n\n\t\t\t\tjQuery('#'+this.misc.prefix + '_cp_result_display').after('<div class=\"search-list\" style=\"display: none;\"><select></select></div>'+\n\t\t\t\t'<div id=\"cc_' + this.misc.prefix + '_error\" class=\"mage-error\" generated><div class=\"search-subtext\"></div></div>');\n\n\t\t\t\tjQuery('#'+this.fields.postcode_id).closest('.field').addClass('search-container type_3')\n\t\t\t} else {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_button_id').show();\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').show();\n\t\t\t\tjQuery('#' + this.fields.postcode_id).closest('.field').addClass(\"search-container type_3\");\n\t\t\t}\n\t\t}\n\n\t\tif ('initial' == this.current_setup && crafty_cfg.hide_fields) {\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').hide();\n\t\t} else if ('non_uk' == this.current_setup && crafty_cfg.hide_fields && jQuery('#' + this.fields.postcode_id).val() === \"\") {\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').hide();\n\t\t}\n\n\t\t// modify search input width for aheadworks\n\t\tjQuery('.search-bar').children('.input-text').attr('style', 'width: 64% !important')\n\t\t\n\t\t// hide error to avoid blank vertical space\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').hide();\n\n\t\tthis.current_setup = 'uk';\n\t}\n\n\tthis.setup_for_non_uk = function() {\n\t\t// check if we need to do anything\n\t\tif ('non_uk' != this.current_setup) {\n\t\t\t// move postcode field to show after region\n\t\t\tjQuery('#' + this.fields.county_id).closest('.field').after(jQuery('#' + this.fields.postcode_id).closest('.field'));\n\n\t\t\t// disable autofill\n\t\t\tjQuery('#' + this.fields.postcode_id).attr('autocomplete', 'postal-code')\n\n\t\t\t// hide button and result box if they exist\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_button_id').length == 1) {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_button_id').hide();\n\t\t\t}\n\n\t\t\tif (jQuery('#' + this.misc.prefix + '_cp_result_display').length == 1) {\n\t\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').hide();\n\t\t\t}\n\n\t\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').children('select').remove();\n\n\t\t\t// reset postcode input width\n\t\t\tjQuery('#' + this.fields.postcode_id).closest('.field').removeClass(\"search-container type_3\");\n\n\t\t\t// show fields\n\t\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\n\t\t\t// modify search input width for aheadworks\n\t\t\tjQuery('.search-bar').children('.input-text').attr('style', '')\n\n\t\t\t// hide error to avoid blank vertical space\n\t\t\tjQuery('#cc_' + this.misc.prefix + '_error').hide();\n\n\t\t\tthis.current_setup = 'non_uk';\n\t\t}\n\t}\n\n\tthis.add_lookup = function(setup) {\n\t\t// Step 5 - make sure we only do add_lookup once per instance\n\t\tif (jQuery('#'+setup.fields.postcode_id).attr('cc-applied') == \"1\") {\n\t\t\treturn\n\t\t}\n\t\tcp_obj = CraftyPostcodeCreate(); // instantiate library magic\n\t\tthis.cp_obj = cp_obj;\n\t\t// config\n\t\tthis.fields = setup.fields;\n\t\tthis.misc = setup.misc;\n\n\t\t// the set method is shorthand and is equivalent to cp_obj.config['configItem'] = configValue;\n\t\tcp_obj.set(\"result_elem_id\", this.misc.prefix + \"_cp_result_display\");\n\t\tcp_obj.set(\"form\", \"\");\n\t\tcp_obj.set(\"elem_company\", this.fields.company_id);\n\t\tcp_obj.set(\"elem_street1\", this.fields.address_1_id);\n\t\tcp_obj.set(\"elem_street2\", this.fields.address_2_id);\n\t\tcp_obj.set(\"elem_postcode\", this.fields.postcode_id);\n\t\tcp_obj.set(\"elem_town\", this.fields.town_id);\n\t\tcp_obj.set(\"elem_country\", this.fields.country_id);\n\t\tcp_obj.set(\"elem_county\", this.fields.county_id);\n\n\t\tcp_obj.set(\"prefix\", this.misc.prefix);\n\n\t\tcp_obj.set(\"access_token\", crafty_cfg.key);\n\t\tcp_obj.set(\"res_autoselect\", \"0\");\n\t\tcp_obj.set(\"single_res_autoselect\" , 0);\n\t\tcp_obj.set(\"max_lines\" , 1);\n\n\t\tif (crafty_cfg.advanced.county_data == 'traditional') {\n\t\t\tcp_obj.set(\"traditional_county\" , 1);\n\t\t} else if (crafty_cfg.advanced.county_data == 'former_postal') {\n\t\t\tcp_obj.set(\"traditional_county\" , 0);\n\t\t}\n\n\t\tcp_obj.set(\"busy_img_url\" , null);\n\t\tcp_obj.set(\"hide_result\" , false);\n\t\tcp_obj.set(\"on_result_ready\", this.result_ready.bind(this));\n\t\tcp_obj.set(\"on_result_selected\", this.result_selected.bind(this));\n\t\tcp_obj.set(\"on_error\", this.result_error.bind(this));\n\t\tcp_obj.set(\"first_res_line\", '---- please select your address ----');\n\t\tcp_obj.set(\"err_msg1\", crafty_cfg.error_msg['0001']);\n\t\tcp_obj.set(\"err_msg2\", crafty_cfg.error_msg['0002']);\n\t\tcp_obj.set(\"err_msg3\", crafty_cfg.error_msg['0003']);\n\t\tcp_obj.set(\"err_msg4\", crafty_cfg.error_msg['0004']);\n\t\tcp_obj.set(\"max_width\", \"100%\");\n\n\t\t// do initial setup\n\t\tthis.initial_setup();\n\n\t\t// do setup for current country\n\t\tthis.country_changed();\n\n\t\t// listen for country changes\n\t\tvar countryEl = document.getElementById(this.fields.country_id);\n\t\tcountryEl.addEventListener('change', this.country_changed.bind(this));\n\n\t\tjQuery('#'+setup.fields.postcode_id).attr('cc-applied', '1');\n\t}\n\n\tthis.country_changed = function(e) {\n\t\t// show postcode lookup for:\n\t\t// \"GB\" UK\n\t\t// \"JE\" Jersey\n\t\t// \"GG\" Guernsey\n\t\t// \"IM\" Isle of Man\n\t\tvar curr_country = jQuery('#' + this.fields.country_id).val();\n\t\tif ('GB' == curr_country || 'JE' == curr_country || 'GG' == curr_country || 'IM' == curr_country) {\n\t\t\tthis.setup_for_uk();\n\t\t} else {\n\t\t\tthis.setup_for_non_uk();\n\t\t}\n\t}\n\n\tthis.button_clicked = function() {\n\t\tthis.cp_obj.doLookup();\n\t}\n\n\tthis.result_ready = function() {\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').hide();\n\t}\n\n\tthis.result_selected = function() {\n\t\t// update country field if user selects address from GG/JE, etc.\n\t\tswitch(jQuery('#' + this.fields.postcode_id).val().substring(0,2)){\n\t\t\tcase \"GY\":\n\t\t\tjQuery('#' + this.fields.country_id).val(\"GG\");\n\t\t\tbreak;\n\t\t\tcase \"JE\":\n\t\t\tjQuery('#' + this.fields.country_id).val(\"JE\");\n\t\t\tbreak;\n\t\t\tcase \"IM\":\n\t\t\tjQuery('#' + this.fields.country_id).val(\"IM\");\n\t\t\tbreak;\n\t\t\tdefault:\n\t\t\tjQuery('#' + this.fields.country_id).val(\"GB\");\n\t\t\tbreak;\n\t\t}\n\n\t\tif (crafty_cfg.advanced.county_data == 'none') {\n\t\t\tjQuery('#'+this.fields.county_id).val('')\n\t\t}\n\n\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\n\t\t// trigger change event on address fields to satisfy magento required fields\n\t\tjQuery('#'+this.cp_obj.config[\"elem_company\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_street1\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_street2\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_postcode\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_town\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_county\"]).trigger('change');\n\t\tjQuery('#'+this.cp_obj.config[\"elem_country\"]).trigger('change');\n\t}\n\n\tthis.result_error = function() {\n\t\t// apply magento error styling\n\t\tlet error = jQuery('#' + this.misc.prefix + '_cp_result_display').text();\n\t\tjQuery('#' + this.misc.prefix + '_cp_result_display').text('');\n\t\tjQuery('#' + this.misc.prefix +'_cp_result_display').siblings('.mage-error').children('.search-subtext').text(error);\n\n\t\tjQuery('#cc_' + this.misc.prefix + '_error').show();\n\t\tjQuery('.' + this.misc.prefix + '_cp_address_class').show();\n\t}\n}\n\n\nactivate_cc = function() {\n\tif (jQuery('.onestep-shipping-address').find('[name=\"postcode\"]').length == 1 &&\n\tjQuery('.onestep-shipping-address').find('[name=\"street[0]\"]').length == 1) {\n\t\t// Step 3 - now that we know this form exists, create an instance from our constructor\n\t\tvar cc1 = new CraftyClicksMagento2Class();\n\t\t// Step 4 - run the add_lookup method on our instance and pass it field id's\n\t\tcc1.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\tjQuery('.onestep-shipping-address').find('[name=\"company\"]').attr('id'),\n\t\t\t\t\"address_1_id\":\t\tjQuery('.onestep-shipping-address').find('[name=\"street[0]\"]').attr('id'),\n\t\t\t\t\"address_2_id\":\t\tjQuery('.onestep-shipping-address').find('[name=\"street[1]\"]').attr('id'),\n\t\t\t\t\"postcode_id\":\t\tjQuery('.onestep-shipping-address').find('[name=\"postcode\"]').attr('id'),\n\t\t\t\t\"town_id\":\t\t\t\tjQuery('.onestep-shipping-address').find('[name=\"city\"]').attr('id'),\n\t\t\t\t\"county_id\":\t\t\tjQuery('.onestep-shipping-address').find('[name=\"region\"]')[1].getAttribute('id'),\n\t\t\t\t\"country_id\":\t\t\tjQuery('.onestep-shipping-address').find('[name=\"country_id\"]').attr('id'),\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_class\":\t\t\t\"onestep-shipping-address\",\n\t\t\t\t\"prefix\":\t\t\t\t\t\t\"shipping\"\n\t\t\t}\n\t\t});\n\t}\n\n\tif (jQuery('.onestep-billing-address').find('[name=\"postcode\"]').length == 1 &&\n\tjQuery('.onestep-shipping-address').find('[name=\"street[0]\"]').length == 1) {\n\t\tvar cc2 = new CraftyClicksMagento2Class();\n\t\tcc2.add_lookup({\n\t\t\t\"fields\": {\n\t\t\t\t\"company_id\":\t\t\tjQuery('.onestep-billing-address').find('[name=\"company\"]').attr('id'),\n\t\t\t\t\"address_1_id\":\t\tjQuery('.onestep-billing-address').find('[name=\"street[0]\"]').attr('id'),\n\t\t\t\t\"address_2_id\":\t\tjQuery('.onestep-billing-address').find('[name=\"street[1]\"]').attr('id'),\n\t\t\t\t\"address_3_id\":\t\tjQuery('.onestep-billing-address').find('[name=\"street[2]\"]').attr('id'),\n\t\t\t\t\"postcode_id\":\t\tjQuery('.onestep-billing-address').find('[name=\"postcode\"]').attr('id'),\n\t\t\t\t\"town_id\":\t\t\t\tjQuery('.onestep-billing-address').find('[name=\"city\"]').attr('id'),\n\t\t\t\t\"county_id\":\t\t\tjQuery('.onestep-billing-address').find('[name=\"region\"]')[1].getAttribute('id'),\n\t\t\t\t\"country_id\":\t\t\tjQuery('.onestep-billing-address').find('[name=\"country_id\"]').attr('id'),\n\t\t\t},\n\t\t\t\"misc\": {\n\t\t\t\t\"container_class\":\t\t\t\"onestep-billing-address\",\n\t\t\t\t\"prefix\":\t\t\t\t\t\t\"payment\"\n\t\t\t}\n\t\t});\n\t}\n}\n\nrequirejs(['jquery'], function($) {\n\tjQuery(document).ready(function() {\n\t\t// Step 1 - check crafty is enabled\n\t\tif (crafty_cfg.enabled) {\n\t\t\t// Step 2 - page takes a while to load, so continuously check for forms\n\t\t\tsetInterval(activate_cc, 200);\n\t\t}\n\n\t});\n});","Magento_ReCaptchaPaypal/js/reCaptchaPaypal.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine(\n    [\n        'Magento_ReCaptchaFrontendUi/js/reCaptcha',\n        'jquery'\n    ],\n    function (Component, $) {\n        'use strict';\n\n        return Component.extend({\n\n            /**\n             * Recaptcha callback\n             * @param {String} token\n             */\n            reCaptchaCallback: function (token) {\n                this.tokenField.value = token;\n                this.$parentForm.trigger('captcha:endExecute');\n            },\n\n            /**\n             * Initialize parent form.\n             *\n             * @param {Object} parentForm\n             * @param {String} widgetId\n             */\n            initParentForm: function (parentForm, widgetId) {\n                var me = this;\n\n                parentForm.on('captcha:startExecute', function (event) {\n                    if (!me.tokenField.value && me.getIsInvisibleRecaptcha()) {\n                        // eslint-disable-next-line no-undef\n                        grecaptcha.execute(widgetId);\n                        event.preventDefault(event);\n                        event.stopImmediatePropagation();\n                    } else {\n                        me.$parentForm.trigger('captcha:endExecute');\n                    }\n                });\n\n                // Create a virtual token field\n                this.tokenField = $('<input type=\"text\" name=\"token\" style=\"display: none\" />')[0];\n                this.$parentForm = parentForm;\n                parentForm.append(this.tokenField);\n            }\n        });\n    }\n);\n","Magento_ReCaptchaPaypal/js/payflowpro-method-mixin.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'Magento_Checkout/js/model/payment/additional-validators'\n], function ($, additionalValidators) {\n    'use strict';\n\n    return function (originalComponent) {\n        return originalComponent.extend({\n            /**\n             * Initializes reCaptcha\n             */\n            placeOrder: function () {\n                var original = this._super.bind(this),\n                    // jscs:disable requireCamelCaseOrUpperCaseIdentifiers\n                    isEnabledForPaypal = window.checkoutConfig.recaptcha_paypal,\n                    // jscs:enable requireCamelCaseOrUpperCaseIdentifiers\n                    paymentFormSelector = $('#co-payment-form'),\n                    startEvent = 'captcha:startExecute',\n                    endEvent = 'captcha:endExecute';\n\n                if (!this.validateHandler() || !additionalValidators.validate() || !isEnabledForPaypal) {\n                    return original();\n                }\n\n                paymentFormSelector.off(endEvent).on(endEvent, function () {\n                    original();\n                    paymentFormSelector.off(endEvent);\n                });\n\n                paymentFormSelector.trigger(startEvent);\n            }\n        });\n    };\n});\n","Magento_InventoryConfigurableProductFrontendUi/js/configurable.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'configurableVariationQty',\n    'jquery-ui-modules/widget'\n], function ($, configurableVariationQty) {\n    'use strict';\n\n    return function (configurable) {\n        $.widget('mage.configurable', configurable, {\n\n            /** @inheritdoc */\n            _configureElement: function (element) {\n                var salesChannel = this.options.spConfig.channel,\n                    salesChannelCode = this.options.spConfig.salesChannelCode,\n                    productVariationsSku = this.options.spConfig.sku;\n\n                this._super(element);\n                configurableVariationQty(productVariationsSku[this.simpleProduct], salesChannel, salesChannelCode);\n            }\n        });\n\n        return $.mage.configurable;\n    };\n});\n","Magento_InventoryConfigurableProductFrontendUi/js/configurable-variation-qty.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/**\n * Configurable variation left qty.\n */\ndefine([\n    'jquery',\n    'underscore',\n    'mage/url'\n], function ($, _, urlBuilder) {\n    'use strict';\n\n    return function (productSku, salesChannel, salesChannelCode) {\n        var selectorInfoStockSkuQty = '.availability.only',\n            selectorInfoStockSkuQtyValue = '.availability.only > strong',\n            productQtyInfoBlock = $(selectorInfoStockSkuQty),\n            productQtyInfo = $(selectorInfoStockSkuQtyValue);\n\n        if (!_.isUndefined(productSku) && productSku !== null) {\n            $.ajax({\n                url: urlBuilder.build('inventory_catalog/product/getQty/'),\n                dataType: 'json',\n                data: {\n                    'sku': productSku,\n                    'channel': salesChannel,\n                    'salesChannelCode': salesChannelCode\n                }\n            }).done(function (response) {\n                if (response.qty !== null && response.qty > 0) {\n                    productQtyInfo.text(response.qty);\n                    productQtyInfoBlock.show();\n                } else {\n                    productQtyInfoBlock.hide();\n                }\n            }).fail(function () {\n                productQtyInfoBlock.hide();\n            });\n        } else {\n            productQtyInfoBlock.hide();\n        }\n    };\n});\n","Magento_Swatches/js/catalog-add-to-cart.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\nrequire([\n    'jquery'\n], function ($) {\n    'use strict';\n\n    /**\n     * Add selected swatch attributes to redirect url\n     *\n     * @see Magento_Catalog/js/catalog-add-to-cart\n     */\n    $('body').on('catalogCategoryAddToCartRedirect', function (event, data) {\n        $(data.form).find('[name*=\"super\"]').each(function (index, item) {\n            var $item = $(item),\n                attr;\n\n            if ($item.attr('data-attr-name')) {\n                attr = $item.attr('data-attr-name');\n            } else {\n                attr = $item.parent().attr('attribute-code');\n            }\n            data.redirectParameters.push(attr + '=' + $item.val());\n\n        });\n    });\n});\n","Magento_Swatches/js/configurable-customer-data.js":"require([\n    'jquery',\n    'Magento_ConfigurableProduct/js/options-updater'\n], function ($, Updater) {\n    'use strict';\n\n    var selectors = {\n            formSelector: '#product_addtocart_form',\n            swatchSelector: '.swatch-opt'\n        },\n        swatchWidgetName = 'mage-SwatchRenderer',\n        widgetInitEvent = 'swatch.initialized',\n\n    /**\n    * Sets all configurable swatch attribute's selected values\n    */\n    updateSwatchOptions = function () {\n        var swatchWidget = $(selectors.swatchSelector).data(swatchWidgetName);\n\n        if (!swatchWidget || !swatchWidget._EmulateSelectedByAttributeId) {\n            return;\n        }\n        swatchWidget._EmulateSelectedByAttributeId(this.productOptions);\n    },\n    updater = new Updater(widgetInitEvent, updateSwatchOptions);\n\n    updater.listen();\n});\n","Magento_Swatches/js/swatch-renderer.js":"/**\n * Copyright 2015 Adobe\n * All Rights Reserved.\n */\n\ndefine([\n    'jquery',\n    'underscore',\n    'mage/template',\n    'mage/smart-keyboard-handler',\n    'mage/translate',\n    'priceUtils',\n    'jquery-ui-modules/widget',\n    'jquery/jquery.parsequery',\n    'mage/validation/validation'\n], function ($, _, mageTemplate, keyboardHandler, $t, priceUtils) {\n    'use strict';\n\n    /**\n     * Extend form validation to support swatch accessibility\n     */\n    $.widget('mage.validation', $.mage.validation, {\n        /**\n         * Handle form with swatches validation. Focus on first invalid swatch block.\n         *\n         * @param {jQuery.Event} event\n         * @param {Object} validation\n         */\n        listenFormValidateHandler: function (event, validation) {\n            var swatchWrapper, firstActive, swatches, swatch, successList, errorList, firstSwatch;\n\n            this._superApply(arguments);\n\n            swatchWrapper = '.swatch-attribute-options';\n            swatches = $(event.target).find(swatchWrapper);\n\n            if (!swatches.length) {\n                return;\n            }\n\n            swatch = '.swatch-attribute';\n            firstActive = $(validation.errorList[0].element || []);\n            successList = validation.successList;\n            errorList = validation.errorList;\n            firstSwatch = $(firstActive).parent(swatch).find(swatchWrapper);\n\n            keyboardHandler.focus(swatches);\n\n            $.each(successList, function (index, item) {\n                $(item).parent(swatch).find(swatchWrapper).attr('aria-invalid', false);\n            });\n\n            $.each(errorList, function (index, item) {\n                $(item.element).parent(swatch).find(swatchWrapper).attr('aria-invalid', true);\n            });\n\n            if (firstSwatch.length) {\n                $(firstSwatch).trigger('focus');\n            }\n        }\n    });\n\n    /**\n     * Render tooltips by attributes (only to up).\n     * Required element attributes:\n     *  - data-option-type (integer, 0-3)\n     *  - data-option-label (string)\n     *  - data-option-tooltip-thumb\n     *  - data-option-tooltip-value\n     *  - data-thumb-width\n     *  - data-thumb-height\n     */\n    $.widget('mage.SwatchRendererTooltip', {\n        options: {\n            delay: 200,                             //how much ms before tooltip to show\n            tooltipClass: 'swatch-option-tooltip'  //configurable, but remember about css\n        },\n\n        /**\n         * @private\n         */\n        _init: function () {\n            var $widget = this,\n                $this = this.element,\n                $element = $('.' + $widget.options.tooltipClass),\n                timer,\n                type = parseInt($this.data('option-type'), 10),\n                label = $this.data('option-label'),\n                thumb = $this.data('option-tooltip-thumb'),\n                value = $this.data('option-tooltip-value'),\n                width = $this.data('thumb-width'),\n                height = $this.data('thumb-height'),\n                $image,\n                $title,\n                $corner;\n\n            if (!$element.length) {\n                $element = $('<div class=\"' +\n                    $widget.options.tooltipClass +\n                    '\"><div class=\"image\"></div><div class=\"title\"></div><div class=\"corner\"></div></div>'\n                );\n                $('body').append($element);\n            }\n\n            $image = $element.find('.image');\n            $title = $element.find('.title');\n            $corner = $element.find('.corner');\n\n            $this.on('mouseenter', function () {\n                if (!$this.hasClass('disabled')) {\n                    timer = setTimeout(\n                        function () {\n                            var leftOpt = null,\n                                leftCorner = 0,\n                                left,\n                                $window;\n\n                            if (type === 2) {\n                                // Image\n                                $image.css({\n                                    'background': 'url(\"' + thumb + '\") no-repeat center', //Background case\n                                    'background-size': 'initial',\n                                    'width': width + 'px',\n                                    'height': height + 'px'\n                                });\n                                $image.show();\n                            } else if (type === 1) {\n                                // Color\n                                $image.css({\n                                    background: value\n                                });\n                                $image.show();\n                            } else if (type === 0 || type === 3) {\n                                // Default\n                                $image.hide();\n                            }\n\n                            $title.text(label);\n\n                            leftOpt = $this.offset().left;\n                            left = leftOpt + $this.width() / 2 - $element.width() / 2;\n                            $window = $(window);\n\n                            // the numbers (5 and 5) is magick constants for offset from left or right page\n                            if (left < 0) {\n                                left = 5;\n                            } else if (left + $element.width() > $window.width()) {\n                                left = $window.width() - $element.width() - 5;\n                            }\n\n                            // the numbers (6,  3 and 18) is magick constants for offset tooltip\n                            leftCorner = 0;\n\n                            if ($element.width() < $this.width()) {\n                                leftCorner = $element.width() / 2 - 3;\n                            } else {\n                                leftCorner = (leftOpt > left ? leftOpt - left : left - leftOpt) + $this.width() / 2 - 6;\n                            }\n\n                            $corner.css({\n                                left: leftCorner\n                            });\n                            $element.css({\n                                left: left,\n                                top: $this.offset().top - $element.height() - $corner.height() - 18\n                            }).show();\n                        },\n                        $widget.options.delay\n                    );\n                }\n            });\n\n            $this.on('mouseleave', function () {\n                $element.hide();\n                clearTimeout(timer);\n            });\n\n            $(document).on('tap', function () {\n                $element.hide();\n                clearTimeout(timer);\n            });\n\n            $this.on('tap', function (event) {\n                event.stopPropagation();\n            });\n        }\n    });\n\n    /**\n     * Render swatch controls with options and use tooltips.\n     * Required two json:\n     *  - jsonConfig (magento's option config)\n     *  - jsonSwatchConfig (swatch's option config)\n     *\n     *  Tuning:\n     *  - numberToShow (show \"more\" button if options are more)\n     *  - onlySwatches (hide selectboxes)\n     *  - moreButtonText (text for \"more\" button)\n     *  - selectorProduct (selector for product container)\n     *  - selectorProductPrice (selector for change price)\n     */\n    $.widget('mage.SwatchRenderer', {\n        options: {\n            classes: {\n                attributeClass: 'swatch-attribute',\n                attributeLabelClass: 'swatch-attribute-label',\n                attributeSelectedOptionLabelClass: 'swatch-attribute-selected-option',\n                attributeOptionsWrapper: 'swatch-attribute-options',\n                attributeInput: 'swatch-input',\n                optionClass: 'swatch-option',\n                selectClass: 'swatch-select',\n                moreButton: 'swatch-more',\n                loader: 'swatch-option-loading'\n            },\n            // option's json config\n            jsonConfig: {},\n\n            // swatch's json config\n            jsonSwatchConfig: {},\n\n            // selector of parental block of prices and swatches (need to know where to seek for price block)\n            selectorProduct: '.product-info-main',\n\n            // selector of price wrapper (need to know where set price)\n            selectorProductPrice: '[data-role=priceBox]',\n\n            //selector of product images gallery wrapper\n            mediaGallerySelector: '[data-gallery-role=gallery-placeholder]',\n\n            // selector of category product tile wrapper\n            selectorProductTile: '.product-item',\n\n            // number of controls to show (false or zero = show all)\n            numberToShow: false,\n\n            // show only swatch controls\n            onlySwatches: false,\n\n            // enable label for control\n            enableControlLabel: true,\n\n            // control label id\n            controlLabelId: '',\n\n            // text for more button\n            moreButtonText: $t('More'),\n\n            // Callback url for media\n            mediaCallback: '',\n\n            // Local media cache\n            mediaCache: {},\n\n            // Cache for BaseProduct images. Needed when option unset\n            mediaGalleryInitial: [{}],\n\n            // Use ajax to get image data\n            useAjax: false,\n\n            /**\n             * Defines the mechanism of how images of a gallery should be\n             * updated when user switches between configurations of a product.\n             *\n             * As for now value of this option can be either 'replace' or 'prepend'.\n             *\n             * @type {String}\n             */\n            gallerySwitchStrategy: 'replace',\n\n            // whether swatches are rendered in product list or on product page\n            inProductList: false,\n\n            // sly-old-price block selector\n            slyOldPriceSelector: '.sly-old-price',\n\n            // tier prise selectors start\n            tierPriceTemplateSelector: '#tier-prices-template',\n            tierPriceBlockSelector: '[data-role=\"tier-price-block\"]',\n            tierPriceTemplate: '',\n            // tier prise selectors end\n\n            // A price label selector\n            normalPriceLabelSelector: '.normal-price .price-label',\n            qtyInfo: '#qty'\n        },\n\n        /**\n         * Get chosen product\n         *\n         * @returns int|null\n         */\n        getProduct: function () {\n            var products = this._CalcProducts();\n\n            return _.isArray(products) ? products[0] : null;\n        },\n\n        /**\n         * Get chosen product id\n         *\n         * @returns int|null\n         */\n        getProductId: function () {\n            var products = this._CalcProducts();\n\n            return _.isArray(products) && products.length === 1 ? products[0] : null;\n        },\n\n        /**\n         * @private\n         */\n        _init: function () {\n            // Don't render the same set of swatches twice\n            if ($(this.element).attr('data-rendered')) {\n                return;\n            }\n\n            $(this.element).attr('data-rendered', true);\n\n            if (_.isEmpty(this.options.jsonConfig.images)) {\n                this.options.useAjax = true;\n                // creates debounced variant of _LoadProductMedia()\n                // to use it in events handlers instead of _LoadProductMedia()\n                this._debouncedLoadProductMedia = _.debounce(this._LoadProductMedia.bind(this), 500);\n            }\n\n            this.options.tierPriceTemplate = $(this.options.tierPriceTemplateSelector).html();\n\n            if (this.options.jsonConfig !== '' && this.options.jsonSwatchConfig !== '') {\n                // store unsorted attributes\n                this.options.jsonConfig.mappedAttributes = _.clone(this.options.jsonConfig.attributes);\n                this._sortAttributes();\n                this._RenderControls();\n                this._setPreSelectedGallery();\n                $(this.element).trigger('swatch.initialized');\n            } else {\n                console.log('SwatchRenderer: No input data received');\n            }\n        },\n\n        /**\n         * @private\n         */\n        _sortAttributes: function () {\n            this.options.jsonConfig.attributes = _.sortBy(this.options.jsonConfig.attributes, function (attribute) {\n                return parseInt(attribute.position, 10);\n            });\n        },\n\n        /**\n         * @private\n         */\n        _create: function () {\n            var options = this.options,\n                gallery = $('[data-gallery-role=gallery-placeholder]', '.column.main'),\n                productData = this._determineProductData(),\n                $main = productData.isInProductView ?\n                    this.element.parents('.column.main') :\n                    this.element.parents('.product-item-info');\n\n            if (productData.isInProductView) {\n                gallery.data('gallery') ?\n                    this._onGalleryLoaded(gallery) :\n                    gallery.on('gallery:loaded', this._onGalleryLoaded.bind(this, gallery));\n            } else {\n                options.mediaGalleryInitial = [{\n                    'img': $main.find('.product-image-photo').attr('src')\n                }];\n            }\n\n            this.productForm = this.element.parents(this.options.selectorProductTile).find('form:first');\n            this.inProductList = this.productForm.length > 0;\n            $(this.options.qtyInfo).on('input', this._onQtyChanged.bind(this));\n        },\n\n        /**\n         * Determine product id and related data\n         *\n         * @returns {{productId: *, isInProductView: bool}}\n         * @private\n         */\n        _determineProductData: function () {\n            // Check if product is in a list of products.\n            var productId,\n                isInProductView = false;\n\n            productId = this.element.parents('.product-item-details')\n                .find('.price-box.price-final_price').attr('data-product-id');\n\n            if (!productId) {\n                // Check individual product.\n                productId = $('[name=product]').val();\n                isInProductView = productId > 0;\n            }\n\n            return {\n                productId: productId,\n                isInProductView: isInProductView\n            };\n        },\n\n        /**\n         * Render controls\n         *\n         * @private\n         */\n        _RenderControls: function () {\n            var $widget = this,\n                container = this.element,\n                classes = this.options.classes,\n                chooseText = this.options.jsonConfig.chooseText,\n                showTooltip = this.options.showTooltip;\n\n            $widget.optionsMap = {};\n\n            $.each(this.options.jsonConfig.attributes, function () {\n                var item = this,\n                    controlLabelId = 'option-label-' + item.code + '-' + item.id,\n                    options = $widget._RenderSwatchOptions(item, controlLabelId),\n                    select = $widget._RenderSwatchSelect(item, chooseText),\n                    input = $widget._RenderFormInput(item),\n                    listLabel = '',\n                    label = '';\n\n                // Show only swatch controls\n                if ($widget.options.onlySwatches && !$widget.options.jsonSwatchConfig.hasOwnProperty(item.id)) {\n                    return;\n                }\n\n                if ($widget.options.enableControlLabel) {\n                    label +=\n                        '<span id=\"' + controlLabelId + '\" class=\"' + classes.attributeLabelClass + '\">' +\n                        $('<i></i>').text(item.label).html() +\n                        '</span>' +\n                        '<span class=\"' + classes.attributeSelectedOptionLabelClass + '\"></span>';\n                }\n\n                if ($widget.inProductList) {\n                    $widget.productForm.append(input);\n                    input = '';\n                    listLabel = 'aria-label=\"' + $('<i></i>').text(item.label).html() + '\"';\n                } else {\n                    listLabel = 'aria-labelledby=\"' + controlLabelId + '\"';\n                }\n\n                // Create new control\n                container.append(\n                    '<div class=\"' + classes.attributeClass + ' ' + item.code + '\" ' +\n                         'data-attribute-code=\"' + item.code + '\" ' +\n                         'data-attribute-id=\"' + item.id + '\">' +\n                        label +\n                        '<div aria-activedescendant=\"\" ' +\n                             'tabindex=\"0\" ' +\n                             'aria-invalid=\"false\" ' +\n                             'aria-required=\"true\" ' +\n                             'role=\"listbox\" ' + listLabel +\n                             'class=\"' + classes.attributeOptionsWrapper + ' clearfix\">' +\n                            options + select +\n                        '</div>' + input +\n                    '</div>'\n                );\n\n                $widget.optionsMap[item.id] = {};\n\n                // Aggregate options array to hash (key => value)\n                $.each(item.options, function () {\n                    if (this.products.length > 0) {\n                        let salableProducts = this.products;\n\n                        if ($widget.options.jsonConfig.canDisplayShowOutOfStockStatus) {\n                            salableProducts = $widget.options.jsonConfig.salable[item.id][this.id];\n                        }\n                        $widget.optionsMap[item.id][this.id] = {\n                            price: parseInt(\n                                $widget.options.jsonConfig.optionPrices[this.products[0]].finalPrice.amount,\n                                10\n                            ),\n                            products: salableProducts\n                        };\n                    }\n                });\n            });\n\n            if (showTooltip === 1) {\n                // Connect Tooltip\n                container\n                    .find('[data-option-type=\"1\"], [data-option-type=\"2\"],' +\n                        ' [data-option-type=\"0\"], [data-option-type=\"3\"]')\n                    .SwatchRendererTooltip();\n            }\n\n            // Hide all elements below more button\n            $('.' + classes.moreButton).nextAll().hide();\n\n            // Handle events like click or change\n            $widget._EventListener();\n\n            // Rewind options\n            $widget._Rewind(container);\n\n            //Emulate click on all swatches from Request\n            $widget._EmulateSelected($.parseQuery());\n            $widget._EmulateSelected($widget._getSelectedAttributes());\n        },\n\n        disableSwatchForOutOfStockProducts: function () {\n            let $widget = this, container = this.element;\n\n            $.each(this.options.jsonConfig.attributes, function () {\n                let item = this;\n\n                if ($widget.options.jsonConfig.canDisplayShowOutOfStockStatus) {\n                    let salableProducts = $widget.options.jsonConfig.salable[item.id],\n                        swatchOptions = $(container).find(`[data-attribute-id='${item.id}']`).find('.swatch-option');\n\n                    swatchOptions.each(function (key, value) {\n                        let optionId = $(value).data('option-id');\n\n                        if (!salableProducts.hasOwnProperty(optionId)) {\n                            $(value).attr('disabled', true).addClass('disabled');\n                        }\n                    });\n                }\n            });\n        },\n\n        /**\n         * Render swatch options by part of config\n         *\n         * @param {Object} config\n         * @param {String} controlId\n         * @returns {String}\n         * @private\n         */\n        _RenderSwatchOptions: function (config, controlId) {\n            var optionConfig = this.options.jsonSwatchConfig[config.id],\n                optionClass = this.options.classes.optionClass,\n                sizeConfig = this.options.jsonSwatchImageSizeConfig,\n                moreLimit = parseInt(this.options.numberToShow, 10),\n                moreClass = this.options.classes.moreButton,\n                moreText = this.options.moreButtonText,\n                countAttributes = 0,\n                html = '';\n\n            if (!this.options.jsonSwatchConfig.hasOwnProperty(config.id)) {\n                return '';\n            }\n\n            $.each(config.options, function (index) {\n                var id,\n                    type,\n                    value,\n                    thumb,\n                    label,\n                    width,\n                    height,\n                    attr,\n                    swatchImageWidth,\n                    swatchImageHeight;\n\n                if (!optionConfig.hasOwnProperty(this.id)) {\n                    return '';\n                }\n\n                // Add more button\n                if (moreLimit === countAttributes++) {\n                    html += '<a href=\"#\" class=\"' + moreClass + '\"><span>' + moreText + '</span></a>';\n                }\n\n                id = this.id;\n                type = parseInt(optionConfig[id].type, 10);\n                value = optionConfig[id].hasOwnProperty('value') ?\n                    $('<i></i>').text(optionConfig[id].value).html() : '';\n                thumb = optionConfig[id].hasOwnProperty('thumb') ? optionConfig[id].thumb : '';\n                width = _.has(sizeConfig, 'swatchThumb') ? sizeConfig.swatchThumb.width : 110;\n                height = _.has(sizeConfig, 'swatchThumb') ? sizeConfig.swatchThumb.height : 90;\n                label = this.label ? $('<i></i>').text(this.label).html() : '';\n                attr =\n                    ' id=\"' + controlId + '-item-' + id + '\"' +\n                    ' index=\"' + index + '\"' +\n                    ' aria-checked=\"false\"' +\n                    ' aria-describedby=\"' + controlId + '\"' +\n                    ' tabindex=\"0\"' +\n                    ' data-option-type=\"' + type + '\"' +\n                    ' data-option-id=\"' + id + '\"' +\n                    ' data-option-label=\"' + label + '\"' +\n                    ' aria-label=\"' + label + '\"' +\n                    ' role=\"option\"' +\n                    ' data-thumb-width=\"' + width + '\"' +\n                    ' data-thumb-height=\"' + height + '\"';\n\n                attr += thumb !== '' ? ' data-option-tooltip-thumb=\"' + thumb + '\"' : '';\n                attr += value !== '' ? ' data-option-tooltip-value=\"' + value + '\"' : '';\n\n                swatchImageWidth = _.has(sizeConfig, 'swatchImage') ? sizeConfig.swatchImage.width : 30;\n                swatchImageHeight = _.has(sizeConfig, 'swatchImage') ? sizeConfig.swatchImage.height : 20;\n\n                if (!this.hasOwnProperty('products') || this.products.length <= 0) {\n                    attr += ' data-option-empty=\"true\"';\n                }\n\n                if (type === 0) {\n                    // Text\n                    html += '<div class=\"' + optionClass + ' text\" ' + attr + '>' + (value ? value : label) +\n                        '</div>';\n                } else if (type === 1) {\n                    // Color\n                    html += '<div class=\"' + optionClass + ' color\" ' + attr +\n                        ' style=\"background: ' + value +\n                        ' no-repeat center; background-size: initial;\">' + '' +\n                        '</div>';\n                } else if (type === 2) {\n                    // Image\n                    html += '<div class=\"' + optionClass + ' image\" ' + attr +\n                        ' style=\"background: url(' + value + ') no-repeat center; background-size: initial;width:' +\n                        swatchImageWidth + 'px; height:' + swatchImageHeight + 'px\">' + '' +\n                        '</div>';\n                } else if (type === 3) {\n                    // Clear\n                    html += '<div class=\"' + optionClass + '\" ' + attr + '></div>';\n                } else {\n                    // Default\n                    html += '<div class=\"' + optionClass + '\" ' + attr + '>' + label + '</div>';\n                }\n            });\n\n            return html;\n        },\n\n        /**\n         * Render select by part of config\n         *\n         * @param {Object} config\n         * @param {String} chooseText\n         * @returns {String}\n         * @private\n         */\n        _RenderSwatchSelect: function (config, chooseText) {\n            var html;\n\n            if (this.options.jsonSwatchConfig.hasOwnProperty(config.id)) {\n                return '';\n            }\n\n            html =\n                '<select class=\"' + this.options.classes.selectClass + ' ' + config.code + '\">' +\n                '<option value=\"0\" data-option-id=\"0\">' + chooseText + '</option>';\n\n            $.each(config.options, function () {\n                var label = this.label,\n                    attr = ' value=\"' + this.id + '\" data-option-id=\"' + this.id + '\"';\n\n                if (!this.hasOwnProperty('products') || this.products.length <= 0) {\n                    attr += ' data-option-empty=\"true\"';\n                }\n\n                html += '<option ' + attr + '>' + label + '</option>';\n            });\n\n            html += '</select>';\n\n            return html;\n        },\n\n        /**\n         * Input for submit form.\n         * This control shouldn't have \"type=hidden\", \"display: none\" for validation work :(\n         *\n         * @param {Object} config\n         * @private\n         */\n        _RenderFormInput: function (config) {\n            return '<input class=\"' + this.options.classes.attributeInput + ' super-attribute-select\" ' +\n                'name=\"super_attribute[' + config.id + ']\" ' +\n                'type=\"text\" ' +\n                'value=\"\" ' +\n                'data-selector=\"super_attribute[' + config.id + ']\" ' +\n                'data-validate=\"{required: true}\" ' +\n                'aria-required=\"true\" ' +\n                'aria-invalid=\"false\">';\n        },\n\n        /**\n         * Event listener\n         *\n         * @private\n         */\n        _EventListener: function () {\n            var $widget = this,\n                options = this.options.classes,\n                target;\n\n            $widget.element.on('click', '.' + options.optionClass, function () {\n                return $widget._OnClick($(this), $widget);\n            });\n\n            $widget.element.on('change', '.' + options.selectClass, function () {\n                return $widget._OnChange($(this), $widget);\n            });\n\n            $widget.element.on('click', '.' + options.moreButton, function (e) {\n                e.preventDefault();\n\n                return $widget._OnMoreClick($(this));\n            });\n\n            $widget.element.on('keydown', function (e) {\n                if (e.which === 13) {\n                    target = $(e.target);\n\n                    if (target.is('.' + options.optionClass)) {\n                        return $widget._OnClick(target, $widget);\n                    } else if (target.is('.' + options.selectClass)) {\n                        return $widget._OnChange(target, $widget);\n                    } else if (target.is('.' + options.moreButton)) {\n                        e.preventDefault();\n\n                        return $widget._OnMoreClick(target);\n                    }\n                }\n            });\n        },\n\n        /**\n         * Load media gallery using ajax or json config.\n         *\n         * @private\n         */\n        _loadMedia: function () {\n            var $main = this.inProductList ?\n                    this.element.parents('.product-item-info') :\n                    this.element.parents('.column.main'),\n                images;\n\n            if (this.options.useAjax) {\n                this._debouncedLoadProductMedia();\n            }  else {\n                images = this.options.jsonConfig.images[this.getProduct()];\n\n                if (!images) {\n                    images = this.options.mediaGalleryInitial;\n                }\n                this.updateBaseImage(this._sortImages(images), $main, !this.inProductList);\n            }\n        },\n\n        /**\n         * Sorting images array\n         *\n         * @private\n         */\n        _sortImages: function (images) {\n            return _.sortBy(images, function (image) {\n                return parseInt(image.position, 10);\n            });\n        },\n\n        /**\n         * Event for swatch options\n         *\n         * @param {Object} $this\n         * @param {Object} $widget\n         * @private\n         */\n        _OnClick: function ($this, $widget) {\n            var $parent = $this.parents('.' + $widget.options.classes.attributeClass),\n                $wrapper = $this.parents('.' + $widget.options.classes.attributeOptionsWrapper),\n                $label = $parent.find('.' + $widget.options.classes.attributeSelectedOptionLabelClass),\n                attributeId = $parent.data('attribute-id'),\n                $input = $parent.find('.' + $widget.options.classes.attributeInput),\n                checkAdditionalData = JSON.parse(this.options.jsonSwatchConfig[attributeId]['additional_data']),\n                $priceBox = $widget.element.parents($widget.options.selectorProduct)\n                    .find(this.options.selectorProductPrice);\n\n            if ($widget.inProductList) {\n                $input = $widget.productForm.find(\n                    '.' + $widget.options.classes.attributeInput + '[name=\"super_attribute[' + attributeId + ']\"]'\n                );\n            }\n\n            if ($this.hasClass('disabled')) {\n                return;\n            }\n\n            if ($this.hasClass('selected')) {\n                $parent.removeAttr('data-option-selected').find('.selected').removeClass('selected');\n                $input.val('');\n                $label.text('');\n                $this.attr('aria-checked', false);\n            } else {\n                $parent.attr('data-option-selected', $this.data('option-id')).find('.selected').removeClass('selected');\n                $label.text($this.data('option-label'));\n                $input.val($this.data('option-id'));\n                $input.attr('data-attr-name', this._getAttributeCodeById(attributeId));\n                $this.addClass('selected');\n                $widget._toggleCheckedAttributes($this, $wrapper);\n            }\n\n            $widget._Rebuild();\n\n            if ($priceBox.is(':data(mage-priceBox)')) {\n                $widget._UpdatePrice();\n            }\n\n            $(document).trigger('updateMsrpPriceBlock',\n                [\n                    this._getSelectedOptionPriceIndex(),\n                    $widget.options.jsonConfig.optionPrices,\n                    $priceBox\n                ]);\n\n            if (parseInt(checkAdditionalData['update_product_preview_image'], 10) === 1) {\n                $widget._loadMedia();\n            }\n\n            $input.trigger('change');\n        },\n\n        /**\n         * Get selected option price index\n         *\n         * @return {String|undefined}\n         * @private\n         */\n        _getSelectedOptionPriceIndex: function () {\n            var allowedProduct = this._getAllowedProductWithMinPrice(this._CalcProducts());\n\n            if (_.isEmpty(allowedProduct)) {\n                return undefined;\n            }\n\n            return allowedProduct;\n        },\n\n        /**\n         * Get human readable attribute code (eg. size, color) by it ID from configuration\n         *\n         * @param {Number} attributeId\n         * @returns {*}\n         * @private\n         */\n        _getAttributeCodeById: function (attributeId) {\n            var attribute = this.options.jsonConfig.mappedAttributes[attributeId];\n\n            return attribute ? attribute.code : attributeId;\n        },\n\n        /**\n         * Toggle accessibility attributes\n         *\n         * @param {Object} $this\n         * @param {Object} $wrapper\n         * @private\n         */\n        _toggleCheckedAttributes: function ($this, $wrapper) {\n            $wrapper.attr('aria-activedescendant', $this.attr('id'))\n                .find('.' + this.options.classes.optionClass).attr('aria-checked', false);\n            $this.attr('aria-checked', true);\n        },\n\n        /**\n         * Event for select\n         *\n         * @param {Object} $this\n         * @param {Object} $widget\n         * @private\n         */\n        _OnChange: function ($this, $widget) {\n            var $parent = $this.parents('.' + $widget.options.classes.attributeClass),\n                attributeId = $parent.data('attribute-id'),\n                $input = $parent.find('.' + $widget.options.classes.attributeInput);\n\n            if ($widget.productForm.length > 0) {\n                $input = $widget.productForm.find(\n                    '.' + $widget.options.classes.attributeInput + '[name=\"super_attribute[' + attributeId + ']\"]'\n                );\n            }\n\n            if ($this.val() > 0) {\n                $parent.attr('data-option-selected', $this.val());\n                $input.val($this.val());\n            } else {\n                $parent.removeAttr('data-option-selected');\n                $input.val('');\n            }\n\n            $widget._Rebuild();\n            $widget._UpdatePrice();\n            $widget._loadMedia();\n            $input.trigger('change');\n        },\n\n        /**\n         * Event for more switcher\n         *\n         * @param {Object} $this\n         * @private\n         */\n        _OnMoreClick: function ($this) {\n            $this.nextAll().show();\n            $this.trigger('blur').remove();\n        },\n\n        /**\n         * Rewind options for controls\n         *\n         * @private\n         */\n        _Rewind: function (controls) {\n            controls.find('div[data-option-id], option[data-option-id]')\n                .removeClass('disabled')\n                .prop('disabled', false);\n            controls.find('div[data-option-empty], option[data-option-empty]')\n                .attr('disabled', true)\n                .addClass('disabled')\n                .attr('tabindex', '-1');\n            this.disableSwatchForOutOfStockProducts();\n        },\n\n        /**\n         * Rebuild container\n         *\n         * @private\n         */\n        _Rebuild: function () {\n            var $widget = this,\n                controls = $widget.element.find('.' + $widget.options.classes.attributeClass + '[data-attribute-id]'),\n                selected = controls.filter('[data-option-selected]');\n\n            // Enable all options\n            $widget._Rewind(controls);\n\n            // done if nothing selected\n            if (selected.length <= 0) {\n                return;\n            }\n\n            // Disable not available options\n            controls.each(function () {\n                var $this = $(this),\n                    id = $this.data('attribute-id'),\n                    products = $widget._CalcProducts(id);\n\n                if (selected.length === 1 && selected.first().data('attribute-id') === id) {\n                    return;\n                }\n\n                $this.find('[data-option-id]').each(function () {\n                    var $element = $(this),\n                        option = $element.data('option-id');\n\n                    if (!$widget.optionsMap.hasOwnProperty(id) || !$widget.optionsMap[id].hasOwnProperty(option) ||\n                        $element.hasClass('selected') ||\n                        $element.is(':selected')) {\n                        return;\n                    }\n\n                    if (_.intersection(products, $widget.optionsMap[id][option].products).length <= 0) {\n                        $element.attr('disabled', true).addClass('disabled');\n                    }\n                });\n            });\n        },\n\n        /**\n         * Get selected product list\n         *\n         * @returns {Array}\n         * @private\n         */\n        _CalcProducts: function ($skipAttributeId) {\n            var $widget = this,\n                selectedOptions = '.' + $widget.options.classes.attributeClass + '[data-option-selected]',\n                products = [];\n\n            // Generate intersection of products\n            $widget.element.find(selectedOptions).each(function () {\n                var id = $(this).data('attribute-id'),\n                    option = $(this).attr('data-option-selected');\n\n                if ($skipAttributeId !== undefined && $skipAttributeId === id) {\n                    return;\n                }\n\n                if (!$widget.optionsMap.hasOwnProperty(id) || !$widget.optionsMap[id].hasOwnProperty(option)) {\n                    return;\n                }\n\n                if (products.length === 0) {\n                    products = $widget.optionsMap[id][option].products;\n                } else {\n                    products = _.intersection(products, $widget.optionsMap[id][option].products);\n                }\n            });\n\n            return products;\n        },\n\n        /**\n         * Update total price\n         *\n         * @private\n         */\n        _UpdatePrice: function () {\n            var $widget = this,\n                $product = $widget.element.parents($widget.options.selectorProduct),\n                $productPrice = $product.find(this.options.selectorProductPrice),\n                result = $widget._getNewPrices(),\n                tierPriceHtml,\n                isShow;\n\n            $productPrice.trigger(\n                'updatePrice',\n                {\n                    'prices': $widget._getPrices(result, $productPrice.priceBox('option').prices)\n                }\n            );\n\n            isShow = typeof result != 'undefined' && result.oldPrice.amount !== result.finalPrice.amount;\n\n            $productPrice.find('span:first').toggleClass('special-price', isShow);\n\n            $product.find(this.options.slyOldPriceSelector)[isShow ? 'show' : 'hide']();\n\n            if (typeof result != 'undefined' && result.tierPrices && result.tierPrices.length) {\n                if (this.options.tierPriceTemplate) {\n                    tierPriceHtml = mageTemplate(\n                        this.options.tierPriceTemplate,\n                        {\n                            'tierPrices': result.tierPrices,\n                            '$t': $t,\n                            'currencyFormat': this.options.jsonConfig.currencyFormat,\n                            'priceUtils': priceUtils\n                        }\n                    );\n                    $(this.options.tierPriceBlockSelector).html(tierPriceHtml).show();\n                }\n            } else {\n                $(this.options.tierPriceBlockSelector).hide();\n            }\n\n            $product.find(this.options.normalPriceLabelSelector).hide();\n\n            _.each(this.element.find('.' + this.options.classes.attributeOptionsWrapper), function (attribute) {\n                if ($(attribute).find('.' + this.options.classes.optionClass + '.selected').length === 0) {\n                    if ($(attribute).find('.' + this.options.classes.selectClass).length > 0) {\n                        _.each($(attribute).find('.' + this.options.classes.selectClass), function (dropdown) {\n                            if ($(dropdown).val() === '0') {\n                                $product.find(this.options.normalPriceLabelSelector).show();\n                            }\n                        }.bind(this));\n                    } else {\n                        $product.find(this.options.normalPriceLabelSelector).show();\n                    }\n                }\n            }.bind(this));\n        },\n\n        /**\n         * Get new prices for selected options\n         *\n         * @returns {*}\n         * @private\n         */\n        _getNewPrices: function () {\n            var $widget = this,\n                newPrices = $widget.options.jsonConfig.prices,\n                allowedProduct = this._getAllowedProductWithMinPrice(this._CalcProducts());\n\n            if (!_.isEmpty(allowedProduct)) {\n                newPrices = this.options.jsonConfig.optionPrices[allowedProduct];\n            }\n\n            return newPrices;\n        },\n\n        /**\n         * Get prices\n         *\n         * @param {Object} newPrices\n         * @param {Object} displayPrices\n         * @returns {*}\n         * @private\n         */\n        _getPrices: function (newPrices, displayPrices) {\n            var $widget = this;\n\n            if (_.isEmpty(newPrices)) {\n                newPrices = $widget._getNewPrices();\n            }\n            _.each(displayPrices, function (price, code) {\n\n                if (newPrices[code]) {\n                    displayPrices[code].amount = newPrices[code].amount - displayPrices[code].amount;\n                }\n            });\n\n            return displayPrices;\n        },\n\n        /**\n         * Get product with minimum price from selected options.\n         *\n         * @param {Array} allowedProducts\n         * @returns {String}\n         * @private\n         */\n        _getAllowedProductWithMinPrice: function (allowedProducts) {\n            var optionPrices = this.options.jsonConfig.optionPrices,\n                product = {},\n                optionFinalPrice, optionMinPrice;\n\n            _.each(allowedProducts, function (allowedProduct) {\n                optionFinalPrice = parseFloat(optionPrices[allowedProduct].finalPrice.amount);\n\n                if (_.isEmpty(product) || optionFinalPrice < optionMinPrice) {\n                    optionMinPrice = optionFinalPrice;\n                    product = allowedProduct;\n                }\n            }, this);\n\n            return product;\n        },\n\n        /**\n         * Gets all product media and change current to the needed one\n         *\n         * @private\n         */\n        _LoadProductMedia: function () {\n            var $widget = this,\n                $this = $widget.element,\n                productData = this._determineProductData(),\n                mediaCallData,\n                mediaCacheKey,\n\n                /**\n                 * Processes product media data\n                 *\n                 * @param {Object} data\n                 * @returns void\n                 */\n                mediaSuccessCallback = function (data) {\n                    if (!(mediaCacheKey in $widget.options.mediaCache)) {\n                        $widget.options.mediaCache[mediaCacheKey] = data;\n                    }\n                    $widget._ProductMediaCallback($this, data, productData.isInProductView);\n                    setTimeout(function () {\n                        $widget._DisableProductMediaLoader($this);\n                    }, 300);\n                };\n\n            if (!$widget.options.mediaCallback) {\n                return;\n            }\n\n            mediaCallData = {\n                'product_id': this.getProduct()\n            };\n\n            mediaCacheKey = JSON.stringify(mediaCallData);\n\n            if (mediaCacheKey in $widget.options.mediaCache) {\n                $widget._XhrKiller();\n                $widget._EnableProductMediaLoader($this);\n                mediaSuccessCallback($widget.options.mediaCache[mediaCacheKey]);\n            } else {\n                mediaCallData.isAjax = true;\n                $widget._XhrKiller();\n                $widget._EnableProductMediaLoader($this);\n                $widget.xhr = $.ajax({\n                    url: $widget.options.mediaCallback,\n                    cache: true,\n                    type: 'GET',\n                    dataType: 'json',\n                    data: mediaCallData,\n                    success: mediaSuccessCallback\n                }).done(function () {\n                    $widget._XhrKiller();\n                });\n            }\n        },\n\n        /**\n         * Enable loader\n         *\n         * @param {Object} $this\n         * @private\n         */\n        _EnableProductMediaLoader: function ($this) {\n            var $widget = this;\n\n            if ($('body.catalog-product-view').length > 0) {\n                $this.parents('.column.main').find('.photo.image')\n                    .addClass($widget.options.classes.loader);\n            } else {\n                //Category View\n                $this.parents('.product-item-info').find('.product-image-photo')\n                    .addClass($widget.options.classes.loader);\n            }\n        },\n\n        /**\n         * Disable loader\n         *\n         * @param {Object} $this\n         * @private\n         */\n        _DisableProductMediaLoader: function ($this) {\n            var $widget = this;\n\n            if ($('body.catalog-product-view').length > 0) {\n                $this.parents('.column.main').find('.photo.image')\n                    .removeClass($widget.options.classes.loader);\n            } else {\n                //Category View\n                $this.parents('.product-item-info').find('.product-image-photo')\n                    .removeClass($widget.options.classes.loader);\n            }\n        },\n\n        /**\n         * Callback for product media\n         *\n         * @param {Object} $this\n         * @param {String} response\n         * @param {Boolean} isInProductView\n         * @private\n         */\n        _ProductMediaCallback: function ($this, response, isInProductView) {\n            var $main = isInProductView ? $this.parents('.column.main') : $this.parents('.product-item-info'),\n                $widget = this,\n                images = [],\n\n                /**\n                 * Check whether object supported or not\n                 *\n                 * @param {Object} e\n                 * @returns {*|Boolean}\n                 */\n                support = function (e) {\n                    return e.hasOwnProperty('large') && e.hasOwnProperty('medium') && e.hasOwnProperty('small');\n                };\n\n            if (_.size($widget) < 1 || !support(response)) {\n                this.updateBaseImage(this.options.mediaGalleryInitial, $main, isInProductView);\n\n                return;\n            }\n\n            images.push({\n                full: response.large,\n                img: response.medium,\n                thumb: response.small,\n                isMain: true\n            });\n\n            if (response.hasOwnProperty('gallery')) {\n                $.each(response.gallery, function () {\n                    if (!support(this) || response.large === this.large) {\n                        return;\n                    }\n                    images.push({\n                        full: this.large,\n                        img: this.medium,\n                        thumb: this.small\n                    });\n                });\n            }\n\n            this.updateBaseImage(images, $main, isInProductView);\n        },\n\n        /**\n         * Check if images to update are initial and set their type\n         * @param {Array} images\n         */\n        _setImageType: function (images) {\n\n            images.map(function (img) {\n                if (!img.type) {\n                    img.type = 'image';\n                }\n            });\n\n            return images;\n        },\n\n        /**\n         * Update [gallery-placeholder] or [product-image-photo]\n         * @param {Array} images\n         * @param {jQuery} context\n         * @param {Boolean} isInProductView\n         */\n        updateBaseImage: function (images, context, isInProductView) {\n            var justAnImage = images[0],\n                initialImages = this.options.mediaGalleryInitial,\n                imagesToUpdate,\n                gallery = context.find(this.options.mediaGallerySelector).data('gallery'),\n                isInitial;\n\n            if (isInProductView) {\n                if (_.isUndefined(gallery)) {\n                    context.find(this.options.mediaGallerySelector).on('gallery:loaded', function () {\n                        this.updateBaseImage(images, context, isInProductView);\n                    }.bind(this));\n\n                    return;\n                }\n\n                imagesToUpdate = images.length ? this._setImageType($.extend(true, [], images)) : [];\n                isInitial = _.isEqual(\n                    imagesToUpdate.map(({thumb, img, full, type, videoUrl}) => ({thumb, img, full, type, videoUrl})),\n                    initialImages.map(({thumb, img, full, type, videoUrl}) => ({thumb, img, full, type, videoUrl}))\n                );\n\n                if (this.options.gallerySwitchStrategy === 'prepend' && !isInitial) {\n                    imagesToUpdate = imagesToUpdate.concat(initialImages);\n                }\n\n                imagesToUpdate = this._setImageIndex(imagesToUpdate);\n\n                gallery.updateData(imagesToUpdate);\n                this._addFotoramaVideoEvents(isInitial);\n            } else if (justAnImage && justAnImage.img) {\n                context.find('.product-image-photo').attr('src', justAnImage.img);\n            }\n        },\n\n        /**\n         * Add video events\n         *\n         * @param {Boolean} isInitial\n         * @private\n         */\n        _addFotoramaVideoEvents: function (isInitial) {\n            if (_.isUndefined($.mage.AddFotoramaVideoEvents)\n                || !$(this.options.mediaGallerySelector).AddFotoramaVideoEvents('instance')\n            ) {\n                $(this.options.mediaGallerySelector).on('addfotoramavideoeventscreate', function () {\n                    this._addFotoramaVideoEvents(isInitial);\n                }.bind(this));\n\n                return;\n            }\n\n            if (isInitial) {\n                $(this.options.mediaGallerySelector).AddFotoramaVideoEvents();\n\n                return;\n            }\n\n            $(this.options.mediaGallerySelector).AddFotoramaVideoEvents({\n                selectedOption: this.getProduct(),\n                dataMergeStrategy: this.options.gallerySwitchStrategy\n            });\n        },\n\n        /**\n         * Set correct indexes for image set.\n         *\n         * @param {Array} images\n         * @private\n         */\n        _setImageIndex: function (images) {\n            var length = images.length,\n                i;\n\n            for (i = 0; length > i; i++) {\n                images[i].i = i + 1;\n            }\n\n            return images;\n        },\n\n        /**\n         * Kill doubled AJAX requests\n         *\n         * @private\n         */\n        _XhrKiller: function () {\n            var $widget = this;\n\n            if ($widget.xhr !== undefined && $widget.xhr !== null) {\n                $widget.xhr.abort();\n                $widget.xhr = null;\n            }\n        },\n\n        /**\n         * Emulate mouse click on all swatches that should be selected\n         * @param {Object} [selectedAttributes]\n         * @private\n         */\n        _EmulateSelected: function (selectedAttributes) {\n            $.each(selectedAttributes, $.proxy(function (attributeCode, optionId) {\n                var elem = this.element.find('.' + this.options.classes.attributeClass +\n                    '[data-attribute-code=\"' + attributeCode + '\"] [data-option-id=\"' + optionId + '\"]'),\n                    parentInput = elem.parent();\n\n                if (elem.hasClass('selected')) {\n                    return;\n                }\n\n                if (parentInput.hasClass(this.options.classes.selectClass)) {\n                    parentInput.val(optionId);\n                    parentInput.trigger('change');\n                } else {\n                    elem.trigger('click');\n                }\n            }, this));\n        },\n\n        /**\n         * Emulate mouse click or selection change on all swatches that should be selected\n         * @param {Object} [selectedAttributes]\n         * @private\n         */\n        _EmulateSelectedByAttributeId: function (selectedAttributes) {\n            $.each(selectedAttributes, $.proxy(function (attributeId, optionId) {\n                var elem = this.element.find('.' + this.options.classes.attributeClass +\n                    '[data-attribute-id=\"' + attributeId + '\"] [data-option-id=\"' + optionId + '\"]'),\n                    parentInput = elem.parent();\n\n                if (elem.hasClass('selected')) {\n                    return;\n                }\n\n                if (parentInput.hasClass(this.options.classes.selectClass)) {\n                    parentInput.val(optionId);\n                    parentInput.trigger('change');\n                } else {\n                    elem.trigger('click');\n                }\n            }, this));\n        },\n\n        /**\n         * Get default options values settings with either URL query parameters\n         * @private\n         */\n        _getSelectedAttributes: function () {\n            var hashIndex = window.location.href.indexOf('#'),\n                selectedAttributes = {},\n                params;\n\n            if (hashIndex !== -1) {\n                params = $.parseQuery(window.location.href.substr(hashIndex + 1));\n\n                selectedAttributes = _.invert(_.mapObject(_.invert(params), function (attributeId) {\n                    var attribute = this.options.jsonConfig.mappedAttributes[attributeId];\n\n                    return attribute ? attribute.code : attributeId;\n                }.bind(this)));\n            }\n\n            return selectedAttributes;\n        },\n\n        /**\n         * Callback which fired after gallery gets initialized.\n         *\n         * @param {HTMLElement} element - DOM element associated with a gallery.\n         */\n        _onGalleryLoaded: function (element) {\n            var galleryObject = element.data('gallery');\n\n            this.options.mediaGalleryInitial = galleryObject.returnCurrentImages();\n        },\n\n        /**\n         * Sets mediaCache for cases when jsonConfig contains preSelectedGallery on layered navigation result pages\n         *\n         * @private\n         */\n        _setPreSelectedGallery: function () {\n            var mediaCallData;\n\n            if (this.options.jsonConfig.preSelectedGallery) {\n                mediaCallData = {\n                    'product_id': this.getProduct()\n                };\n\n                this.options.mediaCache[JSON.stringify(mediaCallData)] = this.options.jsonConfig.preSelectedGallery;\n            }\n        },\n\n        /**\n         * Callback for quantity change event.\n         */\n        _onQtyChanged: function () {\n            var $price = this.element.parents(this.options.selectorProduct)\n                .find(this.options.selectorProductPrice);\n\n            $price.trigger(\n                'updatePrice',\n                {\n                    'prices': this._getPrices(this._getNewPrices(), $price.priceBox('option').prices)\n                }\n            );\n        }\n    });\n\n    return $.mage.SwatchRenderer;\n});\n","Magento_Catalog/js/catalog-add-to-cart.js":"/**\n * Copyright \u00a9 2016 Magento. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'mage/translate',\n    'jquery/ui',\n    'mage/url'\n], function($, $t,$u,url) {\n    \"use strict\";\n\n    $.widget('mage.catalogAddToCart', {\n\n        options: {\n            processStart: null,\n            processStop: null,\n            bindSubmit: true,\n            minicartSelector: '[data-block=\"minicart\"]',\n            messagesSelector: '[data-placeholder=\"messages\"]',\n            productStatusSelector: '.stock.available',\n            addToCartButtonSelector: '.action.tocart',\n            addToCartButtonDisabledClass: 'disabled',\n            addToCartButtonTextWhileAdding: '',\n            addToCartButtonTextAdded: '',\n            addToCartButtonTextDefault: ''\n        },\n\n        _create: function() {\n            if (this.options.bindSubmit) {\n                this._bindSubmit();\n            }\n        },\n\n        _bindSubmit: function() {\n            var self = this;\n            this.element.on('submit', function(e) {\n                e.preventDefault();\n                self.submitForm($(this));\n            });\n        },\n\n        isLoaderEnabled: function() {\n            return this.options.processStart && this.options.processStop;\n        },\n\n        /**\n         * Handler for the form 'submit' event\n         *\n         * @param {Object} form\n         */\n        submitForm: function (form) {\n            var addToCartButton, self = this;\n\n            if (form.has('input[type=\"file\"]').length && form.find('input[type=\"file\"]').val() !== '') {\n                self.element.off('submit');\n                // disable 'Add to Cart' button\n                addToCartButton = $(form).find(this.options.addToCartButtonSelector);\n                addToCartButton.prop('disabled', true);\n                addToCartButton.addClass(this.options.addToCartButtonDisabledClass);\n                form.submit();\n            } else {\n                self.ajaxSubmit(form);\n            }\n        },\n\n        ajaxSubmit: function(form) {\n            var self = this;\n            $(self.options.minicartSelector).trigger('contentLoading');\n            self.disableAddToCartButton(form);\n\n            $.ajax({\n                url: form.attr('action'),\n                data: form.serialize(),\n                type: 'post',\n                dataType: 'json',\n                beforeSend: function() {\n                    if (self.isLoaderEnabled()) {\n                        $('body').trigger(self.options.processStart);\n                    }\n                },\n                success: function(res) {\n                    if (self.isLoaderEnabled()) {\n                        $('body').trigger(self.options.processStop);\n                    }\n\n                    if (res.backUrl) {\n                        window.location = res.backUrl;\n                        return;\n                    }\n                    if (res.messages) {\n                        $(self.options.messagesSelector).html(res.messages);\n                    }\n                    if (res.minicart) {\n                        $(self.options.minicartSelector).replaceWith(res.minicart);\n                        $(self.options.minicartSelector).trigger('contentUpdated');\n                    }\n                    if (res.product && res.product.statusText) {\n                        $(self.options.productStatusSelector)\n                            .removeClass('available')\n                            .addClass('unavailable')\n                            .find('span')\n                            .html(res.product.statusText);\n                    }\n                    //self.enableAddToCartButton(form);\n                    window.location.href = url.build('checkout/cart/');\n                }\n            });\n        },\n\n        disableAddToCartButton: function(form) {\n            var addToCartButtonTextWhileAdding = $t('PLEASE WAIT WHILE CART IS BEEN UPDATED');\n            var addToCartButton = $(form).find(this.options.addToCartButtonSelector);\n            addToCartButton.addClass(this.options.addToCartButtonDisabledClass);\n            addToCartButton.find('span').text(addToCartButtonTextWhileAdding);\n            addToCartButton.attr('title', addToCartButtonTextWhileAdding);\n        },\n\n        enableAddToCartButton: function(form) {\n            var addToCartButtonTextAdded = this.options.addToCartButtonTextAdded || $t('Added');\n            var self = this,\n                addToCartButton = $(form).find(this.options.addToCartButtonSelector);\n\n            addToCartButton.find('span').text(addToCartButtonTextAdded);\n            addToCartButton.attr('title', addToCartButtonTextAdded);\n\n            setTimeout(function() {\n                var addToCartButtonTextDefault = self.options.addToCartButtonTextDefault || $t('Add to Cart');\n                addToCartButton.removeClass(self.options.addToCartButtonDisabledClass);\n                addToCartButton.find('span').text(addToCartButtonTextDefault);\n                addToCartButton.attr('title', addToCartButtonTextDefault);\n            }, 1000);\n        }\n    });\n\n    return $.mage.catalogAddToCart;\n});","Magento_Catalog/js/list.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.compareList', {\n\n        /** @inheritdoc */\n        _create: function () {\n            var elem = this.element,\n                products = $('thead td', elem),\n                headings;\n\n            if (products.length > this.options.productsInRow) {\n                headings = $('<table></table>')\n                    .addClass('comparison headings data table')\n                    .insertBefore(elem.closest('.container'));\n\n                elem.addClass('scroll');\n\n                $('th', elem).each(function () {\n                    var th = $(this),\n                        thCopy = th.clone();\n\n                    th.animate({\n                        top: '+=0'\n                    }, 50, function () {\n                        var height = th.height();\n\n                        thCopy.css('height', height)\n                            .appendTo(headings)\n                            .wrap('<tr></tr>');\n                    });\n                });\n            }\n\n            $(this.options.windowPrintSelector).on('click', function (e) {\n                e.preventDefault();\n                window.print();\n            });\n        }\n    });\n\n    return $.mage.compareList;\n});\n","Magento_Catalog/js/price-options.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'underscore',\n    'mage/template',\n    'priceUtils',\n    'priceBox',\n    'jquery-ui-modules/widget'\n], function ($, _, mageTemplate, utils) {\n    'use strict';\n\n    var globalOptions = {\n        productId: null,\n        priceHolderSelector: '.price-box', //data-role=\"priceBox\"\n        optionsSelector: '.product-custom-option',\n        optionConfig: {},\n        optionHandlers: {},\n        optionTemplate: '<%= data.label %>' +\n        '<% if (data.finalPrice.value > 0) { %>' +\n        ' +<%- data.finalPrice.formatted %>' +\n        '<% } else if (data.finalPrice.value < 0) { %>' +\n        ' <%- data.finalPrice.formatted %>' +\n        '<% } %>',\n        controlContainer: 'dd'\n    };\n\n    /**\n     * Custom option preprocessor\n     * @param  {jQuery} element\n     * @param  {Object} optionsConfig - part of config\n     * @return {Object}\n     */\n    function defaultGetOptionValue(element, optionsConfig) {\n        var changes = {},\n            optionValue = element.val(),\n            optionId = utils.findOptionId(element[0]),\n            optionName = element.prop('name'),\n            optionType = element.prop('type'),\n            optionConfig = optionsConfig[optionId],\n            optionHash = optionName;\n\n        switch (optionType) {\n            case 'text':\n            case 'textarea':\n                changes[optionHash] = optionValue ? optionConfig.prices : {};\n                break;\n\n            case 'radio':\n                if (element.is(':checked')) {\n                    changes[optionHash] = optionConfig[optionValue] && optionConfig[optionValue].prices || {};\n                }\n                break;\n\n            case 'select-one':\n                changes[optionHash] = optionConfig[optionValue] && optionConfig[optionValue].prices || {};\n                break;\n\n            case 'select-multiple':\n                _.each(optionConfig, function (row, optionValueCode) {\n                    optionHash = optionName + '##' + optionValueCode;\n                    changes[optionHash] = _.contains(optionValue, optionValueCode) ? row.prices : {};\n                });\n                break;\n\n            case 'checkbox':\n                optionHash = optionName + '##' + optionValue;\n                changes[optionHash] = element.is(':checked') ? optionConfig[optionValue].prices : {};\n                break;\n\n            case 'file':\n                // Checking for 'disable' property equal to checking DOMNode with id*=\"change-\"\n                changes[optionHash] = optionValue || element.prop('disabled') ? optionConfig.prices : {};\n                break;\n        }\n\n        return changes;\n    }\n\n    $.widget('mage.priceOptions', {\n        options: globalOptions,\n\n        /**\n         * @private\n         */\n        _init: function initPriceBundle() {\n            $(this.options.optionsSelector, this.element).trigger('change');\n        },\n\n        /**\n         * Widget creating method.\n         * Triggered once.\n         * @private\n         */\n        _create: function createPriceOptions() {\n            var form = this.element,\n                options = $(this.options.optionsSelector, form),\n                priceBox = $(this.options.priceHolderSelector, $(this.options.optionsSelector).element);\n\n            if (priceBox.data('magePriceBox') &&\n                priceBox.priceBox('option') &&\n                priceBox.priceBox('option').priceConfig\n            ) {\n                if (priceBox.priceBox('option').priceConfig.optionTemplate) {\n                    this._setOption('optionTemplate', priceBox.priceBox('option').priceConfig.optionTemplate);\n                }\n                this._setOption('priceFormat', priceBox.priceBox('option').priceConfig.priceFormat);\n            }\n\n            this._applyOptionNodeFix(options);\n\n            options.on('change', this._onOptionChanged.bind(this));\n        },\n\n        /**\n         * Custom option change-event handler\n         * @param {Event} event\n         * @private\n         */\n        _onOptionChanged: function onOptionChanged(event) {\n            var changes,\n                option = $(event.target),\n                handler = this.options.optionHandlers[option.data('role')];\n\n            option.data('optionContainer', option.closest(this.options.controlContainer));\n\n            if (handler && handler instanceof Function) {\n                changes = handler(option, this.options.optionConfig, this);\n            } else {\n                changes = defaultGetOptionValue(option, this.options.optionConfig);\n            }\n            $(this.options.priceHolderSelector).trigger('updatePrice', changes);\n        },\n\n        /**\n         * Helper to fix issue with option nodes:\n         *  - you can't place any html in option ->\n         *    so you can't style it via CSS\n         * @param {jQuery} options\n         * @private\n         */\n        _applyOptionNodeFix: function applyOptionNodeFix(options) {\n            var config = this.options,\n                format = config.priceFormat,\n                template = config.optionTemplate;\n\n            template = mageTemplate(template);\n            options.filter('select').each(function (index, element) {\n                var $element = $(element),\n                    optionId = utils.findOptionId($element),\n                    optionConfig = config.optionConfig && config.optionConfig[optionId];\n\n                $element.find('option').each(function (idx, option) {\n                    var $option,\n                        optionValue,\n                        toTemplate,\n                        prices;\n\n                    $option = $(option);\n                    optionValue = $option.val();\n\n                    if (!optionValue && optionValue !== 0) {\n                        return;\n                    }\n\n                    toTemplate = {\n                        data: {\n                            label: optionConfig[optionValue] && optionConfig[optionValue].name\n                        }\n                    };\n                    prices = optionConfig[optionValue] ? optionConfig[optionValue].prices : null;\n\n                    if (prices) {\n                        _.each(prices, function (price, type) {\n                            var value = +price.amount;\n\n                            value += _.reduce(price.adjustments, function (sum, x) { //eslint-disable-line\n                                return sum + x;\n                            }, 0);\n                            toTemplate.data[type] = {\n                                value: value,\n                                formatted: utils.formatPriceLocale(value, format)\n                            };\n                        });\n\n                        $option.text(template(toTemplate));\n                    }\n                });\n            });\n        },\n\n        /**\n         * Custom behavior on getting options:\n         * now widget able to deep merge accepted configuration with instance options.\n         * @param  {Object}  options\n         * @return {$.Widget}\n         * @private\n         */\n        _setOptions: function setOptions(options) {\n            $.extend(true, this.options, options);\n            this._super(options);\n\n            return this;\n        }\n    });\n\n    return $.mage.priceOptions;\n});\n","Magento_Catalog/js/upsell-products.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.upsellProducts', {\n        options: {\n            elementsSelector: '.item.product'\n        },\n\n        /**\n         * Bind events to the appropriate handlers.\n         * @private\n         */\n        _create: function () {\n            if (this.element.data('shuffle')) {\n                this._shuffle(this.element.find(this.options.elementsSelector));\n            }\n            this._showUpsellProducts(\n                this.element.find(this.options.elementsSelector),\n                this.element.data('limit'),\n                this.element.data('shuffle-weighted')\n            );\n        },\n\n        /* jscs:disable */\n        /* eslint-disable */\n        /**\n         * Show upsell products according to limit. Shuffle if needed.\n         * @param {*} elements\n         * @param {Number} limit\n         * @param {Boolean} weightedRandom\n         * @private\n         */\n        _showUpsellProducts: function (elements, limit, weightedRandom) {\n            var index, weights = [], random = [], weight = 2, shown = 0, $element, currentGroup, prevGroup;\n\n            if (limit === 0) {\n                limit = elements.length;\n            }\n\n            if (weightedRandom && limit > 0 && limit < elements.length) {\n                for (index = 0; index < limit; index++) {\n                    $element = $(elements[index]);\n                    if ($element.data('shuffle-group') !== '') {\n                        break;\n                    }\n                    $element.show();\n                    shown++;\n                }\n                limit -= shown;\n                for (index = elements.length - 1; index >= 0; index--) {\n                    $element = $(elements[index]);\n                    currentGroup = $element.data('shuffle-group');\n                    if (currentGroup !== '') {\n                        weights.push([index, Math.log(weight)]);\n                        if (typeof prevGroup !== 'undefined' && prevGroup !== currentGroup) {\n                            weight += 2;\n                        }\n                        prevGroup = currentGroup;\n                    }\n                }\n\n                if (weights.length === 0) {\n                    return;\n                }\n\n                for (index = 0; index < weights.length; index++) {\n                    random.push([weights[index][0], Math.pow(Math.random(), 1 / weights[index][1])]);\n                }\n\n                random.sort(function(a, b) {\n                    a = a[1];\n                    b = b[1];\n                    return a < b ? 1 : (a > b ? -1 : 0);\n                });\n                index = 0;\n                while (limit) {\n                    $(elements[random[index][0]]).show();\n                    limit--;\n                    index++\n                }\n                return;\n            }\n\n            for (index = 0; index < limit; index++) {\n                $(elements[index]).show();\n            }\n        },\n\n        /* jscs:disable */\n        /* eslint-disable */\n        /**\n         * Shuffle an array\n         * @param elements\n         * @returns {*}\n         */\n        _shuffle: function shuffle(elements){ //v1.0\n            var parent, child, lastSibling;\n            if (elements.length) {\n                parent = $(elements[0]).parent();\n            }\n            while (elements.length) {\n                child = elements.splice(Math.floor(Math.random() *  elements.length), 1)[0];\n                lastSibling = parent.find('[data-shuffle-group=\"' + $(child).data('shuffle-group') + '\"]').last();\n                lastSibling.after(child);\n            }\n        }\n\n        /* jscs:disable */\n        /* eslint:disable */\n    });\n\n    return $.mage.upsellProducts;\n});\n","Magento_Catalog/js/lensoption.js":"define([\n    \"jquery\",\n    'Magento_Ui/js/modal/alert',\n    \"jquery/ui\",\n    'mage/cookies',\n], function ($, alert) {\n    'use strict';\n    $.widget('mage.lensoption', {\n        _create: function () {\n            var self = this;\n            var options = self.options.optionsData;\n            var inventoryStatus = false;\n            $(document).ready(function() {\n                $('.product-options-bottom').after($(\".time-to-free-delivery\"));\n                tick();\n            })\n            $('select').on('change', function() {\n                if (this.value != \"\") {\n                    var optionId = $(this).attr('id').split('_')[1];\n                    var side = $(this).attr('data-side');\n                    var value = this.value;\n                    $(this).closest('li').next().find('select').removeAttr('disabled');\n                    updateOptions(optionId, value, side);\n                } else {\n                    $(this).closest('li').next().find('select').val('');\n                    $(this).closest('li').nextAll().find('select').val('').prop('disabled','disabled');\n                }                \n            });\n\n            $('select').on('change', function() {\n                $(this).closest('li').next().find('select').val('');\n                $(this).closest('li').nextAll(\":gt(0)\").find('select').val('').prop('disabled','disabled');\n            })\n\n            function updateOptions(optionId, value, side) {\n                var arrayToUpdate = options[optionId];\n                var valuesToUpdate = arrayToUpdate[value];\n                if (!$.isEmptyObject(valuesToUpdate)) {\n                    $('#'+side+'_main #select_'+optionId).closest('li').nextAll().find('select option:gt(0)').remove();\n                    $.each(valuesToUpdate, function(index, value){\n                        $.each(value, function(optionValue, optionText){\n                            $('#'+side+'_main #select_'+index).append(`<option value=\"${optionValue}\">${optionText}</option>`);\n                        })\n                    });\n                }\n            }\n            $('#left_checked').click(function(){\n                if ($(this).prop(\"checked\") == false) {\n                    reset('left');\n                } else if ($(this).prop(\"checked\") == true) {\n                    $(\"#left_main\").find(\"select:nth(0)\").removeAttr('disabled');\n                    $(\"#left_main\").find('ul.options').removeClass('no_display');\n                    $(\"#left_main\").find('.styledSelect').removeClass('disabled');\n                }\n            });\n            $('#right_checked').click(function(){\n                if ($(this).prop(\"checked\") == false) {\n                    reset('right');\n                } else if ($(this).prop(\"checked\") == true) {\n                    $(\"#right_main\").find(\"select:nth(0)\").removeAttr('disabled');\n                    $(\"#right_main\").find('ul.options').removeClass('no_display');\n                    $(\"#right_main\").find('.styledSelect').removeClass('disabled');\n\n                }\n            });\n            function reset(side) {\n                $(\"#\"+side+\"_main\").find(\"select\").prop('disabled', 'disabled');\n                $(\"#\"+side+\"_main\").find(\"select\").val('');\n                $(\"#\"+side+\"_main\").find('ul.options').addClass('no_display');\n                $(\"#\"+side+\"_main\").find('.styledSelect').text('-- Please Select --');\n                $(\"#\"+side+\"_main\").find('.styledSelect').addClass('disabled');\n\n            }\n            function checkProductAvailability() {\n                var selectedData = getSelectedOptionData();\n                $.ajax({\n                    showLoader: true,\n                    type: \"POST\",\n                    dataType: \"json\",\n                    url: self.options.url,\n                    data: {\n                        'selectedData': selectedData,\n                        'productId' : $(\"input[name=product]\").val(),\n                        'form_key': $.mage.cookies.get('form_key'),\n                    },\n                    cache: false,\n                    success: function(data){\n                        inventoryStatus = data.status;\n                    }\n                });\n            }\n            function getSelectedOptionData()\n            {\n                var selectedOptionsData = {};\n                selectedOptionsData['rightEye'] = {};\n                selectedOptionsData['leftEye'] = {};\n                var isRightChecked = $('#right_checked').is(':checked');\n                var isLeftChecked = $('#left_checked').is(':checked');\n                if (isRightChecked) {\n                    $('#right_main select').each(function() {\n                        selectedOptionsData['rightEye'][$(this).attr('data-label')] = $(this).find('option:selected').text();\n                    });\n                }\n                if (isLeftChecked) {\n                    $('#left_main select').each(function() {\n                        selectedOptionsData['leftEye'][$(this).attr('data-label')] = $(this).find('option:selected').text();\n                    });\n                }\n                return selectedOptionsData;\n            }\n            $(\".quantity-manager .add-action\").click(function(){\n                if ($(this).hasClass('add-up') ) {\n                    if (parseInt($(this).parent().parent().find('.quantity-number input.qty').val()) < 12) {\n                        $(this).parent().parent().find('.quantity-number input.qty').val(parseInt($(this).parent().parent().find('.quantity-number input.qty').val()) + 1);\n                    }\n                } else {\n                    if (parseInt($(this).parent().parent().find('.quantity-number input.qty').val()) > 1) {\n                        $(this).parent().parent().find('.quantity-number input.qty').val(parseInt($(this).parent().parent().find('.quantity-number input.qty').val()) - 1);\n                    }\n                }\n            })\n            $('#right_checked').click(function () {\n                updateMessage();\n            })\n            $('#left_checked').click(function () {\n                updateMessage();\n            })\n            $(\"#right_main select\").on('change', function(){\n                updateMessage();\n            })\n            $(\"#left_main select\").on('change', function(){\n                updateMessage();\n            })        \n            function updateMessage() {\n                var rightFlag = true;\n                var leftFlag = true;\n                var isRightChecked = jQuery('#right_checked').is(':checked');\n                var isLeftChecked = jQuery('#left_checked').is(':checked');\n                if (isRightChecked) {\n                    jQuery('#right_main select').each(function() {\n                        if (jQuery(this).val() == \"\") {\n                            rightFlag = false;\n                            return false;\n                        }\n                    });\n                } else {\n                    rightFlag = true;\n                }\n                if (isLeftChecked) {\n                    jQuery('#left_main select').each(function() {\n                        if (jQuery(this).val() == \"\") {\n                            leftFlag = false;\n                            return false;\n                        }\n                    });\n                } else {\n                    leftFlag = true;\n                }\n                if (!isRightChecked && !isLeftChecked) {\n                    jQuery('#demo').addClass('do_not_show');\n                    jQuery(\".warning_message\").removeClass('do_not_show');\n                } \n                // else {\n                    // if (rightFlag && leftFlag) {\n                    //     checkProductAvailability();\n                    //     jQuery('#demo').removeClass('do_not_show');\n                    //     jQuery(\".warning_message\").addClass('do_not_show');\n                    // } else {\n                    //     jQuery('#demo').addClass('do_not_show');\n                    //     jQuery(\".warning_message\").removeClass('do_not_show');\n                    // }\n                // }\n            }\n            var start = new Date;\n            var date = new Date();\n            var todayDay = date.getDay();\n            if (todayDay == 6) {\n                start.setHours(12, 0, 0);\t// 12 noon\n            } else if (todayDay != 0) {\n                start.setHours(17, 0, 0); // 5pm\n            } else {\n                start.setHours(0, 0, 0); // midnight\n            }\n            function pad(num) {\n                return (\"0\" + parseInt(num)).substr(-2);\n            }\n            $('select.product-custom-option.attr-power').each(function() {\n\n                // Cache the number of options\n                var $this = $(this),\n                side = $(this).attr('data-side'),\n                numberOfOptions = $(this).children('option').length;\n\n                // Hides the select element\n                $this.addClass('s-hidden');\n\n                // Wrap the select element in a div\n                $this.wrap('<div class=\"select\"></div>');\n\n                // Insert a styled div to sit over the top of the hidden select element\n                $this.after('<div class=\"styledSelect\"></div>');\n\n                // Cache the styled div\n                var $styledSelect = $this.next('div.styledSelect');\n\n                // Show the first select option in the styled div\n                $styledSelect.text($this.children('option').eq(0).text());\n\n                // Insert an unordered list after the styled div and also cache the list\n                var $list = $('<ul />', {\n                    'class': 'options '+side\n                }).insertAfter($styledSelect);\n\n\n                // Insert a list item into the unordered list for each select option\n                for (var i = 0; i < numberOfOptions; i++) {\n                    // $('<span />', {\n                    // }).appendTo($list);\n                    var optionText = $this.children('option').eq(i).text();\n                    var optionValue = $this.children('option').eq(i).val();\n                    var id = Math.abs(parseFloat(optionText));\n                    if (id != NaN) {\n                        if ($('ul.'+side+' span[title|=\"'+id).length) {\n                            if (parseFloat(optionText) >= 0) {\n                               \n                                $('ul.'+side+' span[title|=\"'+id).append('<li class=\"pos\" rel=\"'+optionValue+'\">'+optionText+'</li>');\n                            } else {\n                                \n                                $('ul.'+side+' span[title|=\"'+id).prepend('<li class=\"neg\" rel=\"'+optionValue+'\">'+optionText+'</li>');\n                            }\n                        } else {\n                            $('ul.'+side).append('<span title=\"'+id+'\"></span>');\n                            if (parseFloat(optionText) >= 0) {\n                                \n                                $('ul.'+side+' span[title|=\"'+id).append('<li class=\"pos\" rel=\"'+optionValue+'\">'+optionText+'</li>');\n                            } else {\n                                \n                                $('ul.'+side+' span[title|=\"'+id).prepend('<li class=\"neg\" rel=\"'+optionValue+'\">'+optionText+'</li>');\n                            }\n                        }\n                    }\n\n                }\n\n                // Cache the list items ()\n                var $listItems = $list.children('li');\n\n                // Show the unordered list when the styled div is clicked (also hides it if the div is clicked again)\n                $styledSelect.click(function(e) {\n                    e.stopPropagation();\n                    if ($(this).hasClass('active')) {\n                        $(this).removeClass('active');\n                        $(this).next('ul.options').hide();\n                    } else {\n                        $(this).addClass('active');\n                        $(this).next('ul.options').show();\n                    }\n                });\n\n                // Hides the unordered list when a list item is clicked and updates the styled div to show the selected list item\n                // Updates the select element to have the value of the equivalent option\n                $(document).on('click', 'ul.options span li', function(e) {    \n                    e.stopPropagation();\n                    $(this).parent().parent().parent().find('select').val($(this).attr('rel'));\n                    var optionId = $(this).parent().parent().parent().find('select').attr('id').split('_')[1];\n                    var side = $(this).parent().parent().parent().find('select').attr('data-side');\n                    console.log(side);\n                    $('#'+side+'_main .styledSelect').text($(this).text()).removeClass('active');\n                    var value = $(this).attr('rel');\n                    if (value != \"\") {\n                        $(this).parents('li').next().find('select').removeAttr('disabled');\n                        updateOptions(optionId, value, side);\n\n                    } else {\n                        $(this).parents('li').next().find('select').val('');\n                        $(this).parents('li').nextAll().find('select').val('').prop('disabled','disabled');\n                    }\n                    $list.hide();\n                });\n\n                // Hides the unordered list when clicking outside of it\n                $(document).click(function() {\n                    $styledSelect.removeClass('active');\n                    $list.hide();\n                });\n\n            });\n            $(document).ready(function(){\n                var titles = [],\n                    elements = [];\n                $('ul.options.left span').each(function(i, item) {\n                    var title = parseFloat($(this).attr('title'));\n                    if (!title) {\n                    } else {\n                        titles[i] = title;\n                        elements[title] = $(this).remove().clone();\n                    }\n                });\n                titles = titles.sort(function(a, b){return a-b});\n                console.log(titles);\n                $.each(titles,function(i, item) {\n                    $('ul.options.left').append(elements[item]);\n                });\n            });\n\n            $(document).ready(function(){\n                var titles = [],\n                    elements = [];\n                $('ul.options.right span').each(function(i, item) {\n                    var title = parseFloat($(this).attr('title'));\n                    if (!title) {\n                    } else {\n                        titles[i] = title;\n                        elements[title] = $(this).remove().clone();\n                    }\n                });\n                titles = titles.sort(function(a, b){return a-b});\n                console.log(titles);\n                $.each(titles,function(i, item) {\n                    $('ul.options.right').append(elements[item]);\n                });\n            });\n\n            function tick() {\n                var showFlag = false;\n                var now = new Date;\n                var remain = ((start - now) / 1000);\n                var hh = pad((remain / 60 / 60) % 60);\n                var mm = pad((remain / 60) % 60);\n                var ss = pad(remain % 60);\n                var stockStatus = \"<p><span class='hemag_stock_status'>-- In Stock --</span></p>\";\n                var dispatchToday = \"<span class='hj_normal_text'>Order within </span> <span class='hj_time_text'>\"+ hh + \":\" + mm + \":\" + ss + \"</span><span class='hj_normal_text'> for Dispatch Today</span>\";\n                if (todayDay == 0 || todayDay == 6) {\n                    var dispatchTomorrow = \"<span class='hj_normal_text'>This Order will be Dispatched on Monday</span>\";\n                } else {\n                    var dispatchTomorrow = \"<span class='hj_normal_text'>This Order will be Dispatched Tomorrow</span>\";\n                }\n                var dispatchLater = \"<span class = 'dispatch_later'>The product will be dispatched in</span></br><span> 1-2 working days</span>\"\n                if (inventoryStatus) {\n                    if (now < start) {\n                        var messageString = stockStatus + dispatchToday;\n                    } else {\n                        var messageString = stockStatus + dispatchTomorrow;\n                    }\n                } else {\n                    var messageString = dispatchLater;\n                }\n                $('#demo').html(messageString);\n                setTimeout(tick, 1000);\n            }\n            document.addEventListener('DOMContentLoaded', tick);\n        }\n    });\n    return $.mage.lensoption;\n});","Magento_Catalog/js/price-option-date.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'priceUtils',\n    'priceOptions',\n    'jquery-ui-modules/widget'\n], function ($, utils) {\n    'use strict';\n\n    var globalOptions = {\n            fromSelector: 'form',\n            dropdownsSelector: '[data-role=calendar-dropdown]'\n        },\n        optionHandler = {};\n\n    optionHandler.optionHandlers = {};\n\n    /**\n     * Custom handler for Date-with-Dropdowns option type.\n     * @param  {jQuery} siblings\n     * @return {Function} function that return object { optionHash : optionAdditionalPrice }\n     */\n    function onCalendarDropdownChange(siblings) {\n        return function (element, optionConfig) {\n            var changes = {},\n                optionId = utils.findOptionId(element),\n                overhead = optionConfig[optionId].prices,\n                isNeedToUpdate = true,\n                optionHash = 'price-option-calendar-' + optionId;\n\n            siblings.each(function (index, el) {\n                isNeedToUpdate = isNeedToUpdate && !!$(el).val();\n            });\n\n            overhead = isNeedToUpdate ? overhead : {};\n            changes[optionHash] = overhead;\n\n            return changes;\n        };\n    }\n\n    /**\n     * Returns number of days for special month and year\n     * @param  {Number} month\n     * @param  {Number} year\n     * @return {Number}\n     */\n    function getDaysInMonth(month, year) {\n        return new Date(year, month, 0).getDate();\n    }\n\n    /**\n     * Adjusts the number of days in the day option element based on which month or year\n     * is selected (changed). Adjusts the days to 28, 29, 30, or 31 typically.\n     * @param {jQuery} dropdowns\n     */\n    function onDateChange(dropdowns) {\n        var daysNodes,\n            curMonth, curYear, expectedDays,\n            options, needed,\n            month = dropdowns.filter('[data-calendar-role=month]'),\n            year = dropdowns.filter('[data-calendar-role=year]');\n\n        if (month.length && year.length) {\n            daysNodes = dropdowns.filter('[data-calendar-role=day]').find('option');\n\n            curMonth = month.val() || '01';\n            curYear = year.val() || '2000';\n            expectedDays = getDaysInMonth(curMonth, curYear);\n\n            if (daysNodes.length - 1 > expectedDays) { // remove unnecessary option nodes\n                daysNodes.each(function (i, e) {\n                    if (e.value > expectedDays) {\n                        $(e).remove();\n                    }\n                });\n            } else if (daysNodes.length - 1 < expectedDays) { // add missing option nodes\n                options = [];\n                needed = expectedDays - daysNodes.length + 1;\n\n                while (needed--) { //eslint-disable-line max-depth\n                    options.push(\n                        '<option value=\"' + (expectedDays - needed) + '\">' + (expectedDays - needed) + '</option>'\n                    );\n                }\n                $(options.join('')).insertAfter(daysNodes.last());\n            }\n        }\n    }\n\n    $.widget('mage.priceOptionDate', {\n        options: globalOptions,\n\n        /**\n         * Function-initializer of priceOptionDate widget\n         * @private\n         */\n        _create: function initOptionDate() {\n            var field = this.element,\n                form = field.closest(this.options.fromSelector),\n                dropdowns = $(this.options.dropdownsSelector, field),\n                dateOptionId;\n\n            if (dropdowns.length) {\n                dateOptionId = this.options.dropdownsSelector + dropdowns.attr('name');\n\n                optionHandler.optionHandlers[dateOptionId] = onCalendarDropdownChange(dropdowns);\n\n                form.priceOptions(optionHandler);\n\n                dropdowns.data('role', dateOptionId);\n                dropdowns.on('change', onDateChange.bind(this, dropdowns));\n            }\n        }\n    });\n\n    return $.mage.priceOptionDate;\n});\n","Magento_Catalog/js/price-utils.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/**\n * @api\n */\ndefine([\n    'jquery',\n    'underscore'\n], function ($, _) {\n    'use strict';\n\n    var globalPriceFormat = {\n        requiredPrecision: 2,\n        integerRequired: 1,\n        decimalSymbol: ',',\n        groupSymbol: ',',\n        groupLength: ','\n    };\n\n    /**\n     * Repeats {string} {times} times\n     * @param  {String} string\n     * @param  {Number} times\n     * @return {String}\n     */\n    function stringPad(string, times) {\n        return new Array(times + 1).join(string);\n    }\n\n    /**\n     * Format the price with the compliance to the specified locale\n     *\n     * @param {Number} amount\n     * @param {Object} format\n     * @param  {Boolean} isShowSign\n     */\n    function formatPriceLocale(amount, format, isShowSign)\n    {\n        var s = '',\n            precision, pattern, locale, r;\n\n        format = _.extend(globalPriceFormat, format);\n        precision = isNaN(format.requiredPrecision = Math.abs(format.requiredPrecision)) ? 2 : format.requiredPrecision;\n        pattern = format.pattern || '%s';\n        locale = window.LOCALE || 'en-US';\n        if (isShowSign === undefined || isShowSign === true) {\n            s = amount < 0 ? '-' : isShowSign ? '+' : '';\n        } else if (isShowSign === false) {\n            s = '';\n        }\n        pattern = pattern.indexOf('{sign}') < 0 ? s + pattern : pattern.replace('{sign}', s);\n        amount = Number(Math.round(Math.abs(+amount || 0) + 'e+' + precision) + ('e-' + precision));\n        r = amount.toLocaleString(locale, {minimumFractionDigits: precision});\n\n        return pattern.replace('%s', r).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n    }\n\n    /**\n     * Formatter for price amount\n     * @param  {Number}  amount\n     * @param  {Object}  format\n     * @param  {Boolean} isShowSign\n     * @return {String}              Formatted value\n     * @deprecated\n     */\n    function formatPrice(amount, format, isShowSign) {\n        var s = '',\n            precision, integerRequired, decimalSymbol, groupSymbol, groupLength, pattern, i, pad, j, re, r, am;\n\n        format = _.extend(globalPriceFormat, format);\n\n        // copied from price-option.js | Could be refactored with varien/js.js\n\n        precision = isNaN(format.requiredPrecision = Math.abs(format.requiredPrecision)) ? 2 : format.requiredPrecision;\n        integerRequired = isNaN(format.integerRequired = Math.abs(format.integerRequired)) ? 1 : format.integerRequired;\n        decimalSymbol = format.decimalSymbol === undefined ? ',' : format.decimalSymbol;\n        groupSymbol = format.groupSymbol === undefined ? '.' : format.groupSymbol;\n        groupLength = format.groupLength === undefined ? 3 : format.groupLength;\n        pattern = format.pattern || '%s';\n\n        if (isShowSign === undefined || isShowSign === true) {\n            s = amount < 0 ? '-' : isShowSign ? '+' : '';\n        } else if (isShowSign === false) {\n            s = '';\n        }\n        pattern = pattern.indexOf('{sign}') < 0 ? s + pattern : pattern.replace('{sign}', s);\n\n        // we're avoiding the usage of to fixed, and using round instead with the e representation to address\n        // numbers like 1.005 = 1.01. Using ToFixed to only provide trailing zeroes in case we have a whole number\n        i = parseInt(\n                amount = Number(Math.round(Math.abs(+amount || 0) + 'e+' + precision) + ('e-' + precision)),\n                10\n            ) + '';\n        pad = i.length < integerRequired ? integerRequired - i.length : 0;\n\n        i = stringPad('0', pad) + i;\n\n        j = i.length > groupLength ? i.length % groupLength : 0;\n        re = new RegExp('(\\\\d{' + groupLength + '})(?=\\\\d)', 'g');\n\n        // replace(/-/, 0) is only for fixing Safari bug which appears\n        // when Math.abs(0).toFixed() executed on '0' number.\n        // Result is '0.-0' :(\n\n        am = Number(Math.round(Math.abs(amount - i) + 'e+' + precision) + ('e-' + precision));\n        r = (j ? i.substr(0, j) + groupSymbol : '') +\n            i.substr(j).replace(re, '$1' + groupSymbol) +\n            (precision ? decimalSymbol + am.toFixed(precision).replace(/-/, 0).slice(2) : '');\n\n        return pattern.replace('%s', r).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n    }\n\n    /**\n     * Deep clone of Object. Doesn't support functions\n     * @param {Object} obj\n     * @return {Object}\n     */\n    function objectDeepClone(obj) {\n        return JSON.parse(JSON.stringify(obj));\n    }\n\n    /**\n     * Helper to find ID in name attribute\n     * @param   {jQuery} element\n     * @returns {undefined|String}\n     */\n    function findOptionId(element) {\n        var re, id, name;\n\n        if (!element) {\n            return id;\n        }\n        name = $(element).attr('name');\n\n        if (name.indexOf('[') !== -1) {\n            re = /\\[([^\\]]+)?\\]/;\n        } else {\n            re = /_([^\\]]+)?_/; // just to support file-type-option\n        }\n        id = re.exec(name) && re.exec(name)[1];\n\n        if (id) {\n            return id;\n        }\n    }\n\n    return {\n        formatPriceLocale: formatPriceLocale,\n        formatPrice: formatPrice,\n        deepClone: objectDeepClone,\n        strPad: stringPad,\n        findOptionId: findOptionId\n    };\n});\n","Magento_Catalog/js/storage-manager.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore',\n    'uiElement',\n    'mageUtils',\n    'Magento_Catalog/js/product/storage/storage-service',\n    'Magento_Customer/js/section-config',\n    'jquery'\n], function (_, Element, utils, storage, sectionConfig, $) {\n    'use strict';\n\n    /**\n     * Flush events, that are clones of the same customer data sections\n     * Events listener\n     */\n    $(document).on('submit', function (event) {\n        var sections;\n\n        if (event.target.hasAttribute('method') && event.target.getAttribute('method').match(/post|put|delete/i)) {\n            sections = sectionConfig.getAffectedSections(event.target.action);\n\n            if (sections && window.localStorage) {\n                _.each(sections, function (section) {\n                    window.localStorage.removeItem(section);\n                });\n            }\n        }\n    });\n\n    return Element.extend({\n        defaults: {\n            defaultNamespace: {\n                lifetime: 1000\n            },\n            storagesConfiguration: {\n                'recently_viewed_product': {\n                    namespace: 'recently_viewed_product',\n                    className: 'IdsStorage',\n                    lifetime: '${ $.defaultNamespace.lifetime }',\n                    requestConfig: {\n                        typeId: '${ $.storagesConfiguration.recently_viewed_product.namespace }'\n                    },\n                    savePrevious: {\n                        namespace: '${ $.storagesConfiguration.recently_viewed_product.namespace }' + '_previous',\n                        className: '${ $.storagesConfiguration.recently_viewed_product.className }'\n                    },\n                    allowToSendRequest: 0\n                },\n                'recently_compared_product': {\n                    namespace: 'recently_compared_product',\n                    className: 'IdsStorageCompare',\n                    provider: 'compare-products',\n                    lifetime: '${ $.defaultNamespace.lifetime }',\n                    requestConfig: {\n                        typeId: '${ $.storagesConfiguration.recently_compared_product.namespace }'\n                    },\n                    savePrevious: {\n                        namespace: '${ $.storagesConfiguration.recently_compared_product.namespace }' + '_previous',\n                        className: '${ $.storagesConfiguration.recently_compared_product.className }'\n                    },\n                    allowToSendRequest: 0\n                },\n                'product_data_storage': {\n                    namespace: 'product_data_storage',\n                    className: 'DataStorage',\n                    allowToSendRequest: 0,\n                    updateRequestConfig: {\n                        url: '',\n                        method: 'GET',\n                        dataType: 'json'\n                    }\n                }\n            },\n            requestConfig: {\n                method: 'POST',\n                dataType: 'json',\n                ajaxSaveType: 'default',\n                ignoreProcessEvents: true\n            },\n            requestSent: 0\n        },\n\n        /**\n         * Initializes provider component.\n         *\n         * @returns {Object} Chainable.\n         */\n        initialize: function () {\n            this._super()\n                .prepareStoragesConfig()\n                .initStorages()\n                .initStartData()\n                .initUpdateStorageDataListener();\n\n            return this;\n        },\n\n        /**\n         * Initializes storages.\n         *\n         * @returns {Object} Chainable.\n         */\n        initStorages: function () {\n            _.each(this.storagesNamespace, function (name) {\n                this[name] = storage.createStorage(this.storagesConfiguration[name]);\n\n                if (this.storagesConfiguration[name].savePrevious) {\n                    this[name].previous = storage.createStorage(this.storagesConfiguration[name].savePrevious);\n                }\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Initializes start data.\n         *\n         * @returns {Object} Chainable.\n         */\n        initStartData: function () {\n            _.each(this.storagesNamespace, function (name) {\n                this.updateDataHandler(name, this[name].get());\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Prepare storages congfig.\n         *\n         * @returns {Object} Chainable.\n         */\n        prepareStoragesConfig: function () {\n            this.storagesNamespace = _.keys(this.storagesConfiguration);\n\n            _.each(this.storagesNamespace, function (name) {\n                this.storagesConfiguration[name].requestConfig = _.extend(\n                    utils.copy(this.requestConfig),\n                    this.storagesConfiguration[name].requestConfig\n                );\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Prepare date in UTC format (in GMT), and calculate unix timestamp based in seconds\n         *\n         * @returns {Number}\n         * @private\n         */\n        getUtcTime: function () {\n            return new Date().getTime() / 1000;\n        },\n\n        /**\n         * Initializes listeners to storages \"data\" property.\n         */\n        initUpdateStorageDataListener: function () {\n            _.each(this.storagesNamespace, function (name) {\n                if (this[name].data) {\n                    this[name].data.subscribe(this.updateDataHandler.bind(this, name));\n                }\n            }.bind(this));\n        },\n\n        /**\n         * Handlers for storages \"data\" property\n         */\n        updateDataHandler: function (name, data) {\n            var previousData = this[name].previous ? this[name].previous.get() : false;\n\n            if (!_.isEmpty(previousData) &&\n                !_.isEmpty(data) &&\n                !utils.compare(data, previousData).equal) {\n                this[name].set(data);\n                this[name].previous.set(data);\n                this.sendRequest(name, data);\n            } else if (\n                _.isEmpty(previousData) &&\n                !_.isEmpty(data)\n            ) {\n                this[name].set(data);\n                this.sendRequest(name, data);\n            }\n        },\n\n        /**\n         * Gets last updated time\n         *\n         * @param {String} name - storage name\n         */\n        getLastUpdate: function (name) {\n            return window.localStorage.getItem(this[name].namespace + '_last_update');\n        },\n\n        /**\n         * Sets last updated time\n         *\n         * @param {String} name - storage name\n         */\n        setLastUpdate: function (name) {\n            window.localStorage.setItem(this[name].namespace + '_last_update', this.getUtcTime());\n        },\n\n        /**\n         * Request handler\n         *\n         * @param {String} name - storage name\n         */\n        requestHandler: function (name) {\n            this.setLastUpdate(name);\n            this.requestSent = 1;\n        },\n\n        /**\n         * Sends request to server to gets data\n         *\n         * @param {String} name - storage name\n         * @param {Object} data - ids\n         */\n        sendRequest: function (name, data) {\n            var params  = utils.copy(this.storagesConfiguration[name].requestConfig),\n                url = params.syncUrl,\n                typeId = params.typeId;\n\n            if (this.requestSent || !~~this.storagesConfiguration[name].allowToSendRequest) {\n                return;\n            }\n\n            delete params.typeId;\n            delete params.url;\n            this.requestSent = 1;\n\n            return utils.ajaxSubmit({\n                url: url,\n                data: {\n                    ids: data,\n                    'type_id': typeId\n                }\n            }, params).done(this.requestHandler.bind(this, name));\n        }\n    });\n});\n","Magento_Catalog/js/price-box.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/**\n * @api\n */\ndefine([\n    'jquery',\n    'Magento_Catalog/js/price-utils',\n    'underscore',\n    'mage/template',\n    'jquery-ui-modules/widget'\n], function ($, utils, _, mageTemplate) {\n    'use strict';\n\n    var globalOptions = {\n        productId: null,\n        priceConfig: null,\n        prices: {},\n        priceTemplate: '<span class=\"price\"><%- data.formatted %></span>'\n    };\n\n    $.widget('mage.priceBox', {\n        options: globalOptions,\n        qtyInfo: '#qty',\n\n        /**\n         * Widget initialisation.\n         * Every time when option changed prices also can be changed. So\n         * changed options.prices -> changed cached prices -> recalculation -> redraw price box\n         */\n        _init: function initPriceBox() {\n            var box = this.element;\n\n            box.trigger('updatePrice');\n            this.cache.displayPrices = utils.deepClone(this.options.prices);\n        },\n\n        /**\n         * Widget creating.\n         */\n        _create: function createPriceBox() {\n            var box = this.element;\n\n            this.cache = {};\n            this._setDefaultsFromPriceConfig();\n            this._setDefaultsFromDataSet();\n\n            box.on('reloadPrice', this.reloadPrice.bind(this));\n            box.on('updatePrice', this.onUpdatePrice.bind(this));\n            $(this.qtyInfo).on('input', this.updateProductTierPrice.bind(this));\n            box.trigger('price-box-initialized');\n        },\n\n        /**\n         * Call on event updatePrice. Proxy to updatePrice method.\n         * @param {Event} event\n         * @param {Object} prices\n         */\n        onUpdatePrice: function onUpdatePrice(event, prices) {\n            return this.updatePrice(prices);\n        },\n\n        /**\n         * Updates price via new (or additional values).\n         * It expects object like this:\n         * -----\n         *   \"option-hash\":\n         *      \"price-code\":\n         *         \"amount\": 999.99999,\n         *         ...\n         * -----\n         * Empty option-hash object or empty price-code object treats as zero amount.\n         * @param {Object} newPrices\n         */\n        updatePrice: function updatePrice(newPrices) {\n            var prices = this.cache.displayPrices,\n                additionalPrice = {},\n                pricesCode = [],\n                priceValue, origin, finalPrice;\n\n            this.cache.additionalPriceObject = this.cache.additionalPriceObject || {};\n\n            if (newPrices) {\n                $.extend(this.cache.additionalPriceObject, newPrices);\n            }\n\n            if (!_.isEmpty(additionalPrice)) {\n                pricesCode = _.keys(additionalPrice);\n            } else if (!_.isEmpty(prices)) {\n                pricesCode = _.keys(prices);\n            }\n\n            _.each(this.cache.additionalPriceObject, function (additional) {\n                if (additional && !_.isEmpty(additional)) {\n                    pricesCode = _.keys(additional);\n                }\n                _.each(pricesCode, function (priceCode) {\n                    priceValue = additional[priceCode] || {};\n                    priceValue.amount = +priceValue.amount || 0;\n                    priceValue.adjustments = priceValue.adjustments || {};\n\n                    additionalPrice[priceCode] = additionalPrice[priceCode] || {\n                        'amount': 0,\n                        'adjustments': {}\n                    };\n                    additionalPrice[priceCode].amount =  0 + (additionalPrice[priceCode].amount || 0) +\n                        priceValue.amount;\n                    _.each(priceValue.adjustments, function (adValue, adCode) {\n                        additionalPrice[priceCode].adjustments[adCode] = 0 +\n                            (additionalPrice[priceCode].adjustments[adCode] || 0) + adValue;\n                    });\n                });\n            });\n\n            if (_.isEmpty(additionalPrice)) {\n                this.cache.displayPrices = utils.deepClone(this.options.prices);\n            } else {\n                _.each(additionalPrice, function (option, priceCode) {\n                    origin = this.options.prices[priceCode] || {};\n                    finalPrice = prices[priceCode] || {};\n                    option.amount = option.amount || 0;\n                    origin.amount = origin.amount || 0;\n                    origin.adjustments = origin.adjustments || {};\n                    finalPrice.adjustments = finalPrice.adjustments || {};\n\n                    finalPrice.amount = 0 + origin.amount + option.amount;\n                    _.each(option.adjustments, function (pa, paCode) {\n                        finalPrice.adjustments[paCode] = 0 + (origin.adjustments[paCode] || 0) + pa;\n                    });\n                }, this);\n            }\n\n            this.element.trigger('priceUpdated', this.cache.displayPrices);\n            this.element.trigger('reloadPrice');\n        },\n\n        /*eslint-disable no-extra-parens*/\n        /**\n         * Render price unit block.\n         */\n        reloadPrice: function reDrawPrices() {\n            var priceFormat = (this.options.priceConfig && this.options.priceConfig.priceFormat) || {},\n                priceTemplate = mageTemplate(this.options.priceTemplate);\n\n            _.each(this.cache.displayPrices, function (price, priceCode) {\n                price.final = _.reduce(price.adjustments, function (memo, amount) {\n                    return memo + amount;\n                }, price.amount);\n\n                price.formatted = utils.formatPriceLocale(price.final, priceFormat);\n\n                $('[data-price-type=\"' + priceCode + '\"]', this.element).html(priceTemplate({\n                    data: price\n                }));\n            }, this);\n        },\n\n        /*eslint-enable no-extra-parens*/\n        /**\n         * Overwrites initial (default) prices object.\n         * @param {Object} prices\n         */\n        setDefault: function setDefaultPrices(prices) {\n            this.cache.displayPrices = utils.deepClone(prices);\n            this.options.prices = utils.deepClone(prices);\n        },\n\n        /**\n         * Custom behavior on getting options:\n         * now widget able to deep merge of accepted configuration.\n         * @param  {Object} options\n         * @return {mage.priceBox}\n         */\n        _setOptions: function setOptions(options) {\n            $.extend(true, this.options, options);\n\n            if ('disabled' in options) {\n                this._setOption('disabled', options.disabled);\n            }\n\n            return this;\n        },\n\n        /**\n         * setDefaultsFromDataSet\n         */\n        _setDefaultsFromDataSet: function _setDefaultsFromDataSet() {\n            var box = this.element,\n                priceHolders = $('[data-price-type]', box),\n                prices = this.options.prices;\n\n            this.options.productId = box.data('productId');\n\n            if (_.isEmpty(prices)) {\n                priceHolders.each(function (index, element) {\n                    var type = $(element).data('priceType'),\n                        amount = parseFloat($(element).data('priceAmount'));\n\n                    if (type && !_.isNaN(amount)) {\n                        prices[type] = {\n                            amount: amount\n                        };\n                    }\n                });\n            }\n        },\n\n        /**\n         * setDefaultsFromPriceConfig\n         */\n        _setDefaultsFromPriceConfig: function _setDefaultsFromPriceConfig() {\n            var config = this.options.priceConfig;\n\n            if (config && config.prices) {\n                this.options.prices = config.prices;\n            }\n        },\n\n        /**\n         * Updates product final and base price according to tier prices\n         */\n        updateProductTierPrice: function updateProductTierPrice() {\n            var originalPrice,\n                prices = {'prices': {}};\n\n            if (this.options.prices.finalPrice) {\n                originalPrice = this.options.prices.finalPrice.amount;\n                prices.prices.finalPrice = {'amount': this.getPrice('price') - originalPrice};\n            }\n\n            if (this.options.prices.basePrice) {\n                originalPrice = this.options.prices.basePrice.amount;\n                prices.prices.basePrice = {'amount': this.getPrice('basePrice') - originalPrice};\n            }\n\n            this.updatePrice(prices);\n        },\n\n        /**\n         * Returns price.\n         *\n         * @param {String} priceKey\n         * @returns {Number}\n         */\n        getPrice: function (priceKey) {\n            var productQty = $(this.qtyInfo).val(),\n                result,\n                tierPriceItem,\n                i;\n\n            for (i = 0; i < this.options.priceConfig.tierPrices.length; i++) {\n                tierPriceItem = this.options.priceConfig.tierPrices[i];\n                if (productQty >= tierPriceItem.qty && tierPriceItem[priceKey]) {\n                    result = tierPriceItem[priceKey];\n                }\n            }\n\n            return result;\n        }\n    });\n\n    return $.mage.priceBox;\n});\n","Magento_Catalog/js/price-option-file.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.priceOptionFile', {\n        options: {\n            fileName: '',\n            fileNamed: '',\n            fieldNameAction: '',\n            changeFileSelector: '',\n            deleteFileSelector: ''\n        },\n\n        /**\n         * Creates instance of widget\n         * @private\n         */\n        _create: function () {\n            this.fileDeleteFlag = this.fileChangeFlag = false;\n            this.inputField = this.element.find('input[name=' + this.options.fileName + ']')[0];\n            this.inputFieldAction = this.element.find('input[name=' + this.options.fieldNameAction + ']')[0];\n            this.fileNameSpan = this.element.parent('dd').find('.' + this.options.fileNamed);\n\n            $(this.options.changeFileSelector).on('click', $.proxy(function () {\n                this._toggleFileChange();\n            }, this));\n            $(this.options.deleteFileSelector).on('click', $.proxy(function () {\n                this._toggleFileDelete();\n            }, this));\n        },\n\n        /**\n         * Toggles whether the current file is being changed or not. If the file is being deleted\n         * then the option to change the file is disabled.\n         * @private\n         */\n        _toggleFileChange: function () {\n            this.element.toggle();\n            this.fileChangeFlag = !this.fileChangeFlag;\n\n            if (!this.fileDeleteFlag) {\n                $(this.inputFieldAction).attr('value', this.fileChangeFlag ? 'save_new' : 'save_old');\n                this.inputField.disabled = !this.fileChangeFlag;\n            }\n        },\n\n        /**\n         * Toggles whether the file is to be deleted. When the file is being deleted, the name of\n         * the file is decorated with strike-through text and the option to change the file is\n         * disabled.\n         * @private\n         */\n        _toggleFileDelete: function () {\n            this.fileDeleteFlag = $(this.options.deleteFileSelector + ':checked').val();\n            $(this.inputFieldAction).attr('value',\n                this.fileDeleteFlag ? '' : this.fileChangeFlag ? 'save_new' : 'save_old');\n            this.inputField.disabled = this.fileDeleteFlag || !this.fileChangeFlag;\n            this.fileNameSpan.css('text-decoration', this.fileDeleteFlag ? 'line-through' : 'none');\n        }\n    });\n\n    return $.mage.priceOptionFile;\n});\n","Magento_Catalog/js/related-products.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget',\n    'mage/translate'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.relatedProducts', {\n        options: {\n            relatedCheckbox: '.related-checkbox', // Class name for a related product's input checkbox.\n            relatedProductsCheckFlag: false, // Related products checkboxes are initially unchecked.\n            relatedProductsField: '#related-products-field', // Hidden input field that stores related products.\n            selectAllMessage: $.mage.__('select all'),\n            unselectAllMessage: $.mage.__('unselect all'),\n            selectAllLink: '[data-role=\"select-all\"]',\n            elementsSelector: '.item.product'\n        },\n\n        /**\n         * Bind events to the appropriate handlers.\n         * @private\n         */\n        _create: function () {\n            $(this.options.selectAllLink, this.element).on('click', $.proxy(this._selectAllRelated, this));\n            $(this.options.relatedCheckbox, this.element).on('click', $.proxy(this._addRelatedToProduct, this));\n\n            if (this.element.data('shuffle')) {\n                this._shuffle(this.element.find(this.options.elementsSelector));\n            }\n            this._showRelatedProducts(\n                this.element.find(this.options.elementsSelector),\n                this.element.data('limit'),\n                this.element.data('shuffle-weighted')\n            );\n        },\n\n        /**\n         * This method either checks all checkboxes for a product's set of related products (select all)\n         * or unchecks them (unselect all).\n         * @private\n         * @param {jQuery.Event} e - Click event on either the \"select all\" link or the \"unselect all\" link.\n         * @return {Boolean} - Prevent default event action and event propagation.\n         */\n        _selectAllRelated: function (e) {\n            let isChecked = this.options.relatedProductsCheckFlag;\n\n            $(e.target).html(isChecked ? this.options.selectAllMessage : this.options.unselectAllMessage);\n            this.options.relatedProductsCheckFlag = !isChecked;\n\n            $(this.options.relatedCheckbox + ':visible').prop('checked', this.options.relatedProductsCheckFlag);\n            this._addRelatedToProduct();\n\n            return false;\n        },\n\n        /**\n         * This method iterates through each checkbox for all related products and collects only those products\n         * whose checkbox has been checked. The selected related products are stored in a hidden input field.\n         * @private\n         */\n        _addRelatedToProduct: function () {\n            $(this.options.relatedProductsField).val(\n                $(this.options.relatedCheckbox + ':checked').map(function () {\n                    return this.value;\n                }).get().join(',')\n            );\n        },\n\n        /* jscs:disable */\n        /* eslint-disable */\n        /**\n         * Show related products according to limit. Shuffle if needed.\n         * @param {*} elements\n         * @param {*} limit\n         * @param weightedRandom\n         * @private\n         */\n        _showRelatedProducts: function (elements, limit, weightedRandom) {\n            var index, weights = [], random = [], weight = 2, shown = 0, $element, currentGroup, prevGroup;\n\n            if (limit === 0) {\n                limit = elements.length;\n            }\n\n            if (weightedRandom && limit > 0 && limit < elements.length) {\n                for (index = 0; index < limit; index++) {\n                    $element = $(elements[index]);\n                    if ($element.data('shuffle-group') !== '') {\n                        break;\n                    }\n                    $element.show();\n                    shown++;\n                }\n                limit -= shown;\n                for (index = elements.length - 1; index >= 0; index--) {\n                    $element = $(elements[index]);\n                    currentGroup = $element.data('shuffle-group');\n                    if (currentGroup !== '') {\n                        weights.push([index, Math.log(weight)]);\n                        if (typeof prevGroup !== 'undefined' && prevGroup !== currentGroup) {\n                            weight += 2;\n                        }\n                        prevGroup = currentGroup;\n                    }\n                }\n\n                if (weights.length === 0) {\n                    return;\n                }\n\n                for (index = 0; index < weights.length; index++) {\n                    random.push([weights[index][0], Math.pow(Math.random(), 1 / weights[index][1])]);\n                }\n\n                random.sort(function(a, b) {\n                    a = a[1];\n                    b = b[1];\n                    return a < b ? 1 : (a > b ? -1 : 0);\n                });\n                index = 0;\n                while (limit) {\n                    $(elements[random[index][0]]).show();\n                    limit--;\n                    index++\n                }\n                return;\n            }\n\n            for (index = 0; index < limit; index++) {\n                $(elements[index]).show();\n            }\n        },\n\n        /* jscs:disable */\n        /* eslint-disable */\n        /**\n         * Shuffle an array\n         * @param {Array} elements\n         * @returns {*}\n         */\n        _shuffle: function shuffle(elements) {\n            var parent, child, lastSibling;\n            if (elements.length) {\n                parent = $(elements[0]).parent();\n            }\n            while (elements.length) {\n                child = elements.splice(Math.floor(Math.random() *  elements.length), 1)[0];\n                lastSibling = parent.find('[data-shuffle-group=\"' + $(child).data('shuffle-group') + '\"]').last();\n                lastSibling.after(child);\n            }\n        }\n\n        /* jscs:disable */\n        /* eslint:disable */\n    });\n\n    return $.mage.relatedProducts;\n});\n","Magento_Catalog/js/gallery.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.gallery', {\n        options: {\n            minWidth: 300, // Minimum width of the gallery image.\n            widthOffset: 90, // Offset added to the width of the gallery image.\n            heightOffset: 210, // Offset added to the height of the gallery image.\n            closeWindow: 'div.buttons-set a[role=\"close-window\"]' // Selector for closing the gallery popup window.\n        },\n\n        /**\n         * Bind click handler for closing the popup window and resize the popup based on the image size.\n         * @private\n         */\n        _create: function () {\n            $(this.options.closeWindow).on('click', function () {\n                window.close();\n            });\n            this._resizeWindow();\n        },\n\n        /**\n         * Resize the gallery image popup window based on the image's dimensions.\n         * @private\n         */\n        _resizeWindow: function () {\n            var img = this.element,\n                width = img.width() < this.options.minWidth ? this.options.minWidth : img.width();\n\n            window.resizeTo(width + this.options.widthOffset, img.height() + this.options.heightOffset);\n        }\n    });\n\n    return $.mage.gallery;\n});\n","Magento_Catalog/js/validate-product.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'mage/mage',\n    'Magento_Catalog/product/view/validation',\n    'catalogAddToCart'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.productValidate', {\n        options: {\n            bindSubmit: false,\n            radioCheckboxClosest: '.nested',\n            addToCartButtonSelector: '.action.tocart'\n        },\n\n        /**\n         * Uses Magento's validation widget for the form object.\n         * @private\n         */\n        _create: function () {\n            var bindSubmit = this.options.bindSubmit;\n\n            this.element.validation({\n                radioCheckboxClosest: this.options.radioCheckboxClosest,\n\n                /**\n                 * Uses catalogAddToCart widget as submit handler.\n                 * @param {Object} form\n                 * @returns {Boolean}\n                 */\n                submitHandler: function (form) {\n                    var jqForm = $(form).catalogAddToCart({\n                        bindSubmit: bindSubmit\n                    });\n\n                    jqForm.catalogAddToCart('submitForm', jqForm);\n\n                    return false;\n                }\n            });\n            $(this.options.addToCartButtonSelector).attr('disabled', false);\n        }\n    });\n\n    return $.mage.productValidate;\n});\n","Magento_Catalog/js/view/image.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'uiComponent'\n], function (Component) {\n    'use strict';\n\n    return Component.extend({\n        /** @inheritdoc */\n        initialize: function () {\n            this._super();\n\n            this.template = window.checkout.imageTemplate || this.template;\n        }\n    });\n});\n","Magento_Catalog/js/view/compare-products.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'uiComponent',\n    'Magento_Customer/js/customer-data',\n    'jquery',\n    'underscore',\n    'mage/mage',\n    'mage/decorate'\n], function (Component, customerData, $, _) {\n    'use strict';\n\n    var sidebarInitialized = false,\n        compareProductsReloaded = false;\n\n    /**\n     * Initialize sidebar\n     */\n    function initSidebar() {\n        if (sidebarInitialized) {\n            return;\n        }\n\n        sidebarInitialized = true;\n        $('[data-role=compare-products-sidebar]').decorate('list', true);\n    }\n\n    return Component.extend({\n        /** @inheritdoc */\n        initialize: function () {\n            this._super();\n            this.compareProducts = customerData.get('compare-products');\n            if (!compareProductsReloaded\n                && !_.isEmpty(this.compareProducts())\n                //Expired section names are reloaded on page load\n                && _.indexOf(customerData.getExpiredSectionNames(), 'compare-products') === -1\n                && window.checkout\n                && window.checkout.websiteId\n                && window.checkout.websiteId !== this.compareProducts().websiteId\n            ) {\n                //set count to 0 to prevent \"compared products\" blocks and count to show with wrong count and items\n                this.compareProducts().count = 0;\n                customerData.reload(['compare-products'], false);\n                compareProductsReloaded = true;\n            }\n            initSidebar();\n        }\n    });\n});\n","Magento_Catalog/js/product/learn-more.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'Magento_Ui/js/grid/columns/column',\n    'Magento_Catalog/js/product/list/column-status-validator'\n], function (Column, columnStatusValidator) {\n    'use strict';\n\n    return Column.extend({\n        /**\n         * Depends on this option, \"Learn More\" link can be shown or hide. Depends on  backend configuration\n         *\n         * @returns {Boolean}\n         */\n        isAllowed: function () {\n            return columnStatusValidator.isValid(this.source(), 'learn_more', 'show_attributes');\n        }\n    });\n});\n","Magento_Catalog/js/product/addtocompare-button.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'Magento_Ui/js/grid/columns/column',\n    'Magento_Catalog/js/product/uenc-processor',\n    'Magento_Catalog/js/product/list/column-status-validator'\n], function (Column, uencProcessor, columnStatusValidator) {\n    'use strict';\n\n    return Column.extend({\n        defaults: {\n            label: ''\n        },\n\n        /**\n         * Prepare Data-Post data that will be used in data-mage-init\n         *\n         * @param {Object} row\n         * @returns {Array}\n         */\n        getDataPost: function (row) {\n            return uencProcessor(row['add_to_compare_button'].url ||\n                    row['add_to_compare_button']['post_data']);\n        },\n\n        /**\n         * Depends on this option, \"Add to compare\" button can be shown or hide. Depends on  backend configuration\n         *\n         * @returns {Boolean}\n         */\n        isAllowed: function () {\n            return columnStatusValidator.isValid(this.source(), 'add_to_compare', 'show_buttons');\n        },\n\n        /**\n         * Get button label.\n         *\n         * @return {String}\n         */\n        getLabel: function () {\n            return this.label;\n        }\n    });\n});\n","Magento_Catalog/js/product/provider.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'underscore',\n    'jquery',\n    'mageUtils',\n    'uiElement',\n    'Magento_Catalog/js/product/storage/storage-service',\n    'Magento_Customer/js/customer-data',\n    'Magento_Catalog/js/product/view/product-ids-resolver'\n], function (_, $, utils, Element, storage, customerData, productResolver) {\n    'use strict';\n\n    return Element.extend({\n        defaults: {\n            identifiersConfig: {\n                namespace: ''\n            },\n            productStorageConfig: {\n                namespace: 'product_data_storage',\n                customerDataProvider: 'product_data_storage',\n                updateRequestConfig: {\n                    url: '',\n                    method: 'GET',\n                    dataType: 'json'\n                },\n                className: 'DataStorage'\n            },\n            ids: {},\n            listens: {\n                ids: 'idsHandler'\n            }\n        },\n\n        /**\n         * Initializes provider component.\n         *\n         * @returns {Provider} Chainable.\n         */\n        initialize: function () {\n            this._super()\n                .initIdsStorage();\n\n            return this;\n        },\n\n        /**\n         * Calls 'initObservable' of parent\n         *\n         * @returns {Object} Chainable.\n         */\n        initObservable: function () {\n            this._super();\n            this.observe('ids');\n\n            return this;\n        },\n\n        /**\n         * Initializes ids storage.\n         *\n         * @returns {Provider} Chainable.\n         */\n        initIdsStorage: function () {\n            storage.onStorageInit(this.identifiersConfig.namespace, this.idsStorageHandler.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Initializes ids storage handler.\n         *\n         * @param {Object} idsStorage\n         */\n        idsStorageHandler: function (idsStorage) {\n            this.idsStorage = idsStorage;\n            this.productStorage = storage.createStorage(this.productStorageConfig);\n            this.productStorage.data.subscribe(this.dataCollectionHandler.bind(this));\n\n            if (~~this.idsStorage.allowToSendRequest) {\n                customerData.reload([idsStorage.namespace]).done(this._resolveDataByIds.bind(this));\n            } else {\n                this._resolveDataByIds();\n            }\n        },\n\n        /**\n         * Callback, which load by ids from ids-storage product data\n         *\n         * @private\n         */\n        _resolveDataByIds: function () {\n            if (!window.checkout || !window.checkout.baseUrl) {\n                // We need data that the minicart provdes to determine storeId/websiteId\n                return;\n            }\n\n            // Filter initial ids to remove \"out of scope\" and \"outdated\" data\n            this.ids(\n                this.filterIds(this.ids())\n            );\n            this.initIdsListener();\n            this.idsMerger(\n                this.idsStorage.get(),\n                this.prepareDataFromCustomerData(customerData.get(this.identifiersConfig.namespace)())\n            );\n        },\n\n        /**\n         * Init ids storage listener.\n         */\n        initIdsListener: function () {\n            customerData.get(this.identifiersConfig.namespace).subscribe(function (data) {\n                this.idsMerger(this.prepareDataFromCustomerData(data));\n            }.bind(this));\n            this.idsStorage.data.subscribe(this.idsMerger.bind(this));\n        },\n\n        /**\n         * Prepare data from customerData.\n         *\n         * @param {Object} data\n         *\n         * @returns {Object}\n         */\n        prepareDataFromCustomerData: function (data) {\n            data = data.items ? data.items : data;\n\n            return data;\n        },\n\n        /**\n         * Filter ids by their lifetime in order to show only hot ids :)\n         *\n         * @param {Object} ids\n         * @returns {Array}\n         */\n        filterIds: function (ids) {\n            var _ids = {},\n                currentTime = new Date().getTime() / 1000,\n                currentProductIds = productResolver($('#product_addtocart_form')),\n                productCurrentScope = this.data.productCurrentScope,\n                scopeId = productCurrentScope === 'store' ? window.checkout.storeId :\n                productCurrentScope === 'group' ? window.checkout.storeGroupId :\n                    window.checkout.websiteId;\n\n            _.each(ids, function (id, key) {\n                if (\n                    currentTime - ids[key]['added_at'] < ~~this.idsStorage.lifetime &&\n                    !_.contains(currentProductIds, ids[key]['product_id']) &&\n                    (!id.hasOwnProperty('scope_id') || ids[key]['scope_id'] === scopeId)\n                ) {\n                    _ids[id['product_id']] = id;\n\n                }\n            }, this);\n\n            return _ids;\n        },\n\n        /**\n         * Merges id from storage and customer data\n         *\n         * @param {Object} data\n         * @param {Object} optionalData\n         */\n        idsMerger: function (data, optionalData) {\n            if (data && optionalData) {\n                data = _.extend(data, optionalData);\n            }\n\n            if (!_.isEmpty(data)) {\n                this.ids(\n                    this.filterIds(_.extend(utils.copy(this.ids()), data))\n                );\n            }\n        },\n\n        /**\n         * Ids update handler\n         *\n         * @param {Object} data\n         */\n        idsHandler: function (data) {\n            this.productStorage.setIds(this.data.currency, this.data.store, data);\n        },\n\n        /**\n         * Process data\n         *\n         * @param {Object} data\n         */\n        processData: function (data) {\n            var curData = utils.copy(this.data),\n                ids = this.ids();\n\n            delete data['data_id'];\n            data = _.values(data);\n\n            _.each(data, function (record, index) {\n                record._rowIndex = index;\n                record['added_at'] = ids[record.id]['added_at'];\n            }, this);\n\n            curData.items = data;\n            this.set('data', curData);\n        },\n\n        /**\n         * Product storage data handler\n         *\n         * @param {Object} data\n         */\n        dataCollectionHandler: function (data) {\n            data = this.filterData(data);\n            this.processData(data);\n        },\n\n        /**\n         * Filters data from product storage by ids\n         *\n         * @param {Object} data\n         *\n         * @returns {Object}\n         */\n        filterData: function (data) {\n            var result = {},\n                i = 0,\n                ids = _.keys(this.ids()),\n                length = ids.length;\n\n            for (i; i < length; i++) {\n                if (ids[i] && data[ids[i]]) {\n                    result[ids[i]] = data[ids[i]];\n                }\n            }\n\n            return result;\n        }\n    });\n});\n","Magento_Catalog/js/product/addtocart-button.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'Magento_Ui/js/grid/columns/column',\n    'Magento_Catalog/js/product/uenc-processor',\n    'Magento_Catalog/js/product/list/column-status-validator'\n], function (Element, uencProcessor, columnStatusValidator) {\n    'use strict';\n\n    return Element.extend({\n        defaults: {\n            label: ''\n        },\n\n        /**\n         * Prepare data, that will be inserted as data-mage-init attribute into button. With help of this attribute\n         * Add To * buttons can understand post data and urls\n         *\n         * @param {Object} row\n         * @returns {String}\n         */\n        getDataMageInit: function (row) {\n            return '{\"redirectUrl\": { \"url\" : \"'  + uencProcessor(row['add_to_cart_button'].url) + '\"}}';\n        },\n\n        /**\n         * Prepare Data-Post data that will be used in data-mage-init\n         *\n         * @param {Object} row\n         * @return {String}\n         */\n        getDataPost: function (row) {\n            return uencProcessor(row['add_to_cart_button']['post_data']);\n        },\n\n        /**\n         * Check if product has required options.\n         *\n         * @param {Object} row\n         * @return {Boolean}\n         */\n        hasRequiredOptions: function (row) {\n            return row['add_to_cart_button']['required_options'];\n        },\n\n        /**\n         * Depends on this option, \"Add to cart\" button can be shown or hide\n         *\n         * @param {Object} row\n         * @returns {Boolean}\n         */\n        isSalable: function (row) {\n            return row['is_salable'];\n        },\n\n        /**\n         * Depends on this option, stock status text can be \"In stock\" or \"Out Of Stock\"\n         *\n         * @param {Object} row\n         * @returns {Boolean}\n         */\n        isAvailable: function (row) {\n            return row['is_available'];\n        },\n\n        /**\n         * Depends on this option, \"Add to cart\" button can be shown or hide. Depends on  backend configuration\n         *\n         * @returns {Boolean}\n         */\n        isAllowed: function () {\n            return columnStatusValidator.isValid(this.source(), 'add_to_cart', 'show_buttons');\n        },\n\n        /**\n         * Get button label.\n         *\n         * @return {String}\n         */\n        getLabel: function () {\n            return this.label;\n        }\n    });\n});\n","Magento_Catalog/js/product/name.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'Magento_Ui/js/grid/columns/column',\n    'Magento_Catalog/js/product/list/column-status-validator',\n    'escaper'\n], function (Column, columnStatusValidator, escaper) {\n    'use strict';\n\n    return Column.extend({\n        defaults: {\n            allowedTags: ['div', 'span', 'b', 'strong', 'i', 'em', 'u', 'a']\n        },\n\n        /**\n         * Depends on this option, product name can be shown or hide. Depends on  backend configuration\n         *\n         * @returns {Boolean}\n         */\n        isAllowed: function () {\n            return columnStatusValidator.isValid(this.source(), 'name', 'show_attributes');\n        },\n\n        /**\n         * Name column.\n         *\n         * @param {String} label\n         * @returns {String}\n         */\n        getNameUnsanitizedHtml: function (label) {\n            return escaper.escapeHtml(label, this.allowedTags);\n        }\n    });\n});\n","Magento_Catalog/js/product/remaining-characters.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'mage/translate',\n    'jquery-ui-modules/widget'\n], function ($, $t) {\n    'use strict';\n\n    $.widget('mage.remainingCharacters', {\n        options: {\n            remainingText: $t('remaining'),\n            tooManyText: $t('too many'),\n            errorClass: 'mage-error',\n            noDisplayClass: 'no-display'\n        },\n\n        /**\n         * Initializes custom option component\n         *\n         * @private\n         */\n        _create: function () {\n            this.note = $(this.options.noteSelector);\n            this.counter = $(this.options.counterSelector);\n\n            this.updateCharacterCount();\n            this.element.on('change keyup paste', this.updateCharacterCount.bind(this));\n        },\n\n        /**\n         * Updates counter message\n         */\n        updateCharacterCount: function () {\n            var length = this.element.val().length,\n                diff = this.options.maxLength - length;\n\n            this.counter.text(this._formatMessage(diff));\n            this.counter.toggleClass(this.options.noDisplayClass, length === 0);\n            this.note.toggleClass(this.options.errorClass, diff < 0);\n        },\n\n        /**\n         * Format remaining characters message\n         *\n         * @param {int} diff\n         * @returns {String}\n         * @private\n         */\n        _formatMessage: function (diff) {\n            var count = Math.abs(diff),\n                qualifier = diff < 0 ? this.options.tooManyText : this.options.remainingText;\n\n            return '(' + count + ' ' + qualifier + ')';\n        }\n    });\n\n    return $.mage.remainingCharacters;\n});\n","Magento_Catalog/js/product/provider-compared.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'underscore',\n    './provider',\n    'Magento_Catalog/js/product/storage/storage-service',\n    'Magento_Customer/js/customer-data'\n], function (_, Provider, storage, customerData) {\n    'use strict';\n\n    return Provider.extend({\n\n        /**\n         * Ids update handler\n         *\n         * @param {Object} data\n         */\n        idsHandler: function (data) {\n            this.productStorage.setIds(this.data.currency, this.data.store, this.dataFilter(data));\n        },\n\n        /**\n         * Filters data by provider\n         *\n         * @param {Object} data\n         *\n         * @returns {Object}\n         */\n        dataFilter: function (data) {\n            var providerData = this.idsStorage.prepareData(customerData.get(this.identifiersConfig.provider)().items),\n                result = {},\n                productCurrentScope,\n                scopeId;\n\n            if (typeof this.data.productCurrentScope !== 'undefined' && window.checkout && window.checkout.baseUrl) {\n                productCurrentScope = this.data.productCurrentScope;\n                scopeId = productCurrentScope === 'store' ? window.checkout.storeId :\n                    productCurrentScope === 'group' ? window.checkout.storeGroupId :\n                        window.checkout.websiteId;\n                _.each(data, function (value, key) {\n                    if (!providerData[productCurrentScope + '-' + scopeId + '-' + key]) {\n                        result[key] = value;\n                    }\n                });\n            } else {\n                _.each(data, function (value, key) {\n                    if (!providerData[key]) {\n                        result[key] = value;\n                    }\n                });\n            }\n\n            return result;\n        },\n\n        /**\n         * Filters data from product storage by ids\n         *\n         * @param {Object} data\n         *\n         * @returns {Object}\n         */\n        filterData: function (data) {\n            var result = {},\n                i = 0,\n                ids = _.keys(this.dataFilter(this.ids())),\n                length = ids.length;\n\n            for (i; i < length; i++) {\n                if (ids[i] && data[ids[i]]) {\n                    result[ids[i]] = data[ids[i]];\n                }\n            }\n\n            return result;\n        }\n    });\n});\n","Magento_Catalog/js/product/query-builder.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n        'underscore'\n    ], function (_) {\n        'use strict';\n\n        return {\n\n            /**\n             * Build query to get id\n             *\n             * @param {Object} data\n             */\n            buildQuery: function (data) {\n                var filters = [];\n\n                _.each(data, function (value, key) {\n                    filters.push({\n                        field: key,\n                        value: value,\n                        'condition_type': 'in'\n                    });\n                });\n\n                return {\n                    searchCriteria: {\n                        filterGroups: [\n                            {\n                                filters: filters\n                            }\n                        ]\n                    }\n                };\n            }\n        };\n    }\n);\n","Magento_Catalog/js/product/uenc-processor.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([], function () {\n        'use strict';\n\n        /**\n         * Check data to JSON.\n         *\n         * @returns {Boolean}\n         */\n        function _isJSON(data) {\n            try {\n                JSON.parse(data);\n            } catch (e) {\n                return false;\n            }\n\n            return true;\n        }\n\n        /**\n         * Processes data.\n         *\n         * @param {Object} data\n         * @param {String} placeholder\n         * @param {String} uenc\n         *\n         * @returns {String}\n         */\n        function _stringProcessor(data, placeholder, uenc) {\n            if (data && ~data.indexOf(placeholder)) {\n                return data.replace(placeholder, uenc);\n            }\n\n            return data;\n        }\n\n        /**\n         * Processes data.\n         *\n         * @param {Object} data\n         * @param {String} placeholder\n         * @param {String} uenc\n         *\n         * @returns {String}\n         */\n        function _objectProcessor(data, placeholder, uenc) {\n            data = JSON.parse(data);\n\n            if (data.hasOwnProperty('action')) {\n                data.action = _stringProcessor(data.action, placeholder, uenc);\n            }\n\n            if (data.hasOwnProperty('data') && data.data.hasOwnProperty('uenc')) {\n                data.data.uenc = uenc;\n            }\n\n            return JSON.stringify(data);\n        }\n\n        /**\n         * Processes data.\n         *\n         * @param {Object} data\n         * @param {String} placeholder\n         *\n         * @returns {String}\n         */\n        return function (data, placeholder) {\n            var uenc = btoa(window.location.href).replace('+/=', '-_,');\n\n            placeholder = placeholder || encodeURI('%uenc%');\n\n            return _isJSON(data) ?\n                _objectProcessor(data, placeholder, uenc) :\n                _stringProcessor(data, placeholder, uenc);\n\n        };\n    }\n);\n","Magento_Catalog/js/product/breadcrumbs.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'Magento_Theme/js/model/breadcrumb-list'\n], function ($, breadcrumbList) {\n    'use strict';\n\n    return function (widget) {\n\n        $.widget('mage.breadcrumbs', widget, {\n            options: {\n                categoryUrlSuffix: '',\n                useCategoryPathInUrl: false,\n                product: '',\n                categoryItemSelector: '.category-item',\n                menuContainer: '[data-action=\"navigation\"] > ul'\n            },\n\n            /** @inheritdoc */\n            _render: function () {\n                this._appendCatalogCrumbs();\n                this._super();\n            },\n\n            /**\n             * Append category and product crumbs.\n             *\n             * @private\n             */\n            _appendCatalogCrumbs: function () {\n                var categoryCrumbs = this._resolveCategoryCrumbs();\n\n                categoryCrumbs.forEach(function (crumbInfo) {\n                    breadcrumbList.push(crumbInfo);\n                });\n\n                if (this.options.product) {\n                    breadcrumbList.push(this._getProductCrumb());\n                }\n            },\n\n            /**\n             * Resolve categories crumbs.\n             *\n             * @return Array\n             * @private\n             */\n            _resolveCategoryCrumbs: function () {\n                var menuItem = this._resolveCategoryMenuItem(),\n                    categoryCrumbs = [];\n\n                if (menuItem !== null && menuItem.length) {\n                    categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));\n\n                    while ((menuItem = this._getParentMenuItem(menuItem)) !== null) {\n                        categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));\n                    }\n                }\n\n                return categoryCrumbs;\n            },\n\n            /**\n             * Returns crumb data.\n             *\n             * @param {Object} menuItem\n             * @return {Object}\n             * @private\n             */\n            _getCategoryCrumb: function (menuItem) {\n                return {\n                    'name': 'category',\n                    'label': menuItem.text(),\n                    'link': menuItem.attr('href'),\n                    'title': ''\n                };\n            },\n\n            /**\n             * Returns product crumb.\n             *\n             * @return {Object}\n             * @private\n             */\n            _getProductCrumb: function () {\n                return {\n                    'name': 'product',\n                    'label': this.options.product,\n                    'link': '',\n                    'title': ''\n                };\n            },\n\n            /**\n             * Find parent menu item for current.\n             *\n             * @param {Object} menuItem\n             * @return {Object|null}\n             * @private\n             */\n            _getParentMenuItem: function (menuItem) {\n                var classes,\n                    classNav,\n                    parentClass,\n                    parentMenuItem = null;\n\n                if (!menuItem) {\n                    return null;\n                }\n\n                classes = menuItem.parent().attr('class');\n                classNav = classes.match(/(nav\\-)[0-9]+(\\-[0-9]+)+/gi);\n\n                if (classNav) {\n                    classNav = classNav[0];\n                    parentClass = classNav.substr(0, classNav.lastIndexOf('-'));\n\n                    if (parentClass.lastIndexOf('-') !== -1) {\n                        parentMenuItem = $(this.options.menuContainer).find('.' + parentClass + ' > a');\n                        parentMenuItem = parentMenuItem.length ? parentMenuItem : null;\n                    }\n                }\n\n                return parentMenuItem;\n            },\n\n            /**\n             * Returns category menu item.\n             *\n             * Tries to resolve category from url or from referrer as fallback and\n             * find menu item from navigation menu by category url.\n             *\n             * @return {Object|null}\n             * @private\n             */\n            _resolveCategoryMenuItem: function () {\n                var categoryUrl = this._resolveCategoryUrl(),\n                    menu = $(this.options.menuContainer),\n                    categoryMenuItem = null;\n\n                if (categoryUrl && menu.length) {\n                    categoryMenuItem = menu.find(\n                        this.options.categoryItemSelector +\n                        ' > a[href=\"' + categoryUrl + '\"]'\n                    );\n                }\n\n                return categoryMenuItem;\n            },\n\n            /**\n             * Returns category url.\n             *\n             * @return {String}\n             * @private\n             */\n            _resolveCategoryUrl: function () {\n                var categoryUrl;\n\n                if (this.options.useCategoryPathInUrl) {\n                    // In case category path is used in product url - resolve category url from current url.\n                    categoryUrl = window.location.href.split('?')[0];\n                    categoryUrl = categoryUrl.substring(0, categoryUrl.lastIndexOf('/')) +\n                        this.options.categoryUrlSuffix;\n                } else {\n                    // In other case - try to resolve it from referrer (without parameters).\n                    categoryUrl = document.referrer;\n\n                    if (categoryUrl.indexOf('?') > 0) {\n                        categoryUrl = categoryUrl.substr(0, categoryUrl.indexOf('?'));\n                    }\n                }\n\n                return categoryUrl;\n            }\n        });\n\n        return $.mage.breadcrumbs;\n    };\n});\n","Magento_Catalog/js/product/list/listing.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'ko',\n    'underscore',\n    'Magento_Ui/js/grid/listing'\n], function (ko, _, Listing) {\n    'use strict';\n\n    return Listing.extend({\n        defaults: {\n            additionalClasses: '',\n            filteredRows: {},\n            limit: 5,\n            listens: {\n                elems: 'filterRowsFromCache',\n                '${ $.provider }:data.items': 'filterRowsFromServer'\n            }\n        },\n\n        /** @inheritdoc */\n        initialize: function () {\n            this._super();\n            this.filteredRows = ko.observable();\n            this.initProductsLimit();\n            this.hideLoader();\n        },\n\n        /**\n         * Initialize product limit\n         * Product limit can be configured through Ui component.\n         * Product limit are present in widget form\n         *\n         * @returns {exports}\n         */\n        initProductsLimit: function () {\n            if (this.source['page_size']) {\n                this.limit = this.source['page_size'];\n            }\n\n            return this;\n        },\n\n        /**\n         * Initializes observable properties.\n         *\n         * @returns {Listing} Chainable.\n         */\n        initObservable: function () {\n            this._super()\n                .track({\n                    rows: []\n                });\n\n            return this;\n        },\n\n        /**\n         * Sort and filter rows, that are already in magento storage cache\n         *\n         * @return void\n         */\n        filterRowsFromCache: function () {\n            this._filterRows(this.rows);\n        },\n\n        /**\n         * Sort and filter rows, that are come from backend\n         *\n         * @param {Object} rows\n         */\n        filterRowsFromServer: function (rows) {\n            this._filterRows(rows);\n        },\n\n        /**\n         * Filter rows by limit and sort them\n         *\n         * @param {Array} rows\n         * @private\n         */\n        _filterRows: function (rows) {\n            this.filteredRows(_.sortBy(rows, 'added_at').reverse().slice(0, this.limit));\n        },\n\n        /**\n         * Can retrieve product url\n         *\n         * @param {Object} row\n         * @returns {String}\n         */\n        getUrl: function (row) {\n            return row.url;\n        },\n\n        /**\n         * Get product attribute by code.\n         *\n         * @param {String} code\n         * @return {Object}\n         */\n        getComponentByCode: function (code) {\n            var elems = this.elems() ? this.elems() : ko.getObservable(this, 'elems'),\n                component;\n\n            component = _.filter(elems, function (elem) {\n                return elem.index === code;\n            }, this).pop();\n\n            return component;\n        }\n    });\n});\n","Magento_Catalog/js/product/list/toolbar.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget'\n], function ($) {\n    'use strict';\n\n    /**\n     * ProductListToolbarForm Widget - this widget is setting cookie and submitting form according to toolbar controls\n     */\n    $.widget('mage.productListToolbarForm', {\n\n        options: {\n            modeControl: '[data-role=\"mode-switcher\"]',\n            directionControl: '[data-role=\"direction-switcher\"]',\n            orderControl: '[data-role=\"sorter\"]',\n            limitControl: '[data-role=\"limiter\"]',\n            mode: 'product_list_mode',\n            direction: 'product_list_dir',\n            order: 'product_list_order',\n            limit: 'product_list_limit',\n            page: 'p',\n            modeDefault: 'grid',\n            directionDefault: 'asc',\n            orderDefault: 'position',\n            limitDefault: '9',\n            url: '',\n            formKey: '',\n            post: false\n        },\n\n        /** @inheritdoc */\n        _create: function () {\n            this._bind(\n                $(this.options.modeControl, this.element),\n                this.options.mode,\n                this.options.modeDefault\n            );\n            this._bind(\n                $(this.options.directionControl, this.element),\n                this.options.direction,\n                this.options.directionDefault\n            );\n            this._bind(\n                $(this.options.orderControl, this.element),\n                this.options.order,\n                this.options.orderDefault\n            );\n            this._bind(\n                $(this.options.limitControl, this.element),\n                this.options.limit,\n                this.options.limitDefault\n            );\n        },\n\n        /** @inheritdoc */\n        _bind: function (element, paramName, defaultValue) {\n            if (element.is('select')) {\n                element.on('change', {\n                    paramName: paramName,\n                    'default': defaultValue\n                }, $.proxy(this._processSelect, this));\n            } else {\n                element.on('click', {\n                    paramName: paramName,\n                    'default': defaultValue\n                }, $.proxy(this._processLink, this));\n            }\n        },\n\n        /**\n         * @param {jQuery.Event} event\n         * @private\n         */\n        _processLink: function (event) {\n            event.preventDefault();\n            this.changeUrl(\n                event.data.paramName,\n                $(event.currentTarget).data('value'),\n                event.data.default\n            );\n        },\n\n        /**\n         * @param {jQuery.Event} event\n         * @private\n         */\n        _processSelect: function (event) {\n            this.changeUrl(\n                event.data.paramName,\n                event.currentTarget.options[event.currentTarget.selectedIndex].value,\n                event.data.default\n            );\n        },\n\n        /**\n         * @private\n         */\n        getUrlParams: function () {\n            var decode = window.decodeURIComponent,\n                urlPaths = this.options.url.split('?'),\n                urlParams = urlPaths[1] ? urlPaths[1].split('&') : [],\n                params = {},\n                parameters, i;\n\n            for (i = 0; i < urlParams.length; i++) {\n                parameters = urlParams[i].split('=');\n                params[decode(parameters[0])] = parameters[1] !== undefined ?\n                    decode(parameters[1].replace(/\\+/g, '%20')) :\n                    '';\n            }\n\n            return params;\n        },\n\n        /**\n         * @returns {String}\n         * @private\n         */\n        getCurrentLimit: function () {\n            return this.getUrlParams()[this.options.limit] || this.options.limitDefault;\n        },\n\n        /**\n         * @returns {String}\n         * @private\n         */\n        getCurrentPage: function () {\n            return this.getUrlParams()[this.options.page] || 1;\n        },\n\n        /**\n         * @param {String} paramName\n         * @param {*} paramValue\n         * @param {*} defaultValue\n         */\n        changeUrl: function (paramName, paramValue, defaultValue) {\n            var urlPaths = this.options.url.split('?'),\n                baseUrl = urlPaths[0],\n                paramData = this.getUrlParams(),\n                currentPage = this.getCurrentPage(),\n                form, params, key, input, formKey, newPage;\n\n            if (currentPage > 1 && paramName === this.options.mode) {\n                delete paramData[this.options.page];\n            }\n\n            if (currentPage > 1 && paramName === this.options.limit) {\n                newPage = Math.floor(this.getCurrentLimit() * (currentPage - 1) / paramValue) + 1;\n\n                if (newPage > 1) {\n                    paramData[this.options.page] = newPage;\n                } else {\n                    delete paramData[this.options.page];\n                }\n            }\n\n            paramData[paramName] = paramValue;\n\n            if (this.options.post) {\n                form = document.createElement('form');\n                params = [this.options.mode, this.options.direction, this.options.order, this.options.limit];\n\n                for (key in paramData) {\n                    if (params.indexOf(key) !== -1) { //eslint-disable-line max-depth\n                        input = document.createElement('input');\n                        input.name = key;\n                        input.value = paramData[key];\n                        form.appendChild(input);\n                        delete paramData[key];\n                    }\n                }\n                formKey = document.createElement('input');\n                formKey.name = 'form_key';\n                formKey.value = this.options.formKey;\n                form.appendChild(formKey);\n\n                paramData = $.param(paramData);\n                baseUrl += paramData.length ? '?' + paramData : '';\n\n                form.action = baseUrl;\n                form.method = 'POST';\n                document.body.appendChild(form);\n                form.submit();\n            } else {\n                if (paramValue == defaultValue) { //eslint-disable-line eqeqeq\n                    delete paramData[paramName];\n                }\n\n                paramData = $.param(paramData);\n                location.href = baseUrl + (paramData.length ? '?' + paramData : '');\n            }\n        }\n    });\n\n    return $.mage.productListToolbarForm;\n});\n","Magento_Catalog/js/product/list/column-status-validator.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore'\n], function (_) {\n    'use strict';\n\n    return _.extend({\n        /**\n         * Check whether we can show column depends on server settings or not\n         *\n         * @param {Object} source\n         * @param {String} attributeCode\n         * @param {String} type\n         * @returns {Boolean}\n         */\n        isValid: function (source, attributeCode, type) {\n            var attributes;\n\n            if (!source[type]) {\n                return false;\n            }\n\n            attributes = source[type].split(',');\n\n            return _.contains(attributes, attributeCode);\n        }\n    });\n});\n","Magento_Catalog/js/product/list/columns/pricetype-box.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'ko',\n    'underscore',\n    'uiCollection'\n], function (ko, _, Collection) {\n    'use strict';\n\n    return Collection.extend({\n        /**\n         * Find from all price ui components, price with specific code, init source on it and set priceType\n         *\n         * @param {String} code\n         * @returns {*|T}\n         */\n        getPriceByCode: function (code) {\n            var elems = this.elems() ? this.elems() : ko.getObservable(this, 'elems'),\n                price;\n\n            price = _.filter(elems, function (elem) {\n                return elem.index.split('.').shift() === code;\n            }, this).pop();\n\n            price.source = this.source();\n            price.priceType = code;\n\n            return price;\n        },\n\n        /**\n         * Retrieve body template\n         *\n         * @returns {String}\n         */\n        getBody: function () {\n            return this.bodyTmpl;\n        },\n\n        /**\n         * Check whether price has price range, depends on different options, that can be choose\n         *\n         * @param {Object} row\n         * @returns {Boolean}\n         */\n        hasPriceRange: function (row) {\n            return row['price_info']['max_regular_price'] !== row['price_info']['min_regular_price'];\n        }\n    });\n});\n","Magento_Catalog/js/product/list/columns/final-price.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore',\n    'uiRegistry',\n    'mageUtils',\n    'uiCollection'\n], function (_, registry, utils, Collection) {\n    'use strict';\n\n    return Collection.extend({\n        defaults: {\n            label: false,\n            headerTmpl: 'ui/grid/columns/text',\n            showMinimalPrice: false,\n            showMaximumPrice: false,\n            useLinkForAsLowAs: false,\n            bodyTmpl: 'Magento_Catalog/product/final_price',\n            priceWrapperCssClasses: '',\n            priceWrapperAttr: {}\n        },\n\n        /**\n         * Get product final price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} final price html\n         */\n        getPrice: function (row) {\n            return row['price_info']['formatted_prices']['final_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getPrice.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} final price html\n         */\n        getPriceUnsanitizedHtml: function (row) {\n            return this.getPrice(row);\n        },\n\n        /**\n         * Get product regular price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} regular price html\n         */\n        getRegularPrice: function (row) {\n            return row['price_info']['formatted_prices']['regular_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getRegularPrice.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} regular price html\n         */\n        getRegularPriceUnsanitizedHtml: function (row) {\n            return this.getRegularPrice(row);\n        },\n\n        /**\n         * Check if product has a price range.\n         *\n         * @param {Object} row\n         * @return {Boolean}\n         */\n        hasPriceRange: function (row) {\n            return row['price_info']['max_regular_price'] !== row['price_info']['min_regular_price'];\n        },\n\n        /**\n         * Check if product has special price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} special price html\n         */\n        hasSpecialPrice: function (row) {\n            return row['price_info']['regular_price'] > row['price_info']['final_price'];\n        },\n\n        /**\n         * Check if product has minimal price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} minimal price html\n         */\n        isMinimalPrice: function (row) {\n            return row['price_info']['minimal_price'] < row['price_info']['final_price'];\n        },\n\n        /**\n         * Get product minimal price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} minimal price html\n         */\n        getMinimalPrice: function (row) {\n            return row['price_info']['formatted_prices']['minimal_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getMinimalPrice.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} minimal price html\n         */\n        getMinimalPriceUnsanitizedHtml: function (row) {\n            return this.getMinimalPrice(row);\n        },\n\n        /**\n         * Check if product is salable.\n         *\n         * @param {Object} row\n         * @return {Boolean}\n         */\n        isSalable: function (row) {\n            return row['is_salable'];\n        },\n\n        /**\n         * Get product maximum price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} maximum price html\n         */\n        getMaxPrice: function (row) {\n            return row['price_info']['formatted_prices']['max_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getMaxPrice.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} maximum price html\n         */\n        getMaxPriceUnsanitizedHtml: function (row) {\n            return this.getMaxPrice(row);\n        },\n\n        /**\n         * Get product maximum regular price in case of price range and special price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} maximum regular price html\n         */\n        getMaxRegularPrice: function (row) {\n            return row['price_info']['formatted_prices']['max_regular_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getMaxRegularPrice.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} maximum regular price html\n         */\n        getMaxRegularPriceUnsanitizedHtml: function (row) {\n            return this.getMaxRegularPrice(row);\n        },\n\n        /**\n         * Get product minimal regular price in case of price range and special price.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} minimal regular price html\n         */\n        getMinRegularPrice: function (row) {\n            return row['price_info']['formatted_prices']['min_regular_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getMinRegularPrice.\n         *\n         * @param {Object} row\n         * @return {HTMLElement} minimal regular price html\n         */\n        getMinRegularPriceUnsanitizedHtml: function (row) {\n            return this.getMinRegularPrice(row);\n        },\n\n        /**\n         * Get adjustments names and return as string.\n         *\n         * @return {String} adjustments classes\n         */\n        getAdjustmentCssClasses: function () {\n            return _.pluck(this.getAdjustments(), 'index').join(' ');\n        },\n\n        /**\n         * Get product minimal price as number.\n         *\n         * @param {Object} row\n         * @return {Number} minimal price amount\n         */\n        getMinimalPriceAmount: function (row) {\n            return row['price_info']['minimal_price'];\n        },\n\n        /**\n         * UnsanitizedHtml version of getMinimalPriceAmount\n         *\n         * @param {Object} row\n         * @return {Number} minimal price amount\n         */\n        getMinimalPriceAmountUnsanitizedHtml: function (row) {\n            return this.getMinimalPriceAmount(row);\n        },\n\n        /**\n         * Get product minimal regular price as number in case of special price.\n         *\n         * @param {Object} row\n         * @return {Number} minimal regular price amount\n         */\n        getMinimalRegularPriceAmount: function (row) {\n            return row['price_info']['min_regular_price'];\n        },\n\n        /**\n         * Get product maximum price as number.\n         *\n         * @param {Object} row\n         * @return {Number} maximum price amount\n         */\n        getMaximumPriceAmount: function (row) {\n            return row['price_info']['max_price'];\n        },\n\n        /**\n         * Get product maximum regular price as number in case of special price.\n         *\n         * @param {Object} row\n         * @return {Number} maximum regular price amount\n         */\n        getMaximumRegularPriceAmount: function (row) {\n            return row['price_info']['max_regular_price'];\n        },\n\n        /**\n         * Check if minimal regular price exist for product.\n         *\n         * @param {Object} row\n         * @return {Boolean}\n         */\n        showMinRegularPrice: function (row) {\n            return this.getMinimalPriceAmount(row) < this.getMinimalRegularPriceAmount(row);\n        },\n\n        /**\n         * Check if maximum regular price exist for product.\n         *\n         * @param {Object} row\n         * @return {Boolean}\n         */\n        showMaxRegularPrice: function (row) {\n            return this.getMaximumPriceAmount(row) < this.getMaximumRegularPriceAmount(row);\n        },\n\n        /**\n         * Get path to the columns' body template.\n         *\n         * @returns {String}\n         */\n        getBody: function () {\n            return this.bodyTmpl;\n        },\n\n        /**\n         * Get all price adjustments.\n         *\n         * @returns {Object}\n         */\n        getAdjustments: function () {\n            var adjustments = this.elems();\n\n            _.each(adjustments, function (adjustment) {\n                adjustment.setPriceType(this.priceType);\n                adjustment.source = this.source;\n            }, this);\n\n            return adjustments;\n        }\n    });\n});\n","Magento_Catalog/js/product/list/columns/price-box.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'ko',\n    'underscore',\n    'uiRegistry',\n    'mageUtils',\n    'uiCollection',\n    'Magento_Catalog/js/product/list/column-status-validator',\n    'uiLayout'\n], function (ko, _, registry, utils, Collection, columnStatusValidator, layout) {\n    'use strict';\n\n    return Collection.extend({\n        defaults: {\n            label: '',\n            hasSpecialPrice: false,\n            showMinimalPrice: false,\n            useLinkForAsLowAs: false,\n            visible: true,\n            headerTmpl: 'ui/grid/columns/text',\n            bodyTmpl: 'Magento_Catalog/product/price/price_box',\n            disableAction: false,\n            controlVisibility: true,\n            sortable: false,\n            sorting: false,\n            draggable: true,\n            fieldClass: {},\n            renders: {\n                default: {}\n            },\n            ignoreTmpls: {\n                fieldAction: true\n            },\n            statefull: {\n                visible: true,\n                sorting: true\n            },\n            imports: {\n                exportSorting: 'sorting'\n            },\n            listens: {\n                elems: ''\n            },\n            modules: {\n                source: '${ $.provider }'\n            },\n            pricesInit: {}\n        },\n\n        /**\n         * Sort prices api\n         *\n         * @returns {exports}\n         */\n        sort: function () {\n            return this;\n        },\n\n        /**\n         * Check whether is allowed to render price or not\n         *\n         * @returns {*}\n         */\n        isAllowed: function () {\n            return columnStatusValidator.isValid(this.source(), 'price', 'show_attributes');\n        },\n\n        /**\n         * Retrieve array of prices, that should be rendered for specific product\n         *\n         * @param {Array} row\n         * @return {Array}\n         */\n        getPrices: function (row) {\n            var elems = this.elems() ? this.elems() : ko.getObservable(this, 'elems'),\n                result;\n\n            //we cant take type of product from row\n            this.initPrices(row);\n            result = _.filter(elems, function (elem) {\n                return elem.productType === row.type;\n            });\n\n            return result;\n        },\n\n        /**\n         * Recursive Merging of objects\n         *\n         * @param {Array} target\n         * @param {Array} source\n         * @returns {Array}\n         * @private\n         */\n        _deepObjectExtend: function (target, source) {\n            var _target = utils.copy(target);\n\n            _.each(source, function (value, key) {\n                if (_.keys(value).length && typeof _target[key] !== 'undefined') {\n                    _target[key] = this._deepObjectExtend(_target[key], value);\n                } else {\n                    _target[key] = value;\n                }\n            }, this);\n\n            return _target;\n        },\n\n        /**\n         * Init price type box, in cases when product type has custom component or bodyTmpl\n         *\n         * @param {String} productType\n         * @private\n         */\n        _initPriceWithCustomMetaData: function (productType) {\n            var price = this._deepObjectExtend(\n                this.renders.prices['default'],\n                this.renders.prices[productType]\n            );\n\n            price.name = productType + '.default';\n            price.parent = this.name;\n            price.source = this.source;\n            price.productType = productType;\n            layout([price]);\n        },\n\n        /**\n         * Init Prices by product type and add them to layout\n         *\n         * @param {Array} _priceData\n         * @param {String} productType\n         * @private\n         */\n        _initPricesForProductType: function (_priceData, productType) {\n            var prices = [];\n\n            this._setPriceNamesToPrices(_priceData, productType);\n            _.sortBy(_priceData, this._comparePrices);\n\n            _.each(_priceData, function (priceData) {\n                if (!priceData.component) {\n                    return;\n                }\n\n                priceData.parent = this.name;\n                priceData.provider = this.provider;\n                priceData.productType = productType;\n                priceData = utils.template(priceData, this);\n                prices.push(priceData);\n            }, this);\n\n            layout(prices);\n        },\n\n        /**\n         * Init dynamic price components\n         *\n         * @param {Array} row\n         * @returns {void}\n         */\n        initPrices: function (row) {\n            var _priceData = [],\n                productType = row.type,\n                defaultPrice = this.renders.prices['default'];\n\n            if (this.pricesInit[productType]) {\n                return true;\n            }\n\n            this.pricesInit[productType] = true;\n\n            if (this.renders.prices[productType] && this._needToApplyCustomTemplate(this.renders.prices[productType])) {\n                return this._initPriceWithCustomMetaData(productType);\n            }\n\n            if (this.renders.prices[productType] && this.renders.prices[productType].children) {\n                _priceData = this._deepObjectExtend(defaultPrice.children, this.renders.prices[productType].children);\n            } else {\n                _priceData = defaultPrice.children;\n            }\n\n            return this._initPricesForProductType(_priceData, productType);\n        },\n\n        /**\n         * Set name to all price components\n         *\n         * @param {Array} prices\n         * @param {String} productType\n         * @private\n         */\n        _setPriceNamesToPrices: function (prices, productType) {\n            _.each(prices, function (price, name) {\n                price.priceType = name;\n                price.name = name + '.' + productType;\n            });\n\n            return prices;\n        },\n\n        /**\n         * Sort callback to compare prices by sort order\n         *\n         * @param {Number} firstPrice\n         * @param {Number} secondPrice\n         * @returns {Number}\n         * @private\n         */\n        _comparePrices: function (firstPrice, secondPrice) {\n            if (firstPrice.sortOrder < secondPrice.sortOrder) {\n                return -1;\n            }\n\n            if (firstPrice.sortOrder > secondPrice.sortOrder) {\n                return 1;\n            }\n\n            return 0;\n        },\n\n        /**\n         * Check whether metadata of product type prices was changed, and we should\n         * to apply custom template or custom component\n         *\n         * @param {Array} productData\n         * @returns {*}\n         * @private\n         */\n        _needToApplyCustomTemplate: function (productData) {\n            return productData.bodyTmpl || productData.component;\n        },\n\n        /**\n         * Returns path to the columns' body template.\n         *\n         * @returns {String}\n         */\n        getBody: function () {\n            return this.bodyTmpl;\n        },\n\n        /**\n         * Get price label.\n         *\n         * @returns {String}\n         */\n        getLabel: function () {\n            return this.label;\n        }\n    });\n});\n","Magento_Catalog/js/product/list/columns/image.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'underscore',\n    'Magento_Ui/js/grid/columns/column',\n    'Magento_Catalog/js/product/list/column-status-validator'\n], function (_, Element, columnStatusValidator) {\n    'use strict';\n\n    return Element.extend({\n        defaults: {\n            bodyTmpl: 'Magento_Catalog/product/list/columns/image',\n            imageCode: 'default',\n            image: {}\n        },\n\n        /**\n         * Find image by code in scope of images\n         *\n         * @param {Object} images\n         * @returns {*|T}\n         */\n        getImage: function (images) {\n            return _.filter(images, function (image) {\n                return this.imageCode === image.code;\n            }, this).pop();\n        },\n\n        /**\n         * Get image path.\n         *\n         * @param {Object} row\n         * @return {String}\n         */\n        getImageUrl: function (row) {\n            return this.getImage(row.images).url;\n        },\n\n        /**\n         * Get image box width.\n         *\n         * @param {Object} row\n         * @return {Number}\n         */\n        getWidth: function (row) {\n            return this.getImage(row.images).width;\n        },\n\n        /**\n         * Get image box height.\n         *\n         * @param {Object} row\n         * @return {Number}\n         */\n        getHeight: function (row) {\n            return this.getImage(row.images).height;\n        },\n\n        /**\n         * Get resized image width.\n         *\n         * @param {Object} row\n         * @return {Number}\n         */\n        getResizedImageWidth: function (row) {\n            return this.getImage(row.images)['resized_width'];\n        },\n\n        /**\n         * Get resized image height.\n         *\n         * @param {Object} row\n         * @return {Number}\n         */\n        getResizedImageHeight: function (row) {\n            return this.getImage(row.images)['resized_height'];\n        },\n\n        /**\n         * Get image alt text.\n         *\n         * @param {Object} row\n         * @return {String}\n         */\n        getLabel: function (row) {\n            if (!this.imageExists(row)) {\n                return this._super();\n            }\n\n            return this.getImage(row.images).label;\n        },\n\n        /**\n         * Check if image exist.\n         *\n         * @param {Object} row\n         * @return {Boolean}\n         */\n        imageExists: function (row) {\n            return this.getImage(row.images) !== 'undefined';\n        },\n\n        /**\n         * Check if component must be shown.\n         *\n         * @return {Boolean}\n         */\n        isAllowed: function () {\n            return columnStatusValidator.isValid(this.source(), 'image', 'show_attributes');\n        }\n    });\n});\n","Magento_Catalog/js/product/storage/ids-storage.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'underscore',\n    'ko',\n    'mageUtils',\n    'jquery/jquery-storageapi'\n], function ($, _, ko, utils) {\n    'use strict';\n\n    /**\n     * Set data to localStorage with support check.\n     *\n     * @param {String} namespace\n     * @param {Object} data\n     */\n    function setLocalStorageItem(namespace, data) {\n        try {\n            window.localStorage.setItem(namespace, JSON.stringify(data));\n        } catch (e) {\n            console.warn('localStorage is unavailable - skipping local caching of product data');\n            console.error(e);\n        }\n    }\n\n    return {\n\n        /**\n         * Class name\n         */\n        name: 'IdsStorage',\n\n        /**\n         * Initializes class\n         *\n         * @return Chainable.\n         */\n        initialize: function () {\n            if (!this.data) {\n                this.data = ko.observable({});\n            }\n\n            this.initCustomerDataReloadListener()\n                .initLocalStorage()\n                .cachesDataFromLocalStorage()\n                .initDataListener();\n\n            return this;\n        },\n\n        /**\n         * Gets data from local storage by current namespace\n         *\n         * @return {Object}.\n         */\n        getDataFromLocalStorage: function () {\n            return this.localStorage.get();\n        },\n\n        /**\n         * Caches data from local storage to local scope\n         *\n         * @return Chainable.\n         */\n        cachesDataFromLocalStorage: function () {\n            this.data(this.getDataFromLocalStorage());\n\n            return this;\n        },\n\n        /**\n         * Initialize localStorage\n         *\n         * @return Chainable.\n         */\n        initLocalStorage: function () {\n            this.localStorage = $.initNamespaceStorage(this.namespace).localStorage;\n\n            return this;\n        },\n\n        /**\n         * Initializes listener to \"data\" property\n         */\n        initDataListener: function () {\n            this.data.subscribe(this.internalDataHandler.bind(this));\n        },\n\n        /**\n         * Initialize listener to customer data reload\n         *\n         * @return Chainable.\n         */\n        initCustomerDataReloadListener: function () {\n            $(document).on('customer-data-reload', function (event, sections) {\n                if ((_.isEmpty(sections) || _.contains(sections, this.namespace)) && ~~this.allowToSendRequest) {\n                    this.localStorage.removeAll();\n                    this.data();\n                }\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Initializes handler to \"data\" property update\n         */\n        internalDataHandler: function (data) {\n            setLocalStorageItem(this.namespace, data);\n        },\n\n        /**\n         * Initializes handler to storage update\n         */\n        externalDataHandler: function (data) {\n            data = data.items ? data.items : data;\n\n            this.set(_.extend(utils.copy(this.data()), data));\n        }\n    };\n});\n\n","Magento_Catalog/js/product/storage/data-storage.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'underscore',\n    'ko',\n    'mageUtils',\n    'Magento_Catalog/js/product/query-builder',\n    'Magento_Customer/js/customer-data',\n    'jquery/jquery-storageapi'\n], function ($, _, ko, utils, queryBuilder, customerData) {\n    'use strict';\n\n    /**\n     * Process data from API request\n     *\n     * @param {Object} data\n     * @returns {Object}\n     */\n    function getParsedDataFromServer(data) {\n        var result = {};\n\n        _.each(data.items, function (item) {\n                if (item.id) {\n                    result[item.id] = item;\n                }\n            }\n        );\n\n        return {\n            items: result\n        };\n    }\n\n    /**\n     * Set data to localStorage with support check.\n     *\n     * @param {String} namespace\n     * @param {Object} data\n     */\n    function setLocalStorageItem(namespace, data) {\n        try {\n            window.localStorage.setItem(namespace, JSON.stringify(data));\n        } catch (e) {\n            console.warn('localStorage is unavailable - skipping local caching of product data');\n            console.error(e);\n        }\n    }\n\n    return {\n\n        /**\n         * Class name\n         */\n        name: 'DataStorage',\n        request: {},\n        customerDataProvider: 'product_data_storage',\n\n        /**\n         * Initialize class\n         *\n         * @return Chainable.\n         */\n        initialize: function () {\n            if (!this.data) {\n                this.data = ko.observable({});\n            }\n\n            this.initLocalStorage()\n                .initCustomerDataReloadListener()\n                .cachesDataFromLocalStorage()\n                .initDataListener()\n                .initProvideStorage()\n                .initProviderListener();\n\n            return this;\n        },\n\n        /**\n         * Initialize listener to customer data reload\n         *\n         * @return Chainable.\n         */\n        initCustomerDataReloadListener: function () {\n            $(document).on('customer-data-invalidate', this._flushProductStorage.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Flush product storage\n         *\n         * @private\n         * @return void\n         */\n        _flushProductStorage: function (event, sections) {\n            if (_.isEmpty(sections) || _.contains(sections, 'product_data_storage')) {\n                this.localStorage.removeAll();\n            }\n        },\n\n        /**\n         * Initialize listener to data property\n         *\n         * @return Chainable.\n         */\n        initDataListener: function () {\n            this.data.subscribe(this.dataHandler.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Initialize provider storage\n         *\n         * @return Chainable.\n         */\n        initProvideStorage: function () {\n            this.providerHandler(customerData.get(this.customerDataProvider)());\n\n            return this;\n        },\n\n        /**\n         * Handler to update \"data\" property.\n         * Sets data to localStorage\n         *\n         * @param {Object} data\n         */\n        dataHandler: function (data) {\n            if (_.isEmpty(data)) {\n                this.localStorage.removeAll();\n            } else {\n                setLocalStorageItem(this.namespace, data);\n            }\n        },\n\n        /**\n         * Handler to update data in provider.\n         *\n         * @param {Object} data\n         */\n        providerHandler: function (data) {\n            var currentData = utils.copy(this.data()),\n                ids = _.keys(data.items);\n\n            if (data.items && ids.length) {\n                //we can extend only items\n                data = data.items;\n                this.data(_.extend(currentData, data));\n            }\n        },\n\n        /**\n         * Sets data ids\n         *\n         * @param {String} currency\n         * @param {String} store\n         * @param {Object} ids\n         */\n        setIds: function (currency, store, ids) {\n            if (!this.hasInCache(currency, store, ids)) {\n                this.loadDataFromServer(currency, store, ids);\n            } else {\n                this.data.valueHasMutated();\n            }\n        },\n\n        /**\n         * Gets data from \"data\" property by identifiers\n         *\n         * @param {String} currency\n         * @param {String} store\n         * @param {Object} productIdentifiers\n         *\n         * @return {Object} data.\n         */\n        getDataByIdentifiers: function (currency, store, productIdentifiers) {\n            var data = {},\n                dataCollection = this.data(),\n                id;\n\n            for (id in productIdentifiers) {\n                if (productIdentifiers.hasOwnProperty(id)) {\n                    data[id] = dataCollection[id];\n                }\n            }\n\n            return data;\n        },\n\n        /**\n         * Checks has cached data or not\n         *\n         * @param {String} currency\n         * @param {String} store\n         * @param {Object} ids\n         *\n         * @return {Boolean}\n         */\n        hasInCache: function (currency, store, ids) {\n            var data = this.data(),\n                id;\n\n            for (id in ids) {\n                if (!data.hasOwnProperty(id) ||\n                    data[id]['currency_code'] !== currency ||\n                    ~~data[id]['store_id'] !== ~~store\n                ) {\n                    return false;\n                }\n            }\n\n            return true;\n        },\n\n        /**\n         * Load data from server by ids\n         *\n         * @param {String} currency\n         * @param {String} store\n         * @param {Object} ids\n         *\n         * @return void\n         */\n        loadDataFromServer: function (currency, store, ids) {\n            var idsArray = _.keys(ids),\n                prepareAjaxParams = {\n                    'entity_id': idsArray.join(',')\n                };\n\n            if (this.request.sent && this.hasIdsInSentRequest(ids)) {\n                return;\n            }\n\n            this.request = {\n                sent: true,\n                data: ids\n            };\n\n            this.updateRequestConfig.data = queryBuilder.buildQuery(prepareAjaxParams);\n            this.updateRequestConfig.data['store_id'] = store;\n            this.updateRequestConfig.data['currency_code'] = currency;\n            $.ajax(this.updateRequestConfig).done(function (data) {\n                this.request = {};\n                this.providerHandler(getParsedDataFromServer(data));\n            }.bind(this));\n        },\n\n        /**\n         * Each product page consist product cache data,\n         * this function prepare those data to appropriate view, and save it\n         *\n         * @param {Object} data\n         */\n        addDataFromPageCache: function (data) {\n            this.providerHandler(getParsedDataFromServer(data));\n        },\n\n        /**\n         * @param {Object} ids\n         * @returns {Boolean}\n         */\n        hasIdsInSentRequest: function (ids) {\n            var sentDataIds,\n                currentDataIds;\n\n            if (this.request.data) {\n                sentDataIds = _.keys(this.request.data);\n                currentDataIds = _.keys(ids);\n\n                return _.every(currentDataIds, function (id) {\n                    return _.lastIndexOf(sentDataIds, id) !== -1;\n                });\n            }\n\n            return false;\n        },\n\n        /**\n         * Initialize provider listener\n         *\n         * @return Chainable.\n         */\n        initProviderListener: function () {\n            customerData.get(this.customerDataProvider).subscribe(this.providerHandler.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Caches data from local storage to local scope\n         *\n         * @return Chainable.\n         */\n        cachesDataFromLocalStorage: function () {\n            this.data(this.getDataFromLocalStorage());\n\n            return this;\n        },\n\n        /**\n         * Gets data from local storage by current namespace\n         *\n         * @return {Object}.\n         */\n        getDataFromLocalStorage: function () {\n            return this.localStorage.get();\n        },\n\n        /**\n         * Initialize localStorage\n         *\n         * @return Chainable.\n         */\n        initLocalStorage: function () {\n            this.localStorage = $.initNamespaceStorage(this.namespace).localStorage;\n\n            return this;\n        }\n    };\n});\n","Magento_Catalog/js/product/storage/storage-service.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery',\n    'underscore',\n    'mageUtils',\n    'mage/translate',\n    'Magento_Catalog/js/product/storage/ids-storage',\n    'Magento_Catalog/js/product/storage/data-storage',\n    'Magento_Catalog/js/product/storage/ids-storage-compare'\n], function ($, _, utils, $t, IdsStorage, DataStore, IdsStorageCompare) {\n    'use strict';\n\n    return (function () {\n\n        var /**\n             * {Object} storages - list of storages\n             */\n            storages = {},\n\n            /**\n             * {Object} classes - list of classes\n             */\n            classes = {},\n\n            /**\n             * {Object} prototype - methods that will be added to all storage classes to prototype property.\n             */\n            prototype = {\n\n                /**\n                 * Sets data to storage\n                 *\n                 * @param {*} data\n                 */\n                set: function (data) {\n                    if (!utils.compare(data, this.data()).equal) {\n                        this.data(data);\n                    }\n                },\n\n                /**\n                 * Adds some data to current storage data\n                 *\n                 * @param {*} data\n                 */\n                add: function (data) {\n                    if (!_.isEmpty(data)) {\n                        this.data(_.extend(utils.copy(this.data()), data));\n                    }\n                },\n\n                /**\n                 * Gets current storage data\n                 *\n                 * @returns {*} data\n                 */\n                get: function () {\n                    return this.data();\n                }\n            },\n\n            /**\n             * Required properties to storage\n             */\n            storagesInterface =  {\n                data: 'function',\n                initialize: 'function',\n                namespace: 'string'\n            },\n\n            /**\n             * Private service methods\n             */\n            _private = {\n\n                /**\n                 * Overrides class method and add ability use _super to call parent method\n                 *\n                 * @param {Object} extensionMethods\n                 * @param {Object} originInstance\n                 */\n                overrideClassMethods: function (extensionMethods, originInstance) {\n                    var methodsName = _.keys(extensionMethods),\n                        i = 0,\n                        length = methodsName.length;\n\n                    for (i; i < length; i++) {\n                        if (_.isFunction(originInstance[methodsName[i]])) {\n                            originInstance[methodsName[i]] = extensionMethods[methodsName[i]];\n                        }\n                    }\n\n                    return originInstance;\n                },\n\n                /**\n                 * Checks is storage implement interface\n                 *\n                 * @param {Object} classInstance\n                 *\n                 * @returns {Boolean}\n                 */\n                isImplementInterface: function (classInstance) {\n                    _.each(storagesInterface, function (key, value) {\n                        if (typeof classInstance[key] !== value) {\n                            return false;\n                        }\n                    });\n\n                    return true;\n                }\n            },\n\n            /**\n             * Subscribers list\n             */\n            subscribers = {};\n\n        (function () {\n            /**\n             * @param {Object} config\n             * @return void\n             */\n            classes[IdsStorage.name] = function (config) {\n                _.extend(this, IdsStorage, config);\n            };\n\n            /**\n             * @param {Object} config\n             * @return void\n             */\n            classes[IdsStorageCompare.name] = function (config) {\n                _.extend(this, IdsStorageCompare, config);\n            };\n\n            /**\n             * @param {Object} config\n             * @return void\n             */\n            classes[DataStore.name] = function (config) {\n                _.extend(this, DataStore, config);\n            };\n\n            _.each(classes, function (classItem) {\n                classItem.prototype = prototype;\n            });\n        })();\n\n        return {\n\n            /**\n             * Creates new storage or returns if storage with declared namespace exist\n             *\n             * @param {Object} config - storage config\n             * @throws {Error}\n             * @returns {Object} storage instance\n             */\n            createStorage: function (config) {\n                var instance,\n                    initialized;\n\n                if (storages[config.namespace]) {\n                    return storages[config.namespace];\n                }\n\n                instance = new classes[config.className](config);\n\n                if (_private.isImplementInterface(instance)) {\n                    initialized = storages[config.namespace] = instance.initialize();\n                    this.processSubscribers(initialized, config);\n\n                    return initialized;\n                }\n\n                throw new Error('Class ' + config.className + $t('does not implement Storage Interface'));\n            },\n\n            /**\n             * Process subscribers\n             *\n             * Differentiate subscribers by their namespaces: recently_viewed or recently_compared\n             * and process callbacks. Callbacks can be add through onStorageInit function\n             *\n             * @param {Object} initialized\n             * @param {Object} config\n             * @return void\n             */\n            processSubscribers: function (initialized, config) {\n                if (subscribers[config.namespace]) {\n                    _.each(subscribers[config.namespace], function (callback) {\n                        callback(initialized);\n                    });\n\n                    delete subscribers[config.namespace];\n                }\n            },\n\n            /**\n             * Listens storage creating by namespace\n             *\n             * @param {String} namespace\n             * @param {Function} callback\n             * @return void\n             */\n            onStorageInit: function (namespace, callback) {\n                if (storages[namespace]) {\n                    callback(storages[namespace]);\n                } else {\n                    subscribers[namespace] ?\n                        subscribers[namespace].push(callback) :\n                        subscribers[namespace] = [callback];\n                }\n            },\n\n            /**\n             * Gets storage by namespace\n             *\n             * @param {String} namespace\n             *\n             * @returns {Object} storage insance\n             */\n            getStorage: function (namespace) {\n                return storages[namespace];\n            }\n        };\n    })();\n});\n\n","Magento_Catalog/js/product/storage/ids-storage-compare.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore',\n    'ko',\n    'mageUtils',\n    'Magento_Customer/js/customer-data',\n    'Magento_Catalog/js/product/storage/ids-storage'\n], function (_, ko, utils, customerData, idsStorage) {\n    'use strict';\n\n    return _.extend(utils.copy(idsStorage), {\n\n        /**\n         * Class name\n         */\n        name: 'IdsStorageCompare',\n\n        /**\n         * Initializes class\n         *\n         * @return Chainable.\n         */\n        initialize: function () {\n            if (!this.data) {\n                this.data = ko.observable({});\n            }\n\n            if (this.provider && window.checkout && window.checkout.baseUrl) {\n                this.providerDataHandler(customerData.get(this.provider)());\n                this.initProviderListener();\n            }\n\n            this.initLocalStorage()\n                .cachesDataFromLocalStorage()\n                .initDataListener();\n\n            return this;\n        },\n\n        /**\n         * Initializes listener for external data provider\n         */\n        initProviderListener: function () {\n            customerData.get(this.provider).subscribe(this.providerDataHandler.bind(this));\n        },\n\n        /**\n         * Initializes handler for external data provider update\n         *\n         * @param {Object} data\n         */\n        providerDataHandler: function (data) {\n            data = data.items || data;\n            data = this.prepareData(data);\n\n            this.add(data);\n        },\n\n        /**\n         * Prepares data to correct interface\n         *\n         * @param {Object} data\n         *\n         * @returns {Object} data\n         */\n        prepareData: function (data) {\n            var result = {},\n                scopeId;\n\n            _.each(data, function (item) {\n                if (typeof item.productScope !== 'undefined') {\n                    scopeId = item.productScope === 'store' ? window.checkout.storeId :\n                        item.productScope === 'group' ? window.checkout.storeGroupId :\n                            window.checkout.websiteId;\n\n                    result[item.productScope + '-' + scopeId + '-' + item.id] = {\n                        'added_at': new Date().getTime() / 1000,\n                        'product_id': item.id,\n                        'scope_id': scopeId\n                    };\n                } else {\n                    result[item.id] = {\n                        'added_at': new Date().getTime() / 1000,\n                        'product_id': item.id\n                    };\n                }\n            });\n\n            return result;\n        }\n    });\n});\n","Magento_Catalog/js/product/view/product-info.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'ko'\n], function (ko) {\n    'use strict';\n\n    return ko.observableArray([]);\n});\n","Magento_Catalog/js/product/view/provider.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore',\n    'uiElement',\n    'Magento_Catalog/js/product/storage/storage-service'\n], function (_, Element, storage) {\n    'use strict';\n\n    return Element.extend({\n        defaults: {\n            identifiersConfig: {\n                namespace: 'recently_viewed_product'\n            },\n            productStorageConfig: {\n                namespace: 'product_data_storage',\n                updateRequestConfig: {\n                    method: 'GET',\n                    dataType: 'json'\n                },\n                className: 'DataStorage'\n            }\n        },\n\n        /**\n         * Initializes\n         *\n         * @returns {Object} Chainable.\n         */\n        initialize: function () {\n            this._super();\n\n            if (window.checkout && window.checkout.baseUrl) {\n                this.initIdsStorage();\n            }\n\n            this.initDataStorage();\n\n            return this;\n        },\n\n        /**\n         * Init ids storage\n         *\n         * @returns {Object} Chainable.\n         */\n        initIdsStorage: function () {\n            storage.onStorageInit(this.identifiersConfig.namespace, this.idsStorageHandler.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Init data storage\n         *\n         * @returns {Object} Chainable.\n         */\n        initDataStorage: function () {\n            storage.onStorageInit(this.productStorageConfig.namespace, this.dataStorageHandler.bind(this));\n\n            return this;\n        },\n\n        /**\n         * Init data storage handler\n         *\n         * @param {Object} dataStorage - storage instance\n         */\n        dataStorageHandler: function (dataStorage) {\n            this.productStorage = dataStorage;\n            this.productStorage.add(this.data.items);\n        },\n\n        /**\n         * Init ids storage handler\n         *\n         * @param {Object} idsStorage - storage instance\n         */\n        idsStorageHandler: function (idsStorage) {\n            this.idsStorage = idsStorage;\n            this.idsStorage.add(this.getIdentifiers());\n        },\n\n        /**\n         * Gets ids from items\n         *\n         * @returns {Object}\n         */\n        getIdentifiers: function () {\n            var result = {},\n                productCurrentScope = this.data.productCurrentScope,\n                scopeId = productCurrentScope === 'store' ? window.checkout.storeId :\n                    productCurrentScope === 'group' ? window.checkout.storeGroupId :\n                        window.checkout.websiteId;\n\n            _.each(this.data.items, function (item, key) {\n                result[productCurrentScope + '-' + scopeId + '-' + key] = {\n                    'added_at': new Date().getTime() / 1000,\n                    'product_id': key,\n                    'scope_id': scopeId\n                };\n            }, this);\n\n            return result;\n        }\n    });\n});\n","Magento_Catalog/js/product/view/product-ids-resolver.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore',\n    'Magento_Catalog/js/product/view/product-ids'\n], function (_, productIds) {\n    'use strict';\n\n    /**\n     * Returns id's of products in form.\n     *\n     * @param {jQuery} $form\n     * @return {Array}\n     */\n    return function ($form) {\n        var idSet = productIds(),\n            product = _.findWhere($form.serializeArray(), {\n            name: 'product'\n        });\n\n        if (!_.isUndefined(product)) {\n            idSet.push(product.value);\n        }\n\n        return _.uniq(idSet);\n    };\n});\n","Magento_Catalog/js/product/view/product-info-resolver.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'underscore',\n    'Magento_Catalog/js/product/view/product-info'\n], function (_, productInfo) {\n    'use strict';\n\n    /**\n     * Returns info about products in form.\n     *\n     * @param {jQuery} $form\n     * @return {Array}\n     */\n    return function ($form) {\n        var product = _.findWhere($form.serializeArray(), {\n                name: 'product'\n            });\n\n        if (!_.isUndefined(product)) {\n            productInfo().push(\n                {\n                    'id': product.value\n                }\n            );\n        }\n\n        return _.uniq(productInfo(), function (item) {\n            return item.id;\n        });\n    };\n});\n\n","Magento_Catalog/js/product/view/product-ids.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'ko'\n], function (ko) {\n    'use strict';\n\n    return ko.observableArray([]);\n});\n","Magento_Catalog/product/view/validation.js":"/**\n * Copyright \u00a9 Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\ndefine([\n    'jquery',\n    'jquery-ui-modules/widget',\n    'mage/validation/validation'\n], function ($) {\n    'use strict';\n\n    $.widget('mage.validation', $.mage.validation, {\n        options: {\n            radioCheckboxClosest: 'ul, ol'\n        },\n\n        /**\n         * @param {*} error\n         * @param {HTMLElement} element\n         */\n        errorPlacement: function (error, element) {\n            var messageBox,\n                dataValidate;\n\n            if ($(element).hasClass('datetime-picker')) {\n                element = $(element).parent();\n\n                if (element.parent().find('.mage-error').length) {\n                    return;\n                }\n            }\n\n            if (element.attr('data-errors-message-box')) {\n                messageBox = $(element.attr('data-errors-message-box'));\n                messageBox.html(error);\n\n                return;\n            }\n\n            dataValidate = element.attr('data-validate');\n\n            if (dataValidate && dataValidate.indexOf('validate-one-checkbox-required-by-name') > 0) {\n                error.appendTo('#links-advice-container');\n            } else if (element.is(':radio, :checkbox')) {\n                element.closest(this.radioCheckboxClosest).after(error);\n            } else {\n                element.after(error);\n            }\n        },\n\n        /**\n         * @param {HTMLElement} element\n         * @param {String} errorClass\n         */\n        highlight: function (element, errorClass) {\n            var dataValidate = $(element).attr('data-validate');\n\n            if (dataValidate && dataValidate.indexOf('validate-required-datetime') > 0) {\n                $(element).parent().find('.datetime-picker').each(function () {\n                    $(this).removeClass(errorClass);\n\n                    if ($(this).val().length === 0) {\n                        $(this).addClass(errorClass);\n                    }\n                });\n            } else if ($(element).is(':radio, :checkbox')) {\n                $(element).closest(this.radioCheckboxClosest).addClass(errorClass);\n            } else {\n                $(element).addClass(errorClass);\n            }\n        },\n\n        /**\n         * @param {HTMLElement} element\n         * @param {String} errorClass\n         */\n        unhighlight: function (element, errorClass) {\n            var dataValidate = $(element).attr('data-validate');\n\n            if (dataValidate && dataValidate.indexOf('validate-required-datetime') > 0) {\n                $(element).parent().find('.datetime-picker').removeClass(errorClass);\n            } else if ($(element).is(':radio, :checkbox')) {\n                $(element).closest(this.radioCheckboxClosest).removeClass(errorClass);\n            } else {\n                $(element).removeClass(errorClass);\n            }\n        }\n    });\n\n    return $.mage.validation;\n});\n","knockoutjs/knockout-repeat.js":"// REPEAT binding for Knockout http://knockoutjs.com/\n// (c) Michael Best\n// License: MIT (http://www.opensource.org/licenses/mit-license.php)\n// Version 2.1.0\n\n(function(factory) {\n    if (typeof define === 'function' && define.amd) {\n        // [1] AMD anonymous module\n        define(['knockout'], factory);\n    } else if (typeof exports === 'object') {\n        // [2] commonJS\n        factory(require('knockout'));\n    } else {\n        // [3] No module loader (plain <script> tag) - put directly in global namespace\n        factory(window.ko);\n    }\n})(function(ko) {\n\nif (!ko.virtualElements)\n    throw Error('Repeat requires at least Knockout 2.1');\n\nvar ko_bindingFlags = ko.bindingFlags || {};\nvar ko_unwrap = ko.utils.unwrapObservable;\n\nvar koProtoName = '__ko_proto__';\n\nif (ko.version >= \"3.0.0\") {\n    // In Knockout 3.0.0, use the node preprocessor to replace a node with a repeat binding with a virtual element\n    var provider = ko.bindingProvider.instance, previousPreprocessFn = provider.preprocessNode;\n    provider.preprocessNode = function(node) {\n        var newNodes, nodeBinding;\n        if (!previousPreprocessFn || !(newNodes = previousPreprocessFn.call(this, node))) {\n            if (node.nodeType === 1 && (nodeBinding = node.getAttribute('data-bind'))) {\n                if (/^\\s*repeat\\s*:/.test(nodeBinding)) {\n                    var leadingComment = node.ownerDocument.createComment('ko ' + nodeBinding),\n                        trailingComment = node.ownerDocument.createComment('/ko');\n                    node.parentNode.insertBefore(leadingComment, node);\n                    node.parentNode.insertBefore(trailingComment, node.nextSibling);\n                    node.removeAttribute('data-bind');\n                    newNodes = [leadingComment, node, trailingComment];\n                }\n            }\n        }\n        return newNodes;\n    };\n}\n\nko.virtualElements.allowedBindings.repeat = true;\nko.bindingHandlers.repeat = {\n    flags: ko_bindingFlags.contentBind | ko_bindingFlags.canUseVirtual,\n    init: function(element, valueAccessor, allBindingsAccessor, xxx, bindingContext) {\n\n        // Read and set fixed options--these options cannot be changed\n        var repeatParam = ko_unwrap(valueAccessor());\n        if (repeatParam && typeof repeatParam == 'object' && !('length' in repeatParam)) {\n            var repeatIndex = repeatParam.index,\n                repeatData = repeatParam.item,\n                repeatStep = repeatParam.step,\n                repeatReversed = repeatParam.reverse,\n                repeatBind = repeatParam.bind,\n                repeatInit = repeatParam.init,\n                repeatUpdate = repeatParam.update;\n        }\n        // Set default values for options that need it\n        repeatIndex = repeatIndex || '$index';\n        repeatData = repeatData || ko.bindingHandlers.repeat.itemName || '$item';\n        repeatStep = repeatStep || 1;\n        repeatReversed = repeatReversed || false;\n\n        var parent = element.parentNode, placeholder;\n        if (element.nodeType == 8) {    // virtual element\n            // Extract the \"children\" and find the single element node\n            var childNodes = ko.utils.arrayFilter(ko.virtualElements.childNodes(element), function(node) { return node.nodeType == 1;});\n            if (childNodes.length !== 1) {\n                throw Error(\"Repeat binding requires a single element to repeat\");\n            }\n            ko.virtualElements.emptyNode(element);\n\n            // The placeholder is the closing comment normally, or the opening comment if reversed\n            placeholder = repeatReversed ? element : element.nextSibling;\n            // The element to repeat is the contained element\n            element = childNodes[0];\n        } else {    // regular element\n            // First clean the element node and remove node's binding\n            var origBindString = element.getAttribute('data-bind');\n            ko.cleanNode(element);\n            element.removeAttribute('data-bind');\n\n            // Original element is no longer needed: delete it and create a placeholder comment\n            placeholder = element.ownerDocument.createComment('ko_repeatplaceholder ' + origBindString);\n            parent.replaceChild(placeholder, element);\n        }\n\n        // extract and remove a data-repeat-bind attribute, if present\n        if (!repeatBind) {\n            repeatBind = element.getAttribute('data-repeat-bind');\n            if (repeatBind) {\n                element.removeAttribute('data-repeat-bind');\n            }\n        }\n\n        // Make a copy of the element node to be copied for each repetition\n        var cleanNode = element.cloneNode(true);\n        if (typeof repeatBind == \"string\") {\n            cleanNode.setAttribute('data-bind', repeatBind);\n            repeatBind = null;\n        }\n\n        // Set up persistent data\n        var lastRepeatCount = 0,\n            notificationObservable = ko.observable(),\n            repeatArray, arrayObservable;\n\n        if (repeatInit) {\n            repeatInit(parent);\n        }\n\n        var subscribable = ko.computed(function() {\n            function makeArrayItemAccessor(index) {\n                var f = function(newValue) {\n                    var item = repeatArray[index];\n                    // Reading the value of the item\n                    if (!arguments.length) {\n                        notificationObservable();   // for dependency tracking\n                        return ko_unwrap(item);\n                    }\n                    // Writing a value to the item\n                    if (ko.isObservable(item)) {\n                        item(newValue);\n                    } else if (arrayObservable && arrayObservable.splice) {\n                        arrayObservable.splice(index, 1, newValue);\n                    } else {\n                        repeatArray[index] = newValue;\n                    }\n                    return this;\n                };\n                // Pretend that our accessor function is an observable\n                f[koProtoName] = ko.observable;\n                return f;\n            }\n\n            function makeBinding(item, index, context) {\n                return repeatArray\n                    ? function() { return repeatBind.call(bindingContext.$data, item, index, context); }\n                    : function() { return repeatBind.call(bindingContext.$data, index, context); }\n            }\n\n            // Read and set up variable options--these options can change and will update the binding\n            var paramObservable = valueAccessor(), repeatParam = ko_unwrap(paramObservable), repeatCount = 0;\n            if (repeatParam && typeof repeatParam == 'object') {\n                if ('length' in repeatParam) {\n                    repeatArray = repeatParam;\n                    repeatCount = repeatArray.length;\n                } else {\n                    if ('foreach' in repeatParam) {\n                        repeatArray = ko_unwrap(paramObservable = repeatParam.foreach);\n                        if (repeatArray && typeof repeatArray == 'object' && 'length' in repeatArray) {\n                            repeatCount = repeatArray.length || 0;\n                        } else {\n                            repeatCount = repeatArray || 0;\n                            repeatArray = null;\n                        }\n                    }\n                    // If a count value is provided (>0), always output that number of items\n                    if ('count' in repeatParam)\n                        repeatCount = ko_unwrap(repeatParam.count) || repeatCount;\n                    // If a limit is provided, don't output more than the limit\n                    if ('limit' in repeatParam)\n                        repeatCount = Math.min(repeatCount, ko_unwrap(repeatParam.limit)) || repeatCount;\n                }\n                arrayObservable = repeatArray && ko.isObservable(paramObservable) ? paramObservable : null;\n            } else {\n                repeatCount = repeatParam || 0;\n            }\n\n            // Remove nodes from end if array is shorter\n            for (; lastRepeatCount > repeatCount; lastRepeatCount-=repeatStep) {\n                ko.removeNode(repeatReversed ? placeholder.nextSibling : placeholder.previousSibling);\n            }\n\n            // Notify existing nodes of change\n            notificationObservable.notifySubscribers();\n\n            // Add nodes to end if array is longer (also initially populates nodes)\n            for (; lastRepeatCount < repeatCount; lastRepeatCount+=repeatStep) {\n                // Clone node and add to document\n                var newNode = cleanNode.cloneNode(true);\n                parent.insertBefore(newNode, repeatReversed ? placeholder.nextSibling : placeholder);\n                newNode.setAttribute('data-repeat-index', lastRepeatCount);\n\n                // Apply bindings to inserted node\n                if (repeatArray && repeatData == '$data') {\n                    var newContext = bindingContext.createChildContext(makeArrayItemAccessor(lastRepeatCount));\n                } else {\n                    var newContext = bindingContext.extend();\n                    if (repeatArray)\n                        newContext[repeatData] = makeArrayItemAccessor(lastRepeatCount);\n                }\n                newContext[repeatIndex] = lastRepeatCount;\n                if (repeatBind) {\n                    var result = ko.applyBindingsToNode(newNode, makeBinding(newContext[repeatData], lastRepeatCount, newContext), newContext, true),\n                        shouldBindDescendants = result && result.shouldBindDescendants;\n                }\n                if (!repeatBind || (result && shouldBindDescendants !== false)) {\n                    ko.applyBindings(newContext, newNode);\n                }\n            }\n            if (repeatUpdate) {\n                repeatUpdate(parent);\n            }\n        }, null, {disposeWhenNodeIsRemoved: placeholder});\n\n        return { controlsDescendantBindings: true, subscribable: subscribable };\n    }\n};\n});"}
}});
