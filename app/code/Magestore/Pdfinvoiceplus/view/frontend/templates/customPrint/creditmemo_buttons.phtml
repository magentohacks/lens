<?php

/**
 * Magestore
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magestore.com license that is
 * available through the world-wide-web at this URL:
 * http://www.magestore.com/license-agreement.html
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Magestore
 * @package     Magestore_Pdfinvoiceplus
 * @copyright   Copyright (c) 2012 Magestore (http://www.magestore.com/)
 * @license     http://www.magestore.com/license-agreement.html
 */

/** @var \Magestore\Pdfinvoiceplus\Block\PrintButton\CreditmemoButton $block */
// @codingStandardsIgnoreFile

$_order = $block->getOrder();
/** @var \Magestore\Pdfinvoiceplus\Helper\Data $pdfInvoiceHelper */
$pdfInvoiceHelper = $this->helper('Magestore\Pdfinvoiceplus\Helper\Data');
$isDisableCorePrinting = $pdfInvoiceHelper->isDisableCorePrinting();
$isEnabledPdfInvoice = $pdfInvoiceHelper->canshowCustomPrint($_order->getStoreId());
?>

<style>
    .order-details-items .action.print{
        display: inline;
    }
</style>

<div class="actions-toolbar">
    <?php if(!$isDisableCorePrinting): ?>
    <a href="<?php /* @escapeNotVerified */ echo $block->getPrintAllCreditmemosUrl($_order) ?>"
       onclick="this.target='_blank'"
       class="action print">
        <span><?php /* @escapeNotVerified */ echo __('Print All Refunds') ?></span>
    </a>
    <?php endif?>
</div>
<?php foreach ($_order->getCreditmemosCollection() as $_creditmemo): ?>
    <?php /** @var \Magento\Sales\Model\Order\Creditmemo $_creditmemo */ ?>
    <div class="order-title">
        <strong><?php /* @escapeNotVerified */ echo __('Refund #') ?><?php /* @escapeNotVerified */ echo $_creditmemo->getIncrementId(); ?> </strong>

        <?php if(!$isDisableCorePrinting): ?>
            <a href="<?php /* @escapeNotVerified */ echo $block->getPrintCreditmemoUrl($_creditmemo) ?>"
               onclick="this.target='_blank'"
               class="action print">
                <span><?php /* @escapeNotVerified */ echo __('Print Refund') ?></span>
            </a>
        <?php endif?>

        <?php if($pdfInvoiceHelper->canshowCustomPrint()): ?>
        <!-- Custom PDF print button -->
        <a href="<?php /* @escapeNotVerified */ echo $pdfInvoiceHelper->getCustomPdfPrintCreditmemoUrl($_creditmemo) ?>"
           onclick="this.target='_blank'"
           class="action print">
            <span><?php /* @escapeNotVerified */ echo __('Print Custom PDF Credit Memo') ?></span>
        </a>
        <?php endif ?>
    </div>

    <div class="table-wrapper order-items-creditmemo">
        <table class="data table table-order-items creditmemo" id="my-refund-table-<?php /* @escapeNotVerified */ echo $_creditmemo->getId(); ?>">
            <caption class="table-caption"><?php /* @escapeNotVerified */ echo __('Items Refunded') ?></caption>
            <thead>
            <tr>
                <th class="col name"><?php /* @escapeNotVerified */ echo __('Product Name') ?></th>
                <th class="col sku"><?php /* @escapeNotVerified */ echo __('SKU') ?></th>
                <th class="col price"><?php /* @escapeNotVerified */ echo __('Price') ?></th>
                <th class="col qty"><?php /* @escapeNotVerified */ echo __('Qty') ?></th>
                <th class="col subtotal"><?php /* @escapeNotVerified */ echo __('Subtotal') ?></th>
                <th class="col discount"><?php /* @escapeNotVerified */ echo __('Discount Amount') ?></th>
                <th class="col total"><?php /* @escapeNotVerified */ echo __('Row Total') ?></th>
            </tr>
            </thead>
            <?php $_items = $_creditmemo->getAllItems(); ?>
            <?php $_count = count($_items) ?>
            <?php foreach ($_items as $_item): ?>
                <?php if ($_item->getOrderItem()->getParentItem()) {
                    continue;
                } ?>
                <tbody>
                <?php echo $block->getItemHtml($_item) ?>
                </tbody>
            <?php endforeach; ?>
            <tfoot>
            <?php echo $block->getTotalsHtml($_creditmemo);?>
            </tfoot>
        </table>
    </div>
    <?php echo $block->getCommentsHtml($_creditmemo)?>
<?php endforeach; ?>
